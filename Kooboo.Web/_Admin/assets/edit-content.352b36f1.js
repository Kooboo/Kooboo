var U=(m,k,s)=>new Promise((T,v)=>{var _=h=>{try{b(s.next(h))}catch(S){v(S)}},u=h=>{try{b(s.throw(h))}catch(S){v(S)}},b=h=>h.done?T(h.value):Promise.resolve(h.value).then(_,u);b((s=s.apply(m,k)).next())});import{g as Y,v as ue,w as ce}from"./i18n.97105311.js";import{g as de,d as pe,a as fe,l as me}from"./textContent.49dfc8fa.js";import{g as ve,u as _e}from"./main.52487121.js";import{u as ye,g as he,_ as ge}from"./index.eb337ef3.js";import{G as be}from"./index.232e741a.js";import{_ as xe}from"./index.56d91124.js";import{u as Z}from"./index.f1409b26.js";import{u as ee}from"./use-operation-dialog.6127483f.js";import{_ as Ce}from"./k-table.e9121736.js";import{_ as te}from"./index.9ffc2c80.js";import{E as we}from"./index.c1764395.js";import{E as Ve}from"./index.f3d28a97.js";import{E as oe}from"./index.4b289bae.js";import{bq as Ee,cr as Se,d as q,g as j,i as W,o as E,j as B,w as V,b as F,u as A,f as J,a as M,b6 as R,F as G,G as ne,aH as Q,t as P,az as le,c as z,K as se,h as ae,aW as ke,k as re,J as Oe,cj as Ie,e as Te,x as Fe}from"./url.2e6a77c4.js";import{_ as X}from"./index.cdaadc8a.js";import{E as ie,a as Ne}from"./index.317a7f30.js";import{u as $e}from"./use-save-tip.aeb07244.js";import{_ as je}from"./plugin-vue_export-helper.21dcd24c.js";import{v as Le,b as Ae}from"./style.f835519e.js";import{s as De}from"./confirm.46f27373.js";import{c as Be}from"./index.afee24fe.js";import{E as Je}from"./windi.539ebeab.js";import{E as Me}from"./index.b09a9f00.js";import{E as Ue,a as Ge,b as Pe}from"./index.3fcd2f53.js";function Ke(m,k,s,T){for(var v=-1,_=m==null?0:m.length;++v<_;){var u=m[v];k(T,u,s(u),m)}return T}function Re(m,k,s,T){return Le(m,function(v,_,u){k(T,v,s(v),u)}),T}function ze(m,k){return function(s,T){var v=Ee(s)?Ke:Re,_=k?k():{};return v(s,m,Ae(T),_)}}var qe=Object.prototype,He=qe.hasOwnProperty,Qe=ze(function(m,k,s){He.call(m,s)?m[s].push(k):Se(m,s,[k])}),We=Qe;const Ye={class:"flex items-center"},Xe=q({props:{modelValue:{type:Boolean},current:null},setup(m,{emit:k}){const s=m,{t:T}=Y(),{visible:v,handleClose:_}=ee(s,k),u=j([]),b=j({}),h=j([]),S=j([]);W(()=>s.current,t=>{t.categoryFolder&&x()}),W(()=>s.modelValue,t=>{t&&(S.value=s.current.contents.map(c=>c.id))});function x(){return U(this,null,function*(){const t=yield de({folderId:s.current.categoryFolder.id,pageNr:1,pageSize:99999});N(t.list,t.columns)})}function N(t,c){var $,n;const D={};t.forEach(l=>{D[l.id]=l}),b.value=D;const w=Object.keys((n=($=t[0])==null?void 0:$.textValues)!=null?n:{})[0];if(w){h.value=[w];const l=c.find(o=>o.name==w);u.value=t.map(o=>{let e=o.textValues[w];if(l!=null&&l.selectionOptions)try{const r=JSON.parse(l.selectionOptions);let d=[e];l.controlType=="CheckBox"&&(d=JSON.parse(e));const O=[];for(const I of d){const y=r.find(L=>L.value==I);y?O.push(y.key):O.push(I)}e=O.join(",")}catch(r){}return{id:o.id,[w]:e}})}}function C(){s.current.contents=S.value.map(t=>{const c=b.value[t];return c||null}).filter(t=>t).map((t,c)=>(t.order=c,t)),_()}function f(t){const c=S.value.indexOf(t);c>-1?S.value.splice(c,1):s.current.multipleChoice?S.value.push(t):S.value=[t]}return(t,c)=>{const D=we,w=Ve,$=oe;return E(),B($,{modelValue:A(v),"onUpdate:modelValue":c[0]||(c[0]=n=>ne(v)?v.value=n:null),width:"600px","close-on-click-modal":!1,title:A(T)("common.categories"),"custom-class":"el-dialog--fixed-footer",onClose:A(_)},{footer:V(()=>[F(te,{onConfirm:C,onCancel:A(_)},null,8,["onCancel"])]),default:V(()=>[F(A(Ce),{data:u.value},{default:V(()=>[F(w,{width:"50"},{default:V(n=>[J("div",Ye,[F(D,{size:"large",class:"pl-14px","model-value":S.value.includes(n.row.id),onChange:l=>f(n.row.id)},null,8,["model-value","onChange"])])]),_:1}),(E(!0),M(G,null,R(h.value,n=>(E(),B(w,{key:n,prop:n,label:n},null,8,["prop","label"]))),128))]),_:1},8,["data"])]),_:1},8,["modelValue","title","onClose"])}}}),Ze=q({props:{modelValue:null},emits:["update:modelValue"],setup(m,{emit:k}){const T=Z(m,"modelValue",k),v=j(!1),_=j({});function u(x,N){var c,D;let C=(c=x.summaryField)!=null?c:Object.keys(x.textValues)[0];C=(D=Object.keys(x.textValues).find(w=>w.toLowerCase()==C.toLowerCase()))!=null?D:"";let f=x.textValues[C];const t=N.columns.find(w=>{var $;return(($=w.name)==null?void 0:$.toLowerCase())==(C==null?void 0:C.toLowerCase())});if(t!=null&&t.selectionOptions)try{const w=JSON.parse(t.selectionOptions);let $=[f];t.controlType=="CheckBox"&&($=JSON.parse(f));const n=[];for(const l of $){const o=w.find(e=>e.value==l);o?n.push(o.key):n.push(l)}f=n.join(",")}catch(w){}return f}function b(x,N,C){C.list.splice(C.index,1)}function h(x){_.value=x,v.value=!0}function S(x,N){const C=x.splice(N.oldIndex,1)[0];x.splice(N.newIndex,0,C),x.forEach((f,t)=>{f.order=t})}return(x,N)=>{const C=ie;return E(),M(G,null,[(E(!0),M(G,null,R(A(T),(f,t)=>(E(),B(C,{key:t,label:f.display||f.alias},{default:V(()=>[F(X,{class:"!p-0 min-w-600px",list:f.contents,"id-prop":"id",onSort:c=>S(f.contents,c),onDelete:b,onAdd:c=>h(f)},{default:V(({item:c})=>[Q(P(u(c,f)),1)]),_:2},1032,["list","onSort","onAdd"])]),_:2},1032,["label"]))),128)),(E(),B(le,{to:"body"},[F(Xe,{modelValue:v.value,"onUpdate:modelValue":N[0]||(N[0]=f=>v.value=f),current:_.value},null,8,["modelValue","current"])]))],64)}}});const et={class:"flex items-center gap-8 max-w-700px truncate"},tt=["title"],ot={key:0,class:"el-dialog__title"},nt=q({props:{modelValue:{type:Boolean},current:null,currentContent:null,paths:null},emits:["save-success"],setup(m,{emit:k}){const s=m,T=ft,{t:v}=Y(),{visible:_,handleClose:u}=ee(s,k),b=z(()=>s.current.embeddedFolder.id),h=z(()=>{var t;return(t=s.currentContent)==null?void 0:t.id}),S=j();function x(){return U(this,null,function*(){var c;const t=yield(c=S.value)==null?void 0:c.save();t&&(k("save-success",{id:t.id,textValues:t.values[Object.keys(t.values)[0]]}),u())})}const N=z(()=>{let t=s.paths;return t||(t=[]),t.length&&!t[t.length-1]&&(t.pop(),t.push(v("common.createEmbedded"))),t.length||t.push(v("common.createEmbedded")),t}),C=j();W(()=>_.value,()=>{se(()=>{var t;_.value?(C.value=(t=Array.from(document.querySelectorAll(".el-overlay")).at(-1))==null?void 0:t.style.zIndex,document.body.style.setProperty("--tox-tinymce-aux-index",C.value),document.body.classList.add("editEmbeddedDialog")):document.body.classList.remove("editEmbeddedDialog")})});function f(t){t.stopImmediatePropagation()}return ae(()=>{window.addEventListener("focusout",f,!0)}),ke(()=>{window.removeEventListener("focusout",f)}),(t,c)=>{const D=oe;return E(),B(D,{modelValue:A(_),"onUpdate:modelValue":c[0]||(c[0]=w=>ne(_)?_.value=w:null),width:"800px","close-on-click-modal":!1,"custom-class":"el-dialog--fixed-footer editEmbeddedDialog","destroy-on-close":"",onClose:A(u)},{header:V(()=>[J("div",et,[(E(!0),M(G,null,R(A(N),(w,$)=>(E(),M(G,{key:$},[J("div",{class:"el-dialog__title truncate",title:w},P(w),9,tt),$<A(N).length-1?(E(),M("div",ot,">")):re("",!0)],64))),128))])]),footer:V(()=>[F(te,{onConfirm:x,onCancel:A(u)},null,8,["onCancel"])]),default:V(()=>[F(A(T),{id:A(h),ref_key:"editContent",ref:S,"folder-id":A(b),paths:m.paths},null,8,["id","folder-id","paths"])]),_:1},8,["modelValue","onClose"])}}}),lt={class:"flex items-center"},st={class:"flex-1 truncate"},at=["onClick"],rt={class:"flex gap-8"},it=["onClick"],ut=q({props:{modelValue:null,id:null,paths:null},emits:["update:modelValue"],setup(m,{emit:k}){const s=m,{t:T}=Y(),v=Z(s,"modelValue",k),_=j(!1),u=j({}),b=j(),h=z(()=>{const n=[];for(const o of v.value)if(o.group){var l=n.find(e=>e.some(r=>r.group==o.group));l?l.push(o):n.push([o])}else n.push([o]);return n});function S(n,l){var d,O,I,y;if(!n)return"";let o=(I=(O=n.summaryField)!=null?O:(d=l.columns.find(L=>L.isSummaryField))==null?void 0:d.name)!=null?I:Object.keys(n.textValues)[0];o=(y=Object.keys(n.textValues).find(L=>L.toLowerCase()==o.toLowerCase()))!=null?y:"";var e=n.textValues[o];const r=l.columns.find(L=>{var g;return((g=L.name)==null?void 0:g.toLowerCase())==(o==null?void 0:o.toLowerCase())});if(r!=null&&r.selectionOptions)try{const L=JSON.parse(r.selectionOptions);let g=[e];r.controlType=="CheckBox"&&(g=JSON.parse(e));const p=[];for(const a of g){const i=L.find(H=>H.value==a);i?p.push(i.key):p.push(a)}e=p.join(",")}catch(L){}return e}function x(n,l){const o=l.find(e=>e.contents.indexOf(n)>-1);return S(n,o)}function N(n,l){const o=l.find(e=>e.contents.indexOf(n)>-1);return(o==null?void 0:o.display)||(o==null?void 0:o.alias)}function C(n,l,o){return U(this,null,function*(){yield De(T("common.deleteEmbeddedFolderTips"));const e=o.list.splice(o.index,1);pe({ids:e.map(r=>r.id),parentId:s.id});for(const r of v.value){const d=r.contents.findIndex(O=>{var I;return O.id==((I=e[0])==null?void 0:I.id)});d>-1&&r.contents.splice(d,1)}})}function f(n,l){u.value=n,b.value=l,_.value=!0}function t(n,l){const o=n.find(e=>e.contents.indexOf(l)>-1);return f(o,l)}function c(n){if(b.value)b.value.textValues=n.textValues;else{if(u.value.group){const l=h.value.find(o=>o.some(e=>e.group==u.value.group));if(l){let o=0;for(const e of l)for(const r of e.contents)r.order>o&&(o=r.order);n.order=o+1}}u.value.contents.push(n)}}function D(n,l){const o=n.splice(l.oldIndex,1)[0];n.splice(l.newIndex,0,o),n.forEach((e,r)=>{e.order=r})}function w(n){var o;if(n.some(e=>e.group)){var l=(o=n[0].group)==null?void 0:o.split("##name##")[1];if(l)return l}return n.map(e=>e.display||e.alias).join(",")}function $(n){var l=[];for(const o of n)l.push(...o.contents);return l.sort((o,e)=>o.order>e.order?1:-1)}return(n,l)=>{var L;const o=Be,e=Je,r=Me,d=Ue,O=Ge,I=Pe,y=ie;return E(),M(G,null,[(E(!0),M(G,null,R(A(h),(g,p)=>(E(),B(y,{key:p,label:w(g)},{default:V(()=>[g.some(a=>a.group)&&g.length>1?(E(),B(X,{key:0,class:"!p-0 min-w-600px",list:$(g),"id-prop":"id",onSort:a=>D($(g),a),onDelete:C},{default:V(({item:a})=>[J("div",lt,[J("div",st,P(x(a,g)),1),F(o,{round:"",class:"flex-shrink-0"},{default:V(()=>[Q(P(N(a,g)),1)]),_:2},1024)])]),right:V(({item:a})=>[J("a",{class:"cursor-pointer px-4 hover:text-blue","data-cy":"edit",onClick:i=>t(g,a)},[F(e,{class:"iconfont icon-a-writein"})],8,at)]),bottom:V(()=>[F(I,{trigger:"click",onCommand:a=>f(g.find(i=>i.embeddedFolder==a))},{dropdown:V(()=>[F(O,null,{default:V(()=>[(E(!0),M(G,null,R(g,a=>(E(),B(d,{key:a.embeddedFolder,command:a.embeddedFolder},{default:V(()=>[J("div",rt,[J("span",null,P(A(T)("common.create")),1),F(o,{round:"",type:"info"},{default:V(()=>[Q(P(a.display||a.alias),1)]),_:2},1024)])]),_:2},1032,["command"]))),128))]),_:2},1024)]),default:V(()=>[F(r,{circle:"","data-cy":"add"},{default:V(()=>[F(e,{class:"text-blue iconfont icon-a-addto"})]),_:1})]),_:2},1032,["onCommand"])]),_:2},1032,["list","onSort"])):(E(),B(X,{key:1,class:"!p-0 min-w-600px",list:g[0].contents,"id-prop":"id",onSort:a=>D(g[0].contents,a),onDelete:C,onAdd:a=>f(g[0])},{default:V(({item:a})=>[Q(P(S(a,g[0])),1)]),right:V(({item:a})=>[J("a",{class:"cursor-pointer px-4 hover:text-blue","data-cy":"edit",onClick:i=>f(g[0],a)},[F(e,{class:"iconfont icon-a-writein"})],8,it)]),_:2},1032,["list","onSort","onAdd"]))]),_:2},1032,["label"]))),128)),(E(),B(le,{to:"body"},[F(nt,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=g=>_.value=g),current:u.value,"current-content":b.value,paths:[...(L=m.paths)!=null?L:[],S(b.value,u.value)],onSaveSuccess:c},null,8,["modelValue","current","current-content","paths"])]))],64)}}});const ct={class:"edit-data"},dt={class:"flex justify-end mb-8"},pt=q({props:{folderId:null,contentType:null,id:null,paths:null,associated:{type:Boolean}},setup(m,{expose:k}){const s=m,{t:T}=Y(),v=j(),_=j([]),u=j([]),b=j([]),h=j({}),S=j({}),x=ve(),N=j(!1),C=$e(),f=_e();ae(()=>U(this,null,function*(){yield c(),s.associated||C.init([h.value,u.value,b.value])}));const t=z(()=>x.visible&&Object.keys(x.cultures).length>1);Oe(()=>{f.firstActiveMenu=""});function c(){return U(this,null,function*(){N.value=!0;const e=yield fe({id:s.id,folderId:s.folderId,typeId:s.contentType});N.value=!1,w(e.properties),u.value=e.categories||[],b.value=e.embedded||[]})}Ie((e,r,d)=>U(this,null,function*(){var O;if(s.associated)return d();e.name==="login"?d():(f.firstActiveMenu=(O=e.meta.activeMenu)!=null?O:e.name,yield C.check([h.value,u.value,b.value]).then(()=>{d()}).catch(()=>{f.firstActiveMenu="contents",d(!1)}))}));const{getControlType:D}=ye();function w(e){if(!e||e.length===0)return;const r=x.default,d=[],O={},I={};e.forEach(y=>{Object.keys(y.values).sort((p,a)=>p===r?-1:a===r?1:0).map(p=>({lang:p,value:y.values[p]})).forEach(p=>{var H;const a={lang:p.lang,name:y.name,displayName:y.isMultilingual&&t.value?y.displayName+" ("+p.lang+")":y.displayName,prop:y.name+"_"+p.lang,toolTip:y.toolTip,selectionOptions:JSON.parse(y.selectionOptions||"[]")||[],validations:JSON.parse((H=y.validations)!=null?H:"[]")||[],multipleValue:y.multipleValue,isMultilingual:y.isMultilingual,controlType:y.controlType,settings:JSON.parse(y.settings||"{}")||{}};d.push(a);let i=p.value;if(a.multipleValue)i=JSON.parse(i||"[]");else{let K=D(y.controlType);K&&(K.value==="Switch"?i&&typeof i=="string"?i=JSON.parse(i.toLowerCase()):i=!!i:K.value==="CheckBox"?i=i?JSON.parse(i):[]:K.value==="KeyValues"?i=i?JSON.parse(i):[]:K.value==="ValueList"?i=i?JSON.parse(i):[]:K.value==="Number"&&(i=i===null?void 0:i))}O[a.prop]=i,I[a.prop]=he(a)})}),_.value=d,h.value=O,S.value=I}function $(){return U(this,arguments,function*(e={}){var y,L,g;try{yield(y=v.value)==null?void 0:y.validate()}catch(p){throw yield l(p),p}const r=We(_.value,p=>p.lang);for(const p in r)e[p]={},r[p].forEach(a=>{let i=h.value[a.prop];(a.multipleValue||Array.isArray(i))&&(i=JSON.stringify(i)),e[p][a.name]=i===void 0?null:i});const d={};(L=u.value)==null||L.forEach(p=>{d[p.categoryFolder.id]=p.contents.map(a=>a.id)});const O={};return(g=b.value)==null||g.forEach(p=>{O[p.embeddedFolder.id]=p.contents.map(a=>({id:a.id,order:a.order}))}),{id:Fe("copy")?void 0:s.id,folderId:s.folderId,typeId:s.contentType,values:e,categories:d,embedded:O}})}function n(){return U(this,null,function*(){const e={},r=yield $(e),d=yield me(r);return C.init([h.value,u.value,b.value]),{id:d,values:e}})}function l(e){return U(this,null,function*(){var r;if(t.value)for(const d in x.cultures)x.selected.includes(d)||x.selectedChanged(d);if(e&&typeof e=="object"){const d=Object.keys(e)[0];yield se(),(r=v.value)==null||r.scrollToField(d)}})}function o(e){if(!(s.associated&&e.name=="Online"))return x.selected.includes(e.lang)}return k({save:n,getSaveData:$}),W(()=>[h.value,u.value,b.value],()=>{C.changed([h.value,u.value,b.value])},{deep:!0}),(e,r)=>{const d=Ne;return E(),M("div",ct,[J("div",dt,[F(xe)]),_.value.length?(E(),B(d,{key:0,ref_key:"form",ref:v,"label-position":"top",model:h.value,rules:S.value,onSubmit:r[2]||(r[2]=ce(()=>{},["prevent"]))},{default:V(()=>{var O;return[(E(!0),M(G,null,R(_.value,(I,y)=>Te((E(),B(ge,{key:y,field:I,model:h.value},null,8,["field","model"])),[[ue,o(I)]])),128)),F(Ze,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=I=>u.value=I)},null,8,["modelValue"]),F(ut,{id:m.id,modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=I=>b.value=I),paths:[...(O=m.paths)!=null?O:[]]},null,8,["id","modelValue","paths"])]}),_:1},8,["model","rules"])):N.value?re("",!0):(E(),B(be,{key:1},{default:V(()=>[J("p",null,P(A(T)("common.noFieldYet")),1)]),_:1}))])}}});var ft=je(pt,[["__scopeId","data-v-5a81a6e0"]]);export{ft as E};
