var ve=Object.defineProperty,ye=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Q=(s,n,t)=>n in s?ve(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,P=(s,n)=>{for(var t in n||(n={}))he.call(n,t)&&Q(s,t,n[t]);if(Y)for(var t of Y(n))be.call(n,t)&&Q(s,t,n[t]);return s},T=(s,n)=>ye(s,ge(n));var V=(s,n,t)=>new Promise((d,i)=>{var u=k=>{try{E(t.next(k))}catch(h){i(h)}},p=k=>{try{E(t.throw(k))}catch(h){i(h)}},E=k=>k.done?d(k.value):Promise.resolve(k.value).then(u,p);E((t=t.apply(s,n)).next())});import{o as re,w as B,H as ke,a1 as Ee}from"./i18n.bcd18f8a.js";import{b as A,d as m,m as X,u as N,ac as $e,E as O,ad as we,ae as Re,B as Ce,a5 as Se,af as Ue,_ as H,ag as Fe,o as Le,w as Pe}from"./windi.19264205.js";import{E as Te}from"./index.57a23e6d.js";import{bB as w,d as M,g as ie,o as y,j as F,w as S,a as U,b6 as _e,n as v,u as a,r as C,k as g,f as q,b as L,t as Z,m as Oe,F as Be,Y as De,B as je,aq as G,i as x,bh as qe,c as ee,aW as Ne,b2 as Ae,as as He,aF as te,aT as se}from"./url.8f5ec20c.js";import{t as J,d as Me}from"./error.7e8331f1.js";import{i as Ke}from"./isNil.98bb3b88.js";import{u as ze}from"./index.c80f5028.js";const ue=Symbol("uploadContextKey"),Ie="ElUpload";class We extends Error{constructor(n,t,d,i){super(n),this.name="UploadAjaxError",this.status=t,this.method=d,this.url=i}}function ae(s,n,t){let d;return t.response?d=`${t.response.error||t.response}`:t.responseText?d=`${t.responseText}`:d=`fail to ${n.method} ${s} ${t.status}`,new We(d,t.status,n.method,s)}function Ve(s){const n=s.responseText||s.response;if(!n)return n;try{return JSON.parse(n)}catch(t){return n}}const Xe=s=>{typeof XMLHttpRequest=="undefined"&&J(Ie,"XMLHttpRequest is undefined");const n=new XMLHttpRequest,t=s.action;n.upload&&n.upload.addEventListener("progress",u=>{const p=u;p.percent=u.total>0?u.loaded/u.total*100:0,s.onProgress(p)});const d=new FormData;if(s.data)for(const[u,p]of Object.entries(s.data))Array.isArray(p)?d.append(u,...p):d.append(u,p);d.append(s.filename,s.file,s.file.name),n.addEventListener("error",()=>{s.onError(ae(t,s,n))}),n.addEventListener("load",()=>{if(n.status<200||n.status>=300)return s.onError(ae(t,s,n));s.onSuccess(Ve(n))}),n.open(s.method,t,!0),s.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);const i=s.headers||{};if(i instanceof Headers)i.forEach((u,p)=>n.setRequestHeader(p,u));else for(const[u,p]of Object.entries(i))Ke(p)||n.setRequestHeader(u,String(p));return n.send(d),n},de=["text","picture","picture-card"];let Ge=1;const ce=()=>Date.now()+Ge++,pe=A({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>X({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:m(Array),default:()=>X([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:de,default:"text"},httpRequest:{type:m(Function),default:Xe},disabled:Boolean,limit:Number}),Je=A(T(P({},pe),{beforeUpload:{type:m(Function),default:w},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:w},onChange:{type:m(Function),default:w},onPreview:{type:m(Function),default:w},onSuccess:{type:m(Function),default:w},onProgress:{type:m(Function),default:w},onError:{type:m(Function),default:w},onExceed:{type:m(Function),default:w}})),Ye=A({files:{type:m(Array),default:()=>X([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:w},listType:{type:String,values:de,default:"text"}}),Qe={remove:s=>!!s},Ze=["onKeydown"],xe=["src"],et=["onClick"],tt=["onClick"],st=["onClick"],at={name:"ElUploadList"},ot=M(T(P({},at),{props:Ye,emits:Qe,setup(s,{emit:n}){const t=s,{t:d}=ze(),i=N("upload"),u=N("icon"),p=N("list"),E=ie(!1),k=r=>{t.handlePreview(r)},h=r=>{n("remove",r)};return(r,$)=>(y(),F(ke,{tag:"ul",class:v([a(i).b("list"),a(i).bm("list",r.listType),a(i).is("disabled",r.disabled)]),name:a(p).b()},{default:S(()=>[(y(!0),U(Be,null,_e(r.files,o=>(y(),U("li",{key:o.uid||o.name,class:v([a(i).be("list","item"),a(i).is(o.status),{focusing:E.value}]),tabindex:"0",onKeydown:re(e=>!r.disabled&&h(o),["delete"]),onFocus:$[0]||($[0]=e=>E.value=!0),onBlur:$[1]||($[1]=e=>E.value=!1),onClick:$[2]||($[2]=e=>E.value=!1)},[C(r.$slots,"default",{file:o},()=>[r.listType==="picture"||o.status!=="uploading"&&r.listType==="picture-card"?(y(),U("img",{key:0,class:v(a(i).be("list","item-thumbnail")),src:o.url,alt:""},null,10,xe)):g("v-if",!0),r.listType!=="picture"&&(o.status==="uploading"||r.listType!=="picture-card")?(y(),U("div",{key:1,class:v(a(i).be("list","item-info"))},[q("a",{class:v(a(i).be("list","item-name")),onClick:B(e=>k(o),["prevent"])},[L(a(O),{class:v(a(u).m("document"))},{default:S(()=>[L(a($e))]),_:1},8,["class"]),q("span",{class:v(a(i).be("list","item-file-name"))},Z(o.name),3)],10,et),o.status==="uploading"?(y(),F(a(Te),{key:0,type:r.listType==="picture-card"?"circle":"line","stroke-width":r.listType==="picture-card"?6:2,percentage:Number(o.percentage),style:Oe(r.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):g("v-if",!0)],2)):g("v-if",!0),q("label",{class:v(a(i).be("list","item-status-label"))},[r.listType==="text"?(y(),F(a(O),{key:0,class:v([a(u).m("upload-success"),a(u).m("circle-check")])},{default:S(()=>[L(a(we))]),_:1},8,["class"])):["picture-card","picture"].includes(r.listType)?(y(),F(a(O),{key:1,class:v([a(u).m("upload-success"),a(u).m("check")])},{default:S(()=>[L(a(Re))]),_:1},8,["class"])):g("v-if",!0)],2),r.disabled?g("v-if",!0):(y(),F(a(O),{key:2,class:v(a(u).m("close")),onClick:e=>h(o)},{default:S(()=>[L(a(Ce))]),_:2},1032,["class","onClick"])),g(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),g(" This is a bug which needs to be fixed "),g(" TODO: Fix the incorrect navigation interaction "),r.disabled?g("v-if",!0):(y(),U("i",{key:3,class:v(a(u).m("close-tip"))},Z(a(d)("el.upload.deleteTip")),3)),r.listType==="picture-card"?(y(),U("span",{key:4,class:v(a(i).be("list","item-actions"))},[q("span",{class:v(a(i).be("list","item-preview")),onClick:e=>r.handlePreview(o)},[L(a(O),{class:v(a(u).m("zoom-in"))},{default:S(()=>[L(a(Se))]),_:1},8,["class"])],10,tt),r.disabled?g("v-if",!0):(y(),U("span",{key:0,class:v(a(i).be("list","item-delete")),onClick:e=>h(o)},[L(a(O),{class:v(a(u).m("delete"))},{default:S(()=>[L(a(Ue))]),_:1},8,["class"])],10,st))],2)):g("v-if",!0)])],42,Ze))),128)),C(r.$slots,"append")]),_:3},8,["class","name"]))}}));var oe=H(ot,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const nt=A({disabled:{type:Boolean,default:!1}}),lt={file:s=>De(s)},rt=["onDrop","onDragover"],it={name:"ElUploadDrag"},ut=M(T(P({},it),{props:nt,emits:lt,setup(s,{emit:n}){const t=s,d="ElUploadDrag",i=je(ue);i||J(d,"usage: <el-upload><el-upload-dragger /></el-upload>");const u=N("upload"),p=ie(!1),E=h=>{if(t.disabled)return;p.value=!1;const r=Array.from(h.dataTransfer.files),$=i.accept.value;if(!$){n("file",r);return}const o=r.filter(e=>{const{type:l,name:f}=e,b=f.includes(".")?`.${f.split(".").pop()}`:"",c=l.replace(/\/.*$/,"");return $.split(",").map(R=>R.trim()).filter(R=>R).some(R=>R.startsWith(".")?b===R:/\/\*$/.test(R)?c===R.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(R)?l===R:!1)});n("file",o)},k=()=>{t.disabled||(p.value=!0)};return(h,r)=>(y(),U("div",{class:v([a(u).b("dragger"),a(u).is("dragover",p.value)]),onDrop:B(E,["prevent"]),onDragover:B(k,["prevent"]),onDragleave:r[0]||(r[0]=B($=>p.value=!1,["prevent"]))},[C(h.$slots,"default")],42,rt))}}));var dt=H(ut,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const ct=A(T(P({},pe),{beforeUpload:{type:m(Function),default:w},onRemove:{type:m(Function),default:w},onStart:{type:m(Function),default:w},onSuccess:{type:m(Function),default:w},onProgress:{type:m(Function),default:w},onError:{type:m(Function),default:w},onExceed:{type:m(Function),default:w}})),pt=["onKeydown"],ft=["name","multiple","accept"],mt={name:"ElUploadContent",inheritAttrs:!1},vt=M(T(P({},mt),{props:ct,setup(s,{expose:n}){const t=s,d=N("upload"),i=G({}),u=G(),p=e=>{if(e.length===0)return;const{autoUpload:l,limit:f,fileList:b,multiple:c,onStart:R,onExceed:_}=t;if(f&&b.length+e.length>f){_(e,b);return}c||(e=e.slice(0,1));for(const K of e){const D=K;D.uid=ce(),R(D),l&&E(D)}},E=e=>V(this,null,function*(){if(u.value.value="",!t.beforeUpload)return k(e);let l;try{l=yield t.beforeUpload(e)}catch(b){l=!1}if(l===!1){t.onRemove(e);return}let f=e;l instanceof Blob&&(l instanceof File?f=l:f=new File([l],e.name,{type:e.type})),k(Object.assign(f,{uid:e.uid}))}),k=e=>{const{headers:l,data:f,method:b,withCredentials:c,name:R,action:_,onProgress:K,onSuccess:D,onError:fe,httpRequest:me}=t,{uid:z}=e,I={headers:l||{},withCredentials:c,file:e,data:f,method:b,filename:R,action:_,onProgress:j=>{K(j,e)},onSuccess:j=>{D(j,e),delete i.value[z]},onError:j=>{fe(j,e),delete i.value[z]}},W=me(I);i.value[z]=W,W instanceof Promise&&W.then(I.onSuccess,I.onError)},h=e=>{const l=e.target.files;!l||p(Array.from(l))},r=()=>{t.disabled||(u.value.value="",u.value.click())},$=()=>{r()};return n({abort:e=>{Fe(i.value).filter(e?([f])=>String(e.uid)===f:()=>!0).forEach(([f,b])=>{b instanceof XMLHttpRequest&&b.abort(),delete i.value[f]})},upload:E}),(e,l)=>(y(),U("div",{class:v([a(d).b(),a(d).m(e.listType),a(d).is("drag",e.drag)]),tabindex:"0",onClick:r,onKeydown:re(B($,["self"]),["enter","space"])},[e.drag?(y(),F(dt,{key:0,disabled:e.disabled,onFile:p},{default:S(()=>[C(e.$slots,"default")]),_:3},8,["disabled"])):C(e.$slots,"default",{key:1}),q("input",{ref_key:"inputRef",ref:u,class:v(a(d).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:h,onClick:l[0]||(l[0]=B(()=>{},["stop"]))},null,42,ft)],42,pt))}}));var ne=H(vt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const le="ElUpload",yt=s=>{var n;(n=s.url)!=null&&n.startsWith("blob:")&&URL.revokeObjectURL(s.url)},gt=(s,n)=>{const t=Ee(s,"fileList",void 0,{passive:!0}),d=o=>t.value.find(e=>e.uid===o.uid);function i(o){var e;(e=n.value)==null||e.abort(o)}function u(o=["ready","uploading","success","fail"]){t.value=t.value.filter(e=>!o.includes(e.status))}const p=(o,e)=>{const l=d(e);!l||(console.error(o),l.status="fail",t.value.splice(t.value.indexOf(l),1),s.onError(o,l,t.value),s.onChange(l,t.value))},E=(o,e)=>{const l=d(e);!l||(s.onProgress(o,l,t.value),l.status="uploading",l.percentage=Math.round(o.percent))},k=(o,e)=>{const l=d(e);!l||(l.status="success",l.response=o,s.onSuccess(o,l,t.value),s.onChange(l,t.value))},h=o=>{const e={name:o.name,percentage:0,status:"ready",size:o.size,raw:o,uid:o.uid};if(s.listType==="picture-card"||s.listType==="picture")try{e.url=URL.createObjectURL(o)}catch(l){Me(le,l.message),s.onError(l,e,t.value)}t.value.push(e),s.onChange(e,t.value)},r=o=>V(void 0,null,function*(){const e=o instanceof File?d(o):o;e||J(le,"file to be removed not found");const l=f=>{i(f);const b=t.value;b.splice(b.indexOf(f),1),s.onRemove(f,b),yt(f)};s.beforeRemove?(yield s.beforeRemove(e,t.value))!==!1&&l(e):l(e)});function $(){t.value.filter(({status:o})=>o==="ready").forEach(({raw:o})=>{var e;return o&&((e=n.value)==null?void 0:e.upload(o))})}return x(()=>s.listType,o=>{o!=="picture-card"&&o!=="picture"||(t.value=t.value.map(e=>{const{raw:l,url:f}=e;if(!f&&l)try{e.url=URL.createObjectURL(l)}catch(b){s.onError(b,e,t.value)}return e}))}),x(t,o=>{for(const e of o)e.uid||(e.uid=ce()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:t,abort:i,clearFiles:u,handleError:p,handleProgress:E,handleStart:h,handleSuccess:k,handleRemove:r,submit:$}},ht={name:"ElUpload"},bt=M(T(P({},ht),{props:Je,setup(s,{expose:n}){const t=s,d=qe(),i=Le(),u=G(),{abort:p,submit:E,clearFiles:k,uploadFiles:h,handleStart:r,handleError:$,handleRemove:o,handleSuccess:e,handleProgress:l}=gt(t,u),f=ee(()=>t.listType==="picture-card"),b=ee(()=>T(P({},t),{onStart:r,onProgress:l,onSuccess:e,onError:$,onRemove:o}));return Ne(()=>{h.value.forEach(({url:c})=>{c!=null&&c.startsWith("blob:")&&URL.revokeObjectURL(c)})}),Ae(ue,{accept:He(t,"accept")}),n({abort:p,submit:E,clearFiles:k,handleStart:r,handleRemove:o}),(c,R)=>(y(),U("div",null,[a(f)&&c.showFileList?(y(),F(oe,{key:0,disabled:a(i),"list-type":c.listType,files:a(h),"handle-preview":c.onPreview,onRemove:a(o)},te({append:S(()=>[c.listType==="picture-card"?(y(),F(ne,se({key:0,ref_key:"uploadRef",ref:u},a(b)),{default:S(()=>[a(d).trigger?C(c.$slots,"trigger",{key:0}):g("v-if",!0),!a(d).trigger&&a(d).default?C(c.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)):g("v-if",!0)]),_:2},[c.$slots.file?{name:"default",fn:S(({file:_})=>[C(c.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):g("v-if",!0),c.listType!=="picture-card"?(y(),F(ne,se({key:1,ref_key:"uploadRef",ref:u},a(b)),{default:S(()=>[a(d).trigger?C(c.$slots,"trigger",{key:0}):g("v-if",!0),!a(d).trigger&&a(d).default?C(c.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)):g("v-if",!0),c.$slots.trigger?C(c.$slots,"default",{key:2}):g("v-if",!0),C(c.$slots,"tip"),!a(f)&&c.showFileList?(y(),F(oe,{key:3,disabled:a(i),"list-type":c.listType,files:a(h),"handle-preview":c.onPreview,onRemove:a(o)},te({_:2},[c.$slots.file?{name:"default",fn:S(({file:_})=>[C(c.$slots,"file",{file:_})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):g("v-if",!0)]))}}));var kt=H(bt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Lt=Pe(kt);export{Lt as E};
