var _=(q,a,f)=>new Promise((g,k)=>{var x=h=>{try{m(f.next(h))}catch(N){k(N)}},b=h=>{try{m(f.throw(h))}catch(N){k(N)}},m=h=>h.done?g(h.value):Promise.resolve(h.value).then(x,b);m((f=f.apply(q,a)).next())});import{_ as fe}from"./icon-button.74ccc970.js";import{S as _e}from"./search-input.2a27ef56.js";import{_ as ge}from"./k-table.b1a54b80.js";import{c as he,G as ye,g as oe,a as be,b as ae,d as ke,e as xe,r as De,f as Ce,h as Ne,i as Ie}from"./index.269bf65e.js";import{u as Ve}from"./use-date.f1258183.js";import{_ as we}from"./action-tag.b6cae96d.js";import{_ as Ee}from"./object-type-tag.6a4036a3.js";import{g as le,o as Te}from"./i18n.a87944a4.js";import{a as $e}from"./index.d2657986.js";import{a as G,r as te,b as Se,d as Re,s as Ue,i as Le}from"./validate.bb56f9e3.js";import{x as Fe,E as He}from"./main.9fdfea92.js";import{_ as Be}from"./index.f0d5f031.js";import{_ as qe}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Me}from"./index.178b9e08.js";import{E as Ye,a as je}from"./index.9fd79879.js";import{E as ne,a as se}from"./index.7c862087.js";import{E as Ae}from"./index.c003dfa1.js";import{d as ie,g as d,i as Y,o as u,j as y,w as n,b as l,u as o,f as U,a as L,b7 as j,F as B,cd as Ke,K as Oe,k as I,aI as R,t as C,ch as Pe}from"./url.4cb47a7a.js";import{u as ze}from"./replace-all.56d2c1f7.js";import{B as Ge}from"./breadcrumb.f4d80c95.js";import{_ as Je}from"./index.cd532f7e.js";import{s as Qe}from"./confirm.b60b5d2f.js";import{E as We}from"./index.76f9eac7.js";import{E as Xe}from"./index.361e2245.js";import{E as Ze}from"./index.d96452a6.js";import{E as eo}from"./index.b38edc72.js";import{E as oo}from"./windi.6360286d.js";import{E as ao}from"./index.24947ed8.js";import"./index.4f90a917.js";import"./index.4d568055.js";/* empty css                                                                 */import"./sortable.esm.a99254e8.js";import"./index.c6da2706.js";import"./isEqual.4cab74e3.js";import"./_baseIsEqual.dc9e64c4.js";import"./error.7e8331f1.js";import"./index.42922617.js";import"./index.7b8c5aef.js";import"./event.776e7e11.js";import"./index.f15f695e.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./dayjs.min.ccc40d4f.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./isNil.98bb3b88.js";import"./_baseClone.b8903935.js";import"./index.fd96ea36.js";import"./scroll.16983984.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./validator.b5df2420.js";import"./index.c10802d9.js";import"./focus-trap.50a00b7f.js";import"./refs.3132cbdb.js";/* empty css                                                               */import"./plugin-vue_export-helper.41ffa612.js";import"./main.esm.e26794cb.js";import"./editor.main.d2800f63.js";import"./dark.9459c47b.js";import"./logo-transparent.1566007e.js";import"./index.f2c1b903.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./index.e3f90979.js";const to={class:"flex items-center justify-between"},lo=ie({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(q,{emit:a}){const f=q,{t:g}=le(),k=d(),x=d(!0),b=d(),m=d({id:f.id,siteName:"",subDomain:"",rootDomain:""}),h=d(!1),N=d(!1),s={subDomain:[G(g("common.subDomainRequiredTips")),te(1,63),Se,Re(m.value)],siteName:[te(1,50),G(g("common.nameRequiredTips")),Ue(),Le(Fe,g("common.siteNameExistsTips"))],rootDomain:G(g("common.rootDomainRequiredTips"))};$e().then(p=>{k.value=p,k.value.length&&(m.value.rootDomain=k.value[0].domainName)});const D=()=>_(this,null,function*(){yield b.value.validate(),yield he(m.value),x.value=!1});return Y(()=>m.value.subDomain,()=>{h.value||(m.value.siteName=m.value.subDomain)}),Y(()=>m.value.siteName,()=>{N.value||(m.value.subDomain=m.value.siteName)}),Y(()=>m.value.rootDomain,()=>{var p,r,V;m.value.sudDomainUseDash=(V=(r=(p=k.value)==null?void 0:p.find(w=>w.domainName==m.value.rootDomain))==null?void 0:r.sudDomainUseDash)!=null?V:!1}),(p,r)=>{const V=Me,w=Ye,A=ne,K=se,M=je,O=Ae;return u(),y(O,{"model-value":x.value,width:"600px","close-on-click-modal":!1,title:o(g)("common.checkoutSite"),onClosed:r[6]||(r[6]=v=>a("update:modelValue",!1))},{footer:n(()=>[l(Be,{"confirm-label":o(g)("common.start"),onConfirm:D,onCancel:r[5]||(r[5]=v=>x.value=!1)},null,8,["confirm-label"])]),default:n(()=>[l(M,{ref_key:"form",ref:b,"label-position":"top",model:m.value,rules:o(s),onKeydown:Te(D,["enter"])},{default:n(()=>[l(w,{label:o(g)("common.siteName"),prop:"siteName"},{default:n(()=>[l(V,{modelValue:m.value.siteName,"onUpdate:modelValue":r[0]||(r[0]=v=>m.value.siteName=v),class:"w-255px","data-cy":"siteName",onInput:r[1]||(r[1]=v=>h.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),U("div",to,[l(w,{label:o(g)("common.domain"),prop:"subDomain",class:"w-255px"},{default:n(()=>[l(V,{modelValue:m.value.subDomain,"onUpdate:modelValue":r[2]||(r[2]=v=>m.value.subDomain=v),"data-cy":"subdomain",onInput:r[3]||(r[3]=v=>N.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),l(w,{prop:"rootDomain",class:"mt-30px"},{default:n(()=>[l(K,{modelValue:m.value.rootDomain,"onUpdate:modelValue":r[4]||(r[4]=v=>m.value.rootDomain=v),class:"flex-1"},{default:n(()=>[(u(!0),L(B,null,j(k.value,v=>(u(),y(A,{key:v.domainName,value:v.domainName,label:(v.sudDomainUseDash?"-":".")+v.domainName,"data-cy":"root-domain-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["model-value","title"])}}});var no=qe(lo,[["__scopeId","data-v-14f8dd8f"]]);const so={class:"p-24"},io={class:"flex space-x-16 mt-16"},mo={key:0},uo=["title","onClick"],ro={"data-cy":"username"},co={"data-cy":"last-modified"},po={key:1,class:"shadow-s-10 rounded-normal overflow-hidden flex flex-col bg-fff dark:bg-[#303030] mt-16"},vo={class:"flex justify-center items-center h-full"},Sa=ie({setup(q){const{t:a}=le(),f=d(),g=d(0),k=Ke(),x=d(!1),b=d(),m=d(),h=d(),N=d(),s=d({startDate:"",endDate:"",userId:"",name:"",storeName:"",actionType:"",pageNr:1}),D=d([s.value.startDate,s.value.endDate]),p=t=>_(this,null,function*(){t&&typeof t=="number"&&(s.value.pageNr=t),s.value.name=s.value.name.trim(),f.value=yield oe(s.value)}),r=t=>_(this,null,function*(){yield xe(t.map(i=>i.id)),yield p(),yield M()}),V=t=>_(this,null,function*(){yield De(t.id),yield p(),yield M()}),w=t=>_(this,null,function*(){g.value=t.id,x.value=!0}),A=t=>_(this,null,function*(){yield Ce(t.id)}),K=t=>_(this,null,function*(){yield Ne(t.map(i=>i.id))}),M=()=>_(this,null,function*(){b.value=yield ae(),m.value=b.value.editType}),O=()=>{D.value=["",""],Object.keys(s.value).forEach(t=>{t!=="name"&&(t!=="pageMr"?s.value[t]="":s.value[t]=1)}),s.value.name?s.value.name="":p(1)},v=()=>_(this,null,function*(){yield Qe(a("common.cleanLogTips"));const t=yield be();z(t)}),me=Pe(()=>p(1),1e3);Y(()=>s.value.name,()=>{s.value.name?me():p(1)});const J=()=>_(this,null,function*(){f.value=yield oe(s.value),b.value=yield ae(),h.value=b.value.storeName,m.value=b.value.editType,N.value=b.value.user});J();const ue=()=>{D.value&&D.value.some(t=>t!==null)?(s.value.startDate=D.value[0].toString(),s.value.endDate=D.value[1].toString()):(s.value.startDate="",s.value.endDate=""),p(1)};function re(t){return _(this,null,function*(){const i=yield Ie(t),E=JSON.parse(i);P.value&&P.value.load(t,E)})}const P=d(null),c=d({id:"",totalItem:0,finishedItems:0,isFinished:!0});function z(t){return _(this,null,function*(){if(t&&(c.value.id=t,c.value.isFinished=!1),!c.value.id){c.value.totalItem=0,c.value.finishedItems=0,c.value.isFinished=!0;return}const{totalItem:i,finishedItems:E,isFinished:F}=yield ke(c.value.id);F?(He.success(a("common.logCleaningInProgress")),c.value.id="",c.value.totalItem=0,c.value.finishedItems=0,c.value.isFinished=!0,yield J()):(c.value.totalItem=i,c.value.finishedItems=E,c.value.isFinished=F)})}const Q=d();return Q.value=setInterval(()=>_(this,null,function*(){c.value.isFinished||z()}),3e3),ye().then(t=>{t&&t.id&&!t.isFinished&&z(t.id)}),Oe(()=>{clearInterval(Q.value)}),(t,i)=>{var X,Z,ee;const E=ne,F=se,ce=We,de=_e,T=Xe,H=Ze,$=eo,W=fe,pe=oo,ve=ao;return u(),L(B,null,[U("div",so,[l(Ge,{name:o(a)("common.siteLogs")},null,8,["name"]),U("div",io,[l(F,{modelValue:s.value.storeName,"onUpdate:modelValue":i[0]||(i[0]=e=>s.value.storeName=e),placeholder:o(a)("common.objectType"),clearable:"",class:"w-180px",onChange:i[1]||(i[1]=e=>p(1))},{default:n(()=>[(u(!0),L(B,null,j(h.value,e=>(u(),y(E,{key:e.key,label:e.value,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(F,{modelValue:s.value.actionType,"onUpdate:modelValue":i[2]||(i[2]=e=>s.value.actionType=e),placeholder:o(a)("common.action"),clearable:"",class:"w-140px",onChange:i[3]||(i[3]=e=>p(1))},{default:n(()=>[(u(!0),L(B,null,j(m.value,e=>(u(),y(E,{key:e.key,label:e.value,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(F,{modelValue:s.value.userId,"onUpdate:modelValue":i[4]||(i[4]=e=>s.value.userId=e),placeholder:o(a)("common.user"),clearable:"",class:"w-160px",onChange:i[5]||(i[5]=e=>p(1))},{default:n(()=>[(u(!0),L(B,null,j(N.value,e=>(u(),y(E,{key:e.key,label:e.value,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(ce,{modelValue:D.value,"onUpdate:modelValue":i[6]||(i[6]=e=>D.value=e),type:"datetimerange","unlink-panels":!0,format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm","range-separator":o(a)("common.to"),"start-placeholder":o(a)("common.startTime"),"end-placeholder":o(a)("common.endTime"),class:"h-40px max-w-460px",editable:!1,onChange:ue},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"]),l(de,{modelValue:s.value.name,"onUpdate:modelValue":i[7]||(i[7]=e=>s.value.name=e),placeholder:o(a)("common.logItem"),class:"w-250px h-10"},null,8,["modelValue","placeholder"]),l(T,{class:"rounded-full","data-cy":"reset",onClick:O},{default:n(()=>[R(C(o(a)("common.reset")),1)]),_:1}),l(T,{class:"rounded-full","data-cy":"cleanLog",disabled:!((Z=(X=f.value)==null?void 0:X.list)!=null&&Z.length),onClick:v},{default:n(()=>[R(C(o(a)("common.cleanLog")),1)]),_:1},8,["disabled"])]),c.value.isFinished?(u(),L("div",mo,[f.value?(u(),y(o(ge),{key:0,data:(ee=f.value)==null?void 0:ee.list,"show-check":"","hide-delete":"",pagination:{currentPage:f.value.pageNr,pageCount:f.value.totalPages,pageSize:f.value.pageSize},class:"mt-16",onChange:p},{bar:n(({selected:e})=>[e.length>0?(u(),y(H,{key:0,placement:"top",content:o(a)("common.undoChangeTip")},{default:n(()=>[l(T,{round:"","data-cy":"undo-changes",onClick:S=>r(e)},{default:n(()=>[R(C(e.length===1?o(a)("common.undoChange"):o(a)("common.undoChanges")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):I("",!0),e.length===1?(u(),y(H,{key:1,placement:"top",content:o(a)("common.restoreTip")},{default:n(()=>[l(T,{round:"","data-cy":"restore-to-point",onClick:S=>V(e[0])},{default:n(()=>[R(C(o(a)("common.restore")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):I("",!0),e.length===1?(u(),y(H,{key:2,placement:"top",content:o(a)("common.checkoutTip")},{default:n(()=>[l(T,{round:"","data-cy":"checkout",onClick:S=>w(e[0])},{default:n(()=>[R(C(o(a)("common.checkout")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):I("",!0),e.length===1?(u(),y(H,{key:3,placement:"top",content:o(a)("common.exportChangesTip")},{default:n(()=>[l(T,{round:"","data-cy":"export-changes",onClick:S=>A(e[0])},{default:n(()=>[R(C(o(a)("common.exportChanges")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):I("",!0),e.length>0?(u(),y(H,{key:4,placement:"top",content:o(a)("common.exportItemTip")},{default:n(()=>[l(T,{round:"","data-cy":"export-item",onClick:S=>K(e)},{default:n(()=>[R(C(e.length===1?o(a)("common.exportItem"):o(a)("common.exportItems")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):I("",!0)]),default:n(()=>[l($,{label:"ID",prop:"id",width:"80px"}),l($,{label:o(a)("common.logItem")},{default:n(({row:e})=>[U("span",{title:e.itemName,class:"ellipsis text-blue cursor-pointer","data-cy":"log-item",onClick:S=>o(k).push(o(ze)({name:"log-versions",query:{keyHash:e.keyHash,storeNameHash:e.storeNameHash,tableNameHash:e.tableNameHash}}))},C(e.itemName),9,uo)]),_:1},8,["label"]),l($,{label:o(a)("common.objectType"),width:"200px"},{default:n(({row:e})=>[l(Ee,{type:e.storeName},null,8,["type"])]),_:1},8,["label"]),l($,{label:o(a)("common.action"),width:"120px"},{default:n(({row:e})=>[l(we,{type:e.actionType},null,8,["type"])]),_:1},8,["label"]),l($,{label:o(a)("common.user"),width:"150px"},{default:n(({row:e})=>[U("span",ro,C(e.userName),1)]),_:1},8,["label"]),l($,{label:o(a)("common.lastModified"),width:"180px"},{default:n(({row:e})=>[U("span",co,C(o(Ve)(e.lastModified)),1)]),_:1},8,["label"]),l($,{align:"right",width:"120px"},{default:n(({row:e})=>[e.hasVideo?(u(),y(W,{key:0,icon:"icon-ve-video",tip:o(a)("common.playVideo"),permission:{feature:"site",action:"log"},onClick:S=>re(e.id)},null,8,["tip","onClick"])):I("",!0),l(W,{icon:"icon-time",tip:o(a)("common.versions"),permission:{feature:"site",action:"log"},"data-cy":"versions",onClick:S=>t.$router.goLogVersions(e.keyHash,e.storeNameHash,e.tableNameHash)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data","pagination"])):I("",!0)])):(u(),L("div",po,[U("div",vo,[l(ve,{title:o(a)("common.taskIsExecuting"),"sub-title":o(a)("common.cleanLogRemaining",{total:c.value.totalItem,count:c.value.finishedItems})},{icon:n(()=>[l(pe,{class:"iconfont icon-bufenchenggong text-56px text-green"})]),_:1},8,["title","sub-title"])])]))]),l(Je,{onReady:i[8]||(i[8]=e=>P.value=e)}),x.value?(u(),y(no,{key:0,id:g.value,modelValue:x.value,"onUpdate:modelValue":i[9]||(i[9]=e=>x.value=e)},null,8,["id","modelValue"])):I("",!0)],64)}}});export{Sa as default};
