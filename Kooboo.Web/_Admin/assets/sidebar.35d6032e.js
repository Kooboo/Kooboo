var ee=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var K=(l,t,e)=>t in l?ee(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,O=(l,t)=>{for(var e in t||(t={}))le.call(t,e)&&K(l,e,t[e]);if($)for(var e of $(t))oe.call(t,e)&&K(l,e,t[e]);return l},D=(l,t)=>te(l,ne(t));var L=(l,t,e)=>new Promise((p,n)=>{var v=f=>{try{d(e.next(f))}catch(h){n(h)}},m=f=>{try{d(e.throw(f))}catch(h){n(h)}},d=f=>f.done?p(f.value):Promise.resolve(f.value).then(v,m);d((e=e.apply(l,t)).next())});import{b as ae,_ as se,a as re,c as ie,d as ue,e as de}from"./basic.9508f80f.js";import{t as ce,b as me}from"./replace-all.b35629e7.js";import{g as N}from"./i18n.25caaace.js";import{E as pe}from"./index.f571dfc9.js";import{E as fe}from"./windi.a815125a.js";import{E as ye}from"./index.e9f8834a.js";import{g as B,c as P,cd as ve,M as he,at as C,d as Q,i as be,o as g,a as I,F as A,b6 as G,b as S,u as a,f as ge,w as M,j as T,r as Se,k as Ee}from"./url.8f5ec20c.js";import{j as H,k as q,m as ke,n as z,c as Ve}from"./style.1b77b3a2.js";import{K as J,L as W,a as Ue}from"./dev-mode.d22f2f80.js";import{g as X}from"./main.1c3b59e3.js";import{n as Y}from"./guid.c1a40312.js";import{r as Me}from"./index.0ea2a2de.js";import{E as _e,a as Te}from"./index.e89ba775.js";function Ce(l){const t=[];if(!l)return t;const e=J(),p=H(l,["link","style"]);for(const n of p){if(q(n,"link")){const v=n.getAttribute("rel"),m=n.getAttribute("href");if(v==="stylesheet"&&m){const d=e.all.find(f=>f.href===m);d&&t.push({el:n,content:d.name,id:d.id})}}q(n,"style")&&t.push({el:n,content:n.innerHTML,id:Y()})}return t}function Ie(l){const t=[];if(!l)return t;const e=W(),p=H(l,["script"]);for(const n of p){const v=n.getAttribute("src");if(v){const m=e.all.find(d=>d.href===v);m&&t.push({el:n,content:m.name,id:m.id,position:R(n)})}else t.push({el:n,content:n.innerHTML,id:Y(),position:R(n)})}return t}function xe(l,t){const e=[];if(!l||!t)return e;const p=X();for(const n of H(l,["meta"])){const v=n.getAttribute("charset"),m=n.getAttribute("property"),d=n.getAttribute("http-equiv"),f=n.getAttribute("name"),h=n.getAttribute("content");if(v){let s=t.find(b=>!!b.charset);s?(s.charset=v,s.el=n):s={charset:v,el:n},e.push(s)}if(d&&h){let s=t.find(b=>b.httpequiv===d);s?(s.content||(s.content={}),s.el=n):(s={httpequiv:d,content:{},el:n},s.content[p.default]=h),e.push(s)}if(f&&h){let s=t.find(b=>b.name===f);s?(s.content||(s.content={}),s.el=n):(s={name:f,content:{},el:n},s.content[p.default]=h),e.push(s)}if(m&&h){let s=t.find(b=>b.property===m);s?(s.content||(s.content={}),s.el=n):(s={property:m,content:{},el:n},s.content[p.default]=h),e.push(s)}}return e}function R(l){return ke(l).some(t=>q(t,"head"))?"head":"body"}const Be=J(),Pe=W(),Z=Ue(),V=B(),i=B(),Le=P(()=>i.value?z(i.value):""),w=P(()=>Ce(i.value)),j=P(()=>Ie(i.value)),F=P(()=>{var l;return xe(i.value,(l=V.value)==null?void 0:l.metas)});function we(l,t,e){i.value.body.innerHTML=Me(l,t!=null?t:!1,e)}function Ae(l){let t=i.value.head.querySelector("#designer-page-style");if(l){if(!t){t=document.createElement("style"),t.setAttribute("id","designer-page-style"),t.innerHTML=l,i.value.head.appendChild(t);return}t.innerHTML=l;return}t&&i.value.head.removeChild(t)}function qe(l,t){return L(this,null,function*(){var p,n;const e=yield Z.getPage(l,t);e.urlPath=(p=e.urlPath)!=null?p:"",e.name=(n=e.name)!=null?n:"",V.value=e,i.value=Ve(V.value.body)})}function He(){const l=ve(),t=he(),e=o=>{const c=w.value[o.oldIndex],r=w.value[o.newIndex].el;r!=null&&r.parentElement&&r.parentElement.insertBefore(c.el,o.oldIndex>o.newIndex?r:r.nextElementSibling),C(i)},p=o=>{if(!i.value)return;const c=Be.all.find(r=>r.id===o);if(c){const r=i.value.createElement("link");r.rel="stylesheet",r.href=c.href,i.value.head.appendChild(r),C(i)}},n=(o,c)=>{const r=j.value.filter(u=>u.position===c),E=r[o.oldIndex],_=r[o.newIndex].el;_.parentElement&&_.parentElement.insertBefore(E.el,o.oldIndex>o.newIndex?_:_.nextElementSibling),C(i)},v=(o,c)=>{if(!i.value)return;const r=Pe.all.find(E=>E.id===o);if(r){const E=i.value.createElement("script");E.src=r.href,c==="head"?i.value.head.appendChild(E):i.value.body.appendChild(E),C(i)}},m=o=>{!i.value||(o.remove(),C(i))},d=(o,c)=>{!i.value||(c&&c.parentElement?c.parentElement.insertBefore(o,c):i.value.head.appendChild(o),C(i))};return{init:qe,setBody:we,setPageStyle:Ae,model:V,styles:w,scripts:j,metas:F,preview:Le,sortStyle:e,insertStyle:p,sortScript:n,insertScript:v,deleteElement:m,insertElement:d,save:()=>L(this,null,function*(){if(!V.value||!i.value)return;V.value.body=z(i.value),V.value.metas=F.value;const o=yield Z.updatePage(V.value);return l.replace({query:D(O({},t.query),{id:o.id})}),o}),updateTitle:o=>{!i.value||(i.value.title=o)},addOrUpdateMeta:o=>{const c=X(),r=ae(o,c.default);o.el&&r?(d(r,o.el),m(o.el)):r&&V.value&&(V.value.metas.push(o),d(r))},deleteMeta:o=>{o.el&&m(o.el)}}}const $e={class:"px-24 py-16 space-y-4"},Ke=Q({props:{modelValue:null},emits:["update:modelValue"],setup(l,{emit:t}){const e=l,{t:p}=N(),n=B(ce(e.modelValue)),v=m=>{n.value.splice(m,1)};return be(()=>n.value,()=>{t("update:modelValue",me(n.value))},{deep:!0}),(m,d)=>{const f=pe,h=fe,s=ye;return g(),I("div",$e,[(g(!0),I(A,null,G(n.value,(b,o)=>(g(),I("div",{key:o,class:"flex items-center space-x-4"},[S(f,{modelValue:b.key,"onUpdate:modelValue":c=>b.key=c,placeholder:a(p)("common.key"),"data-cy":"key"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),S(f,{modelValue:b.value,"onUpdate:modelValue":c=>b.value=c,placeholder:a(p)("common.value"),"data-cy":"value"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),ge("div",null,[S(s,{circle:"","data-cy":"remove",onClick:c=>v(o)},{default:M(()=>[S(h,{class:"text-orange iconfont icon-delete"})]),_:2},1032,["onClick"])])]))),128)),S(s,{circle:"","data-cy":"add",onClick:d[0]||(d[0]=b=>n.value.push({key:"",value:""}))},{default:M(()=>[S(h,{class:"text-blue iconfont icon-a-addto"})]),_:1})])}}}),et=Q({props:{oldUrlPath:null,items:{default(){return["basic","HTMLMeta","parameters","style","scripts","cache"]}}},setup(l){const t=l,{model:e,updateTitle:p,deleteElement:n,styles:v,sortStyle:m,insertStyle:d,scripts:f,sortScript:h,insertScript:s,metas:b,addOrUpdateMeta:o,deleteMeta:c}=He(),{t:r}=N(),E=B("basic");return function(){var U,x;const u=(U=t.items)!=null?U:[];E.value=(x=u[0])!=null?x:"basic"}(),(_,u)=>{const U=_e,x=Te;return a(e)?(g(),T(x,{key:0,modelValue:E.value,"onUpdate:modelValue":u[10]||(u[10]=k=>E.value=k)},{default:M(()=>[(g(!0),I(A,null,G(l.items,k=>(g(),I(A,{key:k},[k==="basic"?(g(),T(U,{key:0,name:"basic",title:a(r)("common.basic")},{default:M(()=>[S(se,{ref_for:!0,ref:"basicForm",url:a(e).urlPath,"onUpdate:url":u[0]||(u[0]=y=>a(e).urlPath=y),titles:a(e).contentTitle,"onUpdate:titles":u[1]||(u[1]=y=>a(e).contentTitle=y),published:a(e).published,"onUpdate:published":u[2]||(u[2]=y=>a(e).published=y),"old-url-path":l.oldUrlPath,"onUpdate:defaultTitle":a(p)},null,8,["url","titles","published","old-url-path","onUpdate:defaultTitle"])]),_:1},8,["title"])):k==="HTMLMeta"?(g(),T(U,{key:1,name:"HTMLMeta",title:a(r)("common.HTMLMeta")},{default:M(()=>[S(re,{list:a(b),onDelete:a(c),onAddOrUpdate:a(o)},null,8,["list","onDelete","onAddOrUpdate"])]),_:1},8,["title"])):k==="parameters"?(g(),T(U,{key:2,name:"parameters",title:a(r)("common.parameters")},{default:M(()=>[S(Ke,{modelValue:a(e).parameters,"onUpdate:modelValue":u[3]||(u[3]=y=>a(e).parameters=y)},null,8,["modelValue"])]),_:1},8,["title"])):k==="style"?(g(),T(U,{key:3,name:"style",title:a(r)("common.style")},{default:M(()=>[S(ie,{list:a(v),onSort:a(m),onInsert:a(d),onDelete:u[4]||(u[4]=y=>a(n)(y.el))},null,8,["list","onSort","onInsert"])]),_:1},8,["title"])):k==="scripts"?(g(),T(U,{key:4,name:"scripts",title:a(r)("common.scripts")},{default:M(()=>[S(ue,{list:a(f),onSort:a(h),onDelete:u[5]||(u[5]=y=>a(n)(y.el)),onInsert:a(s)},null,8,["list","onSort","onInsert"])]),_:1},8,["title"])):k==="cache"?(g(),T(U,{key:5,name:"cache",title:a(r)("common.cache")},{default:M(()=>[S(de,{enable:a(e).enableCache,"onUpdate:enable":u[6]||(u[6]=y=>a(e).enableCache=y),enableVersion:a(e).cacheByVersion,"onUpdate:enableVersion":u[7]||(u[7]=y=>a(e).cacheByVersion=y),minutes:a(e).cacheMinutes,"onUpdate:minutes":u[8]||(u[8]=y=>a(e).cacheMinutes=y),queryKeys:a(e).cacheQueryKeys,"onUpdate:queryKeys":u[9]||(u[9]=y=>a(e).cacheQueryKeys=y)},null,8,["enable","enableVersion","minutes","queryKeys"])]),_:1},8,["title"])):Se(_.$slots,k,{key:6})],64))),128))]),_:3},8,["modelValue"])):Ee("",!0)}}});export{et as _,He as u};
