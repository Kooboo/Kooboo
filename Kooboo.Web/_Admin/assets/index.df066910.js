var we=Object.defineProperty,De=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var oe=(k,o,i)=>o in k?we(k,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):k[o]=i,K=(k,o)=>{for(var i in o||(o={}))Se.call(o,i)&&oe(k,i,o[i]);if(ae)for(var i of ae(o))Be.call(o,i)&&oe(k,i,o[i]);return k},M=(k,o)=>De(k,$e(o));var $=(k,o,i)=>new Promise((_,y)=>{var x=E=>{try{L(i.next(E))}catch(C){y(C)}},m=E=>{try{L(i.throw(E))}catch(C){y(C)}},L=E=>E.done?_(E.value):Promise.resolve(E.value).then(x,m);L((i=i.apply(k,o)).next())});import{_ as Ne}from"./relations-tag.b9cbe606.js";import{_ as re}from"./k-table.b1a54b80.js";import{C as Re,a as Ue,S as Ae,b as Te,i as Ie,_ as Fe,g as je,d as Ke,e as Me}from"./edit-dialog.32cd9a43.js";import{u as Oe}from"./use-date.f1258183.js";import{_ as ue}from"./index.f0d5f031.js";import{_ as Je}from"./object-type-tag.6a4036a3.js";import{g as Q,w as Pe,o as qe}from"./i18n.a87944a4.js";import{E as ce}from"./index.b38edc72.js";import{E as ze}from"./index.178b9e08.js";import{E as de}from"./index.c003dfa1.js";import{d as W,g as v,o as g,j as T,w as r,b as n,u as s,f as O,t as h,aI as N,i as G,a as S,k as B,c as z,F as ne,b7 as He,L as H,ch as Ge}from"./url.4cb47a7a.js";import{g as Qe}from"./main.9fdfea92.js";import{B as We}from"./breadcrumb.f4d80c95.js";import{_ as se}from"./icon-button.74ccc970.js";import{S as Xe}from"./search-input.2a27ef56.js";import{b as Ye}from"./confirm.b60b5d2f.js";import{a as Ze}from"./validate.bb56f9e3.js";import{_ as me}from"./plugin-vue_export-helper.21dcd24c.js";import{E as el}from"./index.79632b7d.js";import{E as pe}from"./index.361e2245.js";import{E as ll}from"./index.99e769ef.js";import{E as tl,a as al}from"./index.9fd79879.js";import{c as ie}from"./cloneDeep.c5011aa2.js";import{E as ol}from"./windi.6360286d.js";import{E as nl,a as sl}from"./index.f15f695e.js";import{E as il}from"./index.42922617.js";import{f as rl,e as ul}from"./fold.cabd17e2.js";import"./replace-all.56d2c1f7.js";import"./page.881ec888.js";import"./index.f2c1b903.js";import"./index.c10802d9.js";import"./error.7e8331f1.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./validator.b5df2420.js";import"./index.4d568055.js";import"./index.7b8c5aef.js";import"./guid.c1a40312.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseIsEqual.dc9e64c4.js";import"./index.fd96ea36.js";import"./index.7c862087.js";import"./index.d96452a6.js";import"./event.776e7e11.js";import"./isEqual.4cab74e3.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./sortable.esm.a99254e8.js";import"./index.c6da2706.js";import"./index.f154d010.js";import"./index.c86a187b.js";import"./dropdown.86d3a7fb.js";import"./refs.3132cbdb.js";import"./alert.d2815716.js";import"./dayjs.min.ccc40d4f.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";/* empty css                                                               */import"./plugin-vue_export-helper.41ffa612.js";import"./index.4f90a917.js";/* empty css                                                                 */import"./logo-transparent.1566007e.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./index.d878e15f.js";import"./_baseClone.b8903935.js";const cl={class:"ml-4"},dl=W({props:{modelValue:{type:Boolean},type:null},emits:["update:modelValue","load"],setup(k,{emit:o}){const i=k,{t:_}=Q(),y=v([]),x=v(!0),m=v([]),L=()=>$(this,null,function*(){i.type==="scan"?yield Re(m.value):yield Ue(m.value),x.value=!1,o("load")});return(()=>$(this,null,function*(){i.type==="scan"?y.value=yield Ae():y.value=yield Te()}))(),(C,d)=>{const R=Je,f=ce,w=ze,U=re,I=ue,F=de;return g(),T(F,{"model-value":x.value,title:s(_)("common.result"),width:"1024px","close-on-click-modal":!1,onClosed:d[2]||(d[2]=p=>o("update:modelValue",!1))},{footer:r(()=>[n(I,{permission:{feature:"label",action:"edit"},"confirm-label":i.type==="scan"?s(_)("common.addLabel"):s(_)("common.update"),disabled:!m.value.length,onConfirm:L,onCancel:d[1]||(d[1]=p=>x.value=!1)},null,8,["confirm-label","disabled"])]),default:r(()=>[n(U,{selectedData:m.value,"onUpdate:selectedData":d[0]||(d[0]=p=>m.value=p),data:y.value,"show-check":"","max-height":300,"hide-delete":""},{leftBar:r(()=>[O("span",cl,"("+h(s(_)("common.scanLabelTips"))+")",1)]),default:r(()=>[n(f,{label:s(_)("common.type"),width:"100"},{default:r(({row:p})=>[n(R,{type:p.type},null,8,["type"])]),_:1},8,["label"]),n(f,{label:s(_)("common.displayName"),width:"150"},{default:r(({row:p})=>[N(h(p.displayName),1)]),_:1},8,["label"]),n(f,{label:s(_)("common.attributes"),width:"100"},{default:r(({row:p})=>[N(h(p.attribute),1)]),_:1},8,["label"]),n(f,{label:s(_)("common.key"),width:"300"},{default:r(({row:p})=>[n(w,{modelValue:p.suggestKey,"onUpdate:modelValue":P=>p.suggestKey=P,autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(f,{label:s(_)("common.value")},{default:r(({row:p})=>[N(h(p.tag),1)]),_:1},8,["label"])]),_:1},8,["selectedData","data"])]),_:1},8,["model-value","title"])}}});const ml={key:0,class:"el-upload__tip ml-8"},pl={key:1,class:"mt-12 w-full"},fl=W({props:{modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(k,{emit:o}){const{t:i}=Q(),_={file:Ze(i("common.selectFileTips"))},y=v(!0),x=v(),m=v({file:null}),L=C=>{m.value.file=C},E=()=>$(this,null,function*(){yield x.value.validate();var C=new FormData;C.append("file",m.value.file.raw),yield Ie(C),y.value=!1,o("reload")});return G(()=>m.value.file,()=>{m.value.file&&x.value.clearValidate("file")}),(C,d)=>{const R=pe,f=ll,w=el,U=tl,I=al,F=de;return g(),T(F,{modelValue:y.value,"onUpdate:modelValue":d[3]||(d[3]=p=>y.value=p),width:"600px","close-on-click-modal":!1,title:s(i)("common.import"),onClosed:d[4]||(d[4]=p=>o("update:modelValue",!1))},{footer:r(()=>[n(ue,{"confirm-label":s(i)("common.start"),onConfirm:E,onCancel:d[2]||(d[2]=p=>y.value=!1)},null,8,["confirm-label"])]),default:r(()=>[n(I,{ref_key:"form",ref:x,"label-position":"top",model:m.value,rules:_,onSubmit:d[1]||(d[1]=Pe(()=>{},["prevent"])),onKeydown:qe(E,["enter"])},{default:r(()=>[n(U,{label:s(i)("common.file"),prop:"file"},{default:r(()=>[n(f,{"show-file-list":!1,action:"","auto-upload":!1,"on-change":L,accept:".json","data-cy":"upload"},{default:r(()=>[n(R,{type:"primary",round:"",plain:""},{default:r(()=>[N(h(s(i)("common.selectFile")),1)]),_:1})]),_:1}),m.value.file?B("",!0):(g(),S("div",ml,h(s(i)("common.supportFile")+": .json"),1)),m.value.file?(g(),S("div",pl,[n(w,{title:m.value.file.name,type:"info",onClose:d[0]||(d[0]=p=>m.value.file=null)},null,8,["title"])])):B("",!0)]),_:1},8,["label"])]),_:1},8,["model","onKeydown"])]),_:1},8,["modelValue","title"])}}});var vl=me(fl,[["__scopeId","data-v-78e96995"]]);const _l={class:"p-24"},yl={class:"flex items-center py-24 justify-between"},bl={class:"flex items-center"},gl={class:"flex item-center space-x-16"},hl={key:0},kl={key:1,class:"flex items-center space-x-12"},xl=["title"],El=["title"],Cl={key:0},Vl={key:0,class:"flex items-center justify-end"},Ll=W({setup(k){const{t:o}=Q(),i=v([]),_=v(""),y=v(""),x=v(!1),m=v(!1),L=v(!1),E=v({}),C=v(),d=v([]),R=v(),f=v("default"),w=v([]),U=v([]),I=()=>{U.value=[]},F=()=>{H(()=>{w.value.forEach(t=>{var e,l;(l=(e=R.value.table)==null?void 0:e.toggleRowExpansion)==null||l.call(e,t,!0)})})},p=[{key:"default",value:o("common.defaultList")},{key:"category",value:o("common.categoryList")}],P={Page:o("common.page"),View:o("common.view"),Layout:o("common.layout")},X=(t,e)=>{const l=t.name.toUpperCase(),u=e.name.toUpperCase();return l<u?-1:l>u?1:0};function j(){return $(this,null,function*(){const t=yield je();i.value=t.sort((e,l)=>e.lastModified>l.lastModified?-1:1)})}const fe=()=>{H(()=>{document.querySelectorAll(".el-table__expand-icon").forEach(t=>{var e,l,u,c;(c=(u=(l=(e=t==null?void 0:t.parentElement)==null?void 0:e.parentElement)==null?void 0:l.parentElement)==null?void 0:u.classList)==null||c.add("cursor-pointer")})})},Y=z(()=>{let t=i.value;if(y.value){const e=y.value.trim().toLowerCase();t=t.filter(l=>{var u;if(l.name.toLowerCase().includes(e))return!0;for(let c in l.values)if((u=l.values[c])!=null&&u.toLowerCase().includes(e))return!0;return!1})}return t}),J=z(()=>{I();let t=[],e=[],l=[],u=[];return ie(Y.value).forEach(c=>{let V=c;V.category_label_id=c.name+"-"+c.id,c.relationDetails.length?c.relationDetails.forEach(D=>{const b=e.find(A=>A.id===D.id);if(b)b.children.push(M(K({},V),{category_label_id:D.name+V.id}));else{const A=M(K({},D),{children:[M(K({},V),{category_label_id:D.name+V.id})]});e.push(A),U.value.push(A)}}):l.push(V)}),e.sort(X),e.forEach(c=>{c.children.sort(X)}),t=e.concat(l),t.forEach(c=>{let V=c;if(V.category_label_id=c.name+"-"+c.id,c.type){const D=u.find(b=>b.type===c.type);if(D)D.children.push(V);else{let b=M(K({},c),{name:P[c.type],id:c.type,category_label_id:c.type,children:[V]});u.push(b),U.value.push(b)}}else u.push(c)}),u.sort((c,V)=>{const D=c.type,b=V.type;return D<b?-1:D>b?1:0}),u}),q=(t=J.value)=>{w.value=U.value,t.forEach(e=>{var l,u;(u=(l=R.value.table)==null?void 0:l.toggleRowExpansion)==null||u.call(l,e,!0),e.children&&q(e.children)})},Z=(t=J.value)=>{t.forEach(e=>{var l,u;(u=(l=R.value.table)==null?void 0:l.toggleRowExpansion)==null||u.call(l,e,!1),e.children&&Z(e.children),w.value=[]})},ve=t=>{var e,l;t!=null&&t.children&&((l=(e=R.value.table)==null?void 0:e.toggleRowExpansion)==null||l.call(e,t),w.value.find(u=>u.id===t.id)?w.value=w.value.filter(u=>u.id!==t.id):w.value.push(t))};function _e(t){return $(this,null,function*(){yield Ye(t.length);const e=t.map(l=>l.id);yield Ke({ids:e}),j()})}const ee=Qe();function le(t){return t.values[ee.default]||""}function ye(t){return $(this,null,function*(){E.value=ie(t),x.value=!0})}function be(){return $(this,null,function*(){E.value={id:"",values:Object.fromEntries(ee.selected.map(t=>[t,""]))},x.value=!0})}function ge(){y.value=_.value,y.value&&f.value==="category"&&H(()=>{q()})}function he(t){t&&j()}const ke=Ge(ge,1e3),xe=()=>{C.value="scan",m.value=!0},Ee=()=>$(this,null,function*(){C.value="scanI18n",m.value=!0}),Ce=()=>$(this,null,function*(){yield Me()}),Ve=t=>{let e=JSON.parse(JSON.stringify(t));if(delete e.category_label_id,d.value.find(l=>l.id===e.id))d.value=d.value.filter(l=>l.id!==e.id);else if(e.relationDetails.length&&f.value==="category")for(let l=0;l<e.relationDetails.length;l++)d.value.push(e);else d.value.push(e)},Le=z(()=>t=>{let e=JSON.parse(JSON.stringify(t));return delete e.category_label_id,d.value.some(l=>l.id===e.id)});return G(()=>_.value,()=>{ke()}),G(()=>[f.value,J.value],()=>{f.value==="category"&&w.value.length&&F(),f.value==="category"&&fe()}),j(),(t,e)=>{const l=pe,u=ol,c=nl,V=sl,D=il,b=ce,A=Ne;return g(),S("div",_l,[n(We,{name:s(o)("common.labels")},null,8,["name"]),O("div",yl,[O("div",bl,[n(l,{round:"","data-cy":"scan",onClick:be},{default:r(()=>[N(h(s(o)("common.new")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[0]||(e[0]=a=>xe())},{default:r(()=>[N(h(s(o)("common.scanlabel")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[1]||(e[1]=a=>Ee())},{default:r(()=>[N(h(s(o)("common.ScanI18N")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[2]||(e[2]=a=>Ce())},{default:r(()=>[n(u,{class:"iconfont icon-share"}),N(" "+h(s(o)("common.export")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[3]||(e[3]=a=>L.value=!0)},{default:r(()=>[n(u,{class:"mr-16 iconfont icon-a-Pullin"}),N(" "+h(s(o)("common.import")),1)]),_:1})]),n(Xe,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),class:"w-238px",placeholder:s(o)("common.searchLabels"),clearable:"","data-cy":"search"},null,8,["modelValue","placeholder"])]),n(s(re),{ref_key:"tableRef",ref:R,selectedData:d.value,"onUpdate:selectedData":e[8]||(e[8]=a=>d.value=a),data:f.value==="default"?s(Y):s(J),"show-check":"",permission:{feature:"label",action:"delete"},"row-key":f.value==="default"?"id":"category_label_id","custom-check":"","is-multi-tree-table":!0,onDelete:_e,onRowClick:ve},{leftBar:r(()=>[O("div",gl,[n(V,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),class:"el-radio-group--rounded"},{default:r(()=>[(g(),S(ne,null,He(p,a=>n(c,{key:a.key,label:a.key,"data-cy":a.key},{default:r(()=>[N(h(a.value),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"]),f.value==="category"?(g(),S(ne,{key:0},[n(l,{circle:"",icon:s(rl),title:s(o)("common.foldAll"),"data-cy":"fold-all",onClick:e[6]||(e[6]=a=>Z())},null,8,["icon","title"]),n(l,{circle:"",icon:s(ul),title:s(o)("common.expandAll"),"data-cy":"expand-all",onClick:e[7]||(e[7]=a=>q())},null,8,["icon","title"])],64)):B("",!0)])]),default:r(()=>[n(b,{label:s(o)("common.name"),prop:"name","class-name":"expanded-column"},{default:r(({row:a})=>[a.children?(g(),S("span",hl,h(a.name),1)):(g(),S("span",kl,[n(D,{size:"large","model-value":s(Le)(a),"data-cy":"checkbox-label",onChange:te=>Ve(a)},null,8,["model-value","onChange"]),O("span",{class:"ellipsis",title:a.name,"data-cy":"name"},h(a.name),9,xl)]))]),_:1},8,["label"]),n(b,{label:s(o)("common.value")},{default:r(({row:a})=>[a.children?B("",!0):(g(),S("div",{key:0,class:"ellipsis",title:le(a),"data-cy":"value"},h(le(a)),9,El))]),_:1},8,["label"]),f.value==="default"?(g(),T(b,{key:0,label:s(o)("common.usedBy"),width:"200"},{default:r(({row:a})=>[n(A,{id:a.id,relations:a.relations,type:"label"},null,8,["id","relations"])]),_:1},8,["label"])):B("",!0),n(b,{label:s(o)("common.lastModified"),width:"180"},{default:r(({row:a})=>[a.children?B("",!0):(g(),S("span",Cl,h(s(Oe)(a.lastModified)),1))]),_:1},8,["label"]),n(b,{width:"100"},{default:r(({row:a})=>[a.children?B("",!0):(g(),S("div",Vl,[n(se,{class:"inline-flex",icon:"icon-a-writein",tip:s(o)("common.edit"),"data-cy":"edit",onClick:te=>ye(a)},null,8,["tip","onClick"]),n(se,{class:"inline-flex",icon:"icon-time",permission:{feature:"site",action:"log"},tip:s(o)("common.version"),"data-cy":"versions",onClick:te=>t.$router.goLogVersions(a.keyHash,a.storeNameHash)},null,8,["tip","onClick"])]))]),_:1})]),_:1},8,["selectedData","data","row-key"]),x.value?(g(),T(Fe,{key:0,modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=a=>x.value=a),current:E.value,onSuccess:he},null,8,["modelValue","current"])):B("",!0),m.value?(g(),T(dl,{key:1,modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=a=>m.value=a),type:C.value,onLoad:j},null,8,["modelValue","type"])):B("",!0),L.value?(g(),T(vl,{key:2,modelValue:L.value,"onUpdate:modelValue":e[11]||(e[11]=a=>L.value=a),onReload:j},null,8,["modelValue"])):B("",!0)])}}});var Ht=me(Ll,[["__scopeId","data-v-29fac599"]]);export{Ht as default};
