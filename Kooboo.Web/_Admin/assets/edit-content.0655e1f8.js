var K=(y,T,c)=>new Promise((h,V)=>{var b=x=>{try{E(c.next(x))}catch(f){V(f)}},g=x=>{try{E(c.throw(x))}catch(f){V(f)}},E=x=>x.done?h(x.value):Promise.resolve(x.value).then(b,g);E((c=c.apply(y,T)).next())});import{g as Z,v as pe,w as fe}from"./i18n.a87944a4.js";import{g as me,d as ve,a as _e,l as ye}from"./textContent.09908244.js";import{g as he,u as ge}from"./main.9fdfea92.js";import{u as be,g as xe,_ as Ce}from"./index.562b5616.js";import{G as we}from"./index.b9a74c44.js";import{_ as Ve}from"./index.f154d010.js";import{u as ne}from"./index.5ed58b47.js";import{u as le}from"./use-operation-dialog.4f6d7533.js";import{_ as Ee}from"./k-table.b1a54b80.js";import{_ as se}from"./index.f0d5f031.js";import{E as ke}from"./index.42922617.js";import{E as Se}from"./index.b38edc72.js";import{E as ae}from"./index.c003dfa1.js";import{br as Oe,cs as Ie,d as X,g as $,i as W,o as w,j as J,w as I,b as A,u as D,f as P,a as G,b7 as Q,F as R,H as re,aI as Y,t as z,aA as ie,c as H,L as ue,h as de,aX as Fe,k as ee,K as Te,cj as Le,e as Ne,x as $e}from"./url.4cb47a7a.js";import{_ as te}from"./index.0e5d639d.js";import{E as ce,a as je}from"./index.9fd79879.js";import{u as Ae}from"./use-save-tip.e3dc783a.js";import{_ as De}from"./plugin-vue_export-helper.21dcd24c.js";import{v as Be,b as Je}from"./style.c350d462.js";import{s as Me}from"./confirm.b60b5d2f.js";import{c as Ue}from"./index.7c862087.js";import{E as Ge}from"./windi.6360286d.js";import{E as Pe}from"./index.361e2245.js";import{E as Ke,a as Re,b as ze}from"./index.c86a187b.js";function qe(y,T,c,h){for(var V=-1,b=y==null?0:y.length;++V<b;){var g=y[V];T(h,g,c(g),y)}return h}function He(y,T,c,h){return Be(y,function(V,b,g){T(h,V,c(V),g)}),h}function Qe(y,T){return function(c,h){var V=Oe(c)?qe:He,b=T?T():{};return V(c,y,Je(h),b)}}var Xe=Object.prototype,Ye=Xe.hasOwnProperty,We=Qe(function(y,T,c){Ye.call(y,c)?y[c].push(T):Ie(y,c,[T])}),Ze=We;const et={class:"flex items-center"},tt=X({props:{modelValue:{type:Boolean},current:null},setup(y,{emit:T}){const c=y,{t:h}=Z(),{visible:V,handleClose:b}=le(c,T),g=$([]),E=$({}),x=$([]),f=$([]);W(()=>c.current,e=>{e.categoryFolder&&N()}),W(()=>c.modelValue,e=>{e&&(f.value=c.current.contents.map(d=>d.id))});function N(){return K(this,null,function*(){const e=yield me({folderId:c.current.categoryFolder.id,pageNr:1,pageSize:99999});F(e.list,e.columns)})}function F(e,d){var j,o;const B={};e.forEach(l=>{B[l.id]=l}),E.value=B;const S=Object.keys((o=(j=e[0])==null?void 0:j.textValues)!=null?o:{})[0];if(S){x.value=[S];const l=d.find(t=>t.name==S);g.value=e.map(t=>{let a=t.textValues[S];if(l!=null&&l.selectionOptions)try{const O=JSON.parse(l.selectionOptions);let U=[a];l.controlType=="CheckBox"&&(U=JSON.parse(a));const n=[];for(const v of U){const p=O.find(u=>u.value==v);p?n.push(p.key):n.push(v)}a=n.join(",")}catch(O){}return{id:t.id,[S]:a}})}}function k(){c.current.contents=f.value.map(e=>{const d=E.value[e];return d||null}).filter(e=>e).map((e,d)=>(e.order=d,e)),b()}function m(e){const d=f.value.indexOf(e);d>-1?f.value.splice(d,1):c.current.multipleChoice?f.value.push(e):f.value=[e]}return(e,d)=>{const B=ke,S=Se,j=ae;return w(),J(j,{modelValue:D(V),"onUpdate:modelValue":d[0]||(d[0]=o=>re(V)?V.value=o:null),width:"600px","close-on-click-modal":!1,title:D(h)("common.categories"),"custom-class":"el-dialog--fixed-footer",onClose:D(b)},{footer:I(()=>[A(se,{onConfirm:k,onCancel:D(b)},null,8,["onCancel"])]),default:I(()=>[A(D(Ee),{data:g.value},{default:I(()=>[A(S,{width:"50"},{default:I(o=>[P("div",et,[A(B,{size:"large",class:"pl-14px","model-value":f.value.includes(o.row.id),onChange:l=>m(o.row.id)},null,8,["model-value","onChange"])])]),_:1}),(w(!0),G(R,null,Q(x.value,o=>(w(),J(S,{key:o,prop:o,label:o},null,8,["prop","label"]))),128))]),_:1},8,["data"])]),_:1},8,["modelValue","title","onClose"])}}}),ot=X({props:{modelValue:null},emits:["update:modelValue"],setup(y,{emit:T}){const h=ne(y,"modelValue",T),V=$(!1),b=$({});function g(N,F){var d,B;let k=(d=N.summaryField)!=null?d:Object.keys(N.textValues)[0];k=(B=Object.keys(N.textValues).find(S=>S.toLowerCase()==k.toLowerCase()))!=null?B:"";let m=N.textValues[k];const e=F.columns.find(S=>{var j;return((j=S.name)==null?void 0:j.toLowerCase())==(k==null?void 0:k.toLowerCase())});if(e!=null&&e.selectionOptions)try{const S=JSON.parse(e.selectionOptions);let j=[m];e.controlType=="CheckBox"&&(j=JSON.parse(m));const o=[];for(const l of j){const t=S.find(a=>a.value==l);t?o.push(t.key):o.push(l)}m=o.join(",")}catch(S){}return m}function E(N,F,k){k.list.splice(k.index,1)}function x(N){b.value=N,V.value=!0}function f(N,F){const k=N.splice(F.oldIndex,1)[0];N.splice(F.newIndex,0,k),N.forEach((m,e)=>{m.order=e})}return(N,F)=>{const k=ce;return w(),G(R,null,[(w(!0),G(R,null,Q(D(h),(m,e)=>(w(),J(k,{key:e,label:m.display||m.alias},{default:I(()=>[A(te,{class:"!p-0 min-w-600px",list:m.contents,"id-prop":"id",onSort:d=>f(m.contents,d),onDelete:E,onAdd:d=>x(m)},{default:I(({item:d})=>[Y(z(g(d,m)),1)]),_:2},1032,["list","onSort","onAdd"])]),_:2},1032,["label"]))),128)),(w(),J(ie,{to:"body"},[A(tt,{modelValue:V.value,"onUpdate:modelValue":F[0]||(F[0]=m=>V.value=m),current:b.value},null,8,["modelValue","current"])]))],64)}}});const nt={class:"flex items-center gap-8 max-w-700px truncate"},lt=["title"],st={key:0,class:"el-dialog__title"},at=X({props:{modelValue:{type:Boolean},current:null,currentContent:null,paths:null},emits:["save-success"],setup(y,{emit:T}){const c=y,h=_t,{t:V}=Z(),{visible:b,handleClose:g}=le(c,T),E=H(()=>c.current.embeddedFolder.id),x=H(()=>{var e;return(e=c.currentContent)==null?void 0:e.id}),f=$();function N(){return K(this,null,function*(){var d;const e=yield(d=f.value)==null?void 0:d.save();e&&(T("save-success",{id:e.id,textValues:e.values[Object.keys(e.values)[0]]}),g())})}const F=H(()=>{let e=c.paths;return e||(e=[]),e.length&&!e[e.length-1]&&(e.pop(),e.push(V("common.createEmbedded"))),e.length||e.push(V("common.createEmbedded")),e}),k=$();W(()=>b.value,()=>{ue(()=>{b.value?(k.value=Array.from(document.querySelectorAll(".el-overlay")).map(e=>parseInt(e.style.zIndex)).sort((e,d)=>d-e)[0],document.body.style.setProperty("--tox-tinymce-aux-index",k.value),document.body.classList.add("editEmbeddedDialog")):document.body.classList.remove("editEmbeddedDialog")})});function m(e){e.stopImmediatePropagation()}return de(()=>{window.addEventListener("focusout",m,!0)}),Fe(()=>{window.removeEventListener("focusout",m)}),(e,d)=>{const B=ae;return w(),J(B,{modelValue:D(b),"onUpdate:modelValue":d[0]||(d[0]=S=>re(b)?b.value=S:null),width:"800px","close-on-click-modal":!1,"custom-class":"el-dialog--fixed-footer editEmbeddedDialog","destroy-on-close":"",onClose:D(g)},{header:I(()=>[P("div",nt,[(w(!0),G(R,null,Q(D(F),(S,j)=>(w(),G(R,{key:j},[P("div",{class:"el-dialog__title truncate",title:S},z(S),9,lt),j<D(F).length-1?(w(),G("div",st,">")):ee("",!0)],64))),128))])]),footer:I(()=>[A(se,{onConfirm:N,onCancel:D(g)},null,8,["onCancel"])]),default:I(()=>[A(D(h),{id:D(x),ref_key:"editContent",ref:f,"folder-id":D(E),paths:y.paths},null,8,["id","folder-id","paths"])]),_:1},8,["modelValue","onClose"])}}}),rt={class:"flex items-center"},it={class:"flex-1 truncate"},ut=["onClick"],dt={class:"flex gap-8"},ct=["onClick"],pt=X({props:{modelValue:null,id:null,paths:null},emits:["update:modelValue"],setup(y,{emit:T}){const c=y,{t:h}=Z(),V=ne(c,"modelValue",T),b=$(!1),g=$({}),E=$(),x=H(()=>{const o=[];for(const t of V.value)if(t.group){var l=o.find(a=>a.some(O=>O.group==t.group));l?l.push(t):o.push([t])}else o.push([t]);return o});function f(o,l){var U,n,v,p;if(!o)return"";let t=(v=(n=o.summaryField)!=null?n:(U=l.columns.find(u=>u.isSummaryField))==null?void 0:U.name)!=null?v:Object.keys(o.textValues)[0];t=(p=Object.keys(o.textValues).find(u=>u.toLowerCase()==t.toLowerCase()))!=null?p:"";var a=o.textValues[t];const O=l.columns.find(u=>{var r;return((r=u.name)==null?void 0:r.toLowerCase())==(t==null?void 0:t.toLowerCase())});if(O!=null&&O.selectionOptions)try{const u=JSON.parse(O.selectionOptions);let r=[a];O.controlType=="CheckBox"&&(r=JSON.parse(a));const _=[];for(const i of r){const M=u.find(s=>s.value==i);M?_.push(M.key):_.push(i)}a=_.join(",")}catch(u){}return a}function N(o,l){const t=l.find(a=>a.contents.indexOf(o)>-1);return f(o,t)}function F(o,l){const t=l.find(a=>a.contents.indexOf(o)>-1);return(t==null?void 0:t.display)||(t==null?void 0:t.alias)}function k(o,l,t){return K(this,null,function*(){yield Me(h("common.deleteEmbeddedFolderTips"));const a=t.list.splice(t.index,1);ve({ids:a.map(O=>O.id),parentId:c.id});for(const O of V.value){const U=O.contents.findIndex(n=>{var v;return n.id==((v=a[0])==null?void 0:v.id)});U>-1&&O.contents.splice(U,1)}})}function m(o,l){g.value=o,E.value=l,b.value=!0}function e(o,l){const t=o.find(a=>a.contents.indexOf(l)>-1);return m(t,l)}function d(o){if(E.value)E.value.textValues=o.textValues;else{if(g.value.group){const l=x.value.find(t=>t.some(a=>a.group==g.value.group));if(l){let t=0;for(const a of l)for(const O of a.contents)O.order>t&&(t=O.order);o.order=t+1}}g.value.contents.push(o)}}function B(o,l){const t=o.splice(l.oldIndex,1)[0];o.splice(l.newIndex,0,t),o.forEach((a,O)=>{a.order=O})}function S(o){var t;if(o.some(a=>a.group)){var l=(t=o[0].group)==null?void 0:t.split("##name##")[1];if(l)return l}return o.map(a=>a.display||a.alias).join(",")}function j(o){var l=[];for(const t of o)l.push(...t.contents);return l.sort((t,a)=>t.order>a.order?1:-1)}return(o,l)=>{var u;const t=Ue,a=Ge,O=Pe,U=Ke,n=Re,v=ze,p=ce;return w(),G(R,null,[(w(!0),G(R,null,Q(D(x),(r,_)=>(w(),J(p,{key:_,label:S(r)},{default:I(()=>[r.some(i=>i.group)&&r.length>1?(w(),J(te,{key:0,class:"!p-0 min-w-600px",list:j(r),"id-prop":"id",onSort:i=>B(j(r),i),onDelete:k},{default:I(({item:i})=>[P("div",rt,[P("div",it,z(N(i,r)),1),A(t,{round:"",class:"flex-shrink-0"},{default:I(()=>[Y(z(F(i,r)),1)]),_:2},1024)])]),right:I(({item:i})=>[P("a",{class:"cursor-pointer px-4 hover:text-blue","data-cy":"edit",onClick:M=>e(r,i)},[A(a,{class:"iconfont icon-a-writein"})],8,ut)]),bottom:I(()=>[A(v,{trigger:"click","max-height":"300px",onCommand:i=>m(r.find(M=>M.embeddedFolder==i))},{dropdown:I(()=>[A(n,null,{default:I(()=>[(w(!0),G(R,null,Q(r,i=>(w(),J(U,{key:i.embeddedFolder,command:i.embeddedFolder},{default:I(()=>[P("div",dt,[P("span",null,z(D(h)("common.create")),1),A(t,{round:"",type:"info"},{default:I(()=>[Y(z(i.display||i.alias),1)]),_:2},1024)])]),_:2},1032,["command"]))),128))]),_:2},1024)]),default:I(()=>[A(O,{circle:"","data-cy":"add"},{default:I(()=>[A(a,{class:"text-blue iconfont icon-a-addto"})]),_:1})]),_:2},1032,["onCommand"])]),_:2},1032,["list","onSort"])):(w(),J(te,{key:1,class:"!p-0 min-w-600px",list:r[0].contents,"id-prop":"id",onSort:i=>B(r[0].contents,i),onDelete:k,onAdd:i=>m(r[0])},{default:I(({item:i})=>[Y(z(f(i,r[0])),1)]),right:I(({item:i})=>[P("a",{class:"cursor-pointer px-4 hover:text-blue","data-cy":"edit",onClick:M=>m(r[0],i)},[A(a,{class:"iconfont icon-a-writein"})],8,ct)]),_:2},1032,["list","onSort","onAdd"]))]),_:2},1032,["label"]))),128)),(w(),J(ie,{to:"body"},[A(at,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=r=>b.value=r),current:g.value,"current-content":E.value,paths:[...(u=y.paths)!=null?u:[],f(E.value,g.value)],onSaveSuccess:d},null,8,["modelValue","current","current-content","paths"])]))],64)}}});const ft={class:"edit-data"},mt={class:"flex justify-end mb-8"},vt=X({props:{folderId:null,contentType:null,id:null,paths:null,associated:{type:Boolean}},emits:["dataLoad"],setup(y,{expose:T,emit:c}){const h=y,{t:V}=Z(),b=$(),g=$([]),E=$([]),x=$([]),f=$({}),N=$({}),F=he(),k=$(!1),m=Ae(),e=ge(),d=$([]);de(()=>K(this,null,function*(){yield S(),h.associated||m.init([f.value,E.value,x.value])}));const B=H(()=>F.visible&&Object.keys(F.cultures).length>1);Te(()=>{e.firstActiveMenu=""});function S(){return K(this,null,function*(){k.value=!0;const n=yield _e({id:h.id,folderId:h.folderId,typeId:h.contentType});c("dataLoad",n),k.value=!1,o(n.properties),E.value=n.categories||[],x.value=n.embedded||[],n.fieldsOrder&&(d.value=n.fieldsOrder)})}Le((n,v,p)=>K(this,null,function*(){var u;if(h.associated)return p();n.name==="login"?p():(e.firstActiveMenu=(u=n.meta.activeMenu)!=null?u:n.name,yield m.check([f.value,E.value,x.value]).then(()=>{p()}).catch(()=>{e.firstActiveMenu="contents",p(!1)}))}));const{getControlType:j}=be();function o(n){if(!n||n.length===0)return;const v=F.default,p=[],u={},r={};n.forEach(_=>{Object.keys(_.values).sort((s,L)=>s===v?-1:L===v?1:0).map(s=>({lang:s,value:_.values[s]})).forEach(s=>{var oe;const L={lang:s.lang,name:_.name,displayName:_.isMultilingual&&B.value?_.displayName+" ("+s.lang+")":_.displayName,prop:_.name+"_"+s.lang,toolTip:_.toolTip,selectionOptions:JSON.parse(_.selectionOptions||"[]")||[],validations:JSON.parse((oe=_.validations)!=null?oe:"[]")||[],multipleValue:_.multipleValue,isMultilingual:_.isMultilingual,controlType:_.controlType,settings:JSON.parse(_.settings||"{}")||{}};p.push(L);let C=s.value;if(L.multipleValue)C=JSON.parse(C||"[]");else{let q=j(_.controlType);q&&(q.value==="Switch"?C&&typeof C=="string"?C=JSON.parse(C.toLowerCase()):C=!!C:q.value==="CheckBox"?C=C?JSON.parse(C):[]:q.value==="KeyValues"?C=C?JSON.parse(C):[]:q.value==="ValueList"?C=C?JSON.parse(C):[]:q.value==="Number"&&(C=C===null?void 0:C))}u[L.prop]=C,r[L.prop]=xe(L)})}),g.value=p,f.value=u,N.value=r}function l(){return K(this,arguments,function*(n={}){var _,i,M;try{yield(_=b.value)==null?void 0:_.validate()}catch(s){throw yield a(s),s}const v=Ze(g.value,s=>s.lang);for(const s in v)n[s]={},v[s].forEach(L=>{let C=f.value[L.prop];(L.multipleValue||Array.isArray(C))&&(C=JSON.stringify(C)),n[s][L.name]=C===void 0?null:C});const p={};(i=E.value)==null||i.forEach(s=>{p[s.categoryFolder.id]=s.contents.map(L=>L.id)});const u={};return(M=x.value)==null||M.forEach(s=>{u[s.embeddedFolder.id]=s.contents.map(L=>({id:L.id,order:L.order}))}),{id:$e("copy")?void 0:h.id,folderId:h.folderId,typeId:h.contentType,values:n,categories:p,embedded:u}})}function t(){return K(this,null,function*(){const n={},v=yield l(n),p=yield ye(v);return m.init([f.value,E.value,x.value]),{id:p,values:n}})}function a(n){return K(this,null,function*(){var v;if(B.value)for(const p in F.cultures)F.selected.includes(p)||F.selectedChanged(p);if(n&&typeof n=="object"){const p=Object.keys(n)[0];yield ue(),(v=b.value)==null||v.scrollToField(p)}})}function O(n){if(!(h.associated&&n.name=="Online"))return F.selected.includes(n.lang)}T({save:t,getSaveData:l}),W(()=>[f.value,E.value,x.value],()=>{m.changed([f.value,E.value,x.value])},{deep:!0});var U=H(()=>{var n=[];let v=g.value?[...g.value]:[],p=x.value?[...x.value]:[],u=E.value?[...E.value]:[];for(const r of d.value){const _=v.find(s=>s.name==r);if(_){n.push({type:"field",value:_}),v=v.filter(s=>s.name!=r);continue}const i=p.find(s=>s.alias==r||s.group==r);if(i){let s=[i];i.group&&(s=p.filter(L=>L.group==i.group)),p=p.filter(L=>!s.includes(L)),n.push({type:"embedded",value:s})}const M=u.find(s=>s.alias==r);if(M){let s=[M];u=u.filter(L=>!s.includes(L)),n.push({type:"category",value:s})}}for(const r of v)n.push({type:"field",value:r});return n.push({type:"embedded",value:p}),n.push({type:"category",value:u}),n});return(n,v)=>{const p=je;return w(),G("div",ft,[P("div",mt,[A(Ve)]),g.value.length?(w(),J(p,{key:0,ref_key:"form",ref:b,"label-position":"top",model:f.value,rules:N.value,onSubmit:v[0]||(v[0]=fe(()=>{},["prevent"]))},{default:I(()=>[(w(!0),G(R,null,Q(D(U),(u,r)=>{var _;return w(),G(R,null,[u.type=="field"?Ne((w(),J(Ce,{key:r+"field",field:u.value,model:f.value},null,8,["field","model"])),[[pe,O(u.value)]]):u.type=="category"?(w(),J(ot,{key:r+"category",modelValue:u.value,"onUpdate:modelValue":i=>u.value=i},null,8,["modelValue","onUpdate:modelValue"])):u.type=="embedded"?(w(),J(pt,{id:y.id,key:r+"embedded",modelValue:u.value,"onUpdate:modelValue":i=>u.value=i,paths:[...(_=y.paths)!=null?_:[]]},null,8,["id","modelValue","onUpdate:modelValue","paths"])):ee("",!0)],64)}),256))]),_:1},8,["model","rules"])):k.value?ee("",!0):(w(),J(we,{key:1},{default:I(()=>[P("p",null,z(D(V)("common.noFieldYet")),1)]),_:1}))])}}});var _t=De(vt,[["__scopeId","data-v-585a5617"]]);export{_t as E};
