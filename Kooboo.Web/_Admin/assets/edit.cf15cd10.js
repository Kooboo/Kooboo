var Q=Object.defineProperty,W=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var R=(l,i,a)=>i in l?Q(l,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[i]=a,U=(l,i)=>{for(var a in i||(i={}))X.call(i,a)&&R(l,a,i[a]);if(I)for(var a of I(i))Y.call(i,a)&&R(l,a,i[a]);return l},M=(l,i)=>W(l,K(i));var F=(l,i,a)=>new Promise((c,u)=>{var E=f=>{try{e(a.next(f))}catch(w){u(w)}},d=f=>{try{e(a.throw(f))}catch(w){u(w)}},e=f=>f.done?c(f.value):Promise.resolve(f.value).then(E,d);e((a=a.apply(l,i)).next())});import{T as Z,H as ee,a5 as oe,_ as te}from"./dev-mode.1f379952.js";import{e as ie}from"./guid.c1a40312.js";import{d as A,g as h,h as re,aW as ae,i as L,o as x,a as H,f as k,b as m,w as v,aH as O,t as C,u as p,n as ne,j as T,k as N,F as q,cd as le,x as J,cj as se,b7 as me,e as pe}from"./url.8f5ec20c.js";import{u as j}from"./replace-all.d441bf14.js";import{c as ue}from"./index.72ccc088.js";import{_ as de}from"./index.5f76a3ad.js";import{u as ce}from"./use-save-tip.8f44d6c0.js";import{U as fe}from"./editor.main.d2800f63.js";import{g as z}from"./i18n.bcd18f8a.js";import{_ as ve}from"./icon-button.315b6443.js";import{E as _e}from"./edit-field-dialog.26db5761.js";import{_ as ye}from"./k-table.7d05e82e.js";import{u as ge}from"./index.8dbd37cf.js";import{_ as be}from"./plugin-vue_export-helper.21dcd24c.js";import{c as P}from"./cloneDeep.060340c1.js";import{E as we}from"./windi.19264205.js";import{E as G}from"./index.aec72f69.js";import{E as he}from"./index.b83a1079.js";import{_ as ke}from"./index.7a75fca3.js";import{E as Se}from"./index.d4a6b2d5.js";import{E as Ve}from"./main.582f9de6.js";import"./index.79f78425.js";import"./error.7e8331f1.js";import"./userWorker.b3a6730b.js";import"./config.812575d1.js";import"./dark.166fd971.js";import"./page.e927203a.js";import"./validate.238a9986.js";import"./index.2341329b.js";import"./index.bda83f28.js";import"./index.bff48780.js";import"./index.649f6c77.js";import"./index.a32fb6e5.js";import"./style.9c8f6403.js";import"./toNumber.6efebd6a.js";import"./_baseIsEqual.547729d3.js";import"./index.6d63eb53.js";import"./index.05e21f33.js";import"./_baseClone.eeff2792.js";import"./isEqual.11d86bcc.js";import"./index.10f642b2.js";import"./index.5cbbc5d7.js";import"./event.776e7e11.js";import"./isNil.98bb3b88.js";import"./index.a3d8335f.js";import"./scroll.4888a9e9.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.eafcfd1f.js";import"./validator.b73911a9.js";import"./index.c80f5028.js";import"./index.8bc4b1d6.js";import"./index.ec6ad7db.js";import"./dropdown.f6378640.js";import"./refs.d2253dd4.js";import"./use-copy-text.c117d066.js";import"./index.73c941f5.js";import"./toggleComment.5b29ca87.js";import"./confirm.eadb49f1.js";import"./logo-transparent.1566007e.js";import"./index.373c837a.js";import"./index.59b1471f.js";import"./index.6d22f937.js";import"./debounce.730e1961.js";import"./index.9a83ee01.js";import"./vuedraggable.umd.7929a3b6.js";import"./index.4dc50d47.js";import"./index.daafc4da.js";import"./index.3be79fd5.js";import"./index.79dc05e0.js";import"./index.ff00fbd6.js";import"./index.57a23e6d.js";import"./alert.8fe5500a.js";import"./index.d84e2378.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.c0b84b74.js";/* empty css                                                          */import"./file.734aeed6.js";import"./use-date.a1321c18.js";import"./dayjs.min.59f10137.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.c73251ef.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.53a9e945.js";import"./image-editor.f97cfa84.js";import"./main.esm.6441082b.js";import"./index.7633560d.js";import"./classCompletion.a22e38a6.js";import"./preload-helper.13a99eb0.js";import"./index.3a977dfb.js";import"./tooltip.e27982e5.js";import"./key-value-editor.958730ca.js";import"./selection-editor.8e0c8e3a.js";import"./index.0a8d3d17.js";import"./index.e3f90979.js";import"./index.7bc7000f.js";import"./index.a0617677.js";import"./editable-tags.310754fc.js";import"./index.4ecdcecf.js";import"./_baseIndexOf.4d7985be.js";import"./index.af31fb90.js";import"./index.2cfdc153.js";import"./string.75b81683.js";import"./isEmpty.8640792d.js";import"./index.6c05d6c4.js";import"./sortable.esm.a99254e8.js";import"./index.564bc658.js";import"./index.20b12391.js";import"./media-dialog.31d6c41c.js";import"./breadcrumb.edaec300.js";import"./plugin-vue_export-helper.41ffa612.js";import"./media.71de4b30.js";import"./index.b8a66e09.js";import"./search-provider.17b07ede.js";import"./last.e7aa49db.js";import"./_baseUniq.098d08d2.js";import"./use-operation-dialog.175b540a.js";import"./folder.8308bb9d.js";import"./relations-tag.7a82bbd0.js";import"./index.ea2df5df.js";import"./browser.6efdef8a.js";import"./throttle.3f3ee457.js";import"./search-input.5b2e8d23.js";import"./layout.29f65550.js";import"./index.4972d853.js";import"./position.f6e7bc86.js";import"./utils.dd51a1eb.js";import"./index.99c245f4.js";import"./index.55babe62.js";import"./file.eef7ed38.js";import"./pick.80c375ab.js";import"./_basePickBy.0604ed3c.js";import"./index.ccf403d8.js";import"./index.f78668f8.js";import"./index.d6799c63.js";import"./index.50c16ae5.js";const xe={class:"flex items-center pb-24"},Ce={"data-cy":"display-name"},Ee={"data-cy":"control-type"},Fe=A({props:{modelValue:null,permission:null,propertyOptions:null,showDefaultValue:{type:Boolean},hidePreviewField:{type:Boolean},enableDynamicOptions:{type:Boolean}},emits:["update:model-value"],setup(l,{emit:i}){const a=l,c=h(),{t:u}=z(),{getControlType:E}=ge(),d=h(!1),e=h([]);re(()=>{e.value=w(a.modelValue.map(t=>{const o=P(t);return _(o,"selectionOptions"),_(o,"validations"),_(o,"settings"),o}))}),ae(()=>{e.value=[],c.value=void 0,d.value=!1});const f=t=>{const o={};t.forEach((n,y)=>{n.order=y,o[n.name]=n}),e.value=w(e.value).map(n=>o[n.name]||n)};function w(t){return t.sort((o,n)=>{if(o.isSystemField!==n.isSystemField){if(o.isSystemField)return 1;if(n.isSystemField)return-1}return o.order>n.order?1:-1})}function S(t){return F(this,null,function*(){e.value.splice(t,1)})}function _(t,o){t[o]?t[o]=typeof t[o]=="string"?JSON.parse(t[o]):t[o]:t[o]=[]}function D(t,o){return typeof t[o]=="string"?t[o]:JSON.stringify(t[o])}function $(){c.value=void 0,d.value=!0}function B(t){c.value=P(t),_(c.value,"selectionOptions"),_(c.value,"validations"),_(c.value,"settings"),d.value=!0}return L(()=>e.value,t=>{const o=t.map(n=>M(U({},n),{selectionOptions:D(n,"selectionOptions"),validations:D(n,"validations"),settings:D(n,"settings")}));i("update:model-value",o)},{deep:!0}),(t,o)=>{const n=we,y=G,r=he,g=ve;return x(),H(q,null,[k("div",xe,[m(y,{round:"","data-cy":"new-field",onClick:$},{default:v(()=>[m(n,{class:"iconfont icon-a-addto"}),O(" "+C(p(u)("common.newField")),1)]),_:1})]),m(p(ye),{ref:"table",data:e.value,"row-class-name":({row:s,rowIndex:V})=>s.isSystemField?"":"draggable",draggable:".draggable","row-key":"name",onSorted:o[0]||(o[0]=s=>f(s))},{default:v(()=>[m(r,{label:p(u)("common.name")},{default:v(({row:s})=>[k("span",{class:ne({"text-999":s.isSystemField}),"data-cy":"field-name"},C(s.name),3)]),_:1},8,["label"]),m(r,{label:p(u)("common.displayName")},{default:v(({row:s})=>[k("span",Ce,C(s.displayName),1)]),_:1},8,["label"]),m(r,{label:p(u)("common.controlType"),width:"200"},{default:v(({row:s})=>{var V;return[k("span",Ee,C((V=p(E)(s.controlType))==null?void 0:V.displayName),1)]}),_:1},8,["label"]),m(r,{width:"120",align:"right"},{default:v(({row:s,$index:V})=>[m(g,{icon:"icon-a-writein",tip:p(u)("common.edit"),"data-cy":"edit",onClick:b=>B(s)},null,8,["tip","onClick"]),s.isSystemField?N("",!0):(x(),T(g,{key:0,permission:{feature:"contentType",action:"edit"},icon:"icon-delete text-orange hover:text-orange",tip:p(u)("common.delete"),"data-cy":"delete",onClick:b=>S(V)},null,8,["tip","onClick"])),m(g,{icon:"icon-move js-sortable cursor-move",tip:p(u)("common.move"),"data-cy":"move"},null,8,["tip"])]),_:1})]),_:1},8,["data","row-class-name"]),d.value?(x(),T(_e,{key:0,modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=s=>d.value=s),fields:e.value,field:c.value,options:l.propertyOptions,"show-default-value":l.showDefaultValue,"hide-preview-field":l.hidePreviewField,"enable-dynamic-options":l.enableDynamicOptions},null,8,["modelValue","fields","field","options","show-default-value","hide-preview-field","enable-dynamic-options"])):N("",!0)],64)}}});var De=be(Fe,[["__scopeId","data-v-d1faafb8"]]);const Be={class:"h-full w-full flex flex-col overflow-hidden"},Te={class:"pt-16 px-32 bg-fff dark:bg-[#222] dark:border-transparent border-b border-solid border-line flex items-start"},$e=k("div",{class:"flex-1"},null,-1),Oe={class:"flex-1"},ui=A({setup(l){const{t:i}=z(),a=Z(),c=le(),u=h(),E=h(),d=ce(),e=h(),f=ee(J("id")||""),w={hideDisplayInSearchResult:!0,hideMultipleLanguage:!0,hideSummaryField:!0},S=h(!1),_=h([]),D=()=>F(this,null,function*(){e.value=yield a.getView(J("id")),d.init(e.value)}),$=()=>{c.goBackOrTo(j({name:"views"}))},B=()=>F(this,null,function*(){if(!e.value)return;yield u.value.validate();const y=e.value.id===ie;yield a.updateView(e.value,f.save()),Ve.success(i("common.saveSuccess")),d.init(e.value),y&&c.replace(j({name:"view-edit",query:{id:e.value.id}}))}),t=()=>{var y,r;S.value=!0,_.value=P((r=(y=e.value)==null?void 0:y.propDefines)!=null?r:[])},o=()=>{!e.value||(e.value.propDefines=P(_.value),S.value=!1)},n=()=>F(this,null,function*(){yield B(),$()});return se((y,r,g)=>F(this,null,function*(){y.name==="login"?g():yield d.check(e.value).then(()=>{g()}).catch(()=>{g(!1)})})),ue("save",B),L(()=>e.value,()=>{d.changed(e.value)},{deep:!0}),D(),(y,r)=>{const g=G,s=Se,V=me("hasPermission");return x(),H(q,null,[k("div",Be,[k("div",Te,[e.value?(x(),T(oe,{key:0,ref_key:"form",ref:u,model:e.value,inline:""},null,8,["model"])):N("",!0),$e,m(g,{round:"",class:"lineButton",onClick:t},{default:v(()=>[O(C(p(i)("common.parameters")),1)]),_:1}),m(g,{round:"",class:"lineButton",onClick:r[0]||(r[0]=b=>E.value.format())},{default:v(()=>[O(C(p(i)("common.format")),1)]),_:1})]),k("div",Oe,[e.value?(x(),T(te,{key:0,ref_key:"editor",ref:E,modelValue:e.value.body,"onUpdate:modelValue":r[1]||(r[1]=b=>e.value.body=b),language:"html","k-script":"",uri:p(fe).file(e.value.id),onMonacoLoadComplete:r[2]||(r[2]=b=>p(f).bindMonaco(b,"html"))},null,8,["modelValue","uri"])):N("",!0)]),m(de,{back:"",permission:{feature:"view",action:"edit"},onCancel:$,onSave:B},{"extra-buttons":v(()=>[pe((x(),T(g,{round:"",type:"primary","data-cy":"save-and-return",onClick:n},{default:v(()=>[O(C(p(i)("common.saveAndReturn")),1)]),_:1})),[[V,{feature:"view",action:"edit"}]])]),_:1})]),m(s,{modelValue:S.value,"onUpdate:modelValue":r[5]||(r[5]=b=>S.value=b),"close-on-click-modal":!1,title:p(i)("common.parameters")},{footer:v(()=>[m(ke,{onConfirm:o,onCancel:r[4]||(r[4]=b=>S.value=!1)})]),default:v(()=>[m(De,{modelValue:_.value,"onUpdate:modelValue":r[3]||(r[3]=b=>_.value=b),"property-options":w,"show-default-value":!0,"hide-preview-field":!0},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}});export{ui as default};
