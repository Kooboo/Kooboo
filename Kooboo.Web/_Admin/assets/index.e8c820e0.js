var Le=Object.defineProperty,De=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var oe=(k,o,i)=>o in k?Le(k,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):k[o]=i,K=(k,o)=>{for(var i in o||(o={}))Se.call(o,i)&&oe(k,i,o[i]);if(ae)for(var i of ae(o))Be.call(o,i)&&oe(k,i,o[i]);return k},M=(k,o)=>De(k,$e(o));var $=(k,o,i)=>new Promise((_,y)=>{var x=E=>{try{w(i.next(E))}catch(C){y(C)}},m=E=>{try{w(i.throw(E))}catch(C){y(C)}},w=E=>E.done?_(E.value):Promise.resolve(E.value).then(x,m);w((i=i.apply(k,o)).next())});import{_ as Ne}from"./relations-tag.b9c377a2.js";import{_ as re}from"./k-table.f75c31cc.js";import{C as Re,a as Ue,S as Ae,b as Te,i as Fe,_ as Ie,g as je,d as Ke,e as Me}from"./edit-dialog.a3be7087.js";import{u as Oe}from"./use-date.28e9a8a3.js";import{_ as ue}from"./index.ed88cf90.js";import{_ as Je}from"./object-type-tag.c1224554.js";import{g as Q,w as He,o as Pe}from"./i18n.2d8b30eb.js";import{E as ce}from"./index.bc06171b.js";import{E as qe}from"./index.bb5499e2.js";import{E as de}from"./index.a4ff385c.js";import{d as W,g as v,o as g,j as T,w as r,b as n,u as s,f as O,t as h,aH as N,i as G,a as S,k as B,c as q,F as ne,b6 as ze,K as z,ch as Ge}from"./url.8f5ec20c.js";import{g as Qe}from"./main.d8c6ef59.js";import{B as We}from"./breadcrumb.79da4f07.js";import{_ as se}from"./icon-button.e30c79ea.js";import{S as Xe}from"./search-input.770da843.js";import{b as Ye}from"./confirm.617d359f.js";import{a as Ze}from"./validate.348f94d6.js";import{_ as me}from"./plugin-vue_export-helper.21dcd24c.js";import{E as el}from"./index.5f2a659f.js";import{E as pe}from"./index.96970839.js";import{E as ll}from"./index.06224119.js";import{E as tl,a as al}from"./index.a141884f.js";import{c as ie}from"./cloneDeep.b77ba92c.js";import{E as ol}from"./windi.bf752d69.js";import{E as nl,a as sl}from"./index.0a83bb10.js";import{E as il}from"./index.4c9af567.js";import{f as rl,e as ul}from"./fold.5d79397c.js";import"./replace-all.dd6016f2.js";import"./page.c26fc024.js";import"./index.80a4dc1a.js";import"./index.bf8ed8c6.js";import"./error.7e8331f1.js";import"./scroll.54c27fbd.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.3f074800.js";import"./isNil.98bb3b88.js";import"./validator.1bcd6e6a.js";import"./index.0535d5fe.js";import"./index.a595fe6d.js";import"./guid.c1a40312.js";import"./style.ad574a57.js";import"./toNumber.6efebd6a.js";import"./_baseIsEqual.2f38f7c3.js";import"./index.593106e3.js";import"./index.ab4ed870.js";import"./index.ec785feb.js";import"./event.776e7e11.js";import"./isEqual.c3e9e9f4.js";import"./debounce.730e1961.js";import"./index.b68af8a1.js";import"./sortable.esm.a99254e8.js";import"./index.14993118.js";import"./index.b3d1cf25.js";import"./index.35ae15db.js";import"./dropdown.d7a15792.js";import"./refs.d2253dd4.js";import"./alert.8fe5500a.js";import"./dayjs.min.35b12e7a.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";/* empty css                                                               */import"./plugin-vue_export-helper.41ffa612.js";import"./index.e87fdc52.js";/* empty css                                                                 */import"./logo-transparent.1566007e.js";import"./index.37979027.js";import"./index.3dc39d21.js";import"./index.832f2769.js";import"./index.b3e4ff8e.js";import"./index.5af167df.js";import"./index.14aabd47.js";import"./_baseClone.29a8cd97.js";const cl={class:"ml-4"},dl=W({props:{modelValue:{type:Boolean},type:null},emits:["update:modelValue","load"],setup(k,{emit:o}){const i=k,{t:_}=Q(),y=v([]),x=v(!0),m=v([]),w=()=>$(this,null,function*(){i.type==="scan"?yield Re(m.value):yield Ue(m.value),x.value=!1,o("load")});return(()=>$(this,null,function*(){i.type==="scan"?y.value=yield Ae():y.value=yield Te()}))(),(C,d)=>{const R=Je,f=ce,L=qe,U=re,F=ue,I=de;return g(),T(I,{"model-value":x.value,title:s(_)("common.result"),width:"1024px","close-on-click-modal":!1,onClosed:d[2]||(d[2]=p=>o("update:modelValue",!1))},{footer:r(()=>[n(F,{permission:{feature:"label",action:"edit"},"confirm-label":i.type==="scan"?s(_)("common.addLabel"):s(_)("common.update"),disabled:!m.value.length,onConfirm:w,onCancel:d[1]||(d[1]=p=>x.value=!1)},null,8,["confirm-label","disabled"])]),default:r(()=>[n(U,{selectedData:m.value,"onUpdate:selectedData":d[0]||(d[0]=p=>m.value=p),data:y.value,"show-check":"","max-height":300,"hide-delete":""},{leftBar:r(()=>[O("span",cl,"("+h(s(_)("common.scanLabelTips"))+")",1)]),default:r(()=>[n(f,{label:s(_)("common.type"),width:"100"},{default:r(({row:p})=>[n(R,{type:p.type},null,8,["type"])]),_:1},8,["label"]),n(f,{label:s(_)("common.displayName"),width:"150"},{default:r(({row:p})=>[N(h(p.displayName),1)]),_:1},8,["label"]),n(f,{label:s(_)("common.attributes"),width:"100"},{default:r(({row:p})=>[N(h(p.attribute),1)]),_:1},8,["label"]),n(f,{label:s(_)("common.key"),width:"300"},{default:r(({row:p})=>[n(L,{modelValue:p.suggestKey,"onUpdate:modelValue":H=>p.suggestKey=H,autosize:"",type:"textarea"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),n(f,{label:s(_)("common.value")},{default:r(({row:p})=>[N(h(p.tag),1)]),_:1},8,["label"])]),_:1},8,["selectedData","data"])]),_:1},8,["model-value","title"])}}});const ml={key:0,class:"el-upload__tip ml-8"},pl={key:1,class:"mt-12 w-full"},fl=W({props:{modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(k,{emit:o}){const{t:i}=Q(),_={file:Ze(i("common.selectFileTips"))},y=v(!0),x=v(),m=v({file:null}),w=C=>{m.value.file=C},E=()=>$(this,null,function*(){yield x.value.validate();var C=new FormData;C.append("file",m.value.file.raw),yield Fe(C),y.value=!1,o("reload")});return G(()=>m.value.file,()=>{m.value.file&&x.value.clearValidate("file")}),(C,d)=>{const R=pe,f=ll,L=el,U=tl,F=al,I=de;return g(),T(I,{modelValue:y.value,"onUpdate:modelValue":d[3]||(d[3]=p=>y.value=p),width:"600px","close-on-click-modal":!1,title:s(i)("common.import"),onClosed:d[4]||(d[4]=p=>o("update:modelValue",!1))},{footer:r(()=>[n(ue,{"confirm-label":s(i)("common.start"),onConfirm:E,onCancel:d[2]||(d[2]=p=>y.value=!1)},null,8,["confirm-label"])]),default:r(()=>[n(F,{ref_key:"form",ref:x,"label-position":"top",model:m.value,rules:_,onSubmit:d[1]||(d[1]=He(()=>{},["prevent"])),onKeydown:Pe(E,["enter"])},{default:r(()=>[n(U,{label:s(i)("common.file"),prop:"file"},{default:r(()=>[n(f,{"show-file-list":!1,action:"","auto-upload":!1,"on-change":w,accept:".json","data-cy":"upload"},{default:r(()=>[n(R,{type:"primary",round:"",plain:""},{default:r(()=>[N(h(s(i)("common.selectFile")),1)]),_:1})]),_:1}),m.value.file?B("",!0):(g(),S("div",ml,h(s(i)("common.supportFile")+": .json"),1)),m.value.file?(g(),S("div",pl,[n(L,{title:m.value.file.name,type:"info",onClose:d[0]||(d[0]=p=>m.value.file=null)},null,8,["title"])])):B("",!0)]),_:1},8,["label"])]),_:1},8,["model","onKeydown"])]),_:1},8,["modelValue","title"])}}});var vl=me(fl,[["__scopeId","data-v-78e96995"]]);const _l={class:"p-24"},yl={class:"flex items-center py-24 justify-between"},bl={class:"flex items-center"},gl={class:"flex item-center space-x-16"},hl={key:0},kl={key:1,class:"flex items-center space-x-12"},xl=["title"],El=["title"],Cl={key:0},Vl={key:0,class:"flex items-center justify-end"},wl=W({setup(k){const{t:o}=Q(),i=v([]),_=v(""),y=v(""),x=v(!1),m=v(!1),w=v(!1),E=v({}),C=v(),d=v([]),R=v(),f=v("default"),L=v([]),U=v([]),F=()=>{U.value=[]},I=()=>{z(()=>{L.value.forEach(t=>{var e,l;(l=(e=R.value.table)==null?void 0:e.toggleRowExpansion)==null||l.call(e,t,!0)})})},p=[{key:"default",value:o("common.defaultList")},{key:"category",value:o("common.categoryList")}],H={Page:o("common.page"),View:o("common.view"),Layout:o("common.layout")},X=(t,e)=>{const l=t.name.toUpperCase(),u=e.name.toUpperCase();return l<u?-1:l>u?1:0};function j(){return $(this,null,function*(){const t=yield je();i.value=t.sort((e,l)=>e.lastModified>l.lastModified?-1:1)})}const fe=()=>{z(()=>{document.querySelectorAll(".el-table__expand-icon").forEach(t=>{var e,l,u,c;(c=(u=(l=(e=t==null?void 0:t.parentElement)==null?void 0:e.parentElement)==null?void 0:l.parentElement)==null?void 0:u.classList)==null||c.add("cursor-pointer")})})},Y=q(()=>{let t=i.value;if(y.value){const e=y.value.trim().toLowerCase();t=t.filter(l=>{var u;if(l.name.toLowerCase().includes(e))return!0;for(let c in l.values)if((u=l.values[c])!=null&&u.toLowerCase().includes(e))return!0;return!1})}return t}),J=q(()=>{F();let t=[],e=[],l=[],u=[];return ie(Y.value).forEach(c=>{let V=c;V.category_label_id=c.name+"-"+c.id,c.relationDetails.length?c.relationDetails.forEach(D=>{const b=e.find(A=>A.id===D.id);if(b)b.children.push(M(K({},V),{category_label_id:D.name+V.id}));else{const A=M(K({},D),{children:[M(K({},V),{category_label_id:D.name+V.id})]});e.push(A),U.value.push(A)}}):l.push(V)}),e.sort(X),e.forEach(c=>{c.children.sort(X)}),t=e.concat(l),t.forEach(c=>{let V=c;if(V.category_label_id=c.name+"-"+c.id,c.type){const D=u.find(b=>b.type===c.type);if(D)D.children.push(V);else{let b=M(K({},c),{name:H[c.type],id:c.type,category_label_id:c.type,children:[V]});u.push(b),U.value.push(b)}}else u.push(c)}),u.sort((c,V)=>{const D=c.type,b=V.type;return D<b?-1:D>b?1:0}),u}),P=(t=J.value)=>{L.value=U.value,t.forEach(e=>{var l,u;(u=(l=R.value.table)==null?void 0:l.toggleRowExpansion)==null||u.call(l,e,!0),e.children&&P(e.children)})},Z=(t=J.value)=>{t.forEach(e=>{var l,u;(u=(l=R.value.table)==null?void 0:l.toggleRowExpansion)==null||u.call(l,e,!1),e.children&&Z(e.children),L.value=[]})},ve=t=>{var e,l;t!=null&&t.children&&((l=(e=R.value.table)==null?void 0:e.toggleRowExpansion)==null||l.call(e,t),L.value.find(u=>u.id===t.id)?L.value=L.value.filter(u=>u.id!==t.id):L.value.push(t))};function _e(t){return $(this,null,function*(){yield Ye(t.length);const e=t.map(l=>l.id);yield Ke({ids:e}),j()})}const ee=Qe();function le(t){return t.values[ee.default]||""}function ye(t){return $(this,null,function*(){E.value=ie(t),x.value=!0})}function be(){return $(this,null,function*(){E.value={id:"",values:Object.fromEntries(ee.selected.map(t=>[t,""]))},x.value=!0})}function ge(){y.value=_.value,y.value&&f.value==="category"&&z(()=>{P()})}function he(t){t&&j()}const ke=Ge(ge,1e3),xe=()=>{C.value="scan",m.value=!0},Ee=()=>$(this,null,function*(){C.value="scanI18n",m.value=!0}),Ce=()=>$(this,null,function*(){yield Me()}),Ve=t=>{let e=JSON.parse(JSON.stringify(t));if(delete e.category_label_id,d.value.find(l=>l.id===e.id))d.value=d.value.filter(l=>l.id!==e.id);else if(e.relationDetails.length&&f.value==="category")for(let l=0;l<e.relationDetails.length;l++)d.value.push(e);else d.value.push(e)},we=q(()=>t=>{let e=JSON.parse(JSON.stringify(t));return delete e.category_label_id,d.value.some(l=>l.id===e.id)});return G(()=>_.value,()=>{ke()}),G(()=>[f.value,J.value],()=>{f.value==="category"&&L.value.length&&I(),f.value==="category"&&fe()}),j(),(t,e)=>{const l=pe,u=ol,c=nl,V=sl,D=il,b=ce,A=Ne;return g(),S("div",_l,[n(We,{name:s(o)("common.labels")},null,8,["name"]),O("div",yl,[O("div",bl,[n(l,{round:"","data-cy":"scan",onClick:be},{default:r(()=>[N(h(s(o)("common.new")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[0]||(e[0]=a=>xe())},{default:r(()=>[N(h(s(o)("common.scanlabel")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[1]||(e[1]=a=>Ee())},{default:r(()=>[N(h(s(o)("common.ScanI18N")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[2]||(e[2]=a=>Ce())},{default:r(()=>[n(u,{class:"iconfont icon-share"}),N(" "+h(s(o)("common.export")),1)]),_:1}),n(l,{round:"","data-cy":"scan",onClick:e[3]||(e[3]=a=>w.value=!0)},{default:r(()=>[n(u,{class:"mr-16 iconfont icon-a-Pullin"}),N(" "+h(s(o)("common.import")),1)]),_:1})]),n(Xe,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=a=>_.value=a),class:"w-238px",placeholder:s(o)("common.searchLabels"),clearable:"","data-cy":"search"},null,8,["modelValue","placeholder"])]),n(s(re),{ref_key:"tableRef",ref:R,selectedData:d.value,"onUpdate:selectedData":e[8]||(e[8]=a=>d.value=a),data:f.value==="default"?s(Y):s(J),"show-check":"",permission:{feature:"label",action:"delete"},"row-key":f.value==="default"?"id":"category_label_id","custom-check":"","is-multi-tree-table":!0,onDelete:_e,onRowClick:ve},{leftBar:r(()=>[O("div",gl,[n(V,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),class:"el-radio-group--rounded"},{default:r(()=>[(g(),S(ne,null,ze(p,a=>n(c,{key:a.key,label:a.key,"data-cy":a.key},{default:r(()=>[N(h(a.value),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"]),f.value==="category"?(g(),S(ne,{key:0},[n(l,{circle:"",icon:s(rl),title:s(o)("common.foldAll"),"data-cy":"fold-all",onClick:e[6]||(e[6]=a=>Z())},null,8,["icon","title"]),n(l,{circle:"",icon:s(ul),title:s(o)("common.expandAll"),"data-cy":"expand-all",onClick:e[7]||(e[7]=a=>P())},null,8,["icon","title"])],64)):B("",!0)])]),default:r(()=>[n(b,{label:s(o)("common.name"),prop:"name","class-name":"expanded-column"},{default:r(({row:a})=>[a.children?(g(),S("span",hl,h(a.name),1)):(g(),S("span",kl,[n(D,{size:"large","model-value":s(we)(a),"data-cy":"checkbox-label",onChange:te=>Ve(a)},null,8,["model-value","onChange"]),O("span",{class:"ellipsis",title:a.name,"data-cy":"name"},h(a.name),9,xl)]))]),_:1},8,["label"]),n(b,{label:s(o)("common.value")},{default:r(({row:a})=>[a.children?B("",!0):(g(),S("div",{key:0,class:"ellipsis",title:le(a),"data-cy":"value"},h(le(a)),9,El))]),_:1},8,["label"]),f.value==="default"?(g(),T(b,{key:0,label:s(o)("common.usedBy"),width:"200"},{default:r(({row:a})=>[n(A,{id:a.id,relations:a.relations,type:"label"},null,8,["id","relations"])]),_:1},8,["label"])):B("",!0),n(b,{label:s(o)("common.lastModified"),width:"180"},{default:r(({row:a})=>[a.children?B("",!0):(g(),S("span",Cl,h(s(Oe)(a.lastModified)),1))]),_:1},8,["label"]),n(b,{width:"100"},{default:r(({row:a})=>[a.children?B("",!0):(g(),S("div",Vl,[n(se,{class:"inline-flex",icon:"icon-a-writein",tip:s(o)("common.edit"),"data-cy":"edit",onClick:te=>ye(a)},null,8,["tip","onClick"]),n(se,{class:"inline-flex",icon:"icon-time",permission:{feature:"site",action:"log"},tip:s(o)("common.version"),"data-cy":"versions",onClick:te=>t.$router.goLogVersions(a.keyHash,a.storeNameHash)},null,8,["tip","onClick"])]))]),_:1})]),_:1},8,["selectedData","data","row-key"]),x.value?(g(),T(Ie,{key:0,modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=a=>x.value=a),current:E.value,onSuccess:he},null,8,["modelValue","current"])):B("",!0),m.value?(g(),T(dl,{key:1,modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=a=>m.value=a),type:C.value,onLoad:j},null,8,["modelValue","type"])):B("",!0),w.value?(g(),T(vl,{key:2,modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=a=>w.value=a),onReload:j},null,8,["modelValue"])):B("",!0)])}}});var zt=me(wl,[["__scopeId","data-v-29fac599"]]);export{zt as default};
