var y=(a,p,e)=>new Promise((u,o)=>{var _=d=>{try{s(e.next(d))}catch(m){o(m)}},v=d=>{try{s(e.throw(d))}catch(m){o(m)}},s=d=>d.done?u(d.value):Promise.resolve(d.value).then(_,v);s((e=e.apply(a,p)).next())});import{u as E,aa as ee,ad as te,ae as oe,af as ae,ag as ne,ah as se,ai as re,aj as ie,ak as ce,al as le,am as pe}from"./dev-mode.7f653a4a.js";import{_ as X}from"./icon-button.a2edb33f.js";import{g as N,v as R,w as V}from"./i18n.0d8cb6d1.js";import{u as de,i as me}from"./main.d919dab0.js";import{d as B,g as S,M as ue,i as F,h as J,J as fe,e as q,u as b,o as c,a as h,b as x,j as A,w as O,f as T,c as ve,x as U,b2 as W,F as I,b6 as L,n as j,k as M,t as Y,l as G,m as _e,b3 as be,b1 as he,K as Q,ax as ye,aV as ke,cj as xe,cs as ge}from"./url.8f5ec20c.js";import{S as we}from"./search-input.fe88eea7.js";import{E as K}from"./windi.dcba9a95.js";import{_ as Te,s as $e}from"./settings.1e2a0012.js";import{E as P}from"./index.3d638063.js";import{_ as H}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Se}from"./index.38840738.js";import{c as Ce}from"./index.8cff0d70.js";import{S as Ie}from"./sortable.esm.a99254e8.js";import{s as D}from"./confirm.f89fa710.js";import{o as Ae,a as Me}from"./config.69138790.js";import"./replace-all.e310d26c.js";import"./guid.c1a40312.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./preload-helper.13a99eb0.js";import"./dark.4719ae81.js";import"./page.be880a87.js";import"./validate.b9ea657d.js";import"./index.3e5d2d38.js";import"./index.f2618a8f.js";import"./index.ddf78e53.js";import"./index.6943850d.js";import"./index.4ccd5d27.js";import"./style.67f0cdc4.js";import"./toNumber.6efebd6a.js";import"./_baseIsEqual.f1f57955.js";import"./index.6756a6f3.js";import"./error.7e8331f1.js";import"./index.6e9a6658.js";import"./_baseClone.24478792.js";import"./isEqual.8058d1d5.js";import"./index.ab7ae43a.js";import"./index.c7806af3.js";import"./index.97ced36a.js";import"./event.776e7e11.js";import"./isNil.98bb3b88.js";import"./index.1e651ffe.js";import"./scroll.9a94de30.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.0c15535f.js";import"./validator.11bc55c7.js";import"./index.1d64e54f.js";import"./index.bc6ab153.js";import"./dropdown.61c74520.js";import"./refs.d2253dd4.js";import"./use-copy-text.7801df9a.js";import"./index.66bd0e61.js";import"./toggleComment.5b29ca87.js";import"./use-save-tip.a46b00fb.js";import"./index.d1d474c4.js";import"./index.d29acda2.js";import"./index.230671a2.js";import"./index.9a7a049b.js";import"./debounce.730e1961.js";import"./index.6d134d76.js";import"./index.6ac167de.js";import"./vuedraggable.umd.e0421fdf.js";import"./index.bdc63b78.js";import"./index.ec3d8ab1.js";import"./index.3be79fd5.js";import"./index.f7975397.js";import"./index.337c36f2.js";import"./index.e68a3b8d.js";import"./alert.8fe5500a.js";import"./index.3b3f2bf9.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.92552fc5.js";/* empty css                                                          */import"./file.f8555a01.js";import"./use-date.3be35318.js";import"./dayjs.min.8b8ca7e9.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.e88ed30a.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.8fc1c564.js";import"./image-editor.37a79505.js";import"./main.esm.ae650d02.js";import"./index.8d99b8f6.js";import"./index.36905e5d.js";import"./index.50c16ae5.js";import"./tooltip.9f258018.js";import"./key-value-editor.37da5d91.js";import"./cloneDeep.007117a9.js";import"./index.66c73cbe.js";import"./index.e3f90979.js";import"./media-dialog.6d9d43ca.js";import"./breadcrumb.3432b615.js";import"./plugin-vue_export-helper.41ffa612.js";import"./media.3136d42d.js";import"./index.ff2ed7f6.js";import"./search-provider.8815ed27.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./use-operation-dialog.1c7cf152.js";import"./folder.8308bb9d.js";import"./relations-tag.c8ada5d9.js";import"./index.8e0d96d6.js";import"./index.43142d25.js";import"./browser.3a7f9e8c.js";import"./throttle.3f3ee457.js";import"./index.17321c3b.js";import"./layout.4c508974.js";import"./index.7d901c84.js";import"./position.a71853ef.js";import"./utils.6f25662a.js";import"./index.66e12c37.js";import"./index.fae306fc.js";import"./index.b7efef2a.js";import"./file.8c428cda.js";import"./index.86140375.js";import"./index.fdd01aa2.js";import"./editable-tags.efc8f93a.js";import"./index.9b4bce31.js";import"./index.77fd2161.js";import"./index.a2cc40a6.js";import"./country-and-region-codes.c36488d2.js";import"./index.55f31b64.js";import"./classCompletion.a22e38a6.js";import"./logo-transparent.1566007e.js";const Le={class:"absolute top-4 right-2px z-50 bg-fff dark:bg-[#252526]"},Be=B({emits:["search","active"],setup(a,{expose:p,emit:e}){const{t:u}=N(),o=S(""),_=S(),v=ue(),s=E();p({focus:()=>{_.value.focus()},clear:()=>{o.value=""}}),F(o,()=>{e("search",o.value.trim())});const f=S(!1),g=i=>y(this,null,function*(){var l;if(i.keyCode===70&&i.ctrlKey){if(((l=s.activeActivity)==null?void 0:l.name)==="code search")return;f.value=!0,_.value.focus(),i.preventDefault()}});J(()=>{document.addEventListener("keydown",g)}),fe(()=>{document.removeEventListener("keydown",g)});const n=()=>{f.value=!1,o.value=""};return F(()=>f.value,()=>{e("active",f.value)}),F(()=>{var i;return[(i=s.activeActivity)==null?void 0:i.name,v.query.moduleId]},()=>{f.value=!1,o.value=""}),(i,l)=>{var r;const k=we,t=K;return q((c(),h("div",Le,[x(k,{ref_key:"input",ref:_,modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=$=>o.value=$),placeholder:b(u)("common.searchFileName"),class:"h-28px w-180px mr-2px text-12px"},null,8,["modelValue","placeholder"]),x(t,{class:"iconfont icon-delete5 text-blue text-opacity-80 cursor-pointer text-12px",title:b(u)("common.close"),onClick:n},null,8,["title"])],512)),[[R,f.value&&((r=b(s).activeActivity)==null?void 0:r.name)!=="code search"]])}}}),Fe={class:"p-24 pb-150px"},je=B({setup(a,{expose:p}){return p({save:()=>y(this,null,function*(){$e()})}),(u,o)=>{const _=P;return c(),A(_,null,{default:O(()=>[T("div",Fe,[x(Te)])]),_:1})}}});const Z=a=>(be("data-v-0ccfe652"),a=a(),he(),a),De={class:"h-full bg-fff dark:bg-[#252526] dark:border-none flex border-r border-solid border-line dark:border-[#f00]"},Ee={class:"w-48px h-full dark:bg-[#333333] dark:border-none border-r border-line border-solid flex flex-col"},Ve=["data-cy","onClick"],We=Z(()=>T("div",{class:"flex-1"},null,-1)),Oe={class:"ellipsis h-36px text-black flex items-center pl-12 pr-4 dark:text-fff/60"},Ne={class:"ellipsis h-full leading-9","data-cy":"tab-title"},Re=Z(()=>T("div",{class:"flex-1"},null,-1)),qe={key:0,class:"-space-x-4 flex items-center"},Ke=B({setup(a){const{t:p}=N(),e=E(),u=S(),o=S(""),_=S(!1),v=de(),s=()=>{e.addTab({id:"setting",name:p("common.setting"),panel:je,icon:"icon-a-setup"})},d=ve(()=>{var f;return((f=e.activeActivity)==null?void 0:f.name)=="code search"});J(()=>{const f=U("activity");f?e.selectActivity(f):e.activeActivity.init||e.selectActivity(e.activeActivity.name)});const m=f=>{setTimeout(()=>{e.selectActivity(f,!0)},0)};return W("keyword",o),(f,g)=>{const n=K,i=Se,l=X,k=P;return c(),h("div",De,[T("div",Ee,[(c(!0),h(I,null,L(b(e).activities,t=>(c(),A(i,{key:t.name,class:"box-item",transition:"bounce","hide-after":0,content:t.display,placement:"right"},{default:O(()=>{var r;return[T("div",{class:j(["side-icon",t.name===((r=b(e).activeActivity)==null?void 0:r.name)?"bg-blue/10 !text-blue/87":""]),"data-cy":`tab-${t.name}`,onClick:$=>m(t.name)},[x(n,{class:j(["iconfont text-18px",t.icon])},null,8,["class"])],10,Ve)]}),_:2},1032,["content"]))),128)),We,b(v).hasAccess("site","edit")?(c(),h("div",{key:0,class:"side-icon","data-cy":"setting",onClick:s},[x(n,{class:"iconfont icon-a-setup"})])):M("",!0)]),T("div",{class:"w-200px h-full relative",onClick:g[3]||(g[3]=t=>!b(d)&&u.value&&u.value.focus())},[x(Be,{ref_key:"filterBar",ref:u,onActive:g[0]||(g[0]=t=>_.value=t),onSearch:g[1]||(g[1]=t=>o.value=t)},null,512),(c(!0),h(I,null,L(b(e).activities,t=>{var r,$,C;return q((c(),h("div",{key:t.name,class:"h-full flex flex-col"},[T("div",Oe,[T("span",Ne,Y((r=t.panelDisplay)!=null?r:t.display),1),Re,t.actions?(c(),h("div",qe,[(c(!0),h(I,null,L(t.actions,w=>(c(),h(I,{key:w.name},[w.visible?(c(),A(l,{key:0,icon:w.icon,tip:w.display,class:"","data-cy":w.name,onClick:z=>w.invoke()},null,8,["icon","tip","data-cy","onClick"])):M("",!0)],64))),128))])):M("",!0)]),x(k,{class:"flex-1",style:_e({outline:_.value&&(($=b(e).activeActivity)==null?void 0:$.name)!=="code search"?"1px solid rgba(34, 150, 243,.5)":""}),onClick:g[2]||(g[2]=V(()=>{},["stop"]))},{default:O(()=>[(c(),A(G(t.panel),{ref_for:!0,ref:w=>t.panelInstance.resolve(w)},null,512))]),_:2},1032,["style"])],512)),[[R,t.name===((C=b(e).activeActivity)==null?void 0:C.name)]])}),128))])])}}});var ze=H(Ke,[["__scopeId","data-v-0ccfe652"]]);const Ue={class:"h-26px bg-gray/60 dark:bg-[#252526] text-s flex"},Je=["onWheel"],Pe=["title","onClick","onContextmenu"],Qe={class:"w-4 h-4 rounded-full bg-444 dark:bg-[#fffa] absolute left-4"},Xe={class:"select-none ellipsis","data-cy":"file-name"},Ye={key:0,class:"flex items-center p-8 -space-x-4"},Ge=B({setup(a){const{t:p}=N(),e=E(),u=S(),o=S(),_=S();J(()=>{o.value&&Ie.create(o.value,{forceFallback:!0,filter:".icon-close",dragClass:"sortable-drag",fallbackTolerance:5})}),F(()=>e.tabs,()=>{Q(()=>{u.value&&u.value.update()})},{deep:!0}),F(()=>e.activeTab,()=>{d()});function v(n){if(e.activeTab===n){d();return}e.activeTab=n}function s(n){var l;const i=(l=u.value)==null?void 0:l.$refs.wrap$;i&&(i.scrollLeft=i.scrollLeft+(n.deltaX+n.deltaY))}function d(){Q(()=>{var i,l;const n=(i=o.value)==null?void 0:i.querySelector(".activeTab");if(n&&u.value){const k=u.value.$el.offsetWidth,t=n.offsetLeft,r=n.offsetLeft+n.offsetWidth,$=(l=u.value)==null?void 0:l.$refs.wrap$,C=$.scrollLeft;t>=C&&r<=k+C+1||($.scrollLeft=r-k+50)}})}const m=n=>y(this,null,function*(){n.changed&&(yield D(p("common.unsavedChangesLeaveTips"))),e.deleteTab(n.id)}),f=(n,i)=>y(this,null,function*(){n.some(k=>k.changed)&&(yield D(p("common.unsavedChangesLeaveTips"))),e.deleteTabs(i)}),g=[{name:p("common.close"),invoke:n=>y(this,null,function*(){n.changed&&(yield D(p("common.unsavedChangesLeaveTips"))),e.deleteTab(n.id)})},{name:p("common.closeToRight"),invoke:n=>y(this,null,function*(){const i=e.tabs.findIndex(t=>t.id===n.id),l=e.tabs.filter((t,r)=>r>i),k=l.map(t=>t.id);f(l,k)})},{name:p("common.closeOthers"),invoke:n=>y(this,null,function*(){const i=e.tabs.map(t=>t.id),l=e.tabs.filter(t=>t.id!=n.id),k=i.filter(t=>t!=n.id);f(l,k)})},{name:p("common.closeSaved"),invoke:()=>y(this,null,function*(){const i=e.tabs.filter(l=>!l.changed).map(l=>l.id);e.deleteTabs(i)})},{name:p("common.closeAll"),invoke:()=>y(this,null,function*(){const n=e.tabs.map(i=>i.id);f(e.tabs,n)})}];return(n,i)=>{var t;const l=K,k=P;return c(),h("div",Ue,[T("div",{class:"whitespace-nowrap flex-1 overflow-hidden",onWheel:V(s,["prevent"])},[x(k,{ref_key:"scrollbar",ref:u},{default:O(()=>[T("div",{ref_key:"sortableWrap",ref:o,class:"h-26px"},[(c(!0),h(I,null,L(b(e).tabs,r=>{var $,C;return c(),h("div",{key:r.id,title:r.name,class:j(["group inline-flex h-full cursor-default items-center border-r border-solid border-line dark:border-transparent px-8 space-x-4 min-w-64 overflow-hidden max-w-280px relative",(($=b(e).activeTab)==null?void 0:$.id)===r.id?"bg-fff activeTab dark:bg-[#1e1e1e] dark:text-fff/86":"dark:bg-[#2d2d2d] dark:text-fff/60 hover:bg-black/10"]),"data-cy":"opened-file",onClick:w=>v(r),onContextmenu:V(w=>{var z;return(z=_.value)==null?void 0:z.openMenu(w,r)},["prevent","stop"])},[q(T("div",Qe,null,512),[[R,r.changed]]),x(l,{class:j(["iconfont",r.icon||"icon-code"])},null,8,["class"]),T("span",Xe,Y(r.name),1),x(l,{class:j(["iconfont icon-close cursor-pointer hover:text-blue group-hover:opacity-100",((C=b(e).activeTab)==null?void 0:C.id)===r.id?"opacity-100":"opacity-0"]),"data-cy":"close",onClick:V(w=>m(r),["stop"])},null,8,["class","onClick"])],42,Pe)}),128))],512)]),_:1},512)],40,Je),(t=b(e).activeTab)!=null&&t.actions?(c(),h("div",Ye,[(c(!0),h(I,null,L(b(e).activeTab.actions,r=>(c(),h(I,{key:r.name},[r.visible?(c(),A(X,{key:0,tip:r.display,icon:r.icon,class:"!p-0 !text-m dark:text-fff/60",onClick:$=>r.invoke()},null,8,["tip","icon","onClick"])):M("",!0)],64))),128))])):M("",!0),x(ee,{ref_key:"contextMenu",ref:_,actions:g},null,512)])}}});var He=H(Ge,[["__scopeId","data-v-37d8b64a"]]);const Ze={class:"h-full flex-1 relative overflow-hidden"},et={key:0,class:"absolute inset-0 flex items-center justify-center text-200px text-black/5 dark:bg-[#1e1e1e] dark:text-[#424242]"},tt={class:"h-[calc(100%-26px)] w-full dark:bg-[#1e1e1e]"},ot=B({setup(a){const p=E(),e=()=>y(this,null,function*(){var _;const o=yield(_=p.activeTab)==null?void 0:_.panelInstance.promise;o&&o.save&&o.save()}),u=(o,_,v)=>{var d;const s=(d=o.actions)==null?void 0:d.find(m=>m.name===_);if(s)for(const m in v)s[m]=v[m]};return Ce("save",e),(o,_)=>{const v=K;return c(),h("div",Ze,[b(p).tabs.length?M("",!0):(c(),h("div",et,[x(v,{class:"iconfont icon-code3"})])),b(p).tabs.length?(c(),A(He,{key:1})):M("",!0),T("div",tt,[(c(!0),h(I,null,L(b(p).tabs,s=>{var d;return c(),A(ye,{key:s.id},[q((c(),A(G(s.panel),{id:s.id,ref_for:!0,ref:m=>s.panelInstance.resolve(m),name:s.name,params:s.params,onChanged:m=>s.changed=m,onSetAction:(m,f)=>u(s,m,f)},null,8,["id","name","params","onChanged","onSetAction"])),[[R,((d=b(p).activeTab)==null?void 0:d.id)===s.id]])],1024)}),128))])])}}});function at(){return{open(a){switch(a.type.toLowerCase()){case"page":ce({id:a.id,name:a.name},a.params.type==="RichText"?le:pe);break;case"script":ie({id:a.id,name:a.name,ownerObjectId:a.params.ownerObjectId});break;case"style":re({id:a.id,name:a.name,ownerObjectId:a.params.ownerObjectId});break;case"menu":se({id:a.id,name:a.name});break;case"layout":ne({id:a.id,name:a.name});break;case"view":ae({id:a.id,name:a.name});break;case"form":oe({id:a.id,name:a.name});break;case"code":te({id:a.id,name:a.name,codeType:a.params.codeType});break}}}}const nt={key:0,class:"h-full flex min-h-600px"},$a=B({setup(a){const p=at(),e=v=>{me(u("common.resourceNotFound",{url:v}))},{t:u}=N(),o=E();return ke(()=>y(this,null,function*(){yield o.loadActivePanel()})),xe(v=>y(this,null,function*(){o.tabs.length&&v.name!="login"&&(yield D(u("common.leaveDevModeTip")),o.activeTab=void 0,o.tabs=[])})),ge((v,s)=>y(this,null,function*(){var d=U("siteId",v.query),m=U("siteId",s.query);o.tabs.length&&d!=m&&(yield D(u("common.leaveDevModeTip")),o.activeTab=void 0,o.tabs=[])})),W("updateTabModel",v=>y(this,null,function*(){var d,m;const s=yield(m=(d=o.tabs.find(f=>f.id===v.id))==null?void 0:d.panelInstance)==null?void 0:m.promise;!s||s.updateModel(v)})),W(Ae,p.open),W(Me,e),(v,s)=>b(o).activities.length?(c(),h("div",nt,[x(ze),x(ot)])):M("",!0)}});export{$a as default};
