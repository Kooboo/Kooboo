var Q=(e,s,t)=>new Promise((o,c)=>{var h=m=>{try{u(t.next(m))}catch(v){c(v)}},n=m=>{try{u(t.throw(m))}catch(v){c(v)}},u=m=>m.done?o(m.value):Promise.resolve(m.value).then(h,n);u((t=t.apply(e,s)).next())});import{_ as Z}from"./preload-helper.13a99eb0.js";import{_ as ee,a as te}from"./kmail-button.6d1c1156.js";import{g as z,w as G}from"./i18n.a87944a4.js";import{d as D,N as R,c as $,O as V,u as l,o as r,j as x,w as f,a as y,n as B,f as b,t as C,b7 as q,F as L,aI as K,k as N,cd as ie,b as _,g as O,x as oe,h as ne,K as se,i as re}from"./url.4cb47a7a.js";import{u as I,s as ae,a as le,b as ue,c as me,E as ce,r as de}from"./main.9fdfea92.js";import{E as P}from"./windi.6360286d.js";import{E as pe,a as fe,b as ve}from"./index.44a8997d.js";import{u as _e}from"./replace-all.56d2c1f7.js";import{n as xe}from"./guid.c1a40312.js";import{c as U}from"./cloneDeep.c5011aa2.js";import{_ as he}from"./plugin-vue_export-helper.21dcd24c.js";import{E as W}from"./index.fd96ea36.js";import{E as be}from"./index.42922617.js";import{E as ye,a as Me}from"./index.ac10ee42.js";import{_ as ke,a as ge,D as Se}from"./code-conflict.68dfd473.js";import{E as we}from"./index.1f664aab.js";import"./light-switch.51a4a594.js";import"./dark.9459c47b.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.1fd72ea8.js";import"./index.c86a187b.js";import"./index.361e2245.js";import"./index.7b8c5aef.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./dropdown.86d3a7fb.js";import"./index.4d568055.js";import"./refs.3132cbdb.js";import"./avatar.f8531598.js";import"./logo-transparent.1566007e.js";import"./index.d24a40b9.js";import"./email.3c5ebb02.js";import"./index.d2657986.js";import"./index.50c16ae5.js";import"./aria.75ec5909.js";import"./index.77bc9666.js";import"./error.7e8331f1.js";import"./_baseClone.b8903935.js";import"./_baseIsEqual.dc9e64c4.js";import"./event.776e7e11.js";import"./index.9fd79879.js";import"./isEqual.4cab74e3.js";import"./dev-mode.acf56c3e.js";import"./use-shortcuts.ff4b1f52.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./config.1e73f9c3.js";import"./page.881ec888.js";import"./validate.bb56f9e3.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./index.f2c1b903.js";import"./index.178b9e08.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./validator.b5df2420.js";import"./use-copy-text.ec245a13.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./use-save-tip.e3dc783a.js";import"./confirm.b60b5d2f.js";import"./index.f0d5f031.js";import"./index.6918f0a5.js";import"./index.f15f695e.js";import"./index.7c862087.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./index.c003dfa1.js";import"./icon-button.74ccc970.js";import"./index.4f90a917.js";import"./vuedraggable.umd.af323a53.js";import"./index.f154d010.js";import"./index.b9a74c44.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./alert.d2815716.js";import"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./index.0e5d639d.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";import"./index.bec063d7.js";import"./diff.b23bba43.js";const Ae=["src"],Ee=["src"],Ce=D({props:{item:null},setup(e){const s=R(),t=I(),o=$(()=>n=>{if(n.advanced===void 0)return!0;let u=JSON.parse(JSON.stringify(t.site.visibleAdvancedMenus));return u===null?!0:!!u.includes(n.name)}),c=$(()=>n=>!t.site.visibleAdvancedMenus||n.items.some(u=>!u.advanced)?!0:n.items.some(u=>t.site.visibleAdvancedMenus.includes(u.name)));function h(n){return typeof n.queryBuilder=="function"?n.queryBuilder(n,s):{SiteId:s.query.SiteId}}return(n,u)=>{const m=P,v=V("SubMenu",!0),w=pe,A=fe,S=V("router-link");return e.item.items.length&&l(c)(e.item)?(r(),x(w,{key:0,index:e.item.id},{title:f(()=>[typeof e.item.icon=="string"&&e.item.icon.startsWith("/")?(r(),y("img",{key:0,class:"w-18px h-18px mr-8",src:e.item.icon},null,8,Ae)):(r(),x(m,{key:1,class:B(["iconfont",e.item.icon])},null,8,["class"])),b("span",null,C(e.item.display),1)]),default:f(()=>[(r(!0),y(L,null,q(e.item.items,i=>(r(),x(v,{key:i.id,item:i},null,8,["item"]))),128))]),_:1},8,["index"])):e.item.name?(r(),x(S,{key:1,to:{name:e.item.name.toLowerCase(),query:h(e.item),params:e.item.params}},{default:f(()=>[l(o)(e.item)?(r(),x(A,{key:0,index:e.item.routeMenuName?e.item.name.toLowerCase()+e.item.routeMenuName:e.item.name.toLowerCase()},{default:f(()=>[e.item.routeMenuName&&e.item.icon?(r(),y("img",{key:0,class:"w-18px h-18px mr-8",src:e.item.icon},null,8,Ee)):(r(),x(m,{key:1,class:B(["iconfont",[e.item.icon,{"!w-18px":!e.item.icon}]])},null,8,["class"])),K(" "+C(e.item.display),1)]),_:1},8,["index"])):N("",!0)]),_:1},8,["to"])):N("",!0)}}}),Ne={class:"transform scale-75 origin-left"},$e=["title"],Be={class:"text-999 dark:text-fff/60 text-s transform"},Ie=D({setup(e){const{t:s}=z(),t=ie(),o=R();var c=I();return(h,n)=>{const u=P;return r(),y("div",{class:"flex items-center px-5 pt-16 pb-12 border-b border-solid border-line dark:border-444 cursor-pointer space-x-12","data-cy":"dashboard",onClick:n[0]||(n[0]=m=>l(t).push(l(_e)({name:"dashboard"})))},[_(u,{class:B(["iconfont text-size-28px text-blue",l(o).name==="dashboard"?"icon-home2":"icon-home"])},null,8,["class"]),b("div",Ne,[b("p",{class:"text-2l ellipsis max-w-150px dark:text-fff/86",title:l(c).site.displayName},C(l(c).site.displayName),9,$e),b("p",Be,C(l(s)("common.currentSite")),1)])])}}}),qe=I();function j(e){var t,o,c,h,n,u,m,v,w,A,S;const s=[];for(const i of e)if((t=i.meta)!=null&&t.menu){const d={name:(o=i.name)==null?void 0:o.toString(),items:[],display:i.meta.menu.display,id:xe(),permission:(h=(c=i.meta)==null?void 0:c.menu)==null?void 0:h.permission,advanced:(n=i.meta)!=null&&n.advanced?(u=i.meta)==null?void 0:u.advanced:void 0,icon:(v=(m=i.meta)==null?void 0:m.menu)==null?void 0:v.icon,queryBuilder:(A=(w=i.meta)==null?void 0:w.menu)==null?void 0:A.queryBuilder,routeMenuName:(S=i.meta)==null?void 0:S.menu.name};i.children&&d.items.push(...j(i.children)),s.push(d)}else i.children&&s.push(...j(i.children));return s}function H(e){const s=[];for(const t of e){const o=U(t);(!o.permission||qe.hasAccess(o.permission.feature,o.permission.action))&&(s.push(o),o.items=H(o.items))}return s}const Le={class:"w-202px h-full relative bg-fff z-10 dark:bg-[#252526]"},De={class:"text-[#303133] dark:text-999"},Re={class:"p-26px pb-16"},Ve={class:"flex justify-between items-center mb-8 dark:text-999"},Oe={class:"text-12px text-666 dark:text-999"},je=["data-cy"],ze=D({setup(e){const s=R(),t=I(),{t:o}=z(),c=O(!1),h=O(),n=$(()=>{var M;const i=j(ae);for(const a of t.moduleMenus){let k=i;if(a.parent&&(k=(M=i.find(p=>p.routeMenuName==a.parent))==null?void 0:M.items),k){var d={id:a.id+a.url,display:a.name,name:"module menu",routeMenuName:a.id+a.url,items:[],icon:a.icon,queryBuilder(){return{url:a.url,SiteId:s.query.SiteId}},params:{module:a.id}};if(a.children){d.id=d.routeMenuName=a.id;for(const p of a.children)d.items.push({id:a.id+p.url,display:p.name,name:"module menu",routeMenuName:a.id+p.url,items:[],queryBuilder(){return{url:p.url,SiteId:s.query.SiteId}},params:{module:a.id}})}k.push(d)}}return i}),u=$(()=>t.isAdmin?n.value:t.permissions?H(n.value):[]),m=$(()=>t.firstActiveMenu?t.firstActiveMenu:s.meta.activeMenu?s.meta.activeMenu:s.name=="module menu"?s.name+s.params.module+oe("url"):s.name),v=i=>{var d,M;if(t.site.visibleAdvancedMenus===null||(d=t.site.visibleAdvancedMenus)!=null&&d.includes(i.name))return!0;if(((M=t.site.visibleAdvancedMenus)==null?void 0:M.length)===0)return!1;if(!i.advanced)return!0},w=i=>{var d,M;if(t.site.visibleAdvancedMenus===null){let a=u.value.filter(p=>p.advanced===!0),k=[];a.forEach(p=>{k=k.concat(p.items)}),t.site.visibleAdvancedMenus=k.filter(p=>p.name!==i&&p.advanced===!0).map(p=>p.name)}else(d=t.site.visibleAdvancedMenus)!=null&&d.includes(i)?t.site.visibleAdvancedMenus=t.site.visibleAdvancedMenus.filter(a=>a!==i):(M=t.site.visibleAdvancedMenus)==null||M.push(i);A()},A=()=>Q(this,null,function*(){yield le(t.site.visibleAdvancedMenus)}),S=i=>{!h.value.contains(i.target)&&c.value&&(c.value=!1)};return ne(()=>{window.addEventListener("click",S)}),se(()=>{window.removeEventListener("click",S)}),(i,d)=>{const M=ve,a=W,k=P,p=be,X=ye,Y=Me;return r(),y("aside",Le,[_(a,{class:"pb-14"},{default:f(()=>[_(Ie),_(M,{"default-active":l(m)},{default:f(()=>[(r(!0),y(L,null,q(l(u),g=>(r(),x(Ce,{key:g.id,item:g},null,8,["item"]))),128))]),_:1},8,["default-active"])]),_:1}),b("div",{class:B(["absolute bottom-0 left-0 right-0 h-[56px] flex items-center px-5 hover:bg-[#d3eafd] dark:hover:bg-[#18222c] cursor-pointer text-444 dark:text-999",c.value?"bg-[#d3eafd]  dark:bg-[#18222c]":""]),"data-cy":"edit-menu",onClick:d[0]||(d[0]=G(g=>c.value=!c.value,["stop"]))},[_(k,{class:"iconfont icon-a-writein3 text-18px text-999 text-opacity-60 mr-8"}),b("span",De,C(l(o)("common.editMenu")),1)],2),b("div",{ref_key:"editMenuBox",ref:h,class:B(["absolute inset-0 left-210px w-250px h-full bg-fff shadow-s-10",c.value?"block":"hidden"])},[_(a,{class:"dark:bg-[#252526]"},{default:f(()=>[b("div",Re,[b("div",Ve,[b("h1",null,C(l(o)("common.editMenu")),1),_(k,{class:"iconfont icon-close cursor-pointer hover:text-blue text-14px",title:l(o)("common.close"),onClick:d[1]||(d[1]=G(g=>c.value=!c.value,["stop"]))},null,8,["title"])]),b("span",Oe,C(l(o)("common.editMenuTips")),1)]),_(Y,{class:"editMenu pt-8"},{default:f(()=>[(r(!0),y(L,null,q(l(u).filter(g=>g.advanced===!0),g=>(r(),x(X,{key:g.id,title:g.display},{default:f(()=>[(r(!0),y(L,null,q(l(U)(g.items).sort((E,T)=>{var F,J;return Number((F=E.advanced)!=null?F:!1)-Number((J=T.advanced)!=null?J:!1)}),E=>(r(),y("div",{key:E.id,class:"py-8 px-44px flex items-center justify-between dark:text-999","data-cy":E.name},[_(p,{"model-value":v(E),disabled:!E.advanced,onChange:T=>w(E.name)},{default:f(()=>[K(C(E.display),1)]),_:2},1032,["model-value","disabled","onChange"])],8,je))),128))]),_:2},1032,["title"]))),128))]),_:1})]),_:1})],2)])}}});var Pe=he(ze,[["__scopeId","data-v-c07b788e"]]);const Te={key:1,class:"h-full flex flex-col bg-[#f3f5f5] dark:bg-[#1e1e1e]"},Fe={key:0,class:"flex-1 overflow-hidden relative"},Je={class:"absolute inset-0 left-202px"},zi=D({setup(e){const{t:s}=z(),t=R(),o=ue(),c=I(),h=me(),n=O(!1),u=m=>{n.value=m};return re(()=>t.query.SiteId,m=>{m&&n.value&&(ce({message:s("common.siteChangingSuccess"),type:"success"}),n.value=!1),de.addRoute({name:"test",path:"/sites/test",component:()=>Z(()=>import("./module-index.6288daf3.js"),["assets/module-index.6288daf3.js","assets/url.4cb47a7a.js","assets/windi.6360286d.js","assets/windi.2d745abf.css","assets/i18n.a87944a4.js"]),meta:{menu:{display:"aaa",icon:"icon-media1"}}})}),(m,v)=>{const w=V("router-view"),A=W,S=we;return r(),x(S,{locale:l(o).locale},{default:f(()=>[l(h).show?(r(),x(ke,{key:0})):N("",!0),l(c).site?(r(),y("div",Te,[_(l(te),{class:"pl-40px"},{left:f(()=>[l(o).limitSite?N("",!0):(r(),x(ge,{key:0,onChange:v[0]||(v[0]=i=>u(i))})),_(Se),l(o).limitSite?N("",!0):(r(),x(ee,{key:1}))]),right:f(()=>[]),_:1}),l(o).header?(r(),y("div",Fe,[_(Pe,{class:"absolute inset-0 right-auto"}),b("div",Je,[_(A,{id:"main-scrollbar",class:"w-full"},{default:f(()=>[(r(),x(w,{key:m.$route.name}))]),_:1})])])):N("",!0)])):N("",!0)]),_:1},8,["locale"])}}});export{zi as default};
