var A=(P,i,x)=>new Promise((p,f)=>{var b=v=>{try{I(x.next(v))}catch(y){f(y)}},m=v=>{try{I(x.throw(v))}catch(y){f(y)}},I=v=>v.done?p(v.value):Promise.resolve(v.value).then(b,m);I((x=x.apply(P,i)).next())});import{_ as de}from"./icon-button.a2edb33f.js";import{_ as pe}from"./k-table.c1a07faa.js";import{m as ue,d as Ne}from"./textContent.3aa165a9.js";import{a as De}from"./content-folder.3d6e690b.js";import{u as fe}from"./use-date.3be35318.js";import{u as G}from"./replace-all.e310d26c.js";import{d as te,cd as _e,g as F,o as c,j as _,w as t,b as l,u as e,f as S,t as V,c as D,e as oe,G as ve,n as ye,aH as W,x as Re,M as Fe,h as Me,N as Ue,b7 as qe,a as J,F as Z,b6 as ee,k as L}from"./url.8f5ec20c.js";import{B as Ae}from"./breadcrumb.3432b615.js";import{S as he}from"./search-input.fe88eea7.js";import{b as Le}from"./confirm.f89fa710.js";import{g as ne,v as Pe}from"./i18n.0d8cb6d1.js";import{u as be}from"./main.d919dab0.js";import{u as ze}from"./page.be880a87.js";import{E as le,a as je}from"./index.8e0d96d6.js";import{E as Ke}from"./index.3d638063.js";import{E as ge}from"./index.6ac167de.js";import{u as ke}from"./content-effect.a44667b4.js";import{_ as xe}from"./index.1f093d3d.js";import{E as we}from"./index.c7806af3.js";import{E as Oe}from"./windi.dcba9a95.js";import{E as Ge,a as He,c as Qe}from"./index.9a7a049b.js";import{E as Je}from"./index.38840738.js";import"./index.36905e5d.js";import"./index.1d64e54f.js";import"./sortable.esm.a99254e8.js";import"./index.17321c3b.js";import"./isEqual.8058d1d5.js";import"./_baseIsEqual.f1f57955.js";import"./index.97ced36a.js";import"./event.776e7e11.js";import"./index.6e9a6658.js";import"./error.7e8331f1.js";import"./isNil.98bb3b88.js";import"./index.ec3d8ab1.js";import"./index.230671a2.js";import"./dayjs.min.8b8ca7e9.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";/* empty css                                                                 */import"./logo-transparent.1566007e.js";import"./index.ab7ae43a.js";import"./index.1e651ffe.js";import"./scroll.9a94de30.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.0c15535f.js";import"./validator.11bc55c7.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./validate.b9ea657d.js";import"./index.3e5d2d38.js";import"./index.f2618a8f.js";import"./index.ddf78e53.js";import"./index.6943850d.js";import"./index.4ccd5d27.js";import"./style.67f0cdc4.js";import"./toNumber.6efebd6a.js";import"./index.6756a6f3.js";import"./_baseClone.24478792.js";import"./guid.c1a40312.js";import"./debounce.730e1961.js";import"./index.6d134d76.js";import"./refs.d2253dd4.js";import"./omitBy.0bb3ab58.js";import"./pickBy.f2c42554.js";import"./_basePickBy.a9f0143d.js";import"./isEmpty.d2ee0b7e.js";import"./search-provider.8815ed27.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./use-operation-dialog.1c7cf152.js";import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.92552fc5.js";import"./file.f8555a01.js";import"./index.d1d474c4.js";import"./folder.8308bb9d.js";import"./relations-tag.c8ada5d9.js";import"./use-copy-text.7801df9a.js";import"./index.43142d25.js";import"./browser.3a7f9e8c.js";import"./throttle.3f3ee457.js";import"./_createCompounder.2027fb34.js";import"./color-picker.f4353bb4.js";import"./index.04b796f6.js";import"./position.a71853ef.js";import"./image-cover.f73aef20.js";import"./media-dialog.6d9d43ca.js";import"./media.3136d42d.js";import"./index.ff2ed7f6.js";/* empty css                                                          *//* empty css                                                          */import"./layout.4c508974.js";import"./index.7d901c84.js";import"./utils.6f25662a.js";import"./index.66e12c37.js";import"./use-file-upload.e88ed30a.js";import"./index.337c36f2.js";import"./index.e68a3b8d.js";import"./index.fae306fc.js";import"./index.b7efef2a.js";import"./file.8c428cda.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.8fc1c564.js";import"./string.75b81683.js";const We=["onClick"],Xe=te({setup(P,{expose:i}){const x=_e(),{onPreview:p}=ze(),f=F(!1),{t:b}=ne(),m=F(),I=be(),v=y=>{var w;if(!I.hasAccess("content","view"))return;const u=x.resolve(G({name:"content",query:{id:y.id,folder:(w=m.value)==null?void 0:w.folderId}}));p(u.href)};return i({show(y){m.value=y,f.value=!0}}),(y,u)=>{const w=le,E=de,z=je,R=Ke,j=ge;return c(),_(j,{modelValue:f.value,"onUpdate:modelValue":u[0]||(u[0]=s=>f.value=s),width:"600px","close-on-click-modal":!1,title:e(b)("common.relation"),onClosed:u[1]||(u[1]=s=>f.value=!1)},{default:t(()=>[l(R,{"max-height":"400px"},{default:t(()=>{var s;return[l(z,{data:(s=m.value)==null?void 0:s.contents,class:"el-table--gray"},{default:t(()=>[l(w,{label:e(b)("common.name")},{default:t(({row:C})=>[S("a",{class:"cursor-pointer underline","data-cy":"name",onClick:r=>e(p)(C.url)},V(C.title),9,We)]),_:1},8,["label"]),l(w,{label:e(b)("common.edit"),width:"80px",align:"right"},{default:t(({row:C})=>[l(E,{permission:{feature:"content",action:"view"},icon:"icon-a-writein",class:"hover:text-blue",tip:e(b)("common.edit"),"data-cy":"edit",onClick:r=>v(C)},null,8,["tip","onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]}),_:1})]),_:1},8,["modelValue","title"])}}}),Ye={class:"h-60px flex items-center"},Ze={class:"flex items-center"},eo=te({props:{folder:null},emits:["reload"],setup(P,{expose:i,emit:x}){const p=P,f=F(!1),b=F(""),{t:m}=ne(),{list:I,columnLoaded:v,pagination:y,fetchList:u,columns:w,keywords:E}=ke(p.folder.id),z=D(()=>w.value.map(r=>({name:r.name,displayName:r.displayName,controlType:r.controlType,multipleValue:r.multipleValue}))),R=D(()=>I.value.map(r=>(r.$DisabledSelect=r.id===b.value,r))),j=r=>{u(1,p.folder.pageSize),b.value=r.id,f.value=!0};function s(r){return A(this,null,function*(){const h=R.value.findIndex(M=>M.id===r.id)+1,T=R.value[h],B=r,$={source:b.value,nextId:B==null?void 0:B.id,prevId:T==null?void 0:T.id,folderId:p.folder.id};yield ue($),x("reload"),C()})}function C(){f.value=!1}return i({show:j}),(r,h)=>{const T=we,B=he,$=le,M=pe,K=ge;return c(),_(K,{modelValue:f.value,"onUpdate:modelValue":h[2]||(h[2]=d=>f.value=d),width:"800px","close-on-click-modal":!1,title:e(m)("common.move"),"custom-class":"el-dialog--fixed-footer editEmbeddedDialog","destroy-on-close":"",onClose:C},{default:t(()=>[oe(l(M,{data:e(R),"row-key":"id",pagination:e(y),"max-height":300,"show-check":"","hide-delete":"","is-radio":!0,permission:{feature:"content",action:"view"},onChange:h[1]||(h[1]=d=>e(u)(d))},{leftBar:t(({selected:d})=>[S("div",Ye,[S("div",null,[l(T,{round:"",class:"dark:bg-666",disabled:!d.length,onClick:ae=>s(d[0])},{default:t(()=>[S("div",Ze,V(e(m)("common.moveBehind")),1)]),_:2},1032,["disabled","onClick"])])])]),bar:t(()=>[l(B,{modelValue:e(E),"onUpdate:modelValue":h[0]||(h[0]=d=>ve(E)?E.value=d:null),placeholder:e(m)("common.searchContents"),class:"w-238px",clearable:"","data-cy":"search"},null,8,["modelValue","placeholder"])]),default:t(()=>[l(xe,{columns:e(z)},null,8,["columns"]),l($,{label:e(m)("content.online"),width:"100",align:"center"},{default:t(({row:d})=>[S("span",{class:ye(d.online?"text-green":"text-999"),"data-cy":"online"},V(d.online?e(m)("common.yes"):e(m)("common.no")),3)]),_:1},8,["label"]),l($,{label:e(m)("common.lastModified"),width:"180",align:"center"},{default:t(({row:d})=>[W(V(e(fe)(d.lastModified)),1)]),_:1},8,["label"])]),_:1},8,["data","pagination"]),[[Pe,e(v)]])]),_:1},8,["modelValue","title"])}}}),oo={class:"p-24"},to={class:"flex items-center py-24 justify-between"},no={class:"max-w-300px overflow-x-clip whitespace-nowrap overflow-ellipsis"},lo={class:"space-x-16 flex items-center"},ao={class:"flex"},ln=te({setup(P){const{t:i}=ne(),x=_e(),p=Re("folder"),{list:f,columns:b,keywords:m,currentKeyword:I,columnLoaded:v,pagination:y,fetchList:u,sortSetting:w,searchCategories:E,categoryOptions:z,onSortChanged:R}=ke(p),j=D(()=>b.value.map(o=>({name:o.name,displayName:o.displayName,controlType:o.controlType,multipleValue:o.multipleValue,attrs:{sortable:K.value,"min-width":180}}))),s=F(),C=F(),r=Fe(),h=be(),T=F();Me(()=>A(this,null,function*(){var o;yield ae(),u(1,(o=s.value)==null?void 0:o.pageSize)}));const B=D(()=>{var o,a;return((o=s.value)==null?void 0:o.sortable)&&((a=s.value)==null?void 0:a.sortField)==="dragAndDrop"}),$=D(()=>{var o;return B.value&&((o=f.value)==null?void 0:o.length)>1}),M=D(()=>$.value&&!I.value),K=D(()=>B.value?void 0:"custom"),d=D(()=>{var o,a;return((o=s.value)==null?void 0:o.displayName)||((a=s.value)==null?void 0:a.name)||""});function ae(){return A(this,null,function*(){s.value=yield De({id:p})})}function Ce(o){return A(this,null,function*(){yield Le(o.length);const a=o.map(g=>g.id);yield Ne({ids:a}),u(y.currentPage)})}function Se(){var o;h.hasAccess("contentType","edit")&&x.push(G({name:"contenttype",query:{id:(o=s.value)==null?void 0:o.contentTypeId,fromRouter:r.name,fromFolder:p}}))}function ie(o,a){x.push(G({name:"content",query:{folder:p,id:o==null?void 0:o.id,copy:a?"true":void 0}}))}function Ie(o){!h.hasAccess("content","edit")||ie(o,!0)}function Ve(o){switch(o.type){case 1:return i("common.embeddedFolder");case 2:return i("common.categoryFolder");default:return i("common.unknown")}}function Ee(o){var a;(a=T.value)==null||a.show(o)}function Te(o){var a;(a=C.value)==null||a.show(o)}function Be(o,a){return A(this,null,function*(){const{newIndex:g,oldIndex:U}=a;if(g===void 0||U===void 0||U===g)return;const X=o[g],O=o[g+1],N=o[g-1],H={source:X.id,folderId:p,prevId:O==null?void 0:O.id,nextId:N==null?void 0:N.id};yield ue(H),yield u()})}return(o,a)=>{var se,ce,me;const g=Oe,U=we,X=Ge,O=He,N=Je,H=Ue("router-link"),Y=de,$e=Qe,Q=le,re=qe("hasPermission");return c(),J("div",oo,[l(Ae,{"crumb-path":[{name:e(i)("common.contentFolders"),route:{name:"contents"}},{name:e(d)}]},null,8,["crumb-path"]),S("div",to,[oe((c(),_(U,{round:"",title:e(i)("common.new")+" "+e(d),"data-cy":"new-text-content",onClick:a[0]||(a[0]=n=>ie())},{default:t(()=>[l(g,{class:"iconfont icon-a-addto"}),W(" "+V(e(i)("common.new"))+" ",1),S("span",no,V(e(d)),1)]),_:1},8,["title"])),[[re,{feature:"content",action:"edit"}]]),S("div",lo,[(c(!0),J(Z,null,ee(e(z),n=>{var k;return c(),_(O,{key:n.id,modelValue:e(E)[n.id],"onUpdate:modelValue":q=>e(E)[n.id]=q,clearable:"",multiple:"",placeholder:(k=n.display)!=null?k:n.alias,onChange:a[1]||(a[1]=()=>e(u)())},{default:t(()=>[(c(!0),J(Z,null,ee(n.options,q=>(c(),_(X,{key:q.key,label:q.value,value:q.key},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])}),128)),l(he,{modelValue:e(m),"onUpdate:modelValue":a[2]||(a[2]=n=>ve(m)?m.value=n:null),placeholder:e(i)("common.searchContents"),class:"w-238px",clearable:"","data-cy":"search"},null,8,["modelValue","placeholder"]),e(h).hasAccess("contentType","edit")?(c(),_(H,{key:0,to:e(G)({name:"contenttype",query:{id:(se=s.value)==null?void 0:se.contentTypeId,fromRouter:e(r).name,fromFolder:e(p)}})},{default:t(()=>[l(N,{class:"box-item",effect:"dark",content:e(i)("common.editContentType"),placement:"top"},{default:t(()=>[l(U,{circle:"","data-cy":"edit-content-type",onClick:Se},{default:t(()=>[l(g,{class:"iconfont icon-a-setup"})]),_:1})]),_:1},8,["content"])]),_:1},8,["to"])):(c(),_(N,{key:1,class:"box-item",effect:"dark",content:e(i)("common.editContentType"),placement:"top"},{default:t(()=>[oe((c(),_(U,{circle:"","data-cy":"edit-content-type"},{default:t(()=>[l(g,{class:"iconfont icon-a-setup"})]),_:1})),[[re,{feature:"contentType",action:"edit"}]])]),_:1},8,["content"]))])]),e(v)?(c(),_(e(pe),{key:0,data:e(f),"show-check":"",draggable:e($),"row-key":"id",pagination:e(y),permission:{feature:"content",action:"delete"},sort:(ce=e(w).prop)!=null?ce:void 0,order:(me=e(w).order)!=null?me:void 0,onDelete:Ce,onChange:a[3]||(a[3]=n=>e(u)(n)),onSorted:Be,onSortChange:e(R)},{bar:t(({selected:n})=>[n.length===1?(c(),_(Y,{key:0,permission:{feature:"content",action:"edit"},circle:"",class:"text-[#192845] !hover:text-blue",icon:"icon-copy",tip:e(i)("common.copy"),"data-cy":"copy",onClick:k=>Ie(n[0])},null,8,["tip","onClick"])):L("",!0),e($)&&n.length===1?(c(),_(Y,{key:1,permission:{feature:"content",action:"edit"},circle:"",class:"text-[#192845] !hover:text-blue",icon:"icon-move",tip:e(i)("common.move"),"data-cy":"move",onClick:k=>Te(n[0])},null,8,["tip","onClick"])):L("",!0)]),default:t(()=>[l(xe,{columns:e(j)},null,8,["columns"]),l(Q,{label:e(i)("common.usedBy"),width:"180"},{default:t(({row:n})=>[n.usedBy?(c(!0),J(Z,{key:0},ee(n.usedBy,k=>(c(),_(N,{key:k.folderId,class:"box-item",effect:"dark",content:Ve(k),placement:"top"},{default:t(()=>[l($e,{class:"cursor-pointer",round:"",size:"small",title:k.displayName||k.folderName,onClick:q=>Ee(k)},{default:t(()=>[W(V(k.displayName||k.folderName),1)]),_:2},1032,["title","onClick"])]),_:2},1032,["content"]))),128)):L("",!0)]),_:1},8,["label"]),l(Q,{prop:"online",sortable:e(K),label:e(i)("content.online"),width:"120",align:"center"},{default:t(({row:n})=>[S("span",{class:ye(n.online?"text-green":"text-999"),"data-cy":"online"},V(n.online?e(i)("common.yes"):e(i)("common.no")),3)]),_:1},8,["sortable","label"]),l(Q,{label:e(i)("common.lastModified"),width:"180",align:"center",prop:"lastModified",sortable:e(K)},{default:t(({row:n})=>[W(V(e(fe)(n.lastModified)),1)]),_:1},8,["label","sortable"]),l(Q,{align:"right",width:e(M)?80:50},{default:t(({row:n})=>[S("div",ao,[l(H,{class:"mx-8 cursor-pointer hover:text-blue",to:e(G)({name:"content",query:{folder:e(p),id:n==null?void 0:n.id,copy:void 0}}),"data-cy":"edit"},{default:t(()=>[l(N,{class:"box-item",effect:"dark",content:e(i)("common.edit"),placement:"top"},{default:t(()=>[l(g,{class:"iconfont icon-a-writein"})]),_:1},8,["content"])]),_:2},1032,["to"]),e(M)?(c(),_(Y,{key:0,icon:"icon-move js-sortable cursor-move",tip:e(i)("common.move"),"data-cy":"move"},null,8,["tip"])):L("",!0)])]),_:1},8,["width"])]),_:1},8,["data","draggable","pagination","sort","order","onSortChange"])):L("",!0),l(Xe,{ref_key:"usedByDialogRef",ref:T},null,512),s.value?(c(),_(eo,{key:1,ref_key:"moveRef",ref:C,folder:s.value,onReload:e(u)},null,8,["folder","onReload"])):L("",!0)])}}});export{ln as default};
