var ie=Object.defineProperty,ue=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var R=(l,t,e)=>t in l?ie(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,j=(l,t)=>{for(var e in t||(t={}))ce.call(t,e)&&R(l,e,t[e]);if(D)for(var e of D(t))me.call(t,e)&&R(l,e,t[e]);return l},N=(l,t)=>ue(l,de(t));var A=(l,t,e)=>new Promise((f,n)=>{var v=y=>{try{d(e.next(y))}catch(h){n(h)}},m=y=>{try{d(e.throw(y))}catch(h){n(h)}},d=y=>y.done?f(y.value):Promise.resolve(y.value).then(v,m);d((e=e.apply(l,t)).next())});import{b as pe,_ as fe,a as ye,c as ve,d as he,e as be}from"./basic.07a117d3.js";import{t as ge,b as Se}from"./replace-all.7cf5f327.js";import{g as W}from"./i18n.48bd28ac.js";import{E as Ee}from"./index.fc90f5ad.js";import{E as Ve}from"./windi.a5b0b048.js";import{E as _e}from"./index.2bc50276.js";import{g as B,c as P,cd as ke,M as Ue,at as T,d as X,i as Me,o as S,a as x,F as H,b6 as Y,b as g,u as o,f as Ie,w as V,j as M,k as Q,r as Te}from"./url.2e6a77c4.js";import{j as K,k as $,m as xe,n as Z,c as Ce}from"./style.19d0c187.js";import{K as ee,L as te,a as we}from"./dev-mode.c4133b5a.js";import{g as ne,u as Be}from"./main.ea42d807.js";import{n as le}from"./guid.c1a40312.js";import{r as Pe}from"./index.4fa52eca.js";import{E as Le,a as Ae}from"./index.aa73e4df.js";import{E as qe}from"./index.cbddf8eb.js";import{E as He,a as $e}from"./index.6855d037.js";function Ke(l){const t=[];if(!l)return t;const e=ee(),f=K(l,["link","style"]);for(const n of f){if($(n,"link")){const v=n.getAttribute("rel"),m=n.getAttribute("href");if(v==="stylesheet"&&m){const d=e.all.find(y=>y.href===m);d&&t.push({el:n,content:d.name,id:d.id})}}$(n,"style")&&t.push({el:n,content:n.innerHTML,id:le()})}return t}function Oe(l){const t=[];if(!l)return t;const e=te(),f=K(l,["script"]);for(const n of f){const v=n.getAttribute("src");if(v){const m=e.all.find(d=>d.href===v);m&&t.push({el:n,content:m.name,id:m.id,position:G(n)})}else t.push({el:n,content:n.innerHTML,id:le(),position:G(n)})}return t}function Fe(l,t){const e=[];if(!l||!t)return e;const f=ne();for(const n of K(l,["meta"])){const v=n.getAttribute("charset"),m=n.getAttribute("property"),d=n.getAttribute("http-equiv"),y=n.getAttribute("name"),h=n.getAttribute("content");if(v){let s=t.find(b=>!!b.charset);s?(s.charset=v,s.el=n):s={charset:v,el:n},e.push(s)}if(d&&h){let s=t.find(b=>b.httpequiv===d);s?(s.content||(s.content={}),s.el=n):(s={httpequiv:d,content:{},el:n},s.content[f.default]=h),e.push(s)}if(y&&h){let s=t.find(b=>b.name===y);s?(s.content||(s.content={}),s.el=n):(s={name:y,content:{},el:n},s.content[f.default]=h),e.push(s)}if(m&&h){let s=t.find(b=>b.property===m);s?(s.content||(s.content={}),s.el=n):(s={property:m,content:{},el:n},s.content[f.default]=h),e.push(s)}}return e}function G(l){return xe(l).some(t=>$(t,"head"))?"head":"body"}const De=ee(),Re=te(),oe=we(),k=B(),i=B(),je=P(()=>i.value?Z(i.value):""),q=P(()=>Ke(i.value)),z=P(()=>Oe(i.value)),J=P(()=>{var l;return Fe(i.value,(l=k.value)==null?void 0:l.metas)});function Ne(l,t,e){i.value.body.innerHTML=Pe(l,t!=null?t:!1,e)}function Qe(l){let t=i.value.head.querySelector("#designer-page-style");if(l){if(!t){t=document.createElement("style"),t.setAttribute("id","designer-page-style"),t.innerHTML=l,i.value.head.appendChild(t);return}t.innerHTML=l;return}t&&i.value.head.removeChild(t)}function Ge(l,t){return A(this,null,function*(){var f,n;const e=yield oe.getPage(l,t);e.urlPath=(f=e.urlPath)!=null?f:"",e.name=(n=e.name)!=null?n:"",k.value=e,i.value=Ce(k.value.body)})}function ze(){const l=ke(),t=Ue(),e=a=>{const c=q.value[a.oldIndex],r=q.value[a.newIndex].el;r!=null&&r.parentElement&&r.parentElement.insertBefore(c.el,a.oldIndex>a.newIndex?r:r.nextElementSibling),T(i)},f=a=>{if(!i.value)return;const c=De.all.find(r=>r.id===a);if(c){const r=i.value.createElement("link");r.rel="stylesheet",r.href=c.href,i.value.head.appendChild(r),T(i)}},n=(a,c)=>{const r=z.value.filter(C=>C.position===c),E=r[a.oldIndex],I=r[a.newIndex].el;I.parentElement&&I.parentElement.insertBefore(E.el,a.oldIndex>a.newIndex?I:I.nextElementSibling),T(i)},v=(a,c)=>{if(!i.value)return;const r=Re.all.find(E=>E.id===a);if(r){const E=i.value.createElement("script");E.src=r.href,c==="head"?i.value.head.appendChild(E):i.value.body.appendChild(E),T(i)}},m=a=>{!i.value||(a.remove(),T(i))},d=(a,c)=>{!i.value||(c&&c.parentElement?c.parentElement.insertBefore(a,c):i.value.head.appendChild(a),T(i))};return{init:Ge,setBody:Ne,setPageStyle:Qe,model:k,styles:q,scripts:z,metas:J,preview:je,sortStyle:e,insertStyle:f,sortScript:n,insertScript:v,deleteElement:m,insertElement:d,save:()=>A(this,null,function*(){if(!k.value||!i.value)return;k.value.body=Z(i.value),k.value.metas=J.value;const a=yield oe.updatePage(k.value);return l.replace({query:N(j({},t.query),{id:a.id})}),a}),updateTitle:a=>{!i.value||(i.value.title=a)},addOrUpdateMeta:a=>{const c=ne(),r=pe(a,c.default);a.el&&r?(d(r,a.el),m(a.el)):r&&k.value&&(k.value.metas.push(a),d(r))},deleteMeta:a=>{a.el&&m(a.el)}}}const Je={class:"px-24 py-16 space-y-4"},We=X({props:{modelValue:null},emits:["update:modelValue"],setup(l,{emit:t}){const e=l,{t:f}=W(),n=B(ge(e.modelValue)),v=m=>{n.value.splice(m,1)};return Me(()=>n.value,()=>{t("update:modelValue",Se(n.value))},{deep:!0}),(m,d)=>{const y=Ee,h=Ve,s=_e;return S(),x("div",Je,[(S(!0),x(H,null,Y(n.value,(b,a)=>(S(),x("div",{key:a,class:"flex items-center space-x-4"},[g(y,{modelValue:b.key,"onUpdate:modelValue":c=>b.key=c,placeholder:o(f)("common.key"),"data-cy":"key"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),g(y,{modelValue:b.value,"onUpdate:modelValue":c=>b.value=c,placeholder:o(f)("common.value"),"data-cy":"value"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),Ie("div",null,[g(s,{circle:"","data-cy":"remove",onClick:c=>v(a)},{default:V(()=>[g(h,{class:"text-orange iconfont icon-delete"})]),_:2},1032,["onClick"])])]))),128)),g(s,{circle:"","data-cy":"add",onClick:d[0]||(d[0]=b=>n.value.push({key:"",value:""}))},{default:V(()=>[g(h,{class:"text-blue iconfont icon-a-addto"})]),_:1})])}}}),pt=X({props:{oldUrlPath:null,items:{default(){return["basic","HTMLMeta","parameters","style","scripts","cache"]}}},setup(l){const t=l,{model:e,updateTitle:f,deleteElement:n,styles:v,sortStyle:m,insertStyle:d,scripts:y,sortScript:h,insertScript:s,metas:b,addOrUpdateMeta:a,deleteMeta:c}=ze(),{t:r}=W(),E=B("basic"),I=Be();return function(){var U,w;const u=(U=t.items)!=null?U:[];E.value=(w=u[0])!=null?w:"basic"}(),(C,u)=>{const U=Le,w=qe,ae=He,se=$e,re=Ae;return o(e)?(S(),M(re,{key:0,modelValue:E.value,"onUpdate:modelValue":u[11]||(u[11]=_=>E.value=_)},{default:V(()=>[(S(!0),x(H,null,Y(l.items,_=>(S(),x(H,{key:_},[_==="basic"?(S(),M(U,{key:0,name:"basic",title:o(r)("common.basic")},{default:V(()=>[g(fe,{ref_for:!0,ref:"basicForm",url:o(e).urlPath,"onUpdate:url":u[0]||(u[0]=p=>o(e).urlPath=p),titles:o(e).contentTitle,"onUpdate:titles":u[1]||(u[1]=p=>o(e).contentTitle=p),published:o(e).published,"onUpdate:published":u[2]||(u[2]=p=>o(e).published=p),"old-url-path":l.oldUrlPath,"onUpdate:defaultTitle":o(f)},null,8,["url","titles","published","old-url-path","onUpdate:defaultTitle"])]),_:1},8,["title"])):_==="HTMLMeta"?(S(),M(U,{key:1,name:"HTMLMeta",title:o(r)("common.HTMLMeta")},{default:V(()=>[g(ye,{list:o(b),onDelete:o(c),onAddOrUpdate:o(a)},null,8,["list","onDelete","onAddOrUpdate"])]),_:1},8,["title"])):_==="parameters"?(S(),M(U,{key:2,name:"parameters",title:o(r)("common.parameters")},{default:V(()=>[g(We,{modelValue:o(e).parameters,"onUpdate:modelValue":u[3]||(u[3]=p=>o(e).parameters=p)},null,8,["modelValue"])]),_:1},8,["title"])):_==="style"?(S(),M(U,{key:3,name:"style",title:o(r)("common.style")},{default:V(()=>{var p,O,F;return[g(ve,{list:o(v),onSort:o(m),onInsert:o(d),onDelete:u[4]||(u[4]=L=>o(n)(L.el))},null,8,["list","onSort","onInsert"]),(F=(O=(p=o(I))==null?void 0:p.site)==null?void 0:O.unocssSettings)!=null&&F.enable?(S(),M(se,{key:0,"label-position":"top",class:"px-24"},{default:V(()=>[g(ae,{label:o(r)("common.disableUnocss")},{default:V(()=>[g(w,{modelValue:o(e).disableUnocss,"onUpdate:modelValue":u[5]||(u[5]=L=>o(e).disableUnocss=L)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})):Q("",!0)]}),_:1},8,["title"])):_==="scripts"?(S(),M(U,{key:4,name:"scripts",title:o(r)("common.scripts")},{default:V(()=>[g(he,{list:o(y),onSort:o(h),onDelete:u[6]||(u[6]=p=>o(n)(p.el)),onInsert:o(s)},null,8,["list","onSort","onInsert"])]),_:1},8,["title"])):_==="cache"?(S(),M(U,{key:5,name:"cache",title:o(r)("common.cache")},{default:V(()=>[g(be,{enable:o(e).enableCache,"onUpdate:enable":u[7]||(u[7]=p=>o(e).enableCache=p),enableVersion:o(e).cacheByVersion,"onUpdate:enableVersion":u[8]||(u[8]=p=>o(e).cacheByVersion=p),minutes:o(e).cacheMinutes,"onUpdate:minutes":u[9]||(u[9]=p=>o(e).cacheMinutes=p),queryKeys:o(e).cacheQueryKeys,"onUpdate:queryKeys":u[10]||(u[10]=p=>o(e).cacheQueryKeys=p)},null,8,["enable","enableVersion","minutes","queryKeys"])]),_:1},8,["title"])):Te(C.$slots,_,{key:6})],64))),128))]),_:3},8,["modelValue"])):Q("",!0)}}});export{pt as _,ze as u};
