var Qo=Object.defineProperty,Xo=Object.defineProperties;var Yo=Object.getOwnPropertyDescriptors;var zt=Object.getOwnPropertySymbols;var Zo=Object.prototype.hasOwnProperty,en=Object.prototype.propertyIsEnumerable;var Jt=(e,l,o)=>l in e?Qo(e,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[l]=o,ge=(e,l)=>{for(var o in l||(l={}))Zo.call(l,o)&&Jt(e,o,l[o]);if(zt)for(var o of zt(l))en.call(l,o)&&Jt(e,o,l[o]);return e},Oe=(e,l)=>Xo(e,Yo(l));var g=(e,l,o)=>new Promise((t,s)=>{var r=u=>{try{n(o.next(u))}catch(d){s(d)}},a=u=>{try{n(o.throw(u))}catch(d){s(d)}},n=u=>u.done?t(u.value):Promise.resolve(u.value).then(r,a);n((o=o.apply(e,l)).next())});import{w as H,d as oe,g as Y,v as Qe,o as ue,p as so,C as tn,Y as on,Q as nn}from"./i18n.bcd18f8a.js";import{d as G,M as De,g as C,a3 as an,h as nt,aW as io,i as ee,b7 as at,o as f,a as M,f as R,b as k,n as de,t as J,r as Ke,e as ie,j as U,k as j,m as $t,c as X,B as He,u as p,J as At,ce as Ee,w as $,b6 as W,F as q,aH as Ae,cf as ln,N as Dt,aV as sn,az as ro,cd as rn,cg as St,c0 as un,ch as dn,K as uo,D as Rt}from"./url.8f5ec20c.js";import{E as be}from"./windi.19264205.js";import{d as N,e as cn,f as Re,u as ce,r as se,D as Ye,g as mn,E as co,h as pn}from"./main.582f9de6.js";import{a as E,C as $e,i as Wt,u as ke}from"./replace-all.d441bf14.js";import{e as Z,n as jt}from"./guid.c1a40312.js";import{g as vn,a as fn,u as yn,b as gn,c as Fe,_ as mo}from"./index.72ccc088.js";import{E as po}from"./index.79f78425.js";import{m as te,M as Pt,D as bn,k as wn,P as _n,_ as kn}from"./userWorker.b3a6730b.js";import{o as vo,a as hn,c as fo}from"./config.812575d1.js";import{d as yo}from"./dark.166fd971.js";import{u as we,g as go,l as xn,a as Cn}from"./page.e927203a.js";import{E as Vt,a as Ot,b as Tt}from"./index.8bc4b1d6.js";import{c as Ve}from"./use-copy-text.c117d066.js";import{s as Be}from"./index.73c941f5.js";import{r as $n,b as Sn,a as Qt}from"./toggleComment.5b29ca87.js";import{d as Vn}from"./style.9c8f6403.js";import{U as je}from"./editor.main.d2800f63.js";import{u as Pe}from"./use-save-tip.8f44d6c0.js";import{r as _e,a as le,s as Te,i as Ce,l as bo}from"./validate.238a9986.js";import{E as me}from"./index.5cbbc5d7.js";import{E as pe,a as ve}from"./index.6d63eb53.js";import{b as xe}from"./confirm.eadb49f1.js";import{_ as fe}from"./index.7a75fca3.js";import{E as Ft}from"./index.373c837a.js";import{E as wo,a as _o}from"./index.59b1471f.js";import{E as Bt,b as Tn,a as qt,c as Mn}from"./index.6d22f937.js";import{E as ye}from"./index.d4a6b2d5.js";import{_ as Xe}from"./icon-button.315b6443.js";import{V as ko}from"./vuedraggable.umd.7929a3b6.js";import{E as lt}from"./index.aec72f69.js";import{_ as In}from"./index.4dc50d47.js";import{G as Rn}from"./index.3be79fd5.js";import{_ as ho}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Ln}from"./index.79dc05e0.js";import{E as Un}from"./index.ff00fbd6.js";import{_ as En}from"./alert.8fe5500a.js";import{E as Nn}from"./index.d84e2378.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.c0b84b74.js";/* empty css                                                          */import"./file.734aeed6.js";import"./use-date.a1321c18.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.c73251ef.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.53a9e945.js";import{I as An}from"./image-editor.f97cfa84.js";import{M as Dn}from"./main.esm.6441082b.js";import{g as jn}from"./index.7633560d.js";const Pn={class:"group-collapse"},On={class:"flex-1","data-cy":"folder"},Fn={class:"transition-all opacity-0 flex items-center space-x-8"},re=G({props:{title:null,add:{type:Boolean},expandDefault:{type:Boolean},permission:null},emits:["onAdd"],setup(e){const l=e,o=De(),t=C(l.expandDefault||!1),s=C(),r=C();let a;const n=()=>g(this,null,function*(){var d;const u=r.value?`${(d=r.value)==null?void 0:d.scrollHeight}px`:void 0;u!==s.value&&(s.value=u,t.value=!0)});return an(n),nt(()=>{a=new MutationObserver(n),a.observe(r.value,{childList:!0,subtree:!0})}),io(()=>{a==null||a.disconnect()}),ee(()=>o.query.activity,()=>{n()}),(u,d)=>{const c=be,m=at("hasPermission");return f(),M("div",Pn,[R("div",{class:"h-26px flex items-center px-12 text-s bg-gray/60 dark:bg-[#333] dark:text-fff/86 space-x-8 not-last:border-b not-last:border-solid not-last:border-gray/50 not-last:dark:border-opacity-20 cursor-pointer",onClick:d[2]||(d[2]=H(w=>t.value=!t.value,["stop"]))},[k(c,{class:de(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",t.value?"rotate-180 ":"rotate-0"]),"data-cy":"expand"},null,8,["class"]),R("span",On,J(e.title),1),R("div",{class:"flex items-center space-x-8 collapse-bar",onClick:d[1]||(d[1]=H(()=>{},["stop"]))},[R("div",Fn,[Ke(u.$slots,"bar"),e.add?ie((f(),U(c,{key:0,class:"iconfont icon-a-addto hover:text-blue","data-cy":"add",onClick:d[0]||(d[0]=w=>u.$emit("onAdd"))},null,512)),[[m,{feature:e.permission,action:"edit",effect:"hiddenIcon"}]]):j("",!0)])])]),R("div",{style:$t({height:t.value?s.value:"0px"}),class:"overflow-hidden transition-all duration-200"},[R("div",{ref_key:"body",ref:r},[Ke(u.$slots,"default")],512)],4)])}}}),Bn=oe.global.t,qn=e=>N.get(E("Code/ListByType",!0),{codeType:e}),Gn=()=>N.get(E("Code/CodeType")),Kn=(e,l)=>N.get(E("Code/GetEdit"),{codeType:e,id:l}),Hn=e=>N.get(E("Code/GetByName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),zn=e=>N.post(E("Code/post"),e),Jn=e=>N.post(E("Code/Deletes"),{ids:e},void 0,{successMessage:Bn("common.deleteSuccess")}),Wn=e=>N.get(E("Code/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Qn=()=>N.get(E("Debugger/GetSession"),void 0,{hiddenLoading:!0,hiddenError:!0}),Xt=()=>N.get(E("Debugger/StartSession"),void 0,{hiddenLoading:!0}),Xn=e=>N.post(E("Debugger/SetBreakPoint"),e,void 0,{hiddenLoading:!0}),Ie=e=>N.get(E("Debugger/Step"),{action:e},{hiddenLoading:!0}),Yn=e=>N.post(E("Debugger/execute"),{jsStatement:e},void 0,{hiddenLoading:!0}),pt=oe.global.t,xo=()=>N.get(E("ScriptModule/list",!0)),Zn=e=>N.post(E("ScriptModule/create"),{name:e},void 0,{successMessage:pt("common.createSuccess")}),ea=e=>N.post(E("ScriptModule/Deletes"),{ids:e},void 0,{successMessage:pt("common.deleteSuccess")}),Zu=(e,l)=>N.post(E("ScriptModule/UpdateStatus"),{moduleId:e,status:l}),ta=()=>N.get(E("ScriptModule/ResourceType")),ed=e=>{cn.get(E("/ScriptModule/export"),{params:{name:e},responseType:"blob",timeout:1e3*60*30}).then(l=>{Vn(l)})},oa=e=>N.post(E("/ScriptModule/Import"),e,void 0,{timeout:1e3*60*30,hiddenLoading:!0,hiddenError:!0,successMessage:pt("common.importSuccess"),errorMessage:pt("common.importFailed"),keepShowErrorMessage:!0}),td=e=>N.post(E("ScriptModule/share"),{id:e},void 0,{successMessage:pt("common.shareSuccess")}),Co=oe.global.t,na=e=>N.get(E("ModuleFiles/AllFiles"),{moduleid:e}),$o=(e,l,o,t)=>N.post(E("ModuleFiles/UpdateText"),{moduleid:l,folder:"/",fileName:o,content:t,objectType:e}),So=(e,l,o,t)=>N.post(E("ModuleFiles/UpdateBinary"),{moduleid:l,folder:"/",fileName:o,base64:t,objectType:e},void 0,{hiddenError:!0,successMessage:Co("common.uploadSuccess")}),aa=(e,l,o)=>N.post(E("ModuleFiles/Remove"),{moduleid:l,fileName:o,folder:"/",objectType:e},void 0,{successMessage:Co("common.deleteSuccess")}),la=(e,l,o)=>N.post(E("ModuleFiles/GetText"),{moduleid:l,fileName:o,folder:"/",objectType:e}),sa=(e,l,o)=>N.post(E("ModuleFiles/GetTextByName"),{moduleName:l,fileName:o,folder:"/",objectType:e},void 0,{hiddenError:!0,hiddenLoading:!0}),ia=oe.global.t,Se=Re("moduleStore",()=>{const e=ce(),l=De(),o=F(),t=C([]),s=C([]),r=C(),a=C([]),n=C(!1);e.site&&ta().then(i=>s.value=i);const u=()=>g(void 0,null,function*(){if(r.value){const i=yield na(r.value);a.value=i.map(_=>Oe(ge({},_),{id:`${r.value}_${_.fullName}`}))}else t.value=yield xo(),n.value=!0}),d=(i,_)=>g(void 0,null,function*(){yield $o(_.name,r.value,i," "),yield u()}),c=(i,_,I)=>g(void 0,null,function*(){yield So(I.name,r.value,i,_),u()}),m=(i,_)=>g(void 0,null,function*(){var I;if(yield aa(_,r.value,i),_=="code"){const V=(I=t.value.find(y=>y.id==r.value))==null?void 0:I.name,x=te.editor.getModel(je.parse(`file:///node_modules/@types/module:${V}/${i}.ts`));x&&x.dispose()}u()}),w=i=>g(void 0,null,function*(){yield ea(i),Pt(),u()}),b=i=>g(void 0,null,function*(){yield Zn(i),u()}),v=i=>{var _;if(r.value=i,o.activeActivity){const I=(_=o.activeActivity.actions)==null?void 0:_.find(V=>V.name==="back");I&&(I.visible=!0)}a.value=[],u()},S=()=>{var i;if(n.value=!1,r.value=void 0,o.activeActivity){o.activeActivity.panelDisplay=ia("common.modules");const _=(i=o.activeActivity.actions)==null?void 0:i.find(I=>I.name==="back");_&&(_.visible=!1)}a.value=[]},h=()=>{S(),u()};return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},S),ee(()=>l==null?void 0:l.query.moduleId,S),{load:u,list:t,createModule:b,deleteModules:w,types:s,editingModule:r,editModule:v,files:a,createModuleFile:d,deleteModuleFile:m,uploadModuleFile:c,exitEditModule:h,reset:S,modulesInitialized:n}}),qe=Re("codeStore",()=>{const e=ce(),l=F(),o=C(),t=C(!1),s=C(!0),r=C({}),a=C([]),n=C(!1),u=X(()=>{const v={};for(const S in r.value)v[S]=l.getSplitNameData(a.value.filter(h=>h.codeType.toLowerCase()===(S==null?void 0:S.toLowerCase())));return v}),d=()=>g(void 0,null,function*(){!e.site||(a.value=yield qn("all"),n.value=!0)}),c=v=>g(void 0,null,function*(){yield Jn(v);for(const S of v){const h=a.value.find(i=>i.id==S);if(h){const i=te.editor.getModel(je.file(`${h.name||h.id}.ts`));i&&i.dispose()}}l.deleteTabs(v),d()}),m=(v,S)=>g(void 0,null,function*(){v.url||(v.url=""),v.enableDiffChecker=!0;const h=yield zn(v);return e.site.recordSiteLogVideo&&S&&(yield Be(h,S,v.isEmbedded)),Object.assign(v,yield w(h))}),w=(v,S,h)=>g(void 0,null,function*(){var I,V;v=v!=null?v:Z;const i=yield Kn(S||"all",v),_={id:i.id,name:i.name||"",body:i.body||"",config:i.config,url:i.url,eventType:i.eventType||h,codeType:i.codeType||S,version:i.version,scriptType:i.scriptType,isEmbedded:i.isEmbedded};return((I=_.codeType)==null?void 0:I.toLowerCase())==="event"&&!_.eventType&&(_.eventType="RouteFinding"),((V=_.codeType)==null?void 0:V.toLowerCase())==="api"&&!_.url&&(_.url=""),_});return ee(()=>{var v;return(v=e.site)==null?void 0:v.id},()=>{a.value=[],n.value=!1,Se().reset(),Pt()}),e.hasAccess("code","view")&&Gn().then(v=>r.value=v),{types:r,codes:a,codesInitialized:n,deleteCodes:c,updateCode:m,getCode:w,loadCodes:d,keywords:o,scriptTypes:[{key:"Classic",value:"Classic"},{key:"Module",value:"Module"}],ignoreCase:s,isRegex:t,codesByType:u}}),ra={key:0},ua=["title"],da={class:"ml-8px ellipsis flex-1","data-cy":"file-name"},ca={class:"pl-12 pr-4"},ae=G({props:{id:null,icon:null,title:null,remove:{type:Boolean},ignoreSearch:{type:Boolean},permission:null,padding:null,hasExpandRow:{type:Boolean},name:null},emits:["remove"],setup(e){const l=e,o=F(),t=De(),s=X(()=>{var n;return t.query.activity==="code search"?o.activeSearch===l.id:((n=o.activeTab)==null?void 0:n.id)===l.id}),r=He("keyword"),a=X(()=>{var n;return(n=l.name)!=null?n:l.title});return(n,u)=>{const d=be,c=at("hasPermission");return e.ignoreSearch||!p(r)||p(a).toLowerCase().indexOf(p(r).toLowerCase())>-1?(f(),M("div",ra,[R("div",{class:de(["group cursor-pointer h-26px flex items-center text-s space-x-4 group hover:bg-blue/30 pr-12",p(s)?"bg-blue/20 dark:text-fff/86":"dark:text-fff/60"]),title:e.title,style:$t(e.hasExpandRow?{paddingLeft:e.padding+"px"}:{paddingLeft:"18px"})},[k(d,{class:de(["iconfont",e.icon||"icon-code3"])},null,8,["class"]),R("div",da,J(e.title),1),R("div",{class:de(["transition-all ease-in-out opacity-0 group-hover:opacity-100 space-x-8",p(s)?"opacity-100":""]),onClick:u[1]||(u[1]=H(()=>{},["stop"]))},[Ke(n.$slots,"default"),e.remove?ie((f(),U(d,{key:0,class:"iconfont icon-delete hover:text-orange","data-cy":"delete",onClick:u[0]||(u[0]=m=>n.$emit("remove"))},null,512)),[[c,{feature:e.permission,action:"delete",effect:"hiddenIcon"}]]):j("",!0)],2)],14,ua),R("div",ca,[Ke(n.$slots,"collapse")])])):j("",!0)}}});var ma=`interface AlertOptions {\r
  title: string;\r
  body: string;\r
  width: string;\r
}\r
\r
interface CurrentMail {\r
  send: () => void;\r
  saveDraft: () => void;\r
  cancel: () => void;\r
  alert: (options: AlertOptions) => void;\r
  subject: string;\r
  to: string;\r
  html: string;\r
  from: string;\r
  dark: boolean;\r
  onDark: (value: boolean) => void;\r
}\r
\r
namespace KScript {\r
  declare interface k {\r
    currentMail: CurrentMail;\r
  }\r
}\r
\r
// declare const currentMail: CurrentMail;\r
`;let Yt=!1,Vo=!1,it={},rt={};const pa=["indexeddb","mysql","sqlserver","sqlite","mongo","sql","localdatabase","localsqlite"],va=[".find('",".findall('",".query('",".orderby('",".orderbydescending('",".where('"],fa=[">",">=","<","<=","=","==","!=","contains","startwith"],ya=[".skip(",".take(",".count("];function ga(e,l){let o=l.lineNumber;for(;o>0;){const t=e.getValueInRange({startLineNumber:o,startColumn:e.getLineFirstNonWhitespaceColumn(o),endLineNumber:o,endColumn:e.getLineFirstNonWhitespaceColumn(o)+1}),s=e.getValueInRange({startLineNumber:o-1,startColumn:e.getLineLastNonWhitespaceColumn(o===1?1:o-1),endLineNumber:o-1,endColumn:e.getLineLastNonWhitespaceColumn(o===1?1:o-1)+1});if(t==="."||s===".")o--;else break}return e.getValueInRange({startLineNumber:o,startColumn:1,endLineNumber:l.lineNumber,endColumn:l.column})}function Zt(e){return e.map(function(l){return{label:l,kind:te.languages.CompletionItemKind.Property,documentation:l,insertText:l,preselect:!0}})}function ba(e){Vo=e,it={},rt={},!Yt&&(Yt=!0,te.languages.registerCompletionItemProvider("typescript",{triggerCharacters:['"',"'","`"," ","(","."],provideCompletionItems(t,s){return g(this,null,function*(){return{suggestions:yield eo(t,s)}})}}),te.languages.registerCompletionItemProvider("html",{triggerCharacters:['"',"'","`"," ","(","."],provideCompletionItems(t,s){return g(this,null,function*(){const r=t.getLanguageIdAtPosition(s.lineNumber,s.column),a={suggestions:[]};return r=="javascript"&&(a.suggestions=yield eo(t,s)),a})}}))}function eo(e,l){return g(this,null,function*(){if(!Vo)return[];let o=ga(e,l).replace(/\s+/g,"").toLowerCase();const t=pa.find(a=>bt(o,["k.db."+a,"k.module."+a]));if(!t)return[];if(!it[t]){const a=Se();it[t]=yield vn(t,a.editingModule)}if(to(o,[`k.db.${t}.`,`k.module.${t}.`]))return Zt(it[t]);o=o.replace(/\"+/g,"'").replace(/\`+/g,"'");const s=it[t].find(function(a){return bt(o,[`k.db.${t}.${a}`,`k.module.${t}.${a}`,`k.db.${t}.gettable('${a}')`,`k.module.${t}.gettable('${a}')`])});if(!s)return[];const r=`${t}_${s}`;if(!rt[r]){const a=Se();rt[r]=yield fn(t,s,a.editingModule)}if(bt(o,va)&&!bt(o,ya)){const a=to(o,rt[r].map(n=>n.toLowerCase()));return Zt(a?fa:rt[r])}return[]})}function bt(e,l){for(const o of l)if(e.indexOf(o)>-1)return!0}function to(e,l){for(const o of l)if(e.endsWith(o))return!0}let oo=!1;function wa(){oo||(oo=!0,te.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"http://www.kooboo.com/module-setting-schema.json",fileMatch:["*/module.config"],schema:{type:"object",properties:{name:{type:"string"},version:{type:"string"},description:{type:"string"},settingDefines:{type:"array",items:{$ref:"http://www.kooboo.com/module-setting-define-schema.json"}},setting:{type:"object"}},required:["name","version"]}},{uri:"http://www.kooboo.com/module-setting-define-schema.json",schema:{type:"object",properties:{name:{type:"string"},type:{enum:["input","textarea","switch","number","select"]},defaultValue:{type:["string","number","null","boolean"]},description:{type:"string"},options:{type:"array",items:{type:["string","number","boolean"]}},display:{type:"string"}},required:["name","type"]}}]}))}const _a=e=>N.post(E("Route/Resolve"),{url:e}),ka=e=>N.get(E("Route/ListByType"),{type:e}),ha=(e,l)=>N.get(E("Route/IsUniqueName"),{name:e,oldName:l},{hiddenLoading:!0,hiddenError:!0});let Lt;function xa(e,l,o){if(!Lt){const t=e._codeEditorService.doOpenEditor.bind(e._codeEditorService);Lt=(s,r)=>{if(t(s,r),typeof l!="function"&&typeof o!="function")return;const{path:a,query:n}=r.resource,u=`${a}${n?"?"+n:""}`;_a(a).then(d=>{d?typeof l=="function"&&l(d):typeof o=="function"&&o(u)}).catch(()=>{typeof o=="function"&&o(u)})}}return Lt}function Ca(e,l,o){const t=e;t._codeEditorService.doOpenEditor=xa(t,l,o).bind(t._codeEditorService)}const he=G({props:{modelValue:null,language:null,kScript:{type:Boolean},kmail:{type:Boolean},options:null,uri:null,module:{type:Boolean}},emits:["update:modelValue","monacoLoadComplete"],setup(e,{expose:l,emit:o}){const t=e,s=C(),r=jt();let a,n;const u=new $e,d=ce(),c=qe(),m=Se(),w=F(),b=He(vo),v=He(hn);l({focus:()=>g(this,null,function*(){yield u.promise,n==null||n.focus()}),goToLine:T=>g(this,null,function*(){var D,P;yield u.promise;const L=T||((D=n==null?void 0:n.getModel())==null?void 0:D.getLineCount())||0,O=((P=n==null?void 0:n.getModel())==null?void 0:P.getLineLength(L))||0;n==null||n.revealLineInCenter(L),n==null||n.setPosition({column:O+1,lineNumber:L}),n==null||n.focus()}),goto:T=>g(this,null,function*(){yield u.promise,n==null||n.setSelection(T),n==null||n.revealRangeInCenter(T)}),search:(T,L)=>g(this,null,function*(){var P,B;yield u.promise;let O;const D=(B=(P=n==null?void 0:n.getModel())==null?void 0:P.findMatches(T,!1,!1,!1,null,!1))==null?void 0:B.map(A=>(Number.isInteger(L)&&!O&&A.range.startLineNumber===L&&(O=A.range),{selectionStartLineNumber:A.range.startLineNumber,selectionStartColumn:A.range.startColumn,positionLineNumber:A.range.endLineNumber,positionColumn:A.range.endColumn}));O?(n==null||n.setSelection(O),n==null||n.revealRangeInCenter(O)):(D&&(n==null||n.setSelections(D)),D&&(n==null||n.revealLineInCenter(D[0].selectionStartLineNumber))),n==null||n.focus()}),format:()=>g(this,null,function*(){var T;yield(T=n==null?void 0:n.getAction("editor.action.formatDocument"))==null?void 0:T.run()}),replace:T=>g(this,null,function*(){var L=n==null?void 0:n.getSelection();if(!!L){var O=new te.Range(L.startLineNumber,L.startColumn,L.endLineNumber,L.endColumn);n==null||n.executeEdits("",[{range:O,text:T}])}})}),ee(()=>t.modelValue,()=>{var T;a&&a.getValue()!==t.modelValue&&a.setValue((T=t.modelValue)!=null?T:"")}),bn(()=>g(this,null,function*(){var T,L,O,D,P;if((L=(T=w.activeTab)==null?void 0:T.params)!=null&&L.moduleId){const B=(P=(D=(O=w.activeTab)==null?void 0:O.params)==null?void 0:D.file)==null?void 0:P.name;return m.files.filter(A=>A.objectType=="code"&&A.name!=B).map(A=>`./${A.name}`)}else{const B=c.codes.filter(K=>K.codeType=="CodeBlock").map(K=>`./${K.name}`),A=m.list.map(K=>`module:${K.name}`);return[...B,...A]}}));const x=["JSON","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","parseFloat","parseInt"];kn((T,L,O)=>(L==null?void 0:L.type)=="attribute"&&L.start==L.end?{suggestions:[],snippet:!1}:(L==null?void 0:L.type)!="content"&&(L==null?void 0:L.type)!="attribute"?{suggestions:O,snippet:!0}:{suggestions:O.filter(P=>{var A,K;if(P.kind=="keyword"||P.name=="globalThis"||P.name=="undefined"||P.name=="Vue")return!1;if(x.includes(P.name))return!0;var B=((A=P.kindModifiers)==null?void 0:A.indexOf("declare"))>-1;return!(((K=P.kindModifiers)==null?void 0:K.indexOf("deprecated"))>-1||B&&P.sortText==="15"&&(P.kind=="var"||P.kind=="module"||P.kind=="class"||P.kind=="function"))}),snippet:!1}),nt(()=>g(this,null,function*(){var D,P,B;d.site&&(wn(A=>g(this,null,function*(){let K=te.Uri.parse(A).path;if(K=K.substring(1,K.length-3),!K)throw new Error("empty path");if(K.startsWith("node_modules")){K=K.split("module:")[1];const ne=K.split("/")[0];let Le=K.split("/")[1];return yield sa("code",ne,Le)}else return(yield Hn(K)).body})),c.codesInitialized||c.loadCodes(),m.modulesInitialized||m.load());let T="";t.kScript&&(T=yield yn()),t.language=="html"&&(yield gn());let L=t.uri;typeof L=="string"&&(L=te.Uri.parse(L)),L||(L=te.Uri.from({scheme:"memory",path:r})),a=te.editor.getModel(L),a?a.setValue((D=t.modelValue)!=null?D:""):a=te.editor.createModel((P=t.modelValue)!=null?P:"",t.language,L);function O(A,K){A=="javascript"&&Wt(K)&&K.length>10&&setTimeout(()=>{te.editor.setModelLanguage(a,"json")},1e3),t.language=="javascript"&&A=="json"&&(!Wt(K)||!(K!=null&&K.trim()))&&setTimeout(()=>{te.editor.setModelLanguage(a,"javascript")},1e3)}a.onDidChangeContent(()=>{const A=a.getValue(),K=a.getLanguageId();O(K,A),o("update:modelValue",A)}),n=te.editor.create(s.value,Oe(ge(ge({},fo),t.options),{model:a})),O(t.language,(B=t.modelValue)!=null?B:""),$n(n),ba(t.kScript),wa(),Sn(n),t.kScript&&Qt(T,"default.d.ts"),t.kmail&&Qt(ma,"kmail.d.ts"),Ca(n,b,v),o("monacoLoadComplete",n),u.resolve(null)})),At(()=>{!a||(a.uri.scheme=="memory"&&a.dispose(),a.uri.toString()=="file:///00000000-0000-0000-0000-000000000000"&&a.dispose())});let y;return ee(()=>d.site,()=>{var T,L;if(!((L=(T=d.site)==null?void 0:T.unocssSettings)!=null&&L.enable)){y&&y();return}y=_n(JSON.parse(d.site.unocssSettings.config))},{immediate:!0,deep:!0}),ee(yo,T=>te.editor.setTheme(T?"vs-dark":"vs"),{immediate:!0}),(T,L)=>(f(),M("div",{ref_key:"container",ref:s,class:"w-full h-full min-h-300px min-w-400px monaco-editor bg-fff"},null,512))}}),$a={key:0,class:"h-full"},Sa=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=qe(),r=F(),a=C(),n=Pe((h,i)=>{if(!((h==="url"||h==="scriptType")&&i))return i}),u=C(!1),d=C(),c=new $e,m=()=>g(this,null,function*(){a.value=yield s.getCode(t.id),c.resolve(null),n.init(a.value)}),w=()=>g(this,null,function*(){!a.value||(yield s.updateCode(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),b=h=>g(this,null,function*(){!a.value||(a.value.url=h.url,a.value.scriptType=h.scriptType)}),v=(h,i)=>g(this,null,function*(){yield c.promise,i?d.value.search(i,h):d.value.goToLine(h)});ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),m(),l({save:w,load:m,config:u,goToLine:v,updateModel:b});const S=X(()=>{if(!!a.value)return`${a.value.name||a.value.id}.ts`});return At(()=>{if(!S.value)return;const h=te.editor.getModel(te.Uri.file(S.value)),i=n.getValue();h&&i&&h.setValue(JSON.parse(i).body)}),(h,i)=>a.value?(f(),M("div",$a,[k(he,{ref_key:"editor",ref:d,modelValue:a.value.body,"onUpdate:modelValue":i[0]||(i[0]=_=>a.value.body=_),language:"typescript",uri:p(te).Uri.file(p(S)),"k-script":"",onMonacoLoadComplete:i[1]||(i[1]=_=>p(r).addTabRecord(t.id,_,"typescript"))},null,8,["modelValue","uri"])])):j("",!0)}}),Va=G({props:{model:null,editMode:{type:Boolean}},setup(e,{expose:l}){const o=e,t=qe(),{t:s}=Y(),r=C(),a=Ee(()=>({name:o.editMode?[]:[_e(1,50),le(s("common.nameRequiredTips")),Te(),Ce(Wn,s("common.codeNameExistsTips"))],url:[le(s("common.urlRequiredTips"))]})),n=c=>{o.model&&!o.model.url&&(o.model.url=`/${c}`)},u=C();nt(()=>g(this,null,function*(){var c;if(((c=o.model.codeType)==null?void 0:c.toLocaleLowerCase())==="event"){const m=yield jn();u.value=[...new Set(m.map(w=>w.category))].map(w=>({category:w,events:m.filter(b=>b.category===w)}))}}));const d=C(!1);return ee(()=>o.model.url,c=>{d.value||o.editMode||(o.model.name=ln(c))}),l({validate:()=>{var c;return(c=r.value)==null?void 0:c.validate()}}),(c,m)=>{const w=me,b=pe,v=Bt,S=Tn,h=qt,i=wo,_=_o,I=ve;return e.model?(f(),U(I,{key:0,ref_key:"form",ref:r,model:e.model,rules:p(a),onSubmit:m[5]||(m[5]=H(()=>{},["prevent"]))},{default:$(()=>{var V;return[k(b,{label:p(s)("common.codeName"),prop:"name"},{default:$(()=>[k(w,{modelValue:e.model.name,"onUpdate:modelValue":m[0]||(m[0]=x=>e.model.name=x),class:"min-w-300px",disabled:e.editMode,title:e.model.name,"data-cy":"code-name",onChange:n,onInput:m[1]||(m[1]=x=>d.value=!0)},null,8,["modelValue","disabled","title"])]),_:1},8,["label"]),((V=e.model.codeType)==null?void 0:V.toLocaleLowerCase())==="api"?(f(),U(b,{key:0,label:"URL",prop:"url"},{default:$(()=>[k(w,{modelValue:e.model.url,"onUpdate:modelValue":m[2]||(m[2]=x=>e.model.url=x),class:"min-w-300px","data-cy":"url"},null,8,["modelValue"])]),_:1})):j("",!0),u.value?(f(),U(b,{key:1},{default:$(()=>[k(h,{modelValue:e.model.eventType,"onUpdate:modelValue":m[3]||(m[3]=x=>e.model.eventType=x),class:"min-w-300px w-full",disabled:e.editMode,"default-first-option":""},{default:$(()=>[(f(!0),M(q,null,W(u.value,x=>(f(),U(S,{key:x.category,label:x.category},{default:$(()=>[(f(!0),M(q,null,W(x.events,y=>(f(),U(v,{key:y.name,label:y.name,value:y.name},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):j("",!0),!(e.model.codeType=="PageScript"&&e.model.isEmbedded)&&e.model.codeType!="CodeBlock"?(f(),U(b,{key:2,label:p(s)("common.scriptType")},{default:$(()=>[k(_,{modelValue:e.model.scriptType,"onUpdate:modelValue":m[4]||(m[4]=x=>e.model.scriptType=x),class:"el-radio-group--rounded"},{default:$(()=>[(f(!0),M(q,null,W(p(t).scriptTypes,x=>(f(),U(i,{key:x.key,label:x.key,"data-cy":x.key},{default:$(()=>[Ae(J(x.value),1)]),_:2},1032,["label","data-cy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):j("",!0)]}),_:1},8,["model","rules"])):j("",!0)}}}),Me=G({props:{actions:null},setup(e,{expose:l}){const o=C(),t=C(!1),s=C(0),r=C(0),a=C();return l({openMenu:(u,d)=>{var c=t.value;t.value=!0,r.value=u.clientY,s.value=u.clientX,o.value=d,setTimeout(()=>{a.value.click(),c&&setTimeout(()=>{t.value=!0,setTimeout(()=>{a.value.click()})},0)},0)},payload:o}),(u,d)=>{const c=Vt,m=Ot,w=Tt;return t.value?(f(),M("div",{key:0,style:$t({top:r.value-2+"px",left:s.value-32+"px"}),class:"fixed"},[k(w,{trigger:"click",onCommand:d[1]||(d[1]=b=>b.invoke(o.value)),onVisibleChange:d[2]||(d[2]=b=>t.value=b)},{dropdown:$(()=>[k(m,null,{default:$(()=>[(f(!0),M(q,null,W(e.actions,b=>(f(),U(c,{key:b.name,command:b},{default:$(()=>[Ae(J(b.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:$(()=>[R("div",{ref_key:"trigger",ref:a,class:"w-64 h-8",onContextmenu:d[0]||(d[0]=H(()=>{},["stop","prevent"]))},null,544)]),_:1})],4)):j("",!0)}}}),Ta=G({setup(e){const l=C(!0);return(o,t)=>(f(),M("div",null,[R("div",{onClick:t[0]||(t[0]=H(s=>l.value=!l.value,["stop"]))},[Ke(o.$slots,"name",{flag:l.value})]),ie(R("div",null,[Ke(o.$slots,"default")],512),[[Qe,l.value]])]))}}),Ma=["title"],Ia={class:"hidden"},Ne=G({props:{data:null,showEdit:{type:Boolean},showSetting:{type:Boolean},permission:null,hiddenRemove:null},emits:["click-handle","remove","click-contextMenu","edit","setting"],setup(e,{emit:l}){const o=De(),t=He("keyword"),s=r=>!(r!=null&&r.children)||(r==null?void 0:r.children.length)===0?r.name.toLowerCase():s(r==null?void 0:r.children[0]);return(r,a)=>{const n=be,u=be,d=Dt("ReSubMenu",!0),c=at("hasPermission");return f(),M("div",null,[k(Ta,null,{name:$(({flag:m})=>{var w;return[p(t)&&s(e.data).includes((w=p(t))==null?void 0:w.toLowerCase())||!p(t)?(f(),M("div",{key:0,class:"h-26px border-b-1 border-gray dark:border-b-1 dark:border-999 flex items-center space-x-12 cursor-pointer pr-12 text-12px dark:text-fff/60",style:$t({paddingLeft:12+e.data.floor*6+"px"})},[k(n,{class:de(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",m?"rotate-180 ":"rotate-0"])},null,8,["class"]),R("span",{class:"ellipsis leading-26px",title:e.data.name},J(e.data.name),9,Ma),R("span",Ia,J(m),1)],4)):j("",!0)]}),default:$(()=>[(f(!0),M(q,null,W(e.data.children,m=>(f(),M(q,null,[m.children?(f(),U(d,{key:m.folderName,data:m,permission:e.permission,"hidden-remove":e.hiddenRemove,"show-edit":e.showEdit,"show-setting":e.showSetting,onRemove:a[0]||(a[0]=w=>l("remove",w)),onClickHandle:a[1]||(a[1]=w=>l("click-handle",w)),onEdit:a[2]||(a[2]=w=>l("edit",w)),onClickContextMenu:a[3]||(a[3]=w=>l("click-contextMenu",w))},null,8,["data","permission","hidden-remove","show-edit","show-setting"])):(f(),U(ae,{id:m.id,key:m.id,title:m.tabName,name:m.name,remove:!e.hiddenRemove,permission:e.permission,"has-expand-row":!0,padding:12+m.floor*6,onClick:w=>l("click-handle",m),onRemove:w=>l("remove",m.id),onContextmenu:H(w=>l("click-contextMenu",{event:w,item:m}),["prevent","stop"])},{default:$(()=>[e.showEdit?ie((f(),U(u,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:w=>l("edit",m)},null,8,["onClick"])),[[c,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]]):j("",!0),e.showSetting?(f(),U(n,{key:1,class:"iconfont icon-a-setup hover:text-blue",onClick:w=>l("setting",m.id)},null,8,["onClick"])):j("",!0)]),_:2},1032,["id","title","name","remove","permission","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1})])}}}),Ra=["onKeydown"],Ze=oe.global.t,La={name:"code",icon:"icon-code",display:Ze("common.code"),route:"code",order:25,permission:"code",actions:[{name:"refresh",display:Ze("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ze("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"code"}))}}]},ut=e=>{const l=[{name:"save",display:Ze("common.save"),visible:!1,icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",display:Ze("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})}];e.codeType==="Api"&&l.push({name:"open",display:Ze("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=qe();let t=o.codes.find(s=>s.id===e.id);if(t||(yield o.loadCodes(),t=o.codes.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.previewUrl)}})}),F().addTab({id:e.id,name:e.name,panel:Sa,icon:"icon-code",actions:l})},Ua=G({setup(e,{expose:l}){const{t:o}=Y(),t=De(),s=qe(),r=C(!1),a=C(),n=C(),u=C(),d=C(),c=()=>g(this,null,function*(){yield s.loadCodes()}),m=i=>g(this,null,function*(){a.value=i,n.value=yield s.getCode(void 0,i.key),r.value=!0}),w=()=>g(this,null,function*(){yield u.value.validate();const i=yield s.updateCode(n.value);ut(i),s.loadCodes(),h(i),r.value=!1}),b=i=>g(this,null,function*(){yield xe(),yield s.deleteCodes([i])}),v=(i,_)=>g(this,null,function*(){a.value=_,n.value=yield s.getCode(i,_.key),r.value=!0}),S=X(()=>{var _,I;var i=[{name:o("common.copyTitle"),invoke:V=>g(this,null,function*(){Ve(V.name)})}];return((I=(_=d.value)==null?void 0:_.payload)==null?void 0:I.codeType)=="Api"&&i.push({name:o("common.preview"),invoke:V=>g(this,null,function*(){const{onPreview:x}=we();x(V.previewUrl)})}),i});l({load:c});const h=He("updateTabModel");return(i,_)=>{var y,T,L;const I=be,V=ye,x=at("hasPermission");return f(),M("div",null,[(f(!0),M(q,null,W(p(s).types,(O,D)=>(f(),U(re,{key:D,permission:"code",title:O,add:"","expand-default":!0,onOnAdd:P=>m({key:D,value:O})},{default:$(()=>[D==="pageScript"?(f(!0),M(q,{key:0},W(p(s).codes.filter(P=>P.codeType==="PageScript"),P=>(f(),U(ae,{id:P.id,key:P.id,title:P.name,name:P.name,remove:"",permission:"code",onClick:B=>ut(P),onRemove:B=>b(P.id),onContextmenu:H(B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B,P)},["prevent","stop"])},{default:$(()=>[P.isEmbedded?j("",!0):ie((f(),U(I,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:B=>v(P.id,{key:D,value:O})},null,8,["onClick"])),[[x,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","onClick","onRemove","onContextmenu"]))),128)):(f(!0),M(q,{key:1},W(p(s).codesByType[D],P=>(f(),M(q,null,[P.children?(f(),U(Ne,{key:P.folderName+P.floor,data:P,"show-edit":D!=="codeBlock",permission:"code",onClickHandle:_[0]||(_[0]=B=>ut(B)),onEdit:B=>v(B.id,{key:B.key,value:B.value}),onRemove:_[1]||(_[1]=B=>b(B)),onClickContextMenu:B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B.event,B.item)}},null,8,["data","show-edit","onEdit","onClickContextMenu"])):(f(),U(ae,{id:P.id,key:P.id,title:P.name,name:P.name,remove:"",permission:"code",padding:12+P.floor*6,onClick:B=>ut(P),onRemove:B=>b(P.id),onContextmenu:H(B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B,P)},["prevent","stop"])},{default:$(()=>[P.codeType!="CodeBlock"?ie((f(),U(I,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:B=>v(P.id,{key:D,value:O})},null,8,["onClick"])),[[x,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]]):j("",!0)]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:2},1032,["title","onOnAdd"]))),128)),R("div",{onClick:_[4]||(_[4]=H(()=>{},["stop"]))},[k(V,{modelValue:r.value,"onUpdate:modelValue":_[3]||(_[3]=O=>r.value=O),width:"600px","close-on-click-modal":!1,title:((y=n.value)==null?void 0:y.id)==p(Z)?p(o)("code.newCode",{name:(T=a.value)==null?void 0:T.value}):p(o)("code.editCode",{name:(L=a.value)==null?void 0:L.value}),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:_[2]||(_[2]=O=>r.value=!1)})]),default:$(()=>{var O;return[R("div",{onKeydown:ue(w,["enter"])},[n.value?(f(),U(Va,{key:0,ref_key:"form",ref:u,"label-position":"top",model:n.value,"edit-mode":((O=n.value)==null?void 0:O.id)!==p(Z)},null,8,["model","edit-mode"])):j("",!0)],40,Ra)]}),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:d,actions:p(S)},null,8,["actions"])])}}});var Ea=Object.freeze(Object.defineProperty({__proto__:null,define:La,open:ut,default:Ua},Symbol.toStringTag,{value:"Module"}));const Na={class:"transition-all px-8 py-4 flex items-center space-x-4 cursor-pointer rounded-normal dark:text-fff/86 !hover:text-blue"},Aa={class:"text-s"},Je=G({props:{icon:null,display:null,shortcut:null},setup(e){return(l,o)=>{const t=be;return f(),M("div",Na,[k(t,{class:de(["iconfont",e.icon])},null,8,["class"]),R("span",null,J(e.display),1),R("span",Aa,J(`(${e.shortcut})`),1)])}}}),Da={class:"py-4 px-8 flex items-center border-b border-solid border-line text-m dark:bg-[#252526]"},ja=G({props:{debugSession:null},setup(e){const l=e,o=F(),{t}=Y(),s=Ee(()=>{var a;return(a=o.activeTab)==null?void 0:a.id.startsWith(Ye)});Fe("StartDebug",()=>{s.value&&Xt()}),Fe("DebugContinue",()=>{s.value&&Ie("None")}),Fe("DebugInto",()=>{s.value&&Ie("Into")}),Fe("DebugOver",()=>{s.value&&Ie("Over")}),Fe("DebugOut",()=>{s.value&&Ie("Out")}),Fe("DebugStop",()=>{s.value&&Ie("Stop")});const r=Ee(()=>{var a;return!l.debugSession||((a=l.debugSession)==null?void 0:a.end)});return(a,n)=>(f(),M("div",Da,[p(r)?(f(),U(Je,{key:0,icon:"icon-play1",display:p(t)("common.start"),shortcut:"F8",onClick:n[0]||(n[0]=u=>p(Xt)())},null,8,["display"])):(f(),M(q,{key:1},[k(Je,{icon:"icon-play2",display:p(t)("common.continue"),shortcut:"F5",onClick:n[1]||(n[1]=u=>p(Ie)("None"))},null,8,["display"]),k(Je,{icon:"icon-debug-step-into",display:p(t)("common.stepInto"),shortcut:"F11",onClick:n[2]||(n[2]=u=>p(Ie)("Into"))},null,8,["display"]),k(Je,{icon:"icon-a-debug-step-over",display:p(t)("common.stepOver"),shortcut:"F10",onClick:n[3]||(n[3]=u=>p(Ie)("Over"))},null,8,["display"]),k(Je,{icon:"icon-a-debug-step-out",display:p(t)("common.stepOut"),shortcut:"Shift + F11",onClick:n[4]||(n[4]=u=>p(Ie)("Out"))},null,8,["display"]),k(Je,{icon:"icon-delete4",display:p(t)("common.stop"),shortcut:"Shift + F5",onClick:n[5]||(n[5]=u=>p(Ie)("stop"))},null,8,["display"])],64))]))}});const Pa={key:0,class:"json-tree-row"},Oa={key:0,class:"json-tree-key"},Fa={key:1,class:"json-tree-colon"},Ba=["title"],qa={key:2,class:"json-tree-comma"},Ga=R("span",{class:"json-tree-indent"},"\xA0",-1),Ka={key:1,class:"json-tree-deep"},Ha=R("span",{class:"json-tree-indent"},"\xA0",-1),za={class:"json-tree-sign"},Ja={key:0,class:"json-tree-key"},Wa={key:1,class:"json-tree-colon"},Qa={class:"json-tree-open"},Xa={class:"json-tree-comma"},Ya=R("span",{class:"json-tree-indent"},"\xA0",-1),Za={class:"json-tree-deeper"},el={class:"json-tree-row"},tl={class:"json-tree-close"},ol={key:0,class:"json-tree-comma"},nl=R("span",{class:"json-tree-indent"},"\xA0",-1),Nt=G({props:{level:null,kv:null,raw:null,data:null},setup(e){const l=e,o=(n,u=0,d=!0,c=void 0)=>{let m={depth:u,last:d,primitive:!0,key:JSON.stringify(c)};if(typeof n!="object")return Object.assign(m,{type:typeof n,value:JSON.stringify(n)});if(n===null)return Object.assign(m,{type:"null",value:"null"});if(Array.isArray(n)){let w=n.map((b,v)=>o(b,u+1,v===n.length-1));return Object.assign(m,{primitive:!1,type:"array",value:w})}else{let w=Object.keys(n),b=w.map((v,S)=>o(n[v],u+1,S===w.length-1,v));return Object.assign(m,{primitive:!1,type:"object",value:b})}},t=C(!0),s=C(!1),r=X(()=>{if(l.kv)return l.kv;let n;try{l.raw?n=JSON.parse(l.raw):typeof l.data!="undefined"?n=l.data:(n="[Vue JSON Tree] No data passed.",console.warn(n))}catch(u){n="[Vue JSON Tree] Invalid raw JSON.",console.warn(n)}return o(n)}),a=n=>n>1?`${n} items`:n?"1 item":"no items";return(n,u)=>{const d=Dt("JsonTree",!0);return f(),M("span",{class:de(["json-tree",{"json-tree-root":p(r).depth===0}])},[p(r).primitive?(f(),M("span",Pa,[(f(!0),M(q,null,W(p(r).depth*2+3,c=>(f(),M("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),p(r).key?(f(),M("span",Oa,J(p(r).key),1)):j("",!0),p(r).key?(f(),M("span",Fa,":\xA0")):j("",!0),R("span",{class:de(["json-tree-value","json-tree-value-"+p(r).type]),title:`${p(r).value}`},J(`${p(r).value}`),11,Ba),p(r).last?j("",!0):(f(),M("span",qa,",")),Ga])):j("",!0),p(r).primitive?j("",!0):(f(),M("span",Ka,[R("span",{class:"json-tree-row json-tree-expando",onClick:u[0]||(u[0]=c=>t.value=!t.value),onMouseover:u[1]||(u[1]=c=>s.value=!0),onMouseout:u[2]||(u[2]=c=>s.value=!1)},[Ha,R("span",za,J(t.value?"-":"+"),1),(f(!0),M(q,null,W(p(r).depth*2+1,c=>(f(),M("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),p(r).key?(f(),M("span",Ja,J(p(r).key),1)):j("",!0),p(r).key?(f(),M("span",Wa,":\xA0")):j("",!0),R("span",Qa,J(p(r).type==="array"?"[":"{"),1),ie(R("span",{class:"json-tree-collapsed"},"\xA0/*\xA0"+J(a(p(r).value.length))+"\xA0*/\xA0",513),[[Qe,!t.value]]),ie(R("span",{class:"json-tree-close"},J(p(r).type==="array"?"]":"}"),513),[[Qe,!t.value]]),ie(R("span",Xa,",",512),[[Qe,!t.value&&!p(r).last]]),Ya],32),ie(R("span",Za,[(f(!0),M(q,null,W(p(r).value,(c,m)=>(f(),U(d,{key:m,kv:c,level:e.level},null,8,["kv","level"]))),128))],512),[[Qe,t.value]]),ie(R("span",el,[R("span",{class:de(["json-tree-ending",{"json-tree-paired":s.value}])},[(f(!0),M(q,null,W(p(r).depth*2+3,c=>(f(),M("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),R("span",tl,J(p(r).type==="array"?"]":"}"),1),p(r).last?j("",!0):(f(),M("span",ol,",")),nl],2)],512),[[Qe,t.value]])]))],2)}}}),al={class:"space-x-8 flex items-center dark:bg-[#202428]"},ll=["disabled","placeholder","onKeydown"],sl=G({props:{debugSession:null},setup(e){const l=e,{t:o}=Y(),t=C(""),s=C([]),r=X(()=>{var u;return!l.debugSession||((u=l.debugSession)==null?void 0:u.end)}),a=()=>g(this,null,function*(){if(!t.value)return;const u=yield Yn(t.value);t.value="",s.value.unshift(u)}),n=u=>{try{return JSON.parse(u)}catch(d){return u}};return(u,d)=>{var w;const c=be,m=po;return f(),M(q,null,[R("div",al,[k(c,{class:de(["iconfont icon-a-nextstep2 dark:text-fff/86",p(r)?"":" animate-pulse animate-duration-1000"])},null,8,["class"]),ie(R("input",{"onUpdate:modelValue":d[0]||(d[0]=b=>t.value=b),disabled:!e.debugSession||((w=e.debugSession)==null?void 0:w.end),class:de(["outline-none w-full bg-transparent dark:text-fff/86",p(r)?"cursor-not-allowed":""]),placeholder:p(o)("common.inputCodeToExecuteTips"),onKeydown:ue(a,["enter"])},null,42,ll),[[so,t.value]])]),k(m,{class:"dark:bg-[#202428]"},{default:$(()=>[(f(!0),M(q,null,W(s.value,(b,v)=>(f(),M("div",{key:v},[k(Nt,{data:n(b)},null,8,["data"])]))),128))]),_:1})],64)}}});function il(e,l,o){const t=[];for(const s of e)t.push({range:new te.Range(s,1,s,1),options:{glyphMarginClassName:"kooboo-debug-breakpoint"}});return l!==void 0&&t.push({range:new te.Range(l,1,l,1),options:{isWholeLine:!0,className:"kooboo-debug-executing"}}),o!==void 0&&t.push({range:new te.Range(o,1,o,1),options:{glyphMarginClassName:"kooboo-debug-hover"}}),t}const rl=G({props:{modelValue:null,options:null,breakpoints:null,executing:null},emits:["update:modelValue","click"],setup(e,{emit:l}){const o=e,t=C(),s=jt();let r,a,n,u=C();ee(()=>o.modelValue,()=>{var c;r&&r.getValue()!==o.modelValue&&r.setValue((c=o.modelValue)!=null?c:"")});const d=()=>{if(!a)return;const c=r.getLineCount(),m=o.breakpoints.filter(w=>w<=c);n=a.deltaDecorations(n||[],il(m,o.executing,u.value))};return ee([()=>o.breakpoints.toString(),()=>o.modelValue,u,()=>o.executing],d),nt(()=>g(this,null,function*(){r=te.editor.createModel(o.modelValue,"typescript",te.Uri.file(s)),a=te.editor.create(t.value,Oe(ge(ge({},fo),o.options),{model:r,glyphMargin:!0,readOnly:!0,minimap:{enabled:!1}})),a.onMouseDown(c=>{var b,v,S,h;if(((v=(b=c==null?void 0:c.target)==null?void 0:b.detail)==null?void 0:v.glyphMarginLeft)===void 0||(h=(S=c==null?void 0:c.target)==null?void 0:S.detail)!=null&&h.isAfterLines)return;const m=c.target.position.lineNumber,w=a.getModel().getLineFirstNonWhitespaceColumn(m);l("click",{line:m,column:w})}),a.onMouseMove(c=>{var m,w;u.value=(w=(m=c==null?void 0:c.target)==null?void 0:m.position)==null?void 0:w.lineNumber}),d()})),At(()=>{r==null||r.dispose()}),ee(yo,c=>te.editor.setTheme(c?"vs-dark":"vs"),{immediate:!0}),(c,m)=>(f(),M("div",{ref_key:"container",ref:t,class:"w-full h-full min-h-300px min-w-400px monaco-editor bg-fff"},null,512))}}),ul={key:0,class:"h-full flex bg-fff"},dl={class:"flex-1 flex flex-col"},cl={class:"flex-1 text-m font-mono relative"},ml={class:"absolute inset-0"},pl={class:"h-238px border-t border-solid border-line dark:bg-[#202428] p-4 text-s font-mono"},vl={key:0,class:"w-300px border-l border-solid border-line relative"},fl=G({props:{id:null},emits:["setAction"],setup(e,{expose:l,emit:o}){const t=e,s=qe(),r=F(),a=C(),n=C();let u=!0;const d=C(t.id.replace(Ye,"")),c=()=>g(this,null,function*(){if(!!u){try{n.value=yield Qn(),n.value.currentCode&&!n.value.end&&(yield m(n.value.currentCode))}catch(_){console.log(_)}setTimeout(()=>g(this,null,function*(){yield c()}),500)}}),m=_=>g(this,null,function*(){_!==d.value&&(_&&(d.value=_),r.debugTab&&(a.value=yield s.getCode(d.value),r.debugTab.name=a.value.name,o("setAction","open",{visible:!!a.value.url})))}),w=()=>g(this,null,function*(){a.value=yield s.getCode(d.value)}),b=X(()=>n.value?n.value.breakpoints.filter(_=>_.source===d.value).map(_=>_.line):[]),v=X(()=>{var _,I,V;if(!((_=n.value)!=null&&_.end))return(V=(I=n.value)==null?void 0:I.debugInfo)==null?void 0:V.currentLine}),S=_=>g(this,null,function*(){!n.value||(n.value.breakpoints=yield Xn({source:d.value,line:_.line,column:_.column}))});io(()=>{u=!1}),m(),c(),l({load:m,reload:w,currentCode:d});const h=C(),i=C();return ee(()=>n.value,()=>{var _,I,V;h.value=(_=n.value)==null?void 0:_.exception,i.value=(V=(I=n.value)==null?void 0:I.debugInfo)==null?void 0:V.variables},{deep:!0}),(_,I)=>{const V=po;return a.value?(f(),M("div",ul,[R("div",dl,[k(ja,{class:"border-b border-solid border-line","debug-session":n.value},null,8,["debug-session"]),R("div",cl,[R("div",ml,[k(rl,{modelValue:a.value.body,"onUpdate:modelValue":I[0]||(I[0]=x=>a.value.body=x),breakpoints:p(b),executing:p(v),onClick:S},null,8,["modelValue","breakpoints","executing"])])]),R("div",pl,[k(sl,{"debug-session":n.value},null,8,["debug-session"])])]),h.value||i.value?(f(),M("div",vl,[k(V,null,{default:$(()=>[h.value?(f(),U(Nt,{key:0,data:h.value},null,8,["data"])):i.value?(f(),U(Nt,{key:1,data:i.value},null,8,["data"])):j("",!0)]),_:1})])):j("",!0)])):j("",!0)}}}),no=oe.global.t,yl={name:"debug",icon:"icon-debugging",display:no("common.debug"),order:90,permission:"debug",actions:[{name:"refresh",display:no("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}}]},gl=G({setup(e,{expose:l}){const{t:o}=Y(),t=qe(),s=F(),r=C(),a=C(),n=m=>t.codes.filter(w=>{var b;return((b=w.codeType)==null?void 0:b.toLowerCase())===(m==null?void 0:m.toLowerCase())}),u=m=>{s.addTab({id:Ye+m.id,name:m.name,panel:fl,icon:"icon-debugging",actions:[{name:"refresh",display:o("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(this,null,function*(){var b,v;const w=yield(v=(b=F().activeTab)==null?void 0:b.panelInstance)==null?void 0:v.promise;!w||w.reload()})},{name:"open",visible:!1,display:o("common.preview"),icon:"icon-eyes",invoke:()=>g(this,null,function*(){var v,S;const w=yield(S=(v=F().activeTab)==null?void 0:v.panelInstance)==null?void 0:S.promise;if(!w)return;const b=t.codes.find(h=>h.id===w.currentCode);if(b){const{onPreview:h}=we();h(b.previewUrl)}})}]})},d=()=>{t.loadCodes()};ee(()=>s.debugTab,m=>g(this,null,function*(){r.value=yield m==null?void 0:m.panelInstance.promise}));const c=X(()=>{var w,b;var m=[{name:o("common.copyTitle"),invoke:v=>g(this,null,function*(){Ve(v.name)})}];return((b=(w=a.value)==null?void 0:w.payload)==null?void 0:b.codeType)=="Api"&&m.push({name:o("common.preview"),invoke:v=>g(this,null,function*(){const{onPreview:S}=we();S(v.previewUrl)})}),m});return l({load:d}),(m,w)=>(f(),M("div",null,[(f(!0),M(q,null,W(p(t).types,(b,v)=>(f(),M(q,{key:v},[n(v).length?(f(),U(re,{key:0,title:b,"expand-default":!0,permission:"debug"},{default:$(()=>[v==="pageScript"?(f(!0),M(q,{key:0},W(p(t).codes.filter(S=>S.codeType==="PageScript"),S=>{var h;return f(),U(ae,{id:S.id,key:S.id,class:de(((h=r.value)==null?void 0:h.currentCode)===S.id?"bg-blue/20 dark:text-fff/86":""),title:S.name,name:S.name,permission:"debug",onClick:i=>u(S),onContextmenu:H(i=>{var _;return(_=a.value)==null?void 0:_.openMenu(i,S)},["prevent","stop"])},null,8,["id","class","title","name","onClick","onContextmenu"])}),128)):(f(!0),M(q,{key:1},W(p(t).codesByType[v],S=>{var h;return f(),M(q,null,[S.children?(f(),U(Ne,{key:S.folderName+S.floor,data:S,permission:"debug","hidden-remove":"true",onClickHandle:w[0]||(w[0]=i=>u(i)),onClickContextMenu:i=>{var _;return(_=a.value)==null?void 0:_.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:S.id,key:S.id,class:de(((h=r.value)==null?void 0:h.currentCode)===S.id?"bg-blue/20 dark:text-fff/86":""),title:S.name,name:S.name,permission:"debug",padding:12+S.floor*6,onContextmenu:H(i=>{var _;return(_=a.value)==null?void 0:_.openMenu(i,S)},["prevent","stop"]),onClick:i=>u(S)},null,8,["id","class","title","name","padding","onContextmenu","onClick"]))],64)}),256))]),_:2},1032,["title"])):j("",!0)],64))),128)),k(Me,{ref_key:"contextMenu",ref:a,actions:p(c)},null,8,["actions"])]))}});var bl=Object.freeze(Object.defineProperty({__proto__:null,define:yl,default:gl},Symbol.toStringTag,{value:"Module"}));const To=oe.global.t,wl=()=>N.get(E("Form/External",!0)),_l=()=>N.get(E("Form/Embedded",!0)),kl=e=>N.post(E("Form/Deletes"),{ids:e},void 0,{successMessage:To("common.deleteSuccess")}),hl=e=>N.get(E("Form/GetEdit"),{id:e}),xl=e=>N.post(E("Form/post"),e),Cl=e=>N.post(E("Form/UpdateSetting"),e),$l=e=>N.get(E("Form/GetSetting"),{id:e}),Sl=e=>N.get(E("Form/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Vl=(e,l)=>N.get(E("Form/FormValues"),{id:e,pageNr:l,pageSize:30}),Tl=e=>N.post(E("Form/DeleteFormValues"),{ids:e},void 0,{successMessage:To("common.deleteSuccess")}),Mo=Re("formStore",()=>{const e=ce(),l=F(),o=C([]),t=C([]),s=()=>g(void 0,null,function*(){o.value=yield wl()}),r=()=>g(void 0,null,function*(){t.value=yield _l()}),a=X(()=>l.getSplitNameData(o.value)),n=()=>Promise.all([s(),r()]),u=b=>g(void 0,null,function*(){yield kl(b),l.deleteTabs(b),n()}),d=b=>g(void 0,null,function*(){b=b||Z;const v=yield hl(b);return v.body||(v.body=""),v.id=b,v}),c=(b,v)=>g(void 0,null,function*(){b.body||(b.body=" ");const S=yield xl(b);return e.site.recordSiteLogVideo&&v&&(yield Be(S,v,b.isEmbedded)),S}),m=(b,v)=>g(void 0,null,function*(){b=b||Z;const S=yield Vl(b,v);return S.id=b,S}),w=b=>g(void 0,null,function*(){yield Tl(b)});return ee(()=>{var b;return(b=e.site)==null?void 0:b.id},()=>{t.value=[],o.value=[]}),{external:o,embedded:t,getExternalFormList:a,loadAll:n,deleteForms:u,getForm:d,updateForm:c,getFormValues:m,deleteFormValues:w}}),Ml={key:0,class:"h-full"},Il=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Mo(),r=F(),a=C(),n=Pe(),u=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getForm(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateForm(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))});ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0});const w=(b,v)=>g(this,null,function*(){yield d.promise,v?u.value.search(v,b):u.value.goToLine(b)});return c(),l({save:m,load:c,goToLine:w}),(b,v)=>a.value?(f(),M("div",Ml,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:v[1]||(v[1]=S=>p(r).addTabRecord(t.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Rl={key:0,class:"h-40px leading-10 dark:text-[#fffa]"},Ll=G({props:{model:null},setup(e,{expose:l}){const o=e,t=De(),{t:s}=Y(),r=C(),a=X(()=>{var u;return o.model.id&&o.model.id===Z&&!((u=o.model)!=null&&u.isEmbedded)}),n=X(()=>({name:a.value?[le(s("common.fieldRequiredTips")),_e(1,50),Te(),Ce(Sl,s("common.valueHasBeenTakenTips"))]:[]}));return l({validate:()=>{var u;return(u=r.value)==null?void 0:u.validate()}}),(u,d)=>{const c=me,m=pe,w=ve;return p(t).query.type==="embedded"?(f(),M("span",Rl,J(p(s)("common.embeddedForm")),1)):(f(),U(w,{key:1,ref_key:"form",ref:r,model:e.model,rules:p(n),onSubmit:d[1]||(d[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(m,{label:p(s)("common.formName"),prop:"name"},{default:$(()=>[k(c,{modelValue:e.model.name,"onUpdate:modelValue":d[0]||(d[0]=b=>e.model.name=b),class:"min-w-300px",disabled:!p(a),title:e.model.name,"data-cy":"form-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"]))}}}),vt=oe.global.t,Ul=()=>N.get(E("Page/all",!0)),El=e=>N.post(E("Page/Deletes"),{ids:e},void 0,{successMessage:vt("common.deleteSuccess")}),od=()=>N.get(E("Page/DefaultRoute")),nd=e=>N.post(E("Page/DefaultRouteUpdate"),e,void 0,{successMessage:vt("common.saveSuccess")}),ad=e=>N.post(E("Page/ConvertFile"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},hiddenError:!0,successMessage:vt("common.importSuccess"),errorMessage:vt("common.importFailed"),keepShowErrorMessage:!0}),Io=e=>N.get(E("Page/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Ro=(e,l)=>ha(e,l),ld=e=>N.post(E("Page/Copy"),e,void 0,{successMessage:vt("common.copySuccess")}),Nl=e=>N.post(E("Page/post"),e),Al=e=>N.post(E("Page/PostRichText"),e),Dl=(e,l)=>N.get(E("Page/GetEdit"),ge({id:e},l)),sd=e=>N.get(E("Page/PageStructure"),{id:e}),id=()=>N.get(E("Page/GetDesignTemplate"),{env:"production"}),rd=e=>N.get(E("GroupEdit/Tree"),{includeScript:e}),ud=(e,l)=>N.post(E("GroupEdit/Search"),{SearchParams:l,includeScript:e}),dd=()=>N.get(E("GroupEdit/GetSiteRunningTask")),cd=()=>N.get(E("GroupEdit/ViewNames")),md=()=>N.get(E("GroupEdit/PageNames")),pd=()=>N.get(E("GroupEdit/BlockNames")),vd=e=>N.post(E("GroupEdit/GetOuterHtml"),{pages:e}),fd=e=>N.post(E("GroupEdit/GetInnerHtml"),{pages:e}),yd=e=>N.get(E(`GroupEdit/GetViewBody?name=${e}`)),gd=e=>N.get(E(`GroupEdit/GetHtmlBlockBody?name=${e}`)),bd=(e,l)=>N.post(E("GroupEdit/EditOuterHtml"),{pages:e,NewBody:l}),wd=(e,l)=>N.post(E("GroupEdit/EditInnerHtml"),{pages:e,NewBody:l}),_d=e=>N.post(E("GroupEdit/DeleteDom"),{pages:e}),kd=(e,l,o,t)=>N.post(E("GroupEdit/ToHtmlBlock"),{pages:e,name:l,body:o,UseExisting:t}),hd=(e,l,o,t)=>N.post(E("GroupEdit/ToView"),{pages:e,viewName:l,body:o,UseExisting:t}),xd=e=>N.get(E(`GroupEdit/GetTaskStatus?TaskId=${e}`)),ft=Re("pageStore",()=>{const e=C([]),l=ce(),o=F(),t=X(()=>o.getSplitNameData(e.value.filter(m=>["Normal","Designer"].includes(m.type)&&m.layoutId===Z))),s=X(()=>o.getSplitNameData(e.value.filter(m=>m.layoutId!==Z))),r=X(()=>o.getSplitNameData(e.value.filter(m=>m.type==="RichText"))),a=()=>g(void 0,null,function*(){const m=yield Ul();return e.value=m,m}),n=m=>g(void 0,null,function*(){yield El(m),o.deleteTabs(m),a()}),u=(m,w)=>g(void 0,null,function*(){m.body||(m.body=" ");const b=yield Al(m);return l.site.recordSiteLogVideo&&w&&(yield Be(b,w)),b}),d=(m,w)=>g(void 0,null,function*(){const b=yield Dl(m||Z,w);return b.body||(b.body=""),b}),c=(m,w)=>g(void 0,null,function*(){m.enableDiffChecker=!0;const b=yield Nl(m);return l.site.recordSiteLogVideo&&w&&(yield Be(b,w)),Object.assign(m,yield d(b))});return ee(()=>{var m;return(m=l.site)==null?void 0:m.id},()=>{e.value=[]}),{list:e,deletePages:n,load:a,updateRichPage:u,getPage:d,updatePage:c,getNormalPage:t,getLayoutPage:s,getRichPage:r}}),jl=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const o=e,{t}=Y(),s=C(!0),r=ft(),a=C(),n=C({id:"",formId:"",method:"get",redirectUrl:"RefreshSelf()",setting:{},formSubmitter:"",enable:!1});$l(o.id).then(m=>{a.value=m,n.value.id=a.value.id,n.value.formId=a.value.formId,n.value.redirectUrl=a.value.redirectUrl,n.value.formSubmitter=a.value.formSubmitter,n.value.enable=a.value.enable,n.value.method=a.value.method||"get",n.value.setting=a.value.setting});const u=X(()=>{const m=[];m.push({key:"RefreshSelf()",value:t("common.refreshSelf")});for(const w of r.list)m.push({key:w.path,value:w.name});return m}),d=()=>g(this,null,function*(){yield Cl(n.value),s.value=!1}),c=X(()=>{if(!a.value)return[];const m=a.value.availableSubmitters.find(w=>w.name===n.value.formSubmitter);return(m==null?void 0:m.settings)||[]});return r.load(),(m,w)=>{const b=Ft,v=pe,S=wo,h=_o,i=Bt,_=qt,I=me,V=ve,x=ye;return f(),M("div",{onClick:w[8]||(w[8]=H(()=>{},["stop"]))},[k(x,{"model-value":s.value,width:"600px","close-on-click-modal":!1,title:p(t)("common.formSetting"),onClosed:w[7]||(w[7]=y=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"form",action:"edit"},onConfirm:d,onCancel:w[6]||(w[6]=y=>s.value=!1)})]),default:$(()=>[a.value?(f(),U(V,{key:0,ref:"form","label-position":"top",model:n.value,onKeydown:ue(d,["enter"])},{default:$(()=>[k(v,{label:p(t)("common.enable")},{default:$(()=>[k(b,{modelValue:n.value.enable,"onUpdate:modelValue":w[0]||(w[0]=y=>n.value.enable=y),"data-cy":"enable"},null,8,["modelValue"])]),_:1},8,["label"]),n.value.enable?(f(),M(q,{key:0},[k(v,{label:p(t)("common.method")},{default:$(()=>[k(h,{modelValue:n.value.method,"onUpdate:modelValue":w[1]||(w[1]=y=>n.value.method=y),class:"el-radio-group--rounded"},{default:$(()=>[(f(),M(q,null,W(["get","post"],y=>k(S,{key:y,label:y,"data-cy":`method-${y}`},{default:$(()=>[Ae(J(y),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),k(v,{label:p(t)("common.redirectTo")},{default:$(()=>[k(_,{modelValue:n.value.redirectUrl,"onUpdate:modelValue":w[2]||(w[2]=y=>n.value.redirectUrl=y),class:"w-full",filterable:"","allow-create":"","default-first-option":"","data-cy":"redirect-dropdown"},{default:$(()=>[(f(!0),M(q,null,W(p(u),y=>(f(),U(i,{key:y.key,value:y.key,label:y.value,"data-cy":"redirect-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),k(v,{label:p(t)("common.submitter")},{default:$(()=>[k(_,{modelValue:n.value.formSubmitter,"onUpdate:modelValue":w[3]||(w[3]=y=>n.value.formSubmitter=y),class:"w-full","data-cy":"submitter-dropdown",onChange:w[4]||(w[4]=y=>n.value.setting={})},{default:$(()=>[(f(!0),M(q,null,W(a.value.availableSubmitters,y=>(f(),U(i,{key:y.name,value:y.name,label:y.name,"data-cy":"submitter-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),n.value.formSubmitter=="SubmitToExternal"?(f(),U(v,{key:0},{default:$(()=>[k(I,{modelValue:n.value.setting.url,"onUpdate:modelValue":w[5]||(w[5]=y=>n.value.setting.url=y),placeholder:"http://www.domain.com/receive","data-cy":"url"},null,8,["modelValue"])]),_:1})):(f(!0),M(q,{key:1},W(p(c),y=>(f(),U(v,{key:y.name,label:y.name},{default:$(()=>[k(_,{modelValue:n.value.setting[y.name.replace(y.name[0],y.name[0].toLocaleLowerCase())],"onUpdate:modelValue":T=>n.value.setting[y.name.replace(y.name[0],y.name[0].toLocaleLowerCase())]=T,class:"w-full",filterable:"","allow-create":"","default-first-option":"","data-cy":"submitter-object-dropdown"},{default:$(()=>[(f(!0),M(q,null,W(y.selectionValues,(T,L)=>(f(),U(i,{key:L,value:L,label:T,"data-cy":"submitter-object-opt"},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))],64)):j("",!0)]),_:1},8,["model","onKeydown"])):j("",!0)]),_:1},8,["model-value","title"])])}}}),Pl=["onKeydown"],ct=oe.global.t,Ol={name:"forms",icon:"icon-page",display:ct("common.form"),route:"forms",order:70,permission:"form",actions:[{name:"refresh",display:ct("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:ct("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"forms"}))}}]},dt=e=>{F().addTab({id:e.id,name:e.name,panel:Il,icon:"icon-page",actions:[{name:"save",display:ct("common.save"),visible:!1,icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.save()})},{name:"refresh",display:ct("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.load()})}]})},Fl=G({setup(e,{expose:l}){const{t:o}=Y(),t=Mo(),s=C(!1),r=C(!1),a=C(""),n=C(),u=C(),d=C(),c=()=>{t.loadAll()},m=()=>g(this,null,function*(){u.value=yield t.getForm(),s.value=!0}),w=()=>g(this,null,function*(){yield n.value.validate();const h=yield t.updateForm(u.value);yield t.loadAll();const i=t.external.find(_=>_.id==h);i&&dt(i),s.value=!1}),b=h=>g(this,null,function*(){yield xe(),yield t.deleteForms([h])}),v=h=>{a.value=h,r.value=!0},S=[{name:o("common.copyTitle"),invoke:h=>g(this,null,function*(){Ve(h.name)})}];return l({load:c}),(h,i)=>{const _=be,I=ye;return f(),M("div",null,[k(re,{title:p(o)("common.external"),add:"","expand-default":!0,permission:"form",onOnAdd:m},{default:$(()=>[(f(!0),M(q,null,W(p(t).getExternalFormList,V=>(f(),M(q,null,[V.children?(f(),U(Ne,{key:V.folderName+V.floor,data:V,permission:"form","show-setting":!0,onClickHandle:i[0]||(i[0]=x=>dt(x)),onRemove:i[1]||(i[1]=x=>b(x)),onSetting:i[2]||(i[2]=x=>v(x)),onClickContextMenu:x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x.event,x.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:V.id,key:V.id,title:V.name,name:V.name,permission:"form",padding:12+V.floor*6,remove:"",onClick:x=>dt(V),onRemove:x=>b(V.id),onContextmenu:H(x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},{default:$(()=>[k(_,{class:"iconfont icon-a-setup hover:text-blue",onClick:x=>v(V.id)},null,8,["onClick"])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(o)("common.embedded"),"expand-default":!0,permission:"form"},{default:$(()=>[(f(!0),M(q,null,W(p(t).embedded,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,permission:"form",remove:"",onClick:x=>dt(V),onRemove:x=>b(V.id),onContextmenu:H(x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},{default:$(()=>[k(_,{class:"iconfont icon-a-setup hover:text-blue",onClick:x=>v(V.id)},null,8,["onClick"])]),_:2},1032,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:i[5]||(i[5]=H(()=>{},["stop"]))},[k(I,{modelValue:s.value,"onUpdate:modelValue":i[4]||(i[4]=V=>s.value=V),width:"600px","close-on-click-modal":!1,title:p(o)("common.newForm"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:i[3]||(i[3]=V=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(w,["enter"])},[u.value?(f(),U(Ll,{key:0,ref_key:"form",ref:n,"label-position":"top",model:u.value},null,8,["model"])):j("",!0)],40,Pl)]),_:1},8,["modelValue","title"])]),r.value?(f(),U(jl,{key:0,id:a.value,modelValue:r.value,"onUpdate:modelValue":i[6]||(i[6]=V=>r.value=V)},null,8,["id","modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:d,actions:S},null,512)])}}});var Bl=Object.freeze(Object.defineProperty({__proto__:null,define:Ol,open:dt,default:Fl},Symbol.toStringTag,{value:"Module"}));const Lo=oe.global.t,Uo=(e,l)=>N.get(E("Layout/get"),ge({id:e},l)),ql=()=>N.get(E("Layout/list",!0)),Cd=(e,l)=>N.post(E("Layout/Copy"),{id:e,name:l},void 0,{successMessage:Lo("common.copySuccess")}),Gl=e=>N.post(E("Layout/post"),e),Kl=e=>N.post(E("Layout/Deletes"),{ids:e},void 0,{successMessage:Lo("common.deleteSuccess")}),Eo=e=>N.get(E("Layout/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),ao=oe.global.t,Gt=Re("layoutStore",()=>{const e=ce(),l=F(),o=C([]),t=X(()=>l.getSplitNameData(o.value)),s=()=>g(void 0,null,function*(){o.value=yield ql()}),r=d=>({name:d?[]:[Te(),_e(1,50),le(ao("common.nameRequiredTips")),Ce(Eo,ao("common.layoutNameExistsTips"))]}),a=d=>g(void 0,null,function*(){yield Kl(d),l.deleteTabs(d),s()}),n=d=>g(void 0,null,function*(){const c=yield Uo(d||Z);return c.body||(c.body=""),c}),u=(d,c)=>g(void 0,null,function*(){d.enableDiffChecker=!0;const m=yield Gl(d);return e.site.recordSiteLogVideo&&c&&(yield Be(m,c)),Object.assign(d,yield n(m))});return ee(()=>{var d;return(d=e.site)==null?void 0:d.id},()=>{o.value=[]}),{load:s,list:o,deleteLayouts:a,getLayout:n,updateLayout:u,getRules:r,getLayoutList:t}}),Hl={key:0,class:"h-full"},zl=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Gt(),r=F(),a=C(),n=Pe(),u=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getLayout(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateLayout(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),w=(b,v)=>g(this,null,function*(){yield d.promise,v?u.value.search(v,b):u.value.goToLine(b)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:w}),(b,v)=>a.value?(f(),M("div",Hl,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:v[1]||(v[1]=S=>p(r).addTabRecord(t.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Jl=G({props:{model:null,editMode:{type:Boolean}},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),r=Ee(()=>({name:o.editMode?[]:[_e(1,50),le(t("common.nameRequiredTips")),Te(),Ce(Eo,t("common.layoutNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const u=me,d=pe,c=ve;return e.model?(f(),U(c,{key:0,ref_key:"form",ref:s,model:e.model,rules:p(r),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.layoutName"),prop:"name"},{default:$(()=>[k(u,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.editMode,title:e.model.name,"data-cy":"layout-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])):j("",!0)}}}),Wl=["onKeydown"],mt=oe.global.t,Ql={name:"layouts",icon:"icon-layout",display:mt("common.layout"),route:"layouts",order:20,permission:"layout",actions:[{name:"refresh",display:mt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:mt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"layouts"}))}}]},_t=e=>{F().addTab({id:e.id,name:e.name,panel:zl,icon:"icon-layout",actions:[{name:"save",visible:!1,display:mt("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.save()})},{name:"refresh",display:mt("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.load()})}]})},Xl=G({setup(e,{expose:l}){const{t:o}=Y(),t=Gt(),s=C(!1),r=C(),a=C(),n=C(),u=()=>g(this,null,function*(){a.value=yield t.getLayout(),s.value=!0}),d=()=>g(this,null,function*(){yield r.value.validate();const b=yield t.updateLayout(a.value);_t(b),t.load(),s.value=!1}),c=b=>g(this,null,function*(){yield xe(),yield t.deleteLayouts([b])}),m=()=>{t.load()},w=[{name:o("common.copyTitle"),invoke:b=>g(this,null,function*(){Ve(b.name)})}];return l({load:m}),(b,v)=>{const S=ye;return f(),M("div",null,[k(re,{title:p(o)("common.list"),add:"","expand-default":!0,permission:"layout",onOnAdd:u},{default:$(()=>[(f(!0),M(q,null,W(p(t).getLayoutList,h=>(f(),M(q,null,[h.children?(f(),U(Ne,{key:h.folderName+h.floor,data:h,permission:"layout",onClickHandle:v[0]||(v[0]=i=>_t(i)),onRemove:v[1]||(v[1]=i=>c(i)),onClickContextMenu:i=>{var _;return(_=n.value)==null?void 0:_.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:h.id,key:h.id,permission:"layout",title:h.name,name:h.name,padding:12+h.floor*6,remove:"",onClick:i=>_t(h),onRemove:i=>c(h.id),onContextmenu:H(i=>{var _;return(_=n.value)==null?void 0:_.openMenu(i,h)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:v[4]||(v[4]=H(()=>{},["stop"]))},[k(S,{modelValue:s.value,"onUpdate:modelValue":v[3]||(v[3]=h=>s.value=h),width:"600px","close-on-click-modal":!1,title:p(o)("common.newLayout"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:d,onCancel:v[2]||(v[2]=h=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(d,["enter"])},[a.value?(f(),U(Jl,{key:0,ref_key:"form",ref:r,"label-position":"top",model:a.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Wl)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:n,actions:w},null,512)])}}});var Yl=Object.freeze(Object.defineProperty({__proto__:null,define:Ql,open:_t,default:Xl},Symbol.toStringTag,{value:"Module"}));const ze=oe.global.t,Zl=()=>N.get(E("Menu/list",!0)),No=(e,l)=>N.get(E("Menu/getMenu"),{id:e,name:l}),es=e=>N.post(E("Menu/Deletes"),{ids:e},void 0,{successMessage:ze("common.deleteSuccess")}),ts=(e,l)=>N.post(E("Menu/Delete"),{rootId:e,id:l},void 0,{successMessage:ze("common.deleteSuccess")}),os=e=>N.post(E("Menu/Create"),{name:e},void 0,{successMessage:ze("common.addSuccess")}),ns=e=>N.get(E("Menu/isUniqueName"),{name:e},{hiddenError:!0,hiddenLoading:!0}),as=e=>N.post(E("Menu/CreateSub"),e,void 0,{successMessage:ze("common.saveSuccess")}),ls=e=>N.post(E("Menu/updateInfo"),e,void 0,{successMessage:ze("common.saveSuccess")}),ss=e=>N.post(E("Menu/UpdateTemplate"),e,void 0,{successMessage:ze("common.saveSuccess")}),Ao=(e,l,o)=>N.post(E("Menu/Swap"),{rootId:e,ida:l,idb:o},void 0,{successMessage:ze("common.saveSuccess")}),Do=Re("menuStore",()=>{const e=ce(),l=F(),o=C([]),t=X(()=>l.getSplitNameData(o.value)),s=()=>g(void 0,null,function*(){o.value=yield Zl()}),r=u=>g(void 0,null,function*(){yield es(u),l.deleteTabs(u),s()}),a=u=>g(void 0,null,function*(){const d=yield os(u);return s(),d}),n=u=>g(void 0,null,function*(){return yield No(u)});return ee(()=>{var u;return(u=e.site)==null?void 0:u.id},()=>{o.value=[]}),{load:s,list:o,deleteMenus:r,getMenu:n,createMenu:a,getMenuList:t}}),is={class:"text-666 dark:text-fff/86 pr-8 pl-16 w-full border-line dark:border-444 rounded-normal border border-solid ellipsis bg-fff dark:bg-444","data-cy":"menu-item"},rs={class:"flex items-center text-m"},us={class:"space-x-8 flex"},ds=["title"],cs=["title"],ms=R("div",{class:"flex-1"},null,-1),ps={class:"p-8 cursor-move menu_move_handler","data-cy":"move"},vs={key:0,class:"pl-32 pr-24 mt-8 mb-16"},fs=G({props:{menu:null,id:null},emits:["reload","add","edit","template","delete"],setup(e,{emit:l}){const o=e,{t}=Y(),s=(r,a)=>g(this,null,function*(){const n=r.children[a.newIndex],u=r.children.splice(a.oldIndex,1)[0];r.children.splice(a.newIndex,0,u),yield Ao(o.id,u.id,n.id),l("reload")});return(r,a)=>{var c,m,w;const n=be,u=Dt("MenuItem",!0),d=lt;return f(),M("div",is,[R("div",rs,[R("div",us,[R("p",{"data-cy":"menu-item-name",class:"max-w-300px ellipsis",title:e.menu.name},J(e.menu.name),9,ds),R("p",{class:"text-blue max-w-500px ellipsis","data-cy":"menu-item-url",title:e.menu.url},J(e.menu.url),9,cs)]),ms,(c=e.menu.children)!=null&&c.length?(f(),U(Xe,{key:0,icon:"icon-code",tip:p(t)("common.editTemplate"),"data-cy":"edit-item-template",onClick:a[0]||(a[0]=b=>r.$emit("template",e.menu))},null,8,["tip"])):j("",!0),(m=e.menu.children)!=null&&m.length?j("",!0):(f(),U(Xe,{key:1,permission:{feature:"menu",action:"edit"},icon:"icon-a-addto",tip:p(t)("common.add"),"data-cy":"add-sub-item",onClick:a[1]||(a[1]=b=>r.$emit("add",e.menu.id))},null,8,["tip"])),k(Xe,{permission:{feature:"menu",action:"edit"},icon:"icon-a-writein",tip:p(t)("common.edit"),"data-cy":"edit-item",onClick:a[2]||(a[2]=b=>r.$emit("edit",e.menu))},null,8,["tip"]),k(Xe,{permission:{feature:"menu",action:"edit"},class:"text-orange hover:text-orange",icon:"icon-delete",tip:p(t)("common.delete"),"data-cy":"delete-item",onClick:a[3]||(a[3]=b=>r.$emit("delete",e.menu.id))},null,8,["tip"]),R("div",ps,[k(n,{class:"iconfont icon-move text-16px"})])]),(w=e.menu.children)!=null&&w.length?(f(),M("div",vs,[k(p(ko),{"model-value":e.menu.children,group:e.menu.id,"item-key":e.id,class:"space-y-8 mb-8",handle:".menu_move_handler","data-cy":"sub-menu-item-wrapper",onSort:a[9]||(a[9]=b=>s(e.menu,b))},{item:$(({element:b})=>[k(u,{id:e.id,menu:b,onReload:a[4]||(a[4]=v=>r.$emit("reload")),onAdd:a[5]||(a[5]=v=>r.$emit("add",v)),onEdit:a[6]||(a[6]=v=>r.$emit("edit",v)),onTemplate:a[7]||(a[7]=v=>r.$emit("template",v)),onDelete:a[8]||(a[8]=v=>r.$emit("delete",v))},null,8,["id","menu"])]),_:1},8,["model-value","group","item-key"]),k(d,{circle:"",onClick:a[10]||(a[10]=b=>r.$emit("add",e.menu.id))},{default:$(()=>[k(n,{class:"text-blue iconfont icon-a-addto"})]),_:1})])):j("",!0)])}}}),ys={class:"flex justify-end"},gs=G({props:{modelValue:{type:Boolean},menu:null},emits:["update:modelValue","reload"],setup(e,{emit:l}){const o=e,{t}=Y(),s=C([]),r={name:[le(t("common.nameRequiredTips")),_e(1,50)],url:[]};ka("Page").then(v=>s.value=v);const a=mn(),n=C(!0),u=C(),d=C(o.menu.values);sn(()=>{a.default in d.value||(d.value[a.default]=o.menu.name)});const c=C({rootId:o.menu.rootId,parentId:o.menu.parentId,name:o.menu.name,url:o.menu.url,id:o.menu.id}),m=Ee(()=>{if(!!c.value)return ge(ge({},c.value),d.value)}),w=()=>g(this,null,function*(){yield u.value.validate();var v=Oe(ge({},c.value),{Values:JSON.stringify(d.value)});v.url||(v.url="#"),v.name=d.value[a.default],c.value.id?yield ls(v):yield as(v),n.value=!1,l("reload")}),b=v=>v===a.default?a.selected.length>1?t("common.name")+" - "+v+" ("+t("common.default")+")":t("common.name"):t("common.name")+" - "+v;return(v,S)=>{const h=me,i=pe,_=Bt,I=qt,V=ve,x=ye;return f(),U(x,{"model-value":n.value,width:"600px","close-on-click-modal":!1,title:p(t)("common.menuItem"),onClosed:S[2]||(S[2]=y=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:S[1]||(S[1]=y=>n.value=!1)})]),default:$(()=>[R("div",ys,[k(In)]),k(V,{ref_key:"form",ref:u,"label-position":"top",model:p(m),rules:p(r),onKeydown:ue(w,["enter"])},{default:$(()=>[(f(!0),M(q,null,W(p(a).selected,y=>(f(),U(i,{key:y,label:b(y),rules:p(r).name,prop:y},{default:$(()=>[k(h,{modelValue:d.value[y],"onUpdate:modelValue":T=>d.value[y]=T,"data-cy":"name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","rules","prop"]))),128)),k(i,{label:"URL",prop:"url"},{default:$(()=>[k(I,{modelValue:c.value.url,"onUpdate:modelValue":S[0]||(S[0]=y=>c.value.url=y),filterable:"","allow-create":"","default-first-option":"",class:"w-full","data-cy":"url-dropdown"},{default:$(()=>[(f(!0),M(q,null,W(s.value,y=>(f(),U(_,{key:y.id,value:y.name,label:y.name,"data-cy":"url-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["model-value","title"])}}}),bs={class:"flex space-x-8"},ws={class:"space-y-8 flex-1"},_s={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden","data-cy":"editor-wrapper"},ks={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden ml-32","data-cy":"editor-wrapper"},hs={class:"flex space-x-4 p-8"},xs={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden","data-cy":"editor-wrapper"},Cs={class:"w-400px bg-card dark:bg-444 rounded-normal flex flex-col"},$s={class:"p-8 font-bold"},Ss={class:"h-full p-8"},Vs={class:"overflow-auto h-374px","data-cy":"preview"},Ts=G({props:{modelValue:{type:Boolean},menu:null},emits:["update:modelValue","reload"],setup(e,{emit:l}){const o=e,{t}=Y(),s=C(),r={lineNumbersMinChars:2,minimap:{enabled:!1},renderLineHighlight:"none"},a={AnchorText:"{anchortext}",Href:"{href}",SubItems:"{items}",ActiveClass:"{activeclass:className}",ParentId:"{parentid}",CurrentId:"{currentid}"},n=C(!0),u=C({containerTop:o.menu.subItemContainer.split("{items}")[0],template:o.menu.subItemTemplate,containerBottom:o.menu.subItemContainer.split("{items}")[1]}),d=(b,v,S,h)=>{var _,I;let i=v;for(const V of b.children){let x=S;if(x.indexOf(a.Href)&&(x=x.split(a.Href).join(V.url?V.url:"#")),x.indexOf(a.AnchorText)&&(x=x.split(a.AnchorText).join(V.name)),x.indexOf(a.CurrentId)&&(x=x.split(a.CurrentId).join(V.id)),x.indexOf(a.ParentId)&&(x=x.split(a.ParentId).join(V.parentId)),x.indexOf("activeclass:")){const y=(_=(x.match(/{[\w\W]*?:([\w\W]*?)}/)||[])[1])==null?void 0:_.toString();y&&(x=x.split(`{activeclass:${y}}`).join(b.children[0]===V?`class="${y}"`:""))}if(x.indexOf(a.SubItems)&&((I=V.children)==null?void 0:I.length)){let y=d(V,V.subItemContainer.split("{items}")[0],V.subItemTemplate,V.subItemContainer.split("{items}")[1]);x=x.split(a.SubItems).join(y)}i+=x}return i+=h,i},c=X(()=>d(o.menu,u.value.containerTop,u.value.template,u.value.containerBottom)),m=b=>{var v;(v=s.value)==null||v.replace(b)},w=()=>g(this,null,function*(){yield ss({Id:o.menu.id,RootId:o.menu.rootId===Z?o.menu.id:o.menu.rootId,SubItemContainer:u.value.containerTop+"{items}"+u.value.containerBottom,SubItemTemplate:u.value.template}),n.value=!1,l("reload")});return(b,v)=>{const S=Mn,h=ye;return f(),U(h,{"model-value":n.value,"custom-class":"el-dialog",width:"1100px","close-on-click-modal":!1,title:p(t)("common.editTemplate"),onClosed:v[4]||(v[4]=i=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"menu",action:"edit"},onConfirm:w,onCancel:v[3]||(v[3]=i=>n.value=!1)})]),default:$(()=>[R("div",bs,[R("div",ws,[R("div",_s,[k(he,{modelValue:u.value.containerTop,"onUpdate:modelValue":v[0]||(v[0]=i=>u.value.containerTop=i),class:"min-h-96px h-96px",language:"html",options:r},null,8,["modelValue"])]),R("div",ks,[k(he,{ref_key:"editor",ref:s,modelValue:u.value.template,"onUpdate:modelValue":v[1]||(v[1]=i=>u.value.template=i),class:"min-h-96px h-173px",language:"html",options:r},null,8,["modelValue"]),R("div",hs,[(f(),M(q,null,W(a,(i,_)=>k(S,{key:_,size:"small",class:"rounded-full cursor-pointer",onClick:I=>m(i)},{default:$(()=>[Ae(J(_),1)]),_:2},1032,["onClick"])),64))])]),R("div",xs,[k(he,{modelValue:u.value.containerBottom,"onUpdate:modelValue":v[2]||(v[2]=i=>u.value.containerBottom=i),language:"html",class:"min-h-96px h-96px",options:r},null,8,["modelValue"])])]),R("div",Cs,[R("div",$s,J(p(t)("common.preview")),1),R("div",Ss,[R("pre",Vs,J(p(c)),1)])])])]),_:1},8,["model-value","title"])}}}),Ms={key:0},Is=G({props:{id:null},emits:["update:model"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),r=ce(),a=C(),n=C(!1),u=C(!1),d=C(),c=()=>g(this,null,function*(){a.value=yield No(t.id,t.id),o("update:model",a.value)}),m=(h,i)=>g(this,null,function*(){const _=h.children[i.newIndex],I=h.children.splice(i.oldIndex,1)[0];h.children.splice(i.newIndex,0,I),yield Ao(a.value.id,I.id,_.id),c()}),w=h=>{!r.hasAccess("menu","edit")||(d.value={parentId:h,rootId:a.value.id,name:"",url:"",values:{},urls:{}},n.value=!0)},b=h=>{!r.hasAccess("menu","edit")||(d.value=h,n.value=!0)},v=h=>g(this,null,function*(){!r.hasAccess("menu","edit")||(yield xe(),yield ts(a.value.id,h),c())}),S=h=>{d.value=h,u.value=!0};return l({onTemplateEdit:S}),c(),(h,i)=>{const _=be,I=lt,V=Xe;return a.value?(f(),M("div",Ms,[k(p(ko),{"model-value":a.value.children,group:a.value.id,"item-key":a.value.id,class:"space-y-8 mb-8",handle:".menu_move_handler","data-cy":"menu-item-wrapper",onSort:i[0]||(i[0]=x=>m(a.value,x))},{item:$(({element:x})=>[k(fs,{id:a.value.id,menu:x,onReload:c,onAdd:w,onDelete:v,onEdit:b,onTemplate:S},null,8,["id","menu"])]),_:1},8,["model-value","group","item-key"]),R("div",null,[a.value.children.length?(f(),U(V,{key:1,permission:{feature:"menu",action:"edit"},circle:"",icon:"icon-a-addto",tip:p(s)("common.addMenuItem"),"data-cy":"add-item",onClick:i[2]||(i[2]=x=>w(a.value.id))},null,8,["tip"])):(f(),U(Rn,{key:0},{button:$(()=>[k(I,{round:"",type:"primary",onClick:i[1]||(i[1]=x=>w(a.value.id))},{default:$(()=>[k(_,{class:"iconfont icon-a-addto"}),Ae(J(p(s)("common.createItemNow")),1)]),_:1})]),default:$(()=>[Ae(J(p(s)("common.createItemNowToCreateAItem"))+" ",1)]),_:1}))]),(f(),U(ro,{to:"body"},[n.value?(f(),U(gs,{key:0,modelValue:n.value,"onUpdate:modelValue":i[3]||(i[3]=x=>n.value=x),menu:d.value,onReload:c},null,8,["modelValue","menu"])):j("",!0),u.value?(f(),U(Ts,{key:1,modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=x=>u.value=x),menu:d.value,onReload:c},null,8,["modelValue","menu"])):j("",!0)]))])):j("",!0)}}}),Rs={class:"h-full p-24"},Ls={class:"flex"},Us=R("div",{class:"flex-1"},null,-1),Es={class:"pb-8"},Ns=G({props:{id:null},setup(e){const{t:l}=Y(),o=C(),t=C();return(s,r)=>(f(),M("div",Rs,[R("div",Ls,[Us,R("div",Es,[k(Xe,{icon:"icon-code",class:"dark:text-fff/86",tip:p(l)("common.editTemplate"),"data-cy":"edit-template",onClick:r[0]||(r[0]=a=>o.value.onTemplateEdit(t.value))},null,8,["tip"])])]),k(Is,{id:e.id,ref_key:"inner",ref:o,"onUpdate:model":r[1]||(r[1]=a=>t.value=a)},null,8,["id"])]))}}),As=["onKeydown"],Ds=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue","created"],setup(e,{emit:l}){const{t:o}=Y(),t={name:[le(o("common.nameRequiredTips")),Te(),_e(1,50),Ce(ns,o("common.menuNameExistsTips"))]},s=C(!0),r=C(),a=Do(),n=C({name:""}),u=()=>g(this,null,function*(){yield r.value.validate();const d=yield a.createMenu(n.value.name);l("created",d),s.value=!1});return(d,c)=>{const m=me,w=pe,b=ve,v=ye;return f(),M("div",{onClick:c[4]||(c[4]=H(()=>{},["stop"]))},[k(v,{"model-value":s.value,width:"600px","close-on-click-modal":!1,title:p(o)("common.addMenu"),onClosed:c[3]||(c[3]=S=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:u,onCancel:c[2]||(c[2]=S=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(u,["enter"])},[k(b,{ref_key:"form",ref:r,"label-position":"top",model:n.value,rules:p(t),onSubmit:c[1]||(c[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(w,{label:p(o)("common.name"),prop:"name"},{default:$(()=>[k(m,{modelValue:n.value.name,"onUpdate:modelValue":c[0]||(c[0]=S=>n.value.name=S),"data-cy":"menu-name"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])],40,As)]),_:1},8,["model-value","title"])])}}}),Ut=oe.global.t,js={name:"menus",icon:"icon-menu",display:Ut("common.menu"),order:60,permission:"menu",actions:[{name:"refresh",display:Ut("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ut("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"menus"}))}}]},kt=e=>{F().addTab({id:e.id,name:e.name,panel:Ns,icon:"icon-menu"})},Ps=G({setup(e,{expose:l}){const{t:o}=Y(),t=Do(),s=C(!1),r=C(),a=()=>{t.load()},n=d=>g(this,null,function*(){yield xe(),yield t.deleteMenus([d])}),u=[{name:o("common.copyTitle"),invoke:d=>g(this,null,function*(){Ve(d.name)})}];return l({load:a}),(d,c)=>(f(),M("div",null,[k(re,{title:p(o)("common.list"),add:"","expand-default":!0,permission:"menu",onOnAdd:c[2]||(c[2]=m=>s.value=!0)},{default:$(()=>[(f(!0),M(q,null,W(p(t).getMenuList,m=>(f(),M(q,null,[m.children?(f(),U(Ne,{key:m.folderName+m.floor,data:m,permission:"menu",onClickHandle:c[0]||(c[0]=w=>kt(w)),onRemove:c[1]||(c[1]=w=>n(w)),onClickContextMenu:w=>{var b;return(b=r.value)==null?void 0:b.openMenu(w.event,w.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:m.id,key:m.id,permission:"menu",title:m.name,name:m.name,padding:12+m.floor*6,remove:"",onClick:w=>kt(m),onRemove:w=>n(m.id),onContextmenu:H(w=>{var b;return(b=r.value)==null?void 0:b.openMenu(w,m)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),s.value?(f(),U(Ds,{key:0,modelValue:s.value,"onUpdate:modelValue":c[3]||(c[3]=m=>s.value=m),onCreated:c[4]||(c[4]=m=>kt(m))},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:r,actions:u},null,512)]))}});var Os=Object.freeze(Object.defineProperty({__proto__:null,define:js,open:kt,default:Ps},Symbol.toStringTag,{value:"Module"}));const Fs=G({props:{model:null},emits:["save"],setup(e,{expose:l,emit:o}){const{t}=Y(),s=C(),r={name:[_e(1,50),le(t("common.nameRequiredTips")),bo()]};return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const u=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,"label-position":"top",model:e.model,rules:p(r),onSubmit:n[2]||(n[2]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.name"),prop:"name"},{default:$(()=>[k(u,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),"data-cy":"name",onKeydown:n[1]||(n[1]=ue(m=>o("save"),["enter"]))},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}});const Bs={key:0,class:"el-upload__tip ml-8"},qs={key:1,class:"mt-12 w-full"},Gs=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const{t:o}=Y(),t={name:[_e(1,50),le(o("common.nameRequiredTips")),bo()],file:le(o("common.selectFileTips"))},s=C(!0),r=C(),a=C({name:"",file:null}),n=Se(),u=c=>{a.value.file=c},d=()=>g(this,null,function*(){yield r.value.validate();var c=new FormData;c.append("file",a.value.file.raw),c.append("name",a.value.name),yield oa(c),Pt(),s.value=!1,n.load()});return n.load(),ee(()=>a.value.file,()=>{a.value.file&&r.value.clearValidate("file")}),(c,m)=>{const w=me,b=pe,v=lt,S=Un,h=Ln,i=ve,_=ye;return f(),U(_,{modelValue:s.value,"onUpdate:modelValue":m[4]||(m[4]=I=>s.value=I),width:"600px","close-on-click-modal":!1,title:p(o)("common.import"),onClosed:m[5]||(m[5]=I=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{"confirm-label":p(o)("common.start"),onConfirm:d,onCancel:m[3]||(m[3]=I=>s.value=!1)},null,8,["confirm-label"])]),default:$(()=>[k(i,{ref_key:"form",ref:r,"label-position":"top",model:a.value,rules:t,onSubmit:m[2]||(m[2]=H(()=>{},["prevent"])),onKeydown:ue(d,["enter"])},{default:$(()=>[k(b,{label:p(o)("common.name"),prop:"name"},{default:$(()=>[k(w,{modelValue:a.value.name,"onUpdate:modelValue":m[0]||(m[0]=I=>a.value.name=I),"data-cy":"module-name"},null,8,["modelValue"])]),_:1},8,["label"]),k(b,{label:p(o)("common.file"),prop:"file"},{default:$(()=>[k(S,{"show-file-list":!1,action:"",accept:"application/zip","auto-upload":!1,"on-change":u,"data-cy":"upload"},{default:$(()=>[k(v,{type:"primary",round:"",plain:""},{default:$(()=>[Ae(J(p(o)("common.selectFile")),1)]),_:1})]),_:1}),a.value.file?j("",!0):(f(),M("div",Bs,J(p(o)("common.compressedPackageFileFormat")),1)),a.value.file?(f(),M("div",qs,[k(h,{title:a.value.file.name,type:"info",onClose:m[1]||(m[1]=I=>a.value.file=null)},null,8,["title"])])):j("",!0)]),_:1},8,["label"])]),_:1},8,["model","onKeydown"])]),_:1},8,["modelValue","title"])}}});var Ks=ho(Gs,[["__scopeId","data-v-38caff42"]]);const Hs=["onKeydown"],zs=["src"],Js=G({setup(e){const{t:l}=Y(),o=rn(),t=Se(),s=C(!1),r=C(!1),a=C(),n=C(),u=C(),d=C(!1);let c=C();const m=()=>g(this,null,function*(){n.value={name:""},s.value=!0}),w=()=>g(this,null,function*(){yield a.value.validate(),yield t.createModule(n.value.name),s.value=!1}),b=h=>g(this,null,function*(){yield xe(),yield t.deleteModules([h])}),v=h=>{t.editModule(h),o.push(ke({name:"dev-mode",query:{activity:"modules",moduleId:h}}))},S=X(()=>{var i,_;var h=[{name:l("common.copyTitle"),invoke:I=>g(this,null,function*(){Ve(I.name)})}];return(_=(i=u.value)==null?void 0:i.payload)!=null&&_.backendViewUrl&&h.push({name:l("common.backend"),invoke:I=>g(this,null,function*(){c.value=I.backendViewUrl,d.value=!0})}),h});return(h,i)=>{const _=be,I=ye,V=at("hasPermission");return f(),M(q,null,[k(re,{title:p(l)("common.list"),add:"","expand-default":!0,permission:"module",onOnAdd:m},{bar:$(()=>[ie(k(_,{class:"iconfont icon-a-Cloudupload hover:text-blue",onClick:i[0]||(i[0]=x=>r.value=!0)},null,512),[[V,{feature:"module",action:"edit",effect:"hiddenIcon"}]])]),default:$(()=>[(f(!0),M(q,null,W(p(t).list,x=>(f(),U(ae,{id:x.id,key:x.id,title:x.name,remove:"",permission:"module",onRemove:y=>b(x.id),onClick:y=>v(x.id),onContextmenu:H(y=>{var T;return(T=u.value)==null?void 0:T.openMenu(y,x)},["prevent","stop"])},null,8,["id","title","onRemove","onClick","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:i[3]||(i[3]=H(()=>{},["stop"]))},[k(I,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=x=>s.value=x),width:"600px","close-on-click-modal":!1,title:p(l)("common.newModule"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:i[1]||(i[1]=x=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(w,["enter"])},[n.value?(f(),U(Fs,{key:0,ref_key:"form",ref:a,model:n.value},null,8,["model"])):j("",!0)],40,Hs)]),_:1},8,["modelValue","title"])]),r.value?(f(),U(Ks,{key:0,modelValue:r.value,"onUpdate:modelValue":i[4]||(i[4]=x=>r.value=x)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:u,actions:p(S)},null,8,["actions"]),k(I,{modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=x=>d.value=x),width:"1000px","close-on-click-modal":!1,"custom-class":"el-dialog--zero-padding",title:p(l)("common.manage"),onClosed:i[6]||(i[6]=x=>d.value=!1)},{default:$(()=>[R("iframe",{src:p(c),class:"w-full h-500px"},null,8,zs)]),_:1},8,["modelValue","title"])],64)}}}),Ws={class:"h-full"},Qs=G({props:{id:null,params:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=C(""),r=Pe(),a=Se(),n=()=>g(this,null,function*(){s.value=yield la(t.params.file.objectType,t.params.moduleId,t.params.file.name),r.init(s.value)}),u=()=>g(this,null,function*(){!s.value||(yield $o(t.params.file.objectType,t.params.moduleId,t.params.file.name,s.value),r.init(s.value),o("changed",!1),o("setAction","save",{visible:!1}))}),d=Ee(()=>t.params.file.name==="Module.config"),c=Ee(()=>{var w;if(t.params.file.objectType=="code"){const b=(w=a.list.find(S=>S.id==t.params.moduleId))==null?void 0:w.name;let v=t.params.file.name;return`file:///node_modules/@types/module:${b}/${v}.ts`}return d.value?`memory:///module:${t.params.moduleId}/${t.params.file.name}`:`memory:///${jt()}`}),m=Ee(()=>t.params.file.objectType==="css"?"css":t.params.file.objectType==="js"?"javascript":t.params.file.objectType==="view"||t.params.file.objectType==="backend"?"html":t.params.file.objectType==="api"||t.params.file.objectType==="code"?"typescript":t.params.file.name==="Module.config"?"json":t.params.file.name==="Dashboard.js"||t.params.file.name==="Event.js"?"typescript":"");return ee(()=>s.value,()=>{o("changed",r.changed(s.value)),o("setAction","save",{visible:r.changed(s.value)})},{deep:!0}),n(),l({save:u,load:n}),(w,b)=>(f(),M("div",Ws,[k(he,{modelValue:s.value,"onUpdate:modelValue":b[0]||(b[0]=v=>s.value=v),uri:p(c),language:p(m),"k-script":""},null,8,["modelValue","uri","language"])]))}}),Xs={class:"h-full"},Ys={class:"ellipsis w-120px h-24 leading-6"},Zs=G({props:{id:null,name:null,params:null},setup(e){const l=e,{t:o}=Y(),t=()=>{St(l.params.url+"?__content_type=application/octet-stream")};return(s,r)=>{const a=lt,n=Nn;return f(),M("div",Xs,[k(n,{icon:"info",title:p(o)("common.canNotOpenFile")},{"sub-title":$(()=>[R("p",null,J(p(o)("common.canNotOpenFileTip")),1)]),extra:$(()=>{var u;return[(u=e.params)!=null&&u.url?(f(),U(a,{key:0,round:"",plain:"",type:"primary",onClick:t},{default:$(()=>[R("span",Ys,J(p(o)("common.downloadThisFile")),1)]),_:1})):j("",!0)]}),_:1},8,["title"])])}}}),ei=G({props:{id:null,name:null,params:null},emits:["changed"],setup(e,{expose:l,emit:o}){const t=e,s=C(),r=C();nt(()=>{const n=ge(ge({},t),t.params);r.value=n});const a=()=>g(this,null,function*(){yield So(t.params.type,t.params.moduleId,t.name,s.value.split("base64,")[1]),o("changed",!1)});return ee(()=>s.value,()=>{o("changed",!0)}),l({save:a}),(n,u)=>r.value?(f(),U(p(An),{key:0,base64:s.value,"onUpdate:base64":u[0]||(u[0]=d=>s.value=d),name:r.value.name,url:r.value.url},null,8,["base64","name","url"])):j("",!0)}});const ti={class:"relative group flex items-center"},oi=["accept","onChange"],ni=["onKeydown"],ai={class:"w-full flex space-x-4"},li=G({setup(e){const{t:l}=Y(),o=Se(),t=ce(),s=F(),r=C(!1),a=C(),n=C(),{onPreview:u}=we(),d={name:[le(l("common.nameRequiredTips")),_e(1,50),Te()]},c=C({name:"",extension:""}),m=C(),w=x=>g(this,null,function*(){m.value=x,c.value.extension=x.defaultExtension,r.value=!0}),b=()=>g(this,null,function*(){yield a.value.validate();let x=c.value.name;yield o.createModuleFile(x,m.value);const y=o.files.find(T=>{var L;return T.name==c.value.name+T.extension&&T.objectType==((L=m.value)==null?void 0:L.name)});y&&i(y),r.value=!1}),v=(x,y,T)=>g(this,null,function*(){yield xe(),yield o.deleteModuleFile(x,y),s.deleteTab(T)}),S=x=>{x.isBinary?h(x):i(x)},h=x=>{s.addTab({id:x.id,name:x.name,panel:x.objectType==="img"?ei:Zs,icon:"icon-classification",params:{url:x.previewUrl,type:x.objectType,moduleId:o.editingModule}})},i=x=>{const y=o.types.find(L=>L.name==x.objectType),T={id:x.id,name:x.name,panel:Qs,icon:"icon-classification",params:{type:y,file:x,moduleId:o.editingModule},actions:[{name:"save",visible:!1,icon:"icon-preservation",display:l("common.save"),invoke:()=>g(this,null,function*(){var O,D;const L=yield(D=(O=F().activeTab)==null?void 0:O.panelInstance)==null?void 0:D.promise;!L||L.save()})},{name:"refresh",display:l("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(this,null,function*(){var O,D;const L=yield(D=(O=F().activeTab)==null?void 0:O.panelInstance)==null?void 0:D.promise;!L||L.load()})}]};x.objectType!=="root"&&x.objectType!=="code"&&T.actions.push({name:"open",display:l("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(this,null,function*(){u(x.previewUrl)})}),s.addTab(T)};function _(x,y){var T=x.target.files[0];if(!!T){var L=new FileReader;L.readAsDataURL(T),L.onload=function(O){var D=O.target.result;o.uploadModuleFile(T.name,D.split("base64,")[1],y)}}}function I(){c.value={name:"",extension:""}}const V=X(()=>{var y,T,L,O;var x=[{name:l("common.copyTitle"),invoke:D=>g(this,null,function*(){Ve(D.name)})}];return((T=(y=n.value)==null?void 0:y.payload)==null?void 0:T.previewUrl)&&((O=(L=n.value)==null?void 0:L.payload)==null?void 0:O.objectType)!="root"&&x.push({name:l("common.preview"),invoke:D=>g(this,null,function*(){u(D.previewUrl)})}),x});return(x,y)=>{var A;const T=be,L=En,O=me,D=pe,P=ve,B=ye;return f(),M("div",null,[(f(!0),M(q,null,W(p(o).types,K=>(f(),U(re,{key:K.name,title:K.displayName,add:K.isText&&K.name!=="root","expand-default":!0,permission:"module",onOnAdd:ne=>w(K)},{bar:$(()=>[R("div",ti,[K.isBinary&&p(t).hasAccess("module","edit")?(f(),U(T,{key:0,class:"iconfont icon-a-Cloudupload group-hover:text-blue","data-cy":"import"})):j("",!0),R("input",{class:"!cursor-pointer absolute inset-0 !opacity-0 bg-green overflow-hidden",type:"file",title:" ",accept:K.name=="img"?"image/*":"","data-cy":"upload",onChange:ne=>_(ne,K)},null,40,oi)])]),default:$(()=>[(f(!0),M(q,null,W(p(o).files.filter(ne=>ne.objectType===K.name),ne=>(f(),U(ae,{id:ne.id,key:ne.name,title:ne.name,remove:ne.objectType!=="root",permission:"module",onRemove:Le=>v(ne.name,ne.objectType,ne.id),onClick:Le=>S(ne),onContextmenu:H(Le=>{var yt;return(yt=n.value)==null?void 0:yt.openMenu(Le,ne)},["prevent","stop"])},null,8,["id","title","remove","onRemove","onClick","onContextmenu"]))),128))]),_:2},1032,["title","add","onOnAdd"]))),128)),(f(),U(ro,{to:"body"},[R("div",{onClick:y[4]||(y[4]=H(()=>{},["stop"]))},[k(B,{modelValue:r.value,"onUpdate:modelValue":y[3]||(y[3]=K=>r.value=K),width:"600px","close-on-click-modal":!1,title:p(l)("common.newModuleType",{type:(A=m.value)==null?void 0:A.displayName}),"destroy-on-close":"",onClose:I},{footer:$(()=>[k(fe,{onConfirm:b,onCancel:y[2]||(y[2]=K=>r.value=!1)})]),default:$(()=>{var K,ne;return[((K=m.value)==null?void 0:K.displayName)==="View"||((ne=m.value)==null?void 0:ne.displayName)==="Backend"?(f(),U(L,{key:0,class:"-mx-32 -mt-24 mb-12",title:p(l)("common.moduleViewEntrance"),content:p(l)("common.moduleViewEntranceTips")},null,8,["title","content"])):j("",!0),R("div",{onKeydown:ue(b,["enter"])},[c.value?(f(),U(P,{key:0,ref_key:"form",ref:a,"label-position":"top",model:c.value,rules:d,onSubmit:y[1]||(y[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(D,{label:p(l)("common.name"),prop:"name"},{default:$(()=>[R("div",ai,[k(O,{modelValue:c.value.name,"onUpdate:modelValue":y[0]||(y[0]=Le=>c.value.name=Le),class:"flex-1","data-cy":"module-file-name"},null,8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model"])):j("",!0)],40,ni)]}),_:1},8,["modelValue","title"]),k(Me,{ref_key:"contextMenu",ref:n,actions:p(V)},null,8,["actions"])])]))])}}});var si=ho(li,[["__scopeId","data-v-645d2160"]]);const wt=oe.global.t,ii={name:"modules",icon:"icon-classification",display:wt("common.modules"),order:100,permission:"module",actions:[{name:"back",display:wt("common.back"),icon:"icon-go-back",visible:!1,invoke(){se.push(ke({name:"dev-mode",query:{activity:"modules"}})),Se().exitEditModule()}},{name:"refresh",display:wt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:wt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"modules"}))}}]},ri=G({setup(e,{expose:l}){const o=Se(),t=F(),s=ce(),r=De(),a=C([]),n=()=>{o.load(),u()},u=()=>g(this,null,function*(){var d;!s.hasAccess("module","view")||(a.value=yield xo(),r.query.moduleId&&r.query.activity==="modules"&&(o.editModule(r.query.moduleId),t.activeActivity&&(t.activeActivity.panelDisplay=(d=a.value.find(c=>c.id===r.query.moduleId))==null?void 0:d.name)))});return ee(()=>r.query.moduleId,()=>{r.query.moduleId&&u()},{immediate:!0}),l({load:n}),(d,c)=>(f(),M("div",null,[p(o).editingModule&&p(o).types.length?(f(),U(si,{key:0})):j("",!0),p(o).editingModule?j("",!0):(f(),U(Js,{key:1}))]))}});var ui=Object.freeze(Object.defineProperty({__proto__:null,define:ii,default:ri},Symbol.toStringTag,{value:"Module"}));function jo(e){return{id:e.id,name:e.name,body:e.body,url:e.urlPath,title:e.title,cacheByVersion:e.cacheByVersion,cacheMinutes:e.cacheMinutes,cacheQueryKeys:e.cacheQueryKeys,enableCache:e.enableCache,published:e.published}}var di=(e=>(e.TagName="TagName",e.Id="Id",e.Class="Class",e))(di||{}),ci=(e=>(e.Equal="Equal",e.StartWith="StartWith",e.Contains="Contains",e))(ci||{});const mi={key:0,class:"h-full"},We=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=ft(),r=F(),a=C(),n=Pe((v,S)=>{if(!(v==="urlPath"&&S))return S}),u=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getPage(t.id),d.resolve(null),n.init(a.value)}),m=v=>g(this,null,function*(){!a.value||(a.value.urlPath=v.urlPath)}),w=()=>g(this,null,function*(){!a.value||(yield s.updatePage(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),b=(v,S)=>g(this,null,function*(){yield d.promise,S?u.value.search(S,v):u.value.goToLine(v)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:w,load:c,goToLine:b,updateModel:m}),(v,S)=>a.value?(f(),M("div",mi,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":S[0]||(S[0]=h=>a.value.body=h),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:S[1]||(S[1]=h=>p(r).addTabRecord(t.id,h,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),pi={key:0,class:"h-full"},st=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=ft(),r=F(),a=C(),n=Pe((v,S)=>{if(!["url","published","title"].includes(v))return S}),u=C(),d=new $e,c=()=>g(this,null,function*(){const v=yield s.getPage(t.id);d.resolve(null),a.value=jo(v),n.init(a.value)}),m=v=>g(this,null,function*(){!a.value||(a.value.url=v.path,a.value.title=v.title,a.value.published=v.online)}),w=()=>g(this,null,function*(){!a.value||(yield s.updateRichPage(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),b=(v,S)=>g(this,null,function*(){yield d.promise,S?u.value.search(S,v):u.value.goToLine(v)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:w,load:c,goToLine:b,updateModel:m}),(v,S)=>a.value?(f(),M("div",pi,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":S[0]||(S[0]=h=>a.value.body=h),language:"html",uri:p(je).file(a.value.id),onMonacoLoadComplete:S[1]||(S[1]=h=>p(r).addTabRecord(t.id,h,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),vi=G({props:{model:null,oldUrlPath:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),r=n=>{!o.model||o.model.urlPath||(o.model.urlPath=`/${n}`)},a=X(()=>({name:[o.model.id===Z?[_e(1,50),le(t("common.nameRequiredTips")),Ce(Io,t("common.thePageNameAlreadyExists"))]:[]],urlPath:[le(t("common.urlRequiredTips")),o.oldUrlPath===o.model.urlPath?"":Ce(n=>Ro(n,o.oldUrlPath),t("common.urlOccupied"))]}));return l({validate:()=>{var n;return(n=s.value)==null?void 0:n.validate()}}),(n,u)=>{const d=me,c=pe,m=ve;return f(),U(m,{ref_key:"form",ref:s,model:e.model,rules:p(a),onSubmit:u[4]||(u[4]=H(()=>{},["prevent"]))},{default:$(()=>[k(c,{label:p(t)("common.pageName"),prop:"name"},{default:$(()=>[k(d,{modelValue:e.model.name,"onUpdate:modelValue":u[0]||(u[0]=w=>e.model.name=w),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"page-name",onInput:u[1]||(u[1]=w=>e.model.name=e.model.name.replace(/\s+/g,"")),onChange:r},null,8,["modelValue","disabled","title"])]),_:1},8,["label"]),k(c,{label:"URL",prop:"urlPath"},{default:$(()=>[k(d,{modelValue:e.model.urlPath,"onUpdate:modelValue":u[2]||(u[2]=w=>e.model.urlPath=w),class:"min-w-300px","data-cy":"url",onInput:u[3]||(u[3]=w=>e.model.urlPath=e.model.urlPath.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])}}}),fi=G({props:{model:null,oldUrl:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),r=n=>{!o.model||o.model.url||(o.model.url=`/${n}`)},a=X(()=>({name:o.model.id!==Z?[]:[_e(1,50),le(t("common.nameRequiredTips")),Ce(Io,t("common.thePageNameAlreadyExists"))],url:[le(t("common.urlRequiredTips")),o.oldUrl===o.model.url?"":Ce(n=>Ro(n,o.oldUrl),t("common.urlOccupied"))],title:[le(t("common.titleRequiredTips"))]}));return l({validate:()=>{var n;return(n=s.value)==null?void 0:n.validate()}}),(n,u)=>{const d=me,c=pe,m=Ft,w=ve;return f(),U(w,{ref_key:"form",ref:s,"label-position":"top",model:e.model,rules:p(a),onSubmit:u[6]||(u[6]=H(()=>{},["prevent"]))},{default:$(()=>[k(c,{label:p(t)("common.pageName"),prop:"name"},{default:$(()=>[k(d,{modelValue:e.model.name,"onUpdate:modelValue":u[0]||(u[0]=b=>e.model.name=b),class:"min-w-325px",title:e.model.name,disabled:e.model.id!==p(Z),"data-cy":"page-name",onInput:u[1]||(u[1]=b=>e.model.name=e.model.name.replace(/\s+/g,"")),onChange:r},null,8,["modelValue","title","disabled"])]),_:1},8,["label"]),k(c,{label:"URL",prop:"url"},{default:$(()=>[k(d,{modelValue:e.model.url,"onUpdate:modelValue":u[2]||(u[2]=b=>e.model.url=b),class:"min-w-325px","data-cy":"url",onInput:u[3]||(u[3]=b=>e.model.url=e.model.url.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1}),k(c,{label:p(t)("common.title"),prop:"title"},{default:$(()=>[k(d,{modelValue:e.model.title,"onUpdate:modelValue":u[4]||(u[4]=b=>e.model.title=b),class:"min-w-325px","data-cy":"title"},null,8,["modelValue"])]),_:1},8,["label"]),Ke(n.$slots,"default"),k(c,{label:p(t)("page.online")},{default:$(()=>[k(m,{modelValue:e.model.published,"onUpdate:modelValue":u[5]||(u[5]=b=>e.model.published=b)},null,8,["modelValue"])]),_:1},8,["label"])]),_:3},8,["model","rules"])}}}),yi=["onKeydown"],et=oe.global.t,gi={name:"pages",icon:"icon-copy",display:et("common.page"),route:"pages",order:0,permission:"pages",actions:[{name:"refresh",display:et("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:et("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"pages"}))}}]},Ue=(e,l)=>{if(e.type==="Designer"){const o=go(e.id,e.layoutId);St(se.resolve(o).href);return}F().addTab({id:e.id,name:e.name,panel:l,icon:"icon-copy",actions:[{name:"save",visible:!1,display:et("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",visible:!0,display:et("common.refresh"),icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})},{name:"open",visible:!0,display:et("common.preview"),icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=ft();let t=o.list.find(s=>s.id===e.id);if(t||(yield o.load(),t=o.list.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.previewUrl)}})}]})},bi=G({setup(e,{expose:l}){const{t:o}=Y(),t=De(),s=ft(),r=Gt(),a=C(!1),n=C(),u=C(),d=C(),c=C(!1);let m=C("normal");const w=C(),b=C(),v=new tn,S=ce(),h=()=>g(this,null,function*(){d.value=yield s.getPage(),d.value.published=!0,m.value="normal",a.value=!0}),i=B=>g(this,null,function*(){d.value=yield s.getPage(),d.value.published=!0;const A=yield Uo(B),K=xn(A.name,A.body);d.value.body=Cn(K),m.value="layout",a.value=!0}),_=()=>g(this,null,function*(){m.value="rich",d.value={id:Z,body:"",title:"",name:"",url:"",cacheByVersion:!1,cacheMinutes:3,enableCache:!1,cacheQueryKeys:" ",published:!0},a.value=!0}),I=(B,A)=>g(this,null,function*(){m.value=A,d.value=yield s.getPage(B),w.value=d.value.urlPath,A==="rich"&&(d.value=jo(d.value)),a.value=!0}),V=()=>g(this,null,function*(){if(m.value==="rich"){yield u.value.validate();const B=yield s.updateRichPage(d.value);yield s.load();const A=s.list.find(K=>K.id==B);A&&Ue(A,st),P(A)}else{yield n.value.validate();const B=yield s.updatePage(d.value);B.type!=="Designer"&&Ue(B,We),s.load(),P(B)}a.value=!1}),x=B=>g(this,null,function*(){yield xe(),yield s.deletePages([B])}),y=()=>{s.load(),r.load()},T=B=>{let A=se.resolve(ke({name:"inline-design",query:{path:B.path,access_token:v.get("jwt_token"),inline_design_lang:on(),scheme:localStorage.getItem("vueuse-color-scheme")}})).href;return A=un(S.site.baseUrl,A),A},L=C(!1),O=X(()=>{const B=[{show:!0,name:o("common.copyTitle"),invoke:A=>g(this,null,function*(){Ve(A.name)})},{show:!0,name:o("common.preview"),invoke:A=>g(this,null,function*(){const{onPreview:K}=we();K(A.previewUrl)})}];return L.value||B.push({show:!0,name:o("common.settings"),invoke:A=>g(this,null,function*(){St(se.resolve(ke({name:A.type==="RichText"?"rich-page-edit":A.layoutId===Z?"page-setting":"layout-page-setting",query:{id:A.id,layoutId:A.layoutId===Z?void 0:A.layoutId}})).href)})}),B.push({show:S.hasAccess("pages","edit"),name:o("common.inlineEditor"),invoke:A=>g(this,null,function*(){const{onPreview:K}=we();K(T(A))})}),B});function D(B,A){var K;L.value=A.type==="Designer",(K=b.value)==null||K.openMenu(B,A)}l({load:y});const P=He("updateTabModel");return(B,A)=>{var Ht;const K=be,ne=Vt,Le=Tt,yt=ye,gt=at("hasPermission");return f(),M(q,null,[k(re,{ref:"collapse",permission:"pages",title:p(o)("common.normalPage"),add:"","expand-default":!0,onOnAdd:h},{default:$(()=>[(f(!0),M(q,null,W(p(s).getNormalPage,z=>(f(),M(q,null,[z.children?(f(),U(Ne,{ref_for:!0,ref:"reSubMenu",key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[0]||(A[0]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[1]||(A[1]=Q=>x(Q)),onEdit:A[2]||(A[2]=Q=>I(Q.id,"normal")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,We),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"normal")},null,8,["onClick"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(o)("common.layoutPage"),"expand-default":!0,permission:"pages"},{bar:$(()=>[p(r).list.length?(f(),U(Le,{key:0,trigger:"click",onCommand:i,onVisibleChange:A[3]||(A[3]=z=>c.value=z)},{dropdown:$(()=>[(f(!0),M(q,null,W(p(r).list,z=>(f(),U(ne,{key:z.id,command:z.id},{default:$(()=>[Ae(J(z.name),1)]),_:2},1032,["command"]))),128))]),default:$(()=>[ie(k(K,{class:de(["iconfont icon-a-addto opacity-0 group-hover:opacity-100 hover:text-blue",c.value?"opacity-100":""])},null,8,["class"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:1})):j("",!0)]),default:$(()=>[(f(!0),M(q,null,W(p(s).getLayoutPage,z=>(f(),M(q,null,[z.children?(f(),U(Ne,{key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[4]||(A[4]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[5]||(A[5]=Q=>x(Q)),onEdit:A[6]||(A[6]=Q=>I(Q.id,"layout")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,We),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"layout")},null,8,["onClick"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(o)("common.richTextPage"),add:"","expand-default":!0,permission:"pages",onOnAdd:_},{default:$(()=>[(f(!0),M(q,null,W(p(s).getRichPage,z=>(f(),M(q,null,[z.children?(f(),U(Ne,{key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[7]||(A[7]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[8]||(A[8]=Q=>x(Q)),onEdit:A[9]||(A[9]=Q=>I(Q.id,"rich")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,st),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"rich")},null,8,["onClick"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:A[12]||(A[12]=H(()=>{},["stop"]))},[k(yt,{modelValue:a.value,"onUpdate:modelValue":A[11]||(A[11]=z=>a.value=z),width:"600px","close-on-click-modal":!1,title:((Ht=d.value)==null?void 0:Ht.id)==p(Z)?p(o)("common.newPage"):p(o)("common.editPage"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:V,onCancel:A[10]||(A[10]=z=>a.value=!1)})]),default:$(()=>[d.value?(f(),M("div",{key:0,onKeydown:ue(V,["enter"])},[p(m)==="rich"?(f(),U(fi,{key:0,ref_key:"richForm",ref:u,"old-url":w.value,"label-position":"top",model:d.value},null,8,["old-url","model"])):(f(),U(vi,{key:1,ref_key:"form",ref:n,"old-url-path":w.value,"label-position":"top",model:d.value},null,8,["old-url-path","model"]))],40,yi)):j("",!0)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:b,actions:p(O).filter(z=>z.show===!0)},null,8,["actions"])],64)}}});var wi=Object.freeze(Object.defineProperty({__proto__:null,define:gi,open:Ue,default:bi},Symbol.toStringTag,{value:"Module"}));const Po=oe.global.t,_i=()=>N.get(E("Script/External",!0)),ki=()=>N.get(E("Script/Embedded",!0)),hi=e=>N.get(E("Script/Get"),{id:e}),xi=e=>N.post(E("Script/Update"),e),Ci=e=>N.post(E("Script/Deletes"),{ids:e},void 0,{successMessage:Po("common.deleteSuccess")}),$i=e=>N.post(E("Upload/Script"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},successMessage:Po("common.uploadSuccess")}),Si=e=>N.get(E("Script/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Oo=oe.global.t,Fo=e=>N.get(E(`ResourceGroup/${e}`,!0)),Bo=e=>N.post(E("ResourceGroup/Update"),e,void 0,{successMessage:Oo("common.saveSuccess")}),qo=e=>N.post(E("ResourceGroup/Deletes"),{ids:e},void 0,{successMessage:Oo("common.deleteSuccess")}),Go=(e,l)=>N.get(E("ResourceGroup/isUniqueName"),{name:e,type:l},{hiddenLoading:!0,hiddenError:!0}),Ko=e=>N.get(E("ResourceGroup/Get"),{id:e}),Mt=Re("scriptStore",()=>{const e=ce(),l=F(),o=C([]),t=C([]),s=C([]),r=X(()=>{const i=[];return i.push(...o.value.map(_=>({id:_.id,name:_.name,href:_.routeName,fullPath:_.fullUrl}))),i.push(...t.value.map(_=>({id:_.id,name:_.name,href:_.relativeUrl,fullPath:_.previewUrl}))),i}),a=()=>g(void 0,null,function*(){o.value=yield _i()}),n=()=>g(void 0,null,function*(){t.value=yield Fo("Script")}),u=()=>g(void 0,null,function*(){s.value=yield ki()}),d=()=>{a(),n(),u()},c=i=>Ko(i),m=i=>g(void 0,null,function*(){yield Bo(i),n()}),w=i=>g(void 0,null,function*(){yield qo(i),l.deleteTabs(i),n()}),b=i=>g(void 0,null,function*(){const _=new FormData;_.append("file",i),yield $i(_),a()}),v=i=>g(void 0,null,function*(){const _=yield hi(i);return _.body||(_.body=""),_}),S=(i,_)=>g(void 0,null,function*(){i.enableDiffChecker=!0;const I=yield xi(i);return e.site.recordSiteLogVideo&&_&&(yield Be(I,_,i.isEmbedded)),Object.assign(i,yield v(I))}),h=i=>g(void 0,null,function*(){yield Ci(i),l.deleteTabs(i),d()});return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},()=>{o.value=[],s.value=[],t.value=[]}),{external:o,embedded:s,group:t,all:r,getGroup:c,updateGroup:m,deleteGroups:w,uploadScript:b,deleteScripts:h,getScript:v,updateScript:S,loadAll:d,loadEmbedded:u,loadExternal:a,loadGroups:n}}),Vi={key:0,class:"h-full"},Ti=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Mt(),r=F(),a=C(),n=Pe(),u=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getScript(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateScript(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),w=(b,v)=>g(this,null,function*(){yield d.promise,v?u.value.search(v,b):u.value.goToLine(b)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:w}),(b,v)=>a.value?(f(),M("div",Vi,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"javascript",uri:p(je).from({scheme:"memory",path:a.value.id}),onMonacoLoadComplete:v[1]||(v[1]=S=>p(r).addTabRecord(t.id,S,"javascript"))},null,8,["modelValue","uri"])])):j("",!0)}}),Mi={class:"p-24"},Ii={class:"flex items-center"},Ri={key:0,class:"w-100px !h-40px flex items-center justify-center"},Li=R("div",null,null,-1),Ho=G({props:{id:null,hiddenName:{type:Boolean}},emits:["save"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),r=Mt(),a=C(),n=C({id:t.id||Z,name:"",typeName:"Script",children:[]}),u=X(()=>n.value.id!==Z),d=()=>g(this,null,function*(){n.value=yield r.getGroup(n.value.id)}),c=X(()=>{const h=[];for(const i of r.external)n.value.children.some(_=>_.routeId===i.routeId)||h.push({name:i.name,routeId:i.routeId});return h}),m=X(()=>{const h={name:[_e(1,50),le(s("common.nameRequiredTips")),Te(),{asyncValidator(_,I,V){return g(this,null,function*(){try{yield Go(I,"script")}catch(x){V(Error(s("common.nameExist")))}})},trigger:"blur"}]};return u.value&&delete h.name,h}),w=()=>g(this,null,function*(){var h;yield(h=a.value)==null?void 0:h.validate(),yield r.updateGroup(n.value)}),b=h=>{const i=c.value.find(_=>_.routeId===h);i&&n.value.children.push(i)},v=h=>{const i=n.value.children.splice(h.oldIndex,1)[0];n.value.children.splice(h.newIndex,0,i)},S=h=>{const i=n.value.children.findIndex(_=>_.routeId===h);n.value.children.splice(i,1)};return n.value.id!==Z&&d(),l({save:w}),(h,i)=>{const _=me,I=pe,V=ve,x=be,y=lt,T=Vt,L=Ot,O=Tt;return f(),M("div",Mi,[e.hiddenName?j("",!0):(f(),U(V,{key:0,ref_key:"form",ref:a,"label-position":"top",model:n.value,rules:p(m),onSubmit:i[1]||(i[1]=H(()=>{},["prevent"])),onKeydown:i[2]||(i[2]=ue(D=>o("save"),["enter"]))},{default:$(()=>[k(I,{label:p(s)("common.name"),prop:"name"},{default:$(()=>[k(_,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value.name=D),disabled:p(u),"data-cy":"group-name"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),k(O,{trigger:"click",onCommand:b},{dropdown:$(()=>[Object.keys(p(c)).length==0?(f(),M("div",Ri,[R("span",null,J(p(s)("common.noData")),1)])):(f(),U(L,{key:1},{default:$(()=>[(f(!0),M(q,null,W(p(c),D=>(f(),U(T,{key:D.routeId,command:D.routeId,"data-cy":"script-opt"},{default:$(()=>[R("span",null,J(D.name),1)]),_:2},1032,["command"]))),128))]),_:1}))]),default:$(()=>[k(y,{round:"",class:"shadow-s-10 border-none","data-cy":"add-script"},{default:$(()=>[R("div",Ii,[R("span",null,J(p(s)("common.addScript")),1),k(x,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})])]),_:1})]),_:1}),k(mo,{class:"!px-0",list:n.value.children,"display-prop":"name","id-prop":"routeId",onSort:v,onDelete:S},{bottom:$(()=>[Li]),_:1},8,["list"])])}}}),Ui={class:"h-full"},Ei=G({props:{id:null},setup(e,{expose:l}){const o=C();return l({save:()=>g(this,null,function*(){o.value.save()})}),(s,r)=>(f(),M("div",Ui,[k(Ho,{id:e.id,ref_key:"inner",ref:o,"hidden-name":""},null,8,["id"])]))}}),Ni=G({props:{model:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),r=X(()=>({name:o.model.id!==Z?"":[_e(1,64),le(t("common.nameRequiredTips")),Te(),Ce(Si,t("common.scriptNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const u=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(r),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.scriptName"),prop:"name"},{default:$(()=>[k(u,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"script-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),Ai=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const{t:o}=Y(),t=C(!0),s=C(),r=()=>g(this,null,function*(){yield s.value.save(),t.value=!1});return(a,n)=>{const u=ye;return f(),M("div",{onClick:n[2]||(n[2]=H(()=>{},["stop"]))},[k(u,{"model-value":t.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:p(o)("common.scriptGroup"),onClosed:n[1]||(n[1]=d=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"script",action:"edit"},onConfirm:r,onCancel:n[0]||(n[0]=d=>t.value=!1)})]),default:$(()=>[k(Ho,{id:e.id,ref_key:"inner",ref:s,class:"p-32",onSave:r},null,8,["id"])]),_:1},8,["model-value","title"])])}}}),Di=["onKeydown"],tt=oe.global.t,ji={name:"scripts",icon:"icon-js",display:tt("common.script"),order:40,permission:"script",actions:[{name:"refresh",display:tt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:tt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"scripts"}))}}]},ht=e=>{const l=[{name:"save",visible:!1,display:tt("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",display:tt("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})}];e.ownerObjectId===Z&&l.push({name:"open",display:tt("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=Mt();let t=o.all.find(s=>s.id===e.id);if(t||(yield Promise.all([o.loadExternal(),o.loadGroups()]),t=o.all.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.fullPath)}})}),F().addTab({id:e.id,name:e.name,panel:Ti,icon:"icon-js",actions:l})},Pi=G({setup(e,{expose:l}){const{t:o}=Y(),t=Mt(),s=F(),r=C(!1),a=C(!1),n=C(),u=C(),d=C(),c=i=>{const _=[{name:"save",visible:!1,display:o("common.save"),icon:"icon-preservation",invoke:()=>g(this,null,function*(){var V,x;const I=yield(x=(V=F().activeTab)==null?void 0:V.panelInstance)==null?void 0:x.promise;!I||I.save()})}];i.previewUrl&&_.push({name:"open",display:o("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>{const{onPreview:I}=we();I(i.previewUrl)}}),s.addTab({id:i.id,name:i.name,panel:Ei,icon:"icon-js",actions:_})},m=()=>g(this,null,function*(){d.value={id:Z,name:"",body:"",extension:"js",isEmbedded:!1,ownerObjectId:void 0},r.value=!0}),w=()=>g(this,null,function*(){yield n.value.validate();const i=yield t.updateScript(d.value);ht(i),t.loadExternal(),r.value=!1}),b=i=>g(this,null,function*(){yield xe(),yield t.deleteScripts([i])}),v=i=>g(this,null,function*(){yield xe(),t.deleteGroups([i])}),S=()=>{t.loadAll()},h=X(()=>{var I,V,x,y,T,L;var i=[{name:o("common.copyTitle"),invoke:O=>g(this,null,function*(){Ve(O.name)})}],_=((V=(I=u.value)==null?void 0:I.payload)==null?void 0:V.fullUrl)||((y=(x=u.value)==null?void 0:x.payload)==null?void 0:y.previewUrl);return _&&!((L=(T=u.value)==null?void 0:T.payload)!=null&&L.isEmbedded)&&i.push({name:o("common.preview"),invoke:O=>g(this,null,function*(){const{onPreview:D}=we();D(_)})}),i});return l({load:S}),(i,_)=>{const I=ye;return f(),M("div",null,[k(re,{title:p(o)("common.external"),add:"","expand-default":!0,permission:"script",onOnAdd:m},{default:$(()=>[(f(!0),M(q,null,W(p(t).external,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>ht(V),onRemove:x=>b(V.id),onContextmenu:H(x=>{var y;return(y=u.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.embedded"),"expand-default":!0,permission:"script"},{default:$(()=>[(f(!0),M(q,null,W(p(t).embedded,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>ht(V),onRemove:x=>b(V.id),onContextmenu:H(x=>{var y;return(y=u.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.group"),add:"","expand-default":!0,permission:"script",onOnAdd:_[0]||(_[0]=V=>a.value=!0)},{default:$(()=>[(f(!0),M(q,null,W(p(t).group,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>c(V),onRemove:x=>v(V.id),onContextmenu:H(x=>{var y;return(y=u.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:_[3]||(_[3]=H(()=>{},["stop"]))},[k(I,{modelValue:r.value,"onUpdate:modelValue":_[2]||(_[2]=V=>r.value=V),width:"600px","close-on-click-modal":!1,title:p(o)("common.newScript"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:_[1]||(_[1]=V=>r.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(w,["enter"])},[d.value?(f(),U(Ni,{key:0,ref_key:"form",ref:n,"label-position":"top",model:d.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Di)]),_:1},8,["modelValue","title"])]),a.value?(f(),U(Ai,{key:0,modelValue:a.value,"onUpdate:modelValue":_[4]||(_[4]=V=>a.value=V)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:u,actions:p(h)},null,8,["actions"])])}}});var Oi=Object.freeze(Object.defineProperty({__proto__:null,define:ji,open:ht,default:Pi},Symbol.toStringTag,{value:"Module"}));const Fi={class:"highlight"},Bi={key:0,class:"active"},qi=G({props:{light:{default:()=>({background:"#f0c1a3",color:"#616161"})},dark:{default:()=>({background:"#595961",color:"#f8f8f2"})},keyword:null,text:null,maxLength:{default:16},pattern:{default:"all"},start:null,end:null},setup(e){const l=e;nn(n=>({"65c4ab22":l.dark.background,d61c1e22:l.dark.color,"5008cfec":l.light.background,"4ff6d9f2":l.light.color}));const o=C([]),t=C([]);function s(n,u){var d=new RegExp(u,"i"),c=n.search(d),m=[];return c!==-1?(m.push(n.substring(0,c)),m.push(n.substring(c+u.length))):m.push(n),m}function r(n,u){var d=new RegExp(u,"i"),c=n.match(d);return c?[c[0]]:[]}ee(()=>l,a,{immediate:!0,deep:!0});function a(){if(!!(l.text&&l.keyword)){if(l.start!==void 0){o.value=s(l.text,l.keyword),t.value=r(l.text,l.keyword);return}if(l.pattern==="first"){const n=l.text.match(new RegExp(l.keyword,"i"));if(n===null){o.value=[l.text];return}t.value=[n[0]];const u=l.text.slice(0,n.index),d=l.text.slice(n.index+l.keyword.length);if(n.index===0){o.value=["",d];return}let c=l.maxLength-l.keyword.length;if(c<0){o.value=["...",d];return}n.index<=c?o.value=[u,d]:o.value=["..."+u.slice(-c).slice(3),d]}else l.pattern==="all"&&(o.value=l.text.split(new RegExp(l.keyword,"i")),t.value=l.text.match(new RegExp(l.keyword,"ig")))}}return(n,u)=>(f(),M("span",Fi,[(f(!0),M(q,null,W(o.value,(d,c)=>{var m;return f(),M(q,{key:c},[R("span",null,J(d),1),c+1!==((m=o.value)==null?void 0:m.length)?(f(),M("span",Bi,J(t.value[c]),1)):j("",!0)],64)}),128))]))}}),Gi=(e,l,o)=>N.get(E("CodeSearch/Search"),{keyword:e,isRegex:l,ignoreCase:o}),Ki={class:"text-s px-8 py-4 flex items-center bg-gray/30 dark:bg-[#333] space-x-4 dark:text-fff/86"},Hi=["placeholder"],zi=["title"],Ji=["title"],Wi=["onClick"],Qi=["title"],Xi={key:1,class:"text-s text-999 break-all p-4","data-cy":"no-search-result"},lo=oe.global.t,Yi={name:"code search",icon:"icon-search",display:lo("common.search"),route:"layouts",order:85,permission:"code",actions:[{name:"refresh",display:lo("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).onSearch()})}}]},Zi=G({setup(e,{expose:l}){const o=He(vo),{t}=Y(),s=F(),r=qe(),a=De(),n=C(),u=C(""),d=C(""),c=()=>g(this,null,function*(){if(u.value=d.value.trim(),!u.value){b();return}if(r.isRegex)try{RegExp(u.value)}catch(h){return}n.value=yield Gi(u.value,r.isRegex,r.ignoreCase)}),m=dn(c,1e3);ee(()=>[d.value,r.ignoreCase,r.isRegex],()=>{m()});const w=(h,i)=>g(this,null,function*(){var V,x,y,T;const _={id:h.id,name:h.name,params:h.params,type:h.type};if(_.type==="Page"&&((V=_.params)==null?void 0:V.type)===3){const L=go(_.id,(x=_.params)==null?void 0:x.layout);St(se.resolve(L).href);return}o(_);const I=yield(T=(y=s.activeTab)==null?void 0:y.panelInstance)==null?void 0:T.promise;!(I!=null&&I.goToLine)||(i!==void 0?(I.goToLine(i,u.value),s.setActiveSearch(h.id+"-"+String(i))):(I.goToLine(1,u.value),s.setActiveSearch(h.id)))}),b=()=>{var h;u.value="",d.value="",n.value=void 0,(h=v.value)==null||h.focus()},v=C(),S=()=>{uo(()=>{var h,i;d.value?(h=v.value)==null||h.select():(i=v.value)==null||i.focus()})};return nt(S),ee(()=>a.query.activity,h=>{h==="code search"&&S()}),l({onSearch:c}),Fe("matchCase",()=>r.ignoreCase=!r.ignoreCase),Fe("useRegularExpression",()=>{r.isRegex=!r.isRegex}),(h,i)=>{var V,x;const _=be,I=qi;return f(),M("div",null,[R("div",Ki,[k(_,{class:"iconfont icon-search text-666 dark:text-fff/86"}),ie(R("input",{ref_key:"inputKeywordEl",ref:v,"onUpdate:modelValue":i[0]||(i[0]=y=>d.value=y),class:"outline-none w-full bg-transparent",placeholder:p(t)("common.inputKeyword"),"data-cy":"search",onClick:i[1]||(i[1]=H(()=>{},["stop"]))},null,8,Hi),[[so,d.value]]),R("span",{class:de(["cursor-pointer",{"text-blue":!p(r).ignoreCase}]),title:p(t)("common.matchCase"),onClick:i[2]||(i[2]=y=>p(r).ignoreCase=!p(r).ignoreCase)},"Aa",10,zi),R("span",{class:de(["cursor-pointer",{"text-blue":p(r).isRegex}]),title:p(t)("common.useRegularExpression"),onClick:i[3]||(i[3]=y=>p(r).isRegex=!p(r).isRegex)},".*",10,Ji),d.value?(f(),U(_,{key:0,class:"iconfont icon-delete5 text-666/50 dark:text-fff/50 cursor-pointer",onClick:b})):j("",!0)]),(V=n.value)!=null&&V.length?(f(!0),M(q,{key:0},W(n.value,y=>(f(),U(ae,{key:y.id,id:y.id,title:y.name,"ignore-search":"",permission:"search",onClick:T=>w(y)},{collapse:$(()=>[(f(!0),M(q,null,W(y.matched,T=>(f(),M("div",{key:T.lineNumber+T.summary,class:de(["cursor-pointer hover:bg-blue/30 px-8",p(s).activeSearch===y.id+"-"+String(T.lineNumber+1)?"bg-blue/30":""]),onClick:H(L=>w(y,T.lineNumber+1),["stop"])},[R("p",{class:"text-s text-666 ellipsis cursor-default select-none pointer-events-none",title:T.summary,"data-cy":"line-summary"},[Ae(J(T.lineNumber+1)+": ",1),k(I,{keyword:u.value,text:T.summary,pattern:"all",start:T.start,end:T.end},null,8,["keyword","text","start","end"])],8,Qi)],10,Wi))),128))]),_:2},1032,["id","title","onClick"]))),128)):((x=n.value)==null?void 0:x.length)===0?(f(),M("p",Xi,J(p(t)("common.searchResultEmpty",{keyword:u.value})),1)):j("",!0)])}}});var er=Object.freeze(Object.defineProperty({__proto__:null,define:Yi,default:Zi},Symbol.toStringTag,{value:"Module"}));const zo=oe.global.t,tr=()=>N.get(E("Style/External",!0)),or=()=>N.get(E("Style/Embedded",!0)),nr=e=>N.get(E("Style/Get"),{id:e}),ar=e=>N.post(E("Style/Update"),e),lr=e=>N.post(E("Style/Deletes"),{ids:e},void 0,{successMessage:zo("common.deleteSuccess")}),sr=e=>N.post(E("Upload/Style"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},successMessage:zo("common.uploadSuccess")}),ir=e=>N.get(E("Style/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),rr=oe.global.t,It=Re("styleStore",()=>{const e=ce(),l=F(),o=C([]),t=C([]),s=C([]),r=X(()=>{const i=[];return i.push(...o.value.map(_=>({id:_.id,name:_.name,href:_.routeName,fullPath:_.fullUrl}))),i.push(...t.value.map(_=>({id:_.id,name:_.name,href:_.relativeUrl,fullPath:_.previewUrl}))),i}),a=()=>g(void 0,null,function*(){o.value=yield tr()}),n=()=>g(void 0,null,function*(){t.value=yield Fo("Style")}),u=()=>g(void 0,null,function*(){s.value=yield or()}),d=()=>{a(),n(),u()},c=i=>Ko(i),m=i=>g(void 0,null,function*(){yield Bo(i),n()}),w=i=>g(void 0,null,function*(){yield qo(i),l.deleteTabs(i),n()}),b=i=>g(void 0,null,function*(){const _=i.name,I=new FormData;_.indexOf(".")>-1&&_.split(".").reverse()[0]==="css"?(I.append("file",i),yield sr(I),a()):co.error(rr("common.fileFormatIsIncorrect"))}),v=i=>g(void 0,null,function*(){const _=yield nr(i);return _.body||(_.body=""),_}),S=(i,_)=>g(void 0,null,function*(){i.enableDiffChecker=!0;const I=yield ar(i);return e.site.recordSiteLogVideo&&_&&(yield Be(I,_,i.isEmbedded)),Object.assign(i,yield v(I))}),h=i=>g(void 0,null,function*(){yield lr(i),l.deleteTabs(i),d()});return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},()=>{o.value=[],s.value=[],t.value=[]}),{external:o,group:t,embedded:s,all:r,getGroup:c,updateGroup:m,deleteGroups:w,uploadStyle:b,deleteStyles:h,getStyle:v,updateStyle:S,loadAll:d,loadEmbedded:u,loadExternal:a,loadGroups:n}}),ur={key:0,class:"h-full"},dr=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=It(),r=F(),a=C(),n=Pe(),u=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getStyle(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateStyle(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),w=(b,v)=>g(this,null,function*(){yield d.promise,v?u.value.search(v,b):u.value.goToLine(b)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:w}),(b,v)=>a.value?(f(),M("div",ur,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"css",uri:p(je).from({scheme:"memory",path:a.value.id}),onMonacoLoadComplete:v[1]||(v[1]=S=>p(r).addTabRecord(t.id,S,"css"))},null,8,["modelValue","uri"])])):j("",!0)}});const cr={class:"p-24"},mr={class:"flex items-center"},pr={key:0,class:"w-100px !h-40px flex items-center justify-center dark:text-fff/86"},vr=R("div",null,null,-1),Jo=G({props:{id:null,hiddenName:{type:Boolean}},emits:["save"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),r=It(),a=C(),n=C({id:t.id||Z,name:"",typeName:"Style",children:[]}),u=X(()=>n.value.id!==Z),d=()=>g(this,null,function*(){n.value=yield r.getGroup(n.value.id)}),c=X(()=>{const h=[];for(const i of r.external)n.value.children.some(_=>_.routeId===i.routeId)||h.push({name:i.name,routeId:i.routeId});return h}),m=X(()=>{const h={name:[_e(1,50),Te(),le(s("common.nameRequiredTips")),{asyncValidator(_,I,V){return g(this,null,function*(){try{yield Go(I,"style")}catch(x){V(Error(s("common.nameExist")))}})},trigger:"blur"}]};return u.value&&delete h.name,h}),w=()=>g(this,null,function*(){var h;yield(h=a.value)==null?void 0:h.validate(),yield r.updateGroup(n.value)}),b=h=>{const i=c.value.find(_=>_.routeId===h);i&&n.value.children.push(i)},v=h=>{const i=n.value.children.splice(h.oldIndex,1)[0];n.value.children.splice(h.newIndex,0,i)},S=h=>{const i=n.value.children.findIndex(_=>_.routeId===h);n.value.children.splice(i,1)};return n.value.id!==Z&&d(),l({save:w}),(h,i)=>{const _=me,I=pe,V=ve,x=be,y=lt,T=Vt,L=Ot,O=Tt;return f(),M("div",cr,[e.hiddenName?j("",!0):(f(),U(V,{key:0,ref_key:"form",ref:a,"label-position":"top",model:n.value,rules:p(m),onSubmit:i[1]||(i[1]=H(()=>{},["prevent"])),onKeydown:i[2]||(i[2]=ue(D=>o("save"),["enter"]))},{default:$(()=>[k(I,{label:p(s)("common.name"),prop:"name"},{default:$(()=>[k(_,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value.name=D),disabled:p(u),"data-cy":"group-name"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),k(O,{trigger:"click",onCommand:b},{dropdown:$(()=>[Object.keys(p(c)).length==0?(f(),M("div",pr,[R("span",null,J(p(s)("common.noData")),1)])):(f(),U(L,{key:1,class:"styleDropdownMenu"},{default:$(()=>[(f(!0),M(q,null,W(p(c),D=>(f(),U(T,{key:D.routeId,command:D.routeId,"data-cy":"style-opt"},{default:$(()=>[R("span",null,J(D.name),1)]),_:2},1032,["command"]))),128))]),_:1}))]),default:$(()=>[k(y,{round:"",class:"shadow-s-10 border-none","data-cy":"add-style"},{default:$(()=>[R("div",mr,[R("span",null,J(p(s)("common.addStyle")),1),k(x,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})])]),_:1})]),_:1}),k(mo,{class:"!px-0",list:n.value.children,"display-prop":"name","id-prop":"routeId",onSort:v,onDelete:S},{bottom:$(()=>[vr]),_:1},8,["list"])])}}}),fr={class:"h-full bg-fff dark:bg-[#141414]"},yr=G({props:{id:null},setup(e,{expose:l}){const o=C();return l({save:()=>g(this,null,function*(){o.value.save()})}),(s,r)=>(f(),M("div",fr,[k(Jo,{id:e.id,ref_key:"inner",ref:o,"hidden-name":""},null,8,["id"])]))}}),gr=G({props:{model:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),r=X(()=>({name:o.model.id!==Z?"":[_e(1,64),le(t("common.nameRequiredTips")),Te(),Ce(ir,t("common.styleNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const u=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(r),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.styleName"),prop:"name"},{default:$(()=>[k(u,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"style-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),br=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const{t:o}=Y(),t=C(!0),s=C(),r=()=>g(this,null,function*(){yield s.value.save(),t.value=!1});return(a,n)=>{const u=ye;return f(),M("div",{onClick:n[2]||(n[2]=H(()=>{},["stop"]))},[k(u,{"model-value":t.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:p(o)("common.styleGroup"),onClosed:n[1]||(n[1]=d=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"style",action:"edit"},onConfirm:r,onCancel:n[0]||(n[0]=d=>t.value=!1)})]),default:$(()=>[k(Jo,{id:e.id,ref_key:"inner",ref:s,onSave:r},null,8,["id"])]),_:1},8,["model-value","title"])])}}}),wr={class:"font-bold dark:text-fff/86"},_r=R("div",{class:"flex-1"},null,-1),kr={class:"font-bold dark:text-fff/86"},hr=R("div",{class:"flex-1"},null,-1),xr={class:"flex items-center w-full"},Cr={class:"font-bold text-666 flex-1"},$r={key:0,class:"border-l-2 border-blue/50 pl-8"},Sr={class:"flex items-center w-full"},Vr={class:"text-666 flex-1"},Tr={class:"flex items-center w-full"},Mr={class:"text-666 flex-1"},Ir={class:"flex items-center w-full"},Rr={class:"font-bold text-666 flex-1"},Lr={key:1,class:"border-l-2 border-blue/50 pl-8"},Ur={class:"text-666"},Er={class:"text-s"},Nr={class:"text-666"},Ar={class:"text-s"},Dr=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const o=ce(),t=C(JSON.parse(JSON.stringify(o.site))),{t:s}=Y(),r=C(!0),a=C(),n=()=>g(this,null,function*(){if(t.value.unocssSettings.enable)try{JSON.parse(t.value.unocssSettings.config),u()}catch(d){co.error(s("common.codeFormatIsIncorrect"));return}else u()}),u=()=>g(this,null,function*(){yield pn(t.value),o.loadSite(),o.loadSites(),r.value=!1});return(d,c)=>{const m=Ft,w=pe,b=he,v=me,S=ve,h=ye;return f(),U(h,{"model-value":r.value,width:"800px","close-on-click-modal":!1,title:p(s)("common.style"),onClosed:c[11]||(c[11]=i=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:n,onCancel:c[10]||(c[10]=i=>r.value=!1)})]),default:$(()=>[k(S,{ref_key:"form",ref:a,"label-position":"top",onKeydown:ue(n,["enter"])},{default:$(()=>[k(w,null,{default:$(()=>[R("span",wr,J(p(s)("common.JsCssCompression")),1),_r,k(m,{modelValue:t.value.enableJsCssCompress,"onUpdate:modelValue":c[0]||(c[0]=i=>t.value.enableJsCssCompress=i),"data-cy":"js-css-compress"},null,8,["modelValue"])]),_:1}),k(w,null,{default:$(()=>[R("span",kr,J(p(s)("common.JsCssBrowserCache")),1),hr,k(m,{modelValue:t.value.enableJsCssBrowerCache,"onUpdate:modelValue":c[1]||(c[1]=i=>t.value.enableJsCssBrowerCache=i),"data-cy":"js-css-cache"},null,8,["modelValue"])]),_:1}),k(w,null,{default:$(()=>[R("div",xr,[R("span",Cr,J(p(s)("settings.atomicCss")),1),k(m,{modelValue:t.value.unocssSettings.enable,"onUpdate:modelValue":c[2]||(c[2]=i=>t.value.unocssSettings.enable=i)},null,8,["modelValue"])])]),_:1}),t.value.unocssSettings.enable?(f(),M("div",$r,[k(w,null,{default:$(()=>[R("div",Sr,[R("span",Vr,J(p(s)("settings.disableSsr")),1),k(m,{modelValue:t.value.unocssSettings.disableSsr,"onUpdate:modelValue":c[3]||(c[3]=i=>t.value.unocssSettings.disableSsr=i)},null,8,["modelValue"])])]),_:1}),k(w,null,{default:$(()=>[R("div",Tr,[R("span",Mr,J(p(s)("settings.resetDefaultStyle")),1),k(m,{modelValue:t.value.unocssSettings.resetStyle,"onUpdate:modelValue":c[4]||(c[4]=i=>t.value.unocssSettings.resetStyle=i)},null,8,["modelValue"])])]),_:1}),k(w,null,{default:$(()=>[R("div",{class:"h-300px w-full",onKeydown:c[6]||(c[6]=H(()=>{},["stop"]))},[k(b,{modelValue:t.value.unocssSettings.config,"onUpdate:modelValue":c[5]||(c[5]=i=>t.value.unocssSettings.config=i),language:"json"},null,8,["modelValue"])],32)]),_:1})])):j("",!0),k(w,null,{default:$(()=>[R("div",Ir,[R("span",Rr,J(p(s)("common.enableCssSplitByMedia")),1),k(m,{modelValue:t.value.enableCssSplitByMedia,"onUpdate:modelValue":c[7]||(c[7]=i=>t.value.enableCssSplitByMedia=i)},null,8,["modelValue"])])]),_:1}),t.value.enableCssSplitByMedia?(f(),M("div",Lr,[k(w,{class:"w-800px"},{default:$(()=>[R("div",null,[R("p",Ur,J(p(s)("common.maxWidthForMobileBrowser")),1),R("p",Er," ("+J(p(s)("common.maxWidthForMobileBrowserDetail"))+") ",1)]),k(v,{modelValue:t.value.mobileMaxWidth,"onUpdate:modelValue":c[8]||(c[8]=i=>t.value.mobileMaxWidth=i),class:"w-500px","data-cy":"max-width"},null,8,["modelValue"])]),_:1}),k(w,{class:"w-900px"},{default:$(()=>[R("div",null,[R("p",Nr,J(p(s)("common.minWidthForDesktopBrowser")),1),R("p",Ar," ("+J(p(s)("common.minWidthForDesktopBrowserDetail"))+") ",1)]),k(v,{modelValue:t.value.desktopMinWidth,"onUpdate:modelValue":c[9]||(c[9]=i=>t.value.desktopMinWidth=i),class:"w-500px","data-cy":"min-width"},null,8,["modelValue"])]),_:1})])):j("",!0)]),_:1},8,["onKeydown"])]),_:1},8,["model-value","title"])}}}),jr=["onKeydown"],Ge=oe.global.t,Pr={name:"styles",icon:"icon-css",display:Ge("common.style"),order:30,permission:"style",actions:[{name:"settings",display:Ge("common.settings"),icon:"icon-a-setup",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).showSettings()})}},{name:"refresh",display:Ge("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ge("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"styles"}))}}]},xt=e=>{const l=[{name:"save",visible:!1,display:Ge("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",display:Ge("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})}];e.ownerObjectId===Z&&l.push({name:"open",display:Ge("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=It();let t=o.all.find(s=>s.id===e.id);if(t||(yield Promise.all([o.loadExternal(),o.loadGroups()]),t=o.all.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.fullPath)}})}),F().addTab({id:e.id,name:e.name,panel:dr,icon:"icon-css",actions:l})},Or=G({setup(e,{expose:l}){const{t:o}=Y(),t=It(),s=F(),r=C(!1),a=C(!1),n=C(!1),u=C(),d=C(),c=C(),m=I=>{const V=[{name:"save",visible:!1,display:o("common.save"),icon:"icon-preservation",invoke:()=>g(this,null,function*(){var y,T;const x=yield(T=(y=F().activeTab)==null?void 0:y.panelInstance)==null?void 0:T.promise;!x||x.save()})}];I.previewUrl&&V.push({name:"open",display:o("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>{const{onPreview:x}=we();x(I.previewUrl)}}),s.addTab({id:I.id,name:I.name,panel:yr,icon:"icon-css",actions:V})},w=()=>g(this,null,function*(){c.value={id:Z,name:"",body:"",extension:"css",isEmbedded:!1,ownerObjectId:void 0},r.value=!0}),b=()=>g(this,null,function*(){yield u.value.validate();const I=yield t.updateStyle(c.value);xt(I),t.loadExternal(),r.value=!1}),v=I=>g(this,null,function*(){yield xe(),yield t.deleteStyles([I])}),S=I=>g(this,null,function*(){yield xe(),t.deleteGroups([I])}),h=()=>{t.loadAll()},i=X(()=>{var x,y,T,L,O,D;var I=[{name:o("common.copyTitle"),invoke:P=>g(this,null,function*(){Ve(P.name)})}],V=((y=(x=d.value)==null?void 0:x.payload)==null?void 0:y.fullUrl)||((L=(T=d.value)==null?void 0:T.payload)==null?void 0:L.previewUrl);return V&&!((D=(O=d.value)==null?void 0:O.payload)!=null&&D.isEmbedded)&&I.push({name:o("common.preview"),invoke:P=>g(this,null,function*(){const{onPreview:B}=we();B(V)})}),I});function _(){n.value=!0}return l({load:h,showSettings:_}),(I,V)=>{const x=ye;return f(),M("div",null,[k(re,{title:p(o)("common.external"),add:"","expand-default":!0,permission:"style",onOnAdd:w},{default:$(()=>[(f(!0),M(q,null,W(p(t).external,y=>(f(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:T=>xt(y),onRemove:T=>v(y.id),onContextmenu:H(T=>{var L;return(L=d.value)==null?void 0:L.openMenu(T,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.embedded"),"expand-default":!0,permission:"style"},{default:$(()=>[(f(!0),M(q,null,W(p(t).embedded,y=>(f(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:T=>xt(y),onRemove:T=>v(y.id),onContextmenu:H(T=>{var L;return(L=d.value)==null?void 0:L.openMenu(T,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.group"),add:"","expand-default":!0,permission:"style",onOnAdd:V[0]||(V[0]=y=>a.value=!0)},{default:$(()=>[(f(!0),M(q,null,W(p(t).group,y=>(f(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:T=>m(y),onRemove:T=>S(y.id),onContextmenu:H(T=>{var L;return(L=d.value)==null?void 0:L.openMenu(T,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:V[3]||(V[3]=H(()=>{},["stop"]))},[k(x,{modelValue:r.value,"onUpdate:modelValue":V[2]||(V[2]=y=>r.value=y),width:"600px","close-on-click-modal":!1,title:p(o)("common.newStyle"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:b,onCancel:V[1]||(V[1]=y=>r.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(b,["enter"])},[c.value?(f(),U(gr,{key:0,ref_key:"form",ref:u,"label-position":"top",model:c.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,jr)]),_:1},8,["modelValue","title"])]),a.value?(f(),U(br,{key:0,modelValue:a.value,"onUpdate:modelValue":V[4]||(V[4]=y=>a.value=y)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:d,actions:p(i)},null,8,["actions"]),n.value?(f(),U(Dr,{key:1,modelValue:n.value,"onUpdate:modelValue":V[5]||(V[5]=y=>n.value=y)},null,8,["modelValue"])):j("",!0)])}}});var Fr=Object.freeze(Object.defineProperty({__proto__:null,define:Pr,open:xt,default:Or},Symbol.toStringTag,{value:"Module"}));const Wo=oe.global.t,Br=()=>N.get(E("View/list",!0)),qr=e=>N.post(E("View/Deletes"),{ids:e},void 0,{successMessage:Wo("common.deleteSuccess")}),$d=(e,l)=>N.post(E("View/Copy"),{id:e,name:l},void 0,{successMessage:Wo("common.copySuccess")}),Gr=e=>N.get(E("View/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Kr=e=>N.post(E("View/post"),e),Hr=e=>N.get(E("View/get"),{id:e}),Kt=Re("viewStore",()=>{const e=ce(),l=F(),o=C([]),t=X(()=>l.getSplitNameData(o.value)),s=()=>g(void 0,null,function*(){o.value=yield Br()}),r=u=>g(void 0,null,function*(){yield qr(u),l.deleteTabs(u),s()}),a=u=>g(void 0,null,function*(){u=u||Z;const d=yield Hr(u);return d.body||(d.body=""),d.id=u,d}),n=(u,d)=>g(void 0,null,function*(){u.enableDiffChecker=!0;const c=yield Kr(u);return e.site.recordSiteLogVideo&&d&&(yield Be(c,d)),Object.assign(u,yield a(c))});return ee(()=>{var u;return(u=e.site)==null?void 0:u.id},()=>{o.value=[]}),{load:s,list:o,deleteViews:r,getView:a,updateView:n,getViews:t}}),zr={key:0,class:"h-full"},Jr=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Kt(),r=F(),a=C(),n=Pe(),u=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getView(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateView(a.value,r.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),w=(b,v)=>g(this,null,function*(){yield d.promise,v?u.value.search(v,b):u.value.goToLine(b)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:w}),(b,v)=>a.value?(f(),M("div",zr,[k(he,{ref_key:"editor",ref:u,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:v[1]||(v[1]=S=>p(r).addTabRecord(t.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Wr=G({props:{model:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),r=Ee(()=>({name:o.model.id!==Z?[]:[Te(),_e(1,50),le(t("common.nameRequiredTips")),Ce(Gr,t("common.viewNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const u=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(r),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.viewName"),prop:"name"},{default:$(()=>[k(u,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"view-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),Qr=["onKeydown"],ot=oe.global.t,Xr={name:"views",icon:"icon-view",display:ot("common.view"),route:"views",order:10,permission:"view",actions:[{name:"refresh",display:ot("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:ot("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"views"}))}}]},Ct=e=>{F().addTab({id:e.id,name:e.name,panel:Jr,icon:"icon-view",actions:[{name:"save",visible:!1,display:ot("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.save()})},{name:"refresh",visible:!0,display:ot("common.refresh"),icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.load()})},{name:"open",display:ot("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const l=Kt();let o=l.list.find(t=>t.id===e.id);if(o||(yield l.load(),o=l.list.find(t=>t.id===e.id)),o){const{onPreview:t}=we();t(o.preview)}})}]})},Yr=G({setup(e,{expose:l}){const{t:o}=Y(),t=Kt(),s=C(!1),r=C(),a=C(),n=C(),u=()=>g(this,null,function*(){a.value=yield t.getView(),s.value=!0}),d=()=>g(this,null,function*(){yield r.value.validate();const b=yield t.updateView(a.value);Ct(b),t.load(),s.value=!1}),c=b=>g(this,null,function*(){yield xe(),yield t.deleteViews([b])}),m=()=>{t.load()},w=[{name:o("common.copyTitle"),invoke:b=>g(this,null,function*(){Ve(b.name)})},{name:o("common.preview"),invoke:b=>g(this,null,function*(){const{onPreview:v}=we();v(b.preview)})}];return l({load:m}),(b,v)=>{const S=ye;return f(),M("div",null,[k(re,{title:p(o)("common.list"),add:"","expand-default":!0,permission:"view",onOnAdd:u},{default:$(()=>[(f(!0),M(q,null,W(p(t).getViews,h=>(f(),M(q,null,[h.children?(f(),U(Ne,{key:h.folderName+h.floor,data:h,permission:"view",onClickHandle:v[0]||(v[0]=i=>Ct(i)),onRemove:v[1]||(v[1]=i=>c(i)),onClickContextMenu:i=>{var _;return(_=n.value)==null?void 0:_.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:h.id,key:h.id,permission:"view",title:h.name,name:h.name,padding:12+h.floor*6,remove:"",onClick:i=>Ct(h),onRemove:i=>c(h.id),onContextmenu:H(i=>{var _;return(_=n.value)==null?void 0:_.openMenu(i,h)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:v[4]||(v[4]=H(()=>{},["stop"]))},[k(S,{modelValue:s.value,"onUpdate:modelValue":v[3]||(v[3]=h=>s.value=h),width:"600px","close-on-click-modal":!1,title:p(o)("common.newView"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:d,onCancel:v[2]||(v[2]=h=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(d,["enter"])},[a.value?(f(),U(Wr,{key:0,ref_key:"form",ref:r,"label-position":"top",model:a.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Qr)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:n,actions:w},null,512)])}}});var Zr=Object.freeze(Object.defineProperty({__proto__:null,define:Xr,open:Ct,default:Yr},Symbol.toStringTag,{value:"Module"}));function eu(e,l,o){let t=0,s=[],r=null;const a=ce();e===""&&(e=Date.now().toString());function n(m,w){l=m,o=w,u()}function u(){!a.site.recordSiteLogVideo||!l||!o||(t=0,s=[],r=new Dn(e,l,o),r.bindStoreCallback(m=>{m.order=t++,s.push(m)}),r.open(),r.on())}function d(){return r==null||r.dispose(),r=null,s}function c(){var w;const m=s;if(t=0,s=[],r==null||r.open(),m.length){const b=(w=m.find(v=>v.type==="Open"))==null?void 0:w.text;return typeof b!="string"||b===(l==null?void 0:l.getValue())?"":JSON.stringify(m)}else return""}return{bindMonaco:n,on:u,off:d,save:c}}const Et={"../views/dev-mode/side-panels/code-panel.vue":Ea,"../views/dev-mode/side-panels/debug-panel.vue":bl,"../views/dev-mode/side-panels/form-panel.vue":Bl,"../views/dev-mode/side-panels/layout-panel.vue":Yl,"../views/dev-mode/side-panels/menu-panel.vue":Os,"../views/dev-mode/side-panels/module-panel.vue":ui,"../views/dev-mode/side-panels/page-panel.vue":wi,"../views/dev-mode/side-panels/script-panel.vue":Oi,"../views/dev-mode/side-panels/search-panel.vue":er,"../views/dev-mode/side-panels/style-panel.vue":Fr,"../views/dev-mode/side-panels/view-panel.vue":Zr},F=Re("devModeStore",()=>{const e=C([]),l=C(),o=ce(),t=C([]),s=C(),r=C(""),a={},n=(y,T,L)=>{var O,D;if(y){for(let P=0;P<y.length;P++)if(((O=y[P].name)==null?void 0:O.toLocaleLowerCase())===(T==null?void 0:T.toLocaleLowerCase())&&((D=y[P].folderName)==null?void 0:D.toLocaleLowerCase())===(T==null?void 0:T.toLocaleLowerCase()))return y[P].children;return y.push({name:T,folderName:T,children:[],floor:L+1}),y[y.length-1].children}},u=y=>{var T;return(T=y.reduce((L,O)=>{const D=O.name.split(".").filter(B=>B!=="");if(D.length>1&&["html","css","js","ts"].includes(D[D.length-1].toLowerCase())){const B=D.pop();D[D.length-1]=D[D.length-1]+"."+B}let P=L;for(let B=0;B<D.length-1;B++)P=n(P,D[B],B);return P&&P.push(Oe(ge({},O),{tabName:D[D.length-1],floor:D.length?D.length:1})),L},[]))==null?void 0:T.sort((L,O)=>L.id&&!O.id?1:!L.id&&O.id?-1:0)},d=X(()=>e.value.find(y=>y.id.startsWith(Ye))),c=y=>{y.panelInstance=new $e,y.id.startsWith(Ye)?w(y):m(y)},m=y=>{const T=e.value.find(L=>L.id===y.id);T?l.value=T:(y.panel=Rt(y.panel),e.value.push(y),l.value=y)},w=y=>g(void 0,null,function*(){d.value?(l.value=d.value,(yield l.value.panelInstance.promise).load(y.id.replace(Ye,""))):(y.panel=Rt(y.panel),e.value.push(y),l.value=y)}),b=y=>{const T=e.value.find(O=>O.id===y);if(!T)return;const L=e.value.findIndex(O=>O.id===T.id);T===l.value&&(l.value=e.value[L===0?1:L-1]),e.value.splice(L,1),x(y)},v=y=>{for(const T of y)b(T)},S=()=>g(void 0,null,function*(){e.value=[],t.value=[];const y=[];s.value=void 0,l.value=void 0,yield uo();for(const T in Et){const L=Et[T].define;L&&(L.permission==="debug"?o.hasAccess("code","debug"):o.hasAccess(L.permission))&&y.push(Oe(ge({},JSON.parse(JSON.stringify(L))),{actions:L.actions,panel:Rt(Et[T].default),panelInstance:new $e}))}t.value=y.sort((T,L)=>T.order-L.order),s.value=t.value[0]}),h=()=>g(void 0,null,function*(){if(!s.value)return;const y=yield s.value.panelInstance.promise;y.load&&y.load()}),i=(y,T)=>g(void 0,null,function*(){const L=t.value.find(O=>O.name===y);!L||(s.value=L,s.value.init||(s.value.init=!0,yield h()),y==="modules"&&se.currentRoute.value.query.activity==="modules"&&T?(se.push(ke({name:"dev-mode",query:{activity:"modules"}})),Se().exitEditModule()):se.replace({name:se.currentRoute.value.name,query:Oe(ge({},se.currentRoute.value.query),{activity:y})}))}),_=y=>{r.value=y},I=(y,T,L)=>{e.value.find(D=>D.id===y)&&(a[y]=eu(y,T,L),a[y].on())},V=y=>{var T;return((T=a[y])==null?void 0:T.save())||""},x=y=>{var T;(T=a[y])==null||T.off(),delete a[y]};return ee(()=>{var y;return(y=o.site)==null?void 0:y.id},S,{immediate:!0}),{tabs:e,activeTab:l,addTab:c,deleteTab:b,deleteTabs:v,debugTab:d,activities:t,activeActivity:s,selectActivity:i,activeSearch:r,setActiveSearch:_,getSplitNameData:u,loadActivePanel:h,addTabRecord:I,saveTabRecord:V,removeTabRecord:x}});export{Ai as $,dd as A,Se as B,Fs as C,la as D,td as E,Zu as F,ed as G,eu as H,Ks as I,vi as J,It as K,Mt as L,id as M,Uo as N,ci as O,jo as P,fi as Q,Cd as R,di as S,Kt as T,$d as U,Mo as V,jl as W,Do as X,Ds as Y,Is as Z,he as _,ft as a,br as a0,Dr as a1,qe as a2,Gi as a3,Jl as a4,Wr as a5,Ll as a6,Ni as a7,gr as a8,Va as a9,Nt as aa,Me as ab,ei as ac,Zs as ad,ut as ae,dt as af,Ct as ag,_t as ah,kt as ai,xt as aj,ht as ak,Ue as al,st as am,We as an,Gt as b,ad as c,nd as d,vd as e,cd as f,od as g,yd as h,Gr as i,pd as j,gd as k,kd as l,fd as m,wd as n,bd as o,Ro as p,_d as q,md as r,Io as s,hd as t,F as u,sd as v,ld as w,xd as x,ud as y,rd as z};
