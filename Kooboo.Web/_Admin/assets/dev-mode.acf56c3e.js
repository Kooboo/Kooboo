var Xo=Object.defineProperty,Yo=Object.defineProperties;var Zo=Object.getOwnPropertyDescriptors;var zt=Object.getOwnPropertySymbols;var en=Object.prototype.hasOwnProperty,tn=Object.prototype.propertyIsEnumerable;var Jt=(e,l,t)=>l in e?Xo(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,ge=(e,l)=>{for(var t in l||(l={}))en.call(l,t)&&Jt(e,t,l[t]);if(zt)for(var t of zt(l))tn.call(l,t)&&Jt(e,t,l[t]);return e},Oe=(e,l)=>Yo(e,Zo(l));var g=(e,l,t)=>new Promise((o,s)=>{var u=r=>{try{n(t.next(r))}catch(d){s(d)}},a=r=>{try{n(t.throw(r))}catch(d){s(d)}},n=r=>r.done?o(r.value):Promise.resolve(r.value).then(u,a);n((t=t.apply(e,l)).next())});import{w as H,d as oe,g as Y,v as Qe,o as ue,p as so,C as on,Y as nn,Q as an}from"./i18n.a87944a4.js";import{d as G,N as De,g as C,a4 as ln,h as nt,aX as io,i as ee,b8 as at,o as v,a as T,f as R,b as k,n as de,t as J,r as Ke,e as ie,j as U,k as j,m as $t,c as X,C as He,u as p,K as At,ce as Ee,w as $,b7 as W,F as q,aI as Ae,cf as sn,O as Dt,aW as rn,aA as ro,cd as un,cg as St,A as dn,ch as cn,L as uo,E as Rt}from"./url.4cb47a7a.js";import{E as be}from"./windi.6360286d.js";import{d as N,e as mn,f as Re,u as ce,r as se,D as Ye,g as pn,E as co,h as vn}from"./main.9fdfea92.js";import{a as E,C as $e,i as Wt,u as ke}from"./replace-all.56d2c1f7.js";import{e as Z,n as jt}from"./guid.c1a40312.js";import{u as Fe}from"./use-shortcuts.ff4b1f52.js";import{E as mo}from"./index.fd96ea36.js";import{m as te,M as Pt,D as fn,k as yn,P as gn,_ as bn}from"./userWorker.b3a6730b.js";import{o as po,a as wn,c as vo}from"./config.1e73f9c3.js";import{d as fo}from"./dark.9459c47b.js";import{u as we,g as yo,l as _n,a as kn}from"./page.881ec888.js";import{E as Vt,a as Ot,b as Tt}from"./index.c86a187b.js";import{c as Ve}from"./use-copy-text.ec245a13.js";import{s as Be}from"./index.269bf65e.js";import{g as hn,a as xn,u as Cn,b as $n}from"./monaco.c080bc0a.js";import{b as Sn,a as Qt}from"./extraLib.d94bb2b4.js";import{d as Vn}from"./style.c350d462.js";import{U as je}from"./editor.main.d2800f63.js";import{u as Pe}from"./use-save-tip.e3dc783a.js";import{r as _e,a as le,s as Te,i as Ce,l as go}from"./validate.bb56f9e3.js";import{E as me}from"./index.178b9e08.js";import{E as pe,a as ve}from"./index.9fd79879.js";import{b as xe}from"./confirm.b60b5d2f.js";import{_ as fe}from"./index.f0d5f031.js";import{E as Ft}from"./index.6918f0a5.js";import{E as bo,a as wo}from"./index.f15f695e.js";import{E as Bt,b as Tn,a as qt,c as Mn}from"./index.7c862087.js";import{E as ye}from"./index.c003dfa1.js";import{_ as Xe}from"./icon-button.74ccc970.js";import{V as _o}from"./vuedraggable.umd.af323a53.js";import{E as lt}from"./index.361e2245.js";import{_ as In}from"./index.f154d010.js";import{G as Rn}from"./index.b9a74c44.js";import{_ as ko}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Ln}from"./index.79632b7d.js";import{E as Un}from"./index.99e769ef.js";import{_ as En}from"./alert.d2815716.js";import{E as ho}from"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import{I as Nn}from"./image-editor.a4ae94b1.js";import{_ as xo}from"./index.0e5d639d.js";import{M as An}from"./main.esm.e26794cb.js";import{g as Dn}from"./index.16f227d6.js";const jn={class:"group-collapse"},Pn={class:"flex-1","data-cy":"folder"},On={class:"transition-all opacity-0 flex items-center space-x-8"},re=G({props:{title:null,add:{type:Boolean},expandDefault:{type:Boolean},permission:null},emits:["onAdd"],setup(e){const l=e,t=De(),o=C(l.expandDefault||!1),s=C(),u=C();let a;const n=()=>g(this,null,function*(){var d;const r=u.value?`${(d=u.value)==null?void 0:d.scrollHeight}px`:void 0;r!==s.value&&(s.value=r,o.value=!0)});return ln(n),nt(()=>{a=new MutationObserver(n),a.observe(u.value,{childList:!0,subtree:!0})}),io(()=>{a==null||a.disconnect()}),ee(()=>t.query.activity,()=>{n()}),(r,d)=>{const c=be,m=at("hasPermission");return v(),T("div",jn,[R("div",{class:"h-26px flex items-center px-12 text-s bg-gray/60 dark:bg-[#333] dark:text-fff/86 space-x-8 not-last:border-b not-last:border-solid not-last:border-gray/50 not-last:dark:border-opacity-20 cursor-pointer",onClick:d[2]||(d[2]=H(_=>o.value=!o.value,["stop"]))},[k(c,{class:de(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",o.value?"rotate-180 ":"rotate-0"]),"data-cy":"expand"},null,8,["class"]),R("span",Pn,J(e.title),1),R("div",{class:"flex items-center space-x-8 collapse-bar",onClick:d[1]||(d[1]=H(()=>{},["stop"]))},[R("div",On,[Ke(r.$slots,"bar"),e.add?ie((v(),U(c,{key:0,class:"iconfont icon-a-addto hover:text-blue","data-cy":"add",onClick:d[0]||(d[0]=_=>r.$emit("onAdd"))},null,512)),[[m,{feature:e.permission,action:"edit",effect:"hiddenIcon"}]]):j("",!0)])])]),R("div",{style:$t({height:o.value?s.value:"0px"}),class:"overflow-hidden transition-all duration-200"},[R("div",{ref_key:"body",ref:u},[Ke(r.$slots,"default")],512)],4)])}}}),Fn=oe.global.t,Bn=e=>N.get(E("Code/ListByType",!0),{codeType:e}),qn=()=>N.get(E("Code/CodeType")),Gn=(e,l)=>N.get(E("Code/GetEdit"),{codeType:e,id:l}),Kn=e=>N.get(E("Code/GetByName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Hn=e=>N.post(E("Code/post"),e),zn=e=>N.post(E("Code/Deletes"),{ids:e},void 0,{successMessage:Fn("common.deleteSuccess")}),Jn=e=>N.get(E("Code/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Wn=()=>N.get(E("Debugger/GetSession"),void 0,{hiddenLoading:!0,hiddenError:!0}),Xt=()=>N.get(E("Debugger/StartSession"),void 0,{hiddenLoading:!0}),Qn=e=>N.post(E("Debugger/SetBreakPoint"),e,void 0,{hiddenLoading:!0}),Ie=e=>N.get(E("Debugger/Step"),{action:e},{hiddenLoading:!0}),Xn=e=>N.post(E("Debugger/execute"),{jsStatement:e},void 0,{hiddenLoading:!0}),pt=oe.global.t,Co=()=>N.get(E("ScriptModule/list",!0)),Yn=e=>N.post(E("ScriptModule/create"),{name:e},void 0,{successMessage:pt("common.createSuccess")}),Zn=e=>N.post(E("ScriptModule/Deletes"),{ids:e},void 0,{successMessage:pt("common.deleteSuccess")}),ld=(e,l)=>N.post(E("ScriptModule/UpdateStatus"),{moduleId:e,status:l}),ea=()=>N.get(E("ScriptModule/ResourceType")),sd=e=>{mn.get(E("/ScriptModule/export"),{params:{name:e},responseType:"blob",timeout:1e3*60*30}).then(l=>{Vn(l)})},ta=e=>N.post(E("/ScriptModule/Import"),e,void 0,{timeout:1e3*60*30,hiddenLoading:!0,hiddenError:!0,successMessage:pt("common.importSuccess"),errorMessage:pt("common.importFailed"),keepShowErrorMessage:!0}),id=e=>N.post(E("ScriptModule/share"),{id:e},void 0,{successMessage:pt("common.shareSuccess")}),$o=oe.global.t,oa=e=>N.get(E("ModuleFiles/AllFiles"),{moduleid:e}),So=(e,l,t,o)=>N.post(E("ModuleFiles/UpdateText"),{moduleid:l,folder:"/",fileName:t,content:o,objectType:e}),Vo=(e,l,t,o)=>N.post(E("ModuleFiles/UpdateBinary"),{moduleid:l,folder:"/",fileName:t,base64:o,objectType:e},void 0,{hiddenError:!0,successMessage:$o("common.uploadSuccess")}),na=(e,l,t)=>N.post(E("ModuleFiles/Remove"),{moduleid:l,fileName:t,folder:"/",objectType:e},void 0,{successMessage:$o("common.deleteSuccess")}),aa=(e,l,t)=>N.post(E("ModuleFiles/GetText"),{moduleid:l,fileName:t,folder:"/",objectType:e}),la=(e,l,t)=>N.post(E("ModuleFiles/GetTextByName"),{moduleName:l,fileName:t,folder:"/",objectType:e},void 0,{hiddenError:!0,hiddenLoading:!0}),sa=oe.global.t,Se=Re("moduleStore",()=>{const e=ce(),l=De(),t=F(),o=C([]),s=C([]),u=C(),a=C([]),n=C(!1);e.site&&ea().then(i=>s.value=i);const r=()=>g(void 0,null,function*(){if(u.value){const i=yield oa(u.value);a.value=i.map(b=>Oe(ge({},b),{id:`${u.value}_${b.objectType}_${b.fullName}`}))}else o.value=yield Co(),n.value=!0}),d=(i,b)=>g(void 0,null,function*(){yield So(b.name,u.value,i," "),yield r()}),c=(i,b,I)=>g(void 0,null,function*(){yield Vo(I.name,u.value,i,b),r()}),m=(i,b)=>g(void 0,null,function*(){var I;if(yield na(b,u.value,i),b=="code"){const V=(I=o.value.find(y=>y.id==u.value))==null?void 0:I.name,x=te.editor.getModel(je.parse(`file:///node_modules/@types/module:${V}/${i}.ts`));x&&x.dispose()}r()}),_=i=>g(void 0,null,function*(){yield Zn(i),Pt(),r()}),w=i=>g(void 0,null,function*(){yield Yn(i),r()}),f=i=>{var b;if(u.value=i,t.activeActivity){const I=(b=t.activeActivity.actions)==null?void 0:b.find(V=>V.name==="back");I&&(I.visible=!0)}a.value=[],r()},S=()=>{var i;if(n.value=!1,u.value=void 0,t.activeActivity){t.activeActivity.panelDisplay=sa("common.modules");const b=(i=t.activeActivity.actions)==null?void 0:i.find(I=>I.name==="back");b&&(b.visible=!1)}a.value=[]},h=()=>{S(),r()};return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},S),ee(()=>l==null?void 0:l.query.moduleId,S),{load:r,list:o,createModule:w,deleteModules:_,types:s,editingModule:u,editModule:f,files:a,createModuleFile:d,deleteModuleFile:m,uploadModuleFile:c,exitEditModule:h,reset:S,modulesInitialized:n}}),qe=Re("codeStore",()=>{const e=ce(),l=F(),t=C(),o=C(!1),s=C(!0),u=C({}),a=C([]),n=C(!1),r=X(()=>{const f={};for(const S in u.value)f[S]=l.getSplitNameData(a.value.filter(h=>h.codeType.toLowerCase()===(S==null?void 0:S.toLowerCase())));return f}),d=()=>g(void 0,null,function*(){!e.site||(a.value=yield Bn("all"),n.value=!0)}),c=f=>g(void 0,null,function*(){yield zn(f);for(const S of f){const h=a.value.find(i=>i.id==S);if(h){const i=te.editor.getModel(je.file(`${h.name||h.id}.ts`));i&&i.dispose()}}l.deleteTabs(f),d()}),m=(f,S)=>g(void 0,null,function*(){f.url||(f.url=""),f.enableDiffChecker=!0;const h=yield Hn(f);return e.site.recordSiteLogVideo&&S&&(yield Be(h,S,f.isEmbedded)),Object.assign(f,yield _(h))}),_=(f,S,h)=>g(void 0,null,function*(){var I,V;f=f!=null?f:Z;const i=yield Gn(S||"all",f),b={id:i.id,name:i.name||"",body:i.body||"",config:i.config,url:i.url,eventType:i.eventType||h,codeType:i.codeType||S,version:i.version,scriptType:i.scriptType,isEmbedded:i.isEmbedded,isDecrypted:i.isDecrypted};return((I=b.codeType)==null?void 0:I.toLowerCase())==="event"&&!b.eventType&&(b.eventType="RouteFinding"),((V=b.codeType)==null?void 0:V.toLowerCase())==="api"&&!b.url&&(b.url=""),b});return ee(()=>{var f;return(f=e.site)==null?void 0:f.id},()=>{a.value=[],n.value=!1,Se().reset(),Pt()}),e.hasAccess("code","view")&&qn().then(f=>u.value=f),{types:u,codes:a,codesInitialized:n,deleteCodes:c,updateCode:m,getCode:_,loadCodes:d,keywords:t,scriptTypes:[{key:"Classic",value:"Classic"},{key:"Module",value:"Module"}],ignoreCase:s,isRegex:o,codesByType:r}}),ia={key:0},ra=["title"],ua={class:"ml-8px ellipsis flex-1","data-cy":"file-name"},da={class:"pl-12 pr-4"},ae=G({props:{id:null,icon:null,title:null,remove:{type:Boolean},ignoreSearch:{type:Boolean},permission:null,padding:null,hasExpandRow:{type:Boolean},name:null},emits:["remove"],setup(e){const l=e,t=F(),o=De(),s=X(()=>{var n;return o.query.activity==="code search"?t.activeSearch===l.id:((n=t.activeTab)==null?void 0:n.id)===l.id}),u=He("keyword"),a=X(()=>{var n;return(n=l.name)!=null?n:l.title});return(n,r)=>{const d=be,c=at("hasPermission");return e.ignoreSearch||!p(u)||p(a).toLowerCase().indexOf(p(u).toLowerCase())>-1?(v(),T("div",ia,[R("div",{class:de(["group cursor-pointer h-26px flex items-center text-s space-x-4 group hover:bg-blue/30 pr-12",p(s)?"bg-blue/20 dark:text-fff/86":"dark:text-fff/60"]),title:e.title,style:$t(e.hasExpandRow?{paddingLeft:e.padding+"px"}:{paddingLeft:"18px"})},[k(d,{class:de(["iconfont",e.icon||"icon-code3"])},null,8,["class"]),R("div",ua,J(e.title),1),R("div",{class:de(["transition-all ease-in-out opacity-0 group-hover:opacity-100 space-x-8",p(s)?"opacity-100":""]),onClick:r[1]||(r[1]=H(()=>{},["stop"]))},[Ke(n.$slots,"default"),e.remove?ie((v(),U(d,{key:0,class:"iconfont icon-delete hover:text-orange","data-cy":"delete",onClick:r[0]||(r[0]=m=>n.$emit("remove"))},null,512)),[[c,{feature:e.permission,action:"delete",effect:"hiddenIcon"}]]):j("",!0)],2)],14,ra),R("div",da,[Ke(n.$slots,"collapse")])])):j("",!0)}}});var ca=`interface AlertOptions {\r
  title: string;\r
  body: string;\r
  width: string;\r
}\r
\r
interface CurrentMail {\r
  send: () => void;\r
  saveDraft: () => void;\r
  cancel: () => void;\r
  alert: (options: AlertOptions) => void;\r
  subject: string;\r
  to: string;\r
  html: string;\r
  from: string;\r
  dark: boolean;\r
  onDark: (value: boolean) => void;\r
}\r
\r
namespace KScript {\r
  declare interface k {\r
    currentMail: CurrentMail;\r
  }\r
}\r
\r
// declare const currentMail: CurrentMail;\r
`;let Yt=!1,To=!1,it={},rt={};const ma=["indexeddb","mysql","sqlserver","sqlite","mongo","sql","localdatabase","localsqlite"],pa=[".find('",".findall('",".query('",".orderby('",".orderbydescending('",".where('"],va=[">",">=","<","<=","=","==","!=","contains","startwith"],fa=[".skip(",".take(",".count("];function ya(e,l){let t=l.lineNumber;for(;t>0;){const o=e.getValueInRange({startLineNumber:t,startColumn:e.getLineFirstNonWhitespaceColumn(t),endLineNumber:t,endColumn:e.getLineFirstNonWhitespaceColumn(t)+1}),s=e.getValueInRange({startLineNumber:t-1,startColumn:e.getLineLastNonWhitespaceColumn(t===1?1:t-1),endLineNumber:t-1,endColumn:e.getLineLastNonWhitespaceColumn(t===1?1:t-1)+1});if(o==="."||s===".")t--;else break}return e.getValueInRange({startLineNumber:t,startColumn:1,endLineNumber:l.lineNumber,endColumn:l.column})}function Zt(e){return e.map(function(l){return{label:l,kind:te.languages.CompletionItemKind.Property,documentation:l,insertText:l,preselect:!0}})}function ga(e){To=e,it={},rt={},!Yt&&(Yt=!0,te.languages.registerCompletionItemProvider("typescript",{triggerCharacters:['"',"'","`"," ","(","."],provideCompletionItems(o,s){return g(this,null,function*(){return{suggestions:yield eo(o,s)}})}}),te.languages.registerCompletionItemProvider("html",{triggerCharacters:['"',"'","`"," ","(","."],provideCompletionItems(o,s){return g(this,null,function*(){const u=o.getLanguageIdAtPosition(s.lineNumber,s.column),a={suggestions:[]};return u=="javascript"&&(a.suggestions=yield eo(o,s)),a})}}))}function eo(e,l){return g(this,null,function*(){if(!To)return[];let t=ya(e,l).replace(/\s+/g,"").toLowerCase();const o=ma.find(a=>bt(t,["k.db."+a,"k.module."+a]));if(!o)return[];if(!it[o]){const a=Se();it[o]=yield hn(o,a.editingModule)}if(to(t,[`k.db.${o}.`,`k.module.${o}.`]))return Zt(it[o]);t=t.replace(/\"+/g,"'").replace(/\`+/g,"'");const s=it[o].find(function(a){return bt(t,[`k.db.${o}.${a}`,`k.module.${o}.${a}`,`k.db.${o}.gettable('${a}')`,`k.module.${o}.gettable('${a}')`])});if(!s)return[];const u=`${o}_${s}`;if(!rt[u]){const a=Se();rt[u]=yield xn(o,s,a.editingModule)}if(bt(t,pa)&&!bt(t,fa)){const a=to(t,rt[u].map(n=>n.toLowerCase()));return Zt(a?va:rt[u])}return[]})}function bt(e,l){for(const t of l)if(e.indexOf(t)>-1)return!0}function to(e,l){for(const t of l)if(e.endsWith(t))return!0}let oo=!1;function ba(){oo||(oo=!0,te.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"http://www.kooboo.com/module-setting-schema.json",fileMatch:["*/module.config"],schema:{type:"object",properties:{name:{type:"string"},version:{type:"string"},description:{type:"string"},settingDefines:{type:"array",items:{$ref:"http://www.kooboo.com/module-setting-define-schema.json"}},setting:{type:"object"}},required:["name","version"]}},{uri:"http://www.kooboo.com/module-setting-define-schema.json",schema:{type:"object",properties:{name:{type:"string"},type:{enum:["input","textarea","switch","number","select"]},defaultValue:{type:["string","number","null","boolean"]},description:{type:"string"},options:{type:"array",items:{type:["string","number","boolean"]}},display:{type:"string"}},required:["name","type"]}}]}))}const wa=e=>N.post(E("Route/Resolve"),{url:e}),_a=e=>N.get(E("Route/ListByType"),{type:e}),ka=(e,l,t)=>N.get(E("Route/IsUniqueName"),{name:e,oldName:l,objId:t},{hiddenLoading:!0,hiddenError:!0});let Lt;function ha(e,l,t){if(!Lt){const o=e._codeEditorService.doOpenEditor.bind(e._codeEditorService);Lt=(s,u)=>{if(o(s,u),typeof l!="function"&&typeof t!="function")return;const{path:a,query:n}=u.resource,r=`${a}${n?"?"+n:""}`;wa(a).then(d=>{d?typeof l=="function"&&l(d):typeof t=="function"&&t(r)}).catch(()=>{typeof t=="function"&&t(r)})}}return Lt}function xa(e,l,t){const o=e;o._codeEditorService.doOpenEditor=ha(o,l,t).bind(o._codeEditorService)}const he=G({props:{modelValue:null,language:null,kScript:{type:Boolean},kmail:{type:Boolean},options:null,uri:null,module:{type:Boolean}},emits:["update:modelValue","monacoLoadComplete"],setup(e,{expose:l,emit:t}){const o=e,s=C(),u=jt();let a,n;const r=new $e,d=ce(),c=qe(),m=Se(),_=F(),w=He(po),f=He(wn);l({focus:()=>g(this,null,function*(){yield r.promise,n==null||n.focus()}),goToLine:M=>g(this,null,function*(){var D,P;yield r.promise;const L=M||((D=n==null?void 0:n.getModel())==null?void 0:D.getLineCount())||0,O=((P=n==null?void 0:n.getModel())==null?void 0:P.getLineLength(L))||0;n==null||n.revealLineInCenter(L),n==null||n.setPosition({column:O+1,lineNumber:L}),n==null||n.focus()}),goto:M=>g(this,null,function*(){yield r.promise,n==null||n.setSelection(M),n==null||n.revealRangeInCenter(M)}),search:(M,L)=>g(this,null,function*(){var P,B;yield r.promise;let O;const D=(B=(P=n==null?void 0:n.getModel())==null?void 0:P.findMatches(M,!1,!1,!1,null,!1))==null?void 0:B.map(A=>(Number.isInteger(L)&&!O&&A.range.startLineNumber===L&&(O=A.range),{selectionStartLineNumber:A.range.startLineNumber,selectionStartColumn:A.range.startColumn,positionLineNumber:A.range.endLineNumber,positionColumn:A.range.endColumn}));O?(n==null||n.setSelection(O),n==null||n.revealRangeInCenter(O)):(D&&(n==null||n.setSelections(D)),D&&(n==null||n.revealLineInCenter(D[0].selectionStartLineNumber))),n==null||n.focus()}),format:()=>g(this,null,function*(){var M;yield(M=n==null?void 0:n.getAction("editor.action.formatDocument"))==null?void 0:M.run()}),replace:M=>g(this,null,function*(){var L=n==null?void 0:n.getSelection();if(!!L){var O=new te.Range(L.startLineNumber,L.startColumn,L.endLineNumber,L.endColumn);n==null||n.executeEdits("",[{range:O,text:M}])}})}),ee(()=>o.modelValue,()=>{var M;a&&a.getValue()!==o.modelValue&&a.setValue((M=o.modelValue)!=null?M:"")}),fn(()=>g(this,null,function*(){var M,L,O,D,P;if((L=(M=_.activeTab)==null?void 0:M.params)!=null&&L.moduleId){const B=(P=(D=(O=_.activeTab)==null?void 0:O.params)==null?void 0:D.file)==null?void 0:P.name;return m.files.filter(A=>A.objectType=="code"&&A.name!=B).map(A=>`./${A.name}`)}else{const B=c.codes.filter(K=>K.codeType=="CodeBlock").map(K=>`./${K.name}`),A=m.list.map(K=>`module:${K.name}`);return[...B,...A]}}));const x=["JSON","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","parseFloat","parseInt"];bn((M,L,O)=>(L==null?void 0:L.type)=="attribute"&&L.start==L.end?{suggestions:[],snippet:!1}:(L==null?void 0:L.type)!="content"&&(L==null?void 0:L.type)!="attribute"?{suggestions:O,snippet:!0}:{suggestions:O.filter(P=>{var A,K;if(P.kind=="keyword"||P.name=="globalThis"||P.name=="undefined"||P.name=="Vue")return!1;if(x.includes(P.name))return!0;var B=((A=P.kindModifiers)==null?void 0:A.indexOf("declare"))>-1;return!(((K=P.kindModifiers)==null?void 0:K.indexOf("deprecated"))>-1||B&&P.sortText==="15"&&(P.kind=="var"||P.kind=="module"||P.kind=="class"||P.kind=="function"))}),snippet:!1}),nt(()=>g(this,null,function*(){var D,P,B;d.site&&(yn(A=>g(this,null,function*(){let K=te.Uri.parse(A).path;if(K=K.substring(1,K.length-3),!K)throw new Error("empty path");if(K.startsWith("node_modules")){K=K.split("module:")[1];const ne=K.split("/")[0];let Le=K.split("/")[1];return yield la("code",ne,Le)}else return(yield Kn(K)).body})),c.codesInitialized||c.loadCodes(),m.modulesInitialized||m.load());let M="";o.kScript&&(M=yield Cn()),o.language=="html"&&(yield $n());let L=o.uri;typeof L=="string"&&(L=te.Uri.parse(L)),L||(L=te.Uri.from({scheme:"memory",path:u})),a=te.editor.getModel(L),a?a.setValue((D=o.modelValue)!=null?D:""):a=te.editor.createModel((P=o.modelValue)!=null?P:"",o.language,L);function O(A,K){A=="javascript"&&Wt(K)&&K.length>10&&setTimeout(()=>{te.editor.setModelLanguage(a,"json")},1e3),o.language=="javascript"&&A=="json"&&(!Wt(K)||!(K!=null&&K.trim()))&&setTimeout(()=>{te.editor.setModelLanguage(a,"javascript")},1e3)}a.onDidChangeContent(()=>{const A=a.getValue(),K=a.getLanguageId();O(K,A),t("update:modelValue",A)}),n=te.editor.create(s.value,Oe(ge(ge({},vo),o.options),{model:a})),O(o.language,(B=o.modelValue)!=null?B:""),ga(o.kScript),ba(),Sn(n),o.kScript&&Qt(M,"default.d.ts"),o.kmail&&Qt(ca,"kmail.d.ts"),xa(n,w,f),t("monacoLoadComplete",n),r.resolve(null)})),At(()=>{!a||(a.uri.scheme=="memory"&&a.dispose(),a.uri.toString()=="file:///00000000-0000-0000-0000-000000000000"&&a.dispose())});let y;return ee(()=>d.site,()=>{var M,L;if(!((L=(M=d.site)==null?void 0:M.unocssSettings)!=null&&L.enable)){y&&y();return}y=gn(JSON.parse(d.site.unocssSettings.config))},{immediate:!0,deep:!0}),ee(fo,M=>te.editor.setTheme(M?"vs-dark":"vs"),{immediate:!0}),(M,L)=>(v(),T("div",{ref_key:"container",ref:s,class:"w-full h-full min-h-300px min-w-400px monaco-editor bg-fff"},null,512))}}),Ca={key:0,class:"h-full relative"},$a={key:0,class:"absolute inset-0 flex items-center justify-center"},Sa=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,{t:s}=Y(),u=qe(),a=F(),n=C(),r=Pe((i,b)=>{if(!((i==="url"||i==="scriptType")&&b))return b}),d=C(!1),c=C(),m=new $e,_=()=>g(this,null,function*(){n.value=yield u.getCode(o.id),m.resolve(null),r.init(n.value)}),w=()=>g(this,null,function*(){!n.value||n.value.isDecrypted||(yield u.updateCode(n.value,a.saveTabRecord(o.id)),r.init(n.value),t("changed",!1),t("setAction","save",{visible:!1}))}),f=i=>g(this,null,function*(){!n.value||(n.value.url=i.url,n.value.scriptType=i.scriptType)}),S=(i,b)=>g(this,null,function*(){yield m.promise,b?c.value.search(b,i):c.value.goToLine(i)});ee(()=>n.value,()=>{t("changed",r.changed(n.value)),t("setAction","save",{visible:r.changed(n.value)})},{deep:!0}),_(),l({save:w,load:_,config:d,goToLine:S,updateModel:f});const h=X(()=>{if(!!n.value)return`${n.value.name||n.value.id}.ts`});return At(()=>{if(!h.value)return;const i=te.editor.getModel(te.Uri.file(h.value)),b=r.getValue();i&&b&&i.setValue(JSON.parse(b).body)}),(i,b)=>{const I=ho;return n.value?(v(),T("div",Ca,[n.value.isDecrypted?(v(),T("div",$a,[k(I,{icon:"error",title:p(s)("common.codeEncryptedTip")},null,8,["title"])])):(v(),U(he,{key:1,ref_key:"editor",ref:c,modelValue:n.value.body,"onUpdate:modelValue":b[0]||(b[0]=V=>n.value.body=V),language:"typescript",uri:p(te).Uri.file(p(h)),"k-script":"",onMonacoLoadComplete:b[1]||(b[1]=V=>p(a).addTabRecord(o.id,V,"typescript"))},null,8,["modelValue","uri"]))])):j("",!0)}}}),Va=G({props:{model:null,editMode:{type:Boolean}},setup(e,{expose:l}){const t=e,o=qe(),{t:s}=Y(),u=C(),a=Ee(()=>({name:t.editMode?[]:[_e(1,50),le(s("common.nameRequiredTips")),Te(),Ce(Jn,s("common.codeNameExistsTips"))],url:[le(s("common.urlRequiredTips"))]})),n=c=>{t.model&&!t.model.url&&(t.model.url=`/${c}`)},r=C();nt(()=>g(this,null,function*(){var c;if(((c=t.model.codeType)==null?void 0:c.toLocaleLowerCase())==="event"){const m=yield Dn();r.value=[...new Set(m.map(_=>_.category))].map(_=>({category:_,events:m.filter(w=>w.category===_)}))}}));const d=C(!1);return ee(()=>t.model.url,c=>{d.value||t.editMode||(t.model.name=sn(c))}),l({validate:()=>{var c;return(c=u.value)==null?void 0:c.validate()}}),(c,m)=>{const _=me,w=pe,f=Bt,S=Tn,h=qt,i=bo,b=wo,I=ve;return e.model?(v(),U(I,{key:0,ref_key:"form",ref:u,model:e.model,rules:p(a),onSubmit:m[5]||(m[5]=H(()=>{},["prevent"]))},{default:$(()=>{var V;return[k(w,{label:p(s)("common.codeName"),prop:"name"},{default:$(()=>[k(_,{modelValue:e.model.name,"onUpdate:modelValue":m[0]||(m[0]=x=>e.model.name=x),class:"min-w-300px",disabled:e.editMode,title:e.model.name,"data-cy":"code-name",onChange:n,onInput:m[1]||(m[1]=x=>d.value=!0)},null,8,["modelValue","disabled","title"])]),_:1},8,["label"]),((V=e.model.codeType)==null?void 0:V.toLocaleLowerCase())==="api"?(v(),U(w,{key:0,label:"URL",prop:"url"},{default:$(()=>[k(_,{modelValue:e.model.url,"onUpdate:modelValue":m[2]||(m[2]=x=>e.model.url=x),class:"min-w-300px","data-cy":"url"},null,8,["modelValue"])]),_:1})):j("",!0),r.value?(v(),U(w,{key:1},{default:$(()=>[k(h,{modelValue:e.model.eventType,"onUpdate:modelValue":m[3]||(m[3]=x=>e.model.eventType=x),class:"min-w-300px w-full",disabled:e.editMode,"default-first-option":""},{default:$(()=>[(v(!0),T(q,null,W(r.value,x=>(v(),U(S,{key:x.category,label:x.category},{default:$(()=>[(v(!0),T(q,null,W(x.events,y=>(v(),U(f,{key:y.name,label:y.name,value:y.name},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):j("",!0),!(e.model.codeType=="PageScript"&&e.model.isEmbedded)&&e.model.codeType!="CodeBlock"?(v(),U(w,{key:2,label:p(s)("common.scriptType")},{default:$(()=>[k(b,{modelValue:e.model.scriptType,"onUpdate:modelValue":m[4]||(m[4]=x=>e.model.scriptType=x),class:"el-radio-group--rounded"},{default:$(()=>[(v(!0),T(q,null,W(p(o).scriptTypes,x=>(v(),U(i,{key:x.key,label:x.key,"data-cy":x.key},{default:$(()=>[Ae(J(x.value),1)]),_:2},1032,["label","data-cy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):j("",!0)]}),_:1},8,["model","rules"])):j("",!0)}}}),Me=G({props:{actions:null},setup(e,{expose:l}){const t=C(),o=C(!1),s=C(0),u=C(0),a=C();return l({openMenu:(r,d)=>{var c=o.value;o.value=!0,u.value=r.clientY,s.value=r.clientX,t.value=d,setTimeout(()=>{a.value.click(),c&&setTimeout(()=>{o.value=!0,setTimeout(()=>{a.value.click()})},0)},0)},payload:t}),(r,d)=>{const c=Vt,m=Ot,_=Tt;return o.value?(v(),T("div",{key:0,style:$t({top:u.value-2+"px",left:s.value-32+"px"}),class:"fixed"},[k(_,{trigger:"click",onCommand:d[1]||(d[1]=w=>w.invoke(t.value)),onVisibleChange:d[2]||(d[2]=w=>o.value=w)},{dropdown:$(()=>[k(m,null,{default:$(()=>[(v(!0),T(q,null,W(e.actions,w=>(v(),U(c,{key:w.name,command:w},{default:$(()=>[Ae(J(w.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:$(()=>[R("div",{ref_key:"trigger",ref:a,class:"w-64 h-8",onContextmenu:d[0]||(d[0]=H(()=>{},["stop","prevent"]))},null,544)]),_:1})],4)):j("",!0)}}}),Ta=G({setup(e){const l=C(!0);return(t,o)=>(v(),T("div",null,[R("div",{onClick:o[0]||(o[0]=H(s=>l.value=!l.value,["stop"]))},[Ke(t.$slots,"name",{flag:l.value})]),ie(R("div",null,[Ke(t.$slots,"default")],512),[[Qe,l.value]])]))}}),Ma=["title"],Ia={class:"hidden"},Ne=G({props:{data:null,showEdit:{type:Boolean},showSetting:{type:Boolean},permission:null,hiddenRemove:null},emits:["click-handle","remove","click-contextMenu","edit","setting"],setup(e,{emit:l}){const t=De(),o=He("keyword"),s=u=>!(u!=null&&u.children)||(u==null?void 0:u.children.length)===0?u.name.toLowerCase():s(u==null?void 0:u.children[0]);return(u,a)=>{const n=be,r=be,d=Dt("ReSubMenu",!0),c=at("hasPermission");return v(),T("div",null,[k(Ta,null,{name:$(({flag:m})=>{var _;return[p(o)&&s(e.data).includes((_=p(o))==null?void 0:_.toLowerCase())||!p(o)?(v(),T("div",{key:0,class:"h-26px border-b-1 border-gray dark:border-b-1 dark:border-999 flex items-center space-x-12 cursor-pointer pr-12 text-12px dark:text-fff/60",style:$t({paddingLeft:12+e.data.floor*6+"px"})},[k(n,{class:de(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",m?"rotate-180 ":"rotate-0"])},null,8,["class"]),R("span",{class:"ellipsis leading-26px",title:e.data.name},J(e.data.name),9,Ma),R("span",Ia,J(m),1)],4)):j("",!0)]}),default:$(()=>[(v(!0),T(q,null,W(e.data.children,m=>(v(),T(q,null,[m.children?(v(),U(d,{key:m.folderName,data:m,permission:e.permission,"hidden-remove":e.hiddenRemove,"show-edit":e.showEdit,"show-setting":e.showSetting,onRemove:a[0]||(a[0]=_=>l("remove",_)),onClickHandle:a[1]||(a[1]=_=>l("click-handle",_)),onEdit:a[2]||(a[2]=_=>l("edit",_)),onClickContextMenu:a[3]||(a[3]=_=>l("click-contextMenu",_))},null,8,["data","permission","hidden-remove","show-edit","show-setting"])):(v(),U(ae,{id:m.id,key:m.id,title:m.tabName,name:m.name,remove:!e.hiddenRemove,permission:e.permission,"has-expand-row":!0,padding:12+m.floor*6,onClick:_=>l("click-handle",m),onRemove:_=>l("remove",m.id),onContextmenu:H(_=>l("click-contextMenu",{event:_,item:m}),["prevent","stop"])},{default:$(()=>[e.showEdit?ie((v(),U(r,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:_=>l("edit",m)},null,8,["onClick"])),[[c,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]]):j("",!0),e.showSetting?(v(),U(n,{key:1,class:"iconfont icon-a-setup hover:text-blue",onClick:_=>l("setting",m.id)},null,8,["onClick"])):j("",!0)]),_:2},1032,["id","title","name","remove","permission","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1})])}}}),Ra=["onKeydown"],Ze=oe.global.t,La={name:"code",icon:"icon-code",display:Ze("common.code"),route:"code",order:25,permission:"code",actions:[{name:"refresh",display:Ze("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ze("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"code"}))}}]},ut=e=>{const l=[{name:"save",display:Ze("common.save"),visible:!1,icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.save()})},{name:"refresh",display:Ze("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.load()})}];e.codeType==="Api"&&l.push({name:"open",display:Ze("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const t=qe();let o=t.codes.find(s=>s.id===e.id);if(o||(yield t.loadCodes(),o=t.codes.find(s=>s.id===e.id)),o){const{onPreview:s}=we();s(o.previewUrl)}})}),F().addTab({id:e.id,name:e.name,panel:Sa,icon:"icon-code",actions:l})},Ua=G({setup(e,{expose:l}){const{t}=Y(),o=De(),s=qe(),u=C(!1),a=C(),n=C(),r=C(),d=C(),c=()=>g(this,null,function*(){yield s.loadCodes()}),m=i=>g(this,null,function*(){a.value=i,n.value=yield s.getCode(void 0,i.key),u.value=!0}),_=()=>g(this,null,function*(){yield r.value.validate();const i=yield s.updateCode(n.value);ut(i),s.loadCodes(),h(i),u.value=!1}),w=i=>g(this,null,function*(){yield xe(),yield s.deleteCodes([i])}),f=(i,b)=>g(this,null,function*(){a.value=b,n.value=yield s.getCode(i,b.key),u.value=!0}),S=X(()=>{var b,I;var i=[{name:t("common.copyTitle"),invoke:V=>g(this,null,function*(){Ve(V.name)})}];return((I=(b=d.value)==null?void 0:b.payload)==null?void 0:I.codeType)=="Api"&&i.push({name:t("common.preview"),invoke:V=>g(this,null,function*(){const{onPreview:x}=we();x(V.previewUrl)})}),i});l({load:c});const h=He("updateTabModel");return(i,b)=>{var y,M,L;const I=be,V=ye,x=at("hasPermission");return v(),T("div",null,[(v(!0),T(q,null,W(p(s).types,(O,D)=>(v(),U(re,{key:D,permission:"code",title:O,add:"","expand-default":!0,onOnAdd:P=>m({key:D,value:O})},{default:$(()=>[D==="pageScript"?(v(!0),T(q,{key:0},W(p(s).codes.filter(P=>P.codeType==="PageScript"),P=>(v(),U(ae,{id:P.id,key:P.id,title:P.name,name:P.name,remove:"",permission:"code",onClick:B=>ut(P),onRemove:B=>w(P.id),onContextmenu:H(B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B,P)},["prevent","stop"])},{default:$(()=>[P.isEmbedded?j("",!0):ie((v(),U(I,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:B=>f(P.id,{key:D,value:O})},null,8,["onClick"])),[[x,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","onClick","onRemove","onContextmenu"]))),128)):(v(!0),T(q,{key:1},W(p(s).codesByType[D],P=>(v(),T(q,null,[P.children?(v(),U(Ne,{key:P.folderName+P.floor,data:P,"show-edit":D!=="codeBlock",permission:"code",onClickHandle:b[0]||(b[0]=B=>ut(B)),onEdit:B=>f(B.id,{key:B.key,value:B.value}),onRemove:b[1]||(b[1]=B=>w(B)),onClickContextMenu:B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B.event,B.item)}},null,8,["data","show-edit","onEdit","onClickContextMenu"])):(v(),U(ae,{id:P.id,key:P.id,title:P.name,name:P.name,remove:"",permission:"code",padding:12+P.floor*6,onClick:B=>ut(P),onRemove:B=>w(P.id),onContextmenu:H(B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B,P)},["prevent","stop"])},{default:$(()=>[P.codeType!="CodeBlock"?ie((v(),U(I,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:B=>f(P.id,{key:D,value:O})},null,8,["onClick"])),[[x,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]]):j("",!0)]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:2},1032,["title","onOnAdd"]))),128)),R("div",{onClick:b[4]||(b[4]=H(()=>{},["stop"]))},[k(V,{modelValue:u.value,"onUpdate:modelValue":b[3]||(b[3]=O=>u.value=O),width:"600px","close-on-click-modal":!1,title:((y=n.value)==null?void 0:y.id)==p(Z)?p(t)("code.newCode",{name:(M=a.value)==null?void 0:M.value}):p(t)("code.editCode",{name:(L=a.value)==null?void 0:L.value}),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:b[2]||(b[2]=O=>u.value=!1)})]),default:$(()=>{var O;return[R("div",{onKeydown:ue(_,["enter"])},[n.value?(v(),U(Va,{key:0,ref_key:"form",ref:r,"label-position":"top",model:n.value,"edit-mode":((O=n.value)==null?void 0:O.id)!==p(Z)},null,8,["model","edit-mode"])):j("",!0)],40,Ra)]}),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:d,actions:p(S)},null,8,["actions"])])}}});var Ea=Object.freeze(Object.defineProperty({__proto__:null,define:La,open:ut,default:Ua},Symbol.toStringTag,{value:"Module"}));const Na={class:"transition-all px-8 py-4 flex items-center space-x-4 cursor-pointer rounded-normal dark:text-fff/86 !hover:text-blue"},Aa={class:"text-s"},Je=G({props:{icon:null,display:null,shortcut:null},setup(e){return(l,t)=>{const o=be;return v(),T("div",Na,[k(o,{class:de(["iconfont",e.icon])},null,8,["class"]),R("span",null,J(e.display),1),R("span",Aa,J(`(${e.shortcut})`),1)])}}}),Da={class:"py-4 px-8 flex items-center border-b border-solid border-line text-m dark:bg-[#252526]"},ja=G({props:{debugSession:null},setup(e){const l=e,t=F(),{t:o}=Y(),s=Ee(()=>{var a;return(a=t.activeTab)==null?void 0:a.id.startsWith(Ye)});Fe("StartDebug",()=>{s.value&&Xt()}),Fe("DebugContinue",()=>{s.value&&Ie("None")}),Fe("DebugInto",()=>{s.value&&Ie("Into")}),Fe("DebugOver",()=>{s.value&&Ie("Over")}),Fe("DebugOut",()=>{s.value&&Ie("Out")}),Fe("DebugStop",()=>{s.value&&Ie("Stop")});const u=Ee(()=>{var a;return!l.debugSession||((a=l.debugSession)==null?void 0:a.end)});return(a,n)=>(v(),T("div",Da,[p(u)?(v(),U(Je,{key:0,icon:"icon-play1",display:p(o)("common.start"),shortcut:"F8",onClick:n[0]||(n[0]=r=>p(Xt)())},null,8,["display"])):(v(),T(q,{key:1},[k(Je,{icon:"icon-play2",display:p(o)("common.continue"),shortcut:"F5",onClick:n[1]||(n[1]=r=>p(Ie)("None"))},null,8,["display"]),k(Je,{icon:"icon-debug-step-into",display:p(o)("common.stepInto"),shortcut:"F11",onClick:n[2]||(n[2]=r=>p(Ie)("Into"))},null,8,["display"]),k(Je,{icon:"icon-a-debug-step-over",display:p(o)("common.stepOver"),shortcut:"F10",onClick:n[3]||(n[3]=r=>p(Ie)("Over"))},null,8,["display"]),k(Je,{icon:"icon-a-debug-step-out",display:p(o)("common.stepOut"),shortcut:"Shift + F11",onClick:n[4]||(n[4]=r=>p(Ie)("Out"))},null,8,["display"]),k(Je,{icon:"icon-delete4",display:p(o)("common.stop"),shortcut:"Shift + F5",onClick:n[5]||(n[5]=r=>p(Ie)("stop"))},null,8,["display"])],64))]))}});const Pa={key:0,class:"json-tree-row"},Oa={key:0,class:"json-tree-key"},Fa={key:1,class:"json-tree-colon"},Ba=["title"],qa={key:2,class:"json-tree-comma"},Ga=R("span",{class:"json-tree-indent"},"\xA0",-1),Ka={key:1,class:"json-tree-deep"},Ha=R("span",{class:"json-tree-indent"},"\xA0",-1),za={class:"json-tree-sign"},Ja={key:0,class:"json-tree-key"},Wa={key:1,class:"json-tree-colon"},Qa={class:"json-tree-open"},Xa={class:"json-tree-comma"},Ya=R("span",{class:"json-tree-indent"},"\xA0",-1),Za={class:"json-tree-deeper"},el={class:"json-tree-row"},tl={class:"json-tree-close"},ol={key:0,class:"json-tree-comma"},nl=R("span",{class:"json-tree-indent"},"\xA0",-1),Nt=G({props:{level:null,kv:null,raw:null,data:null},setup(e){const l=e,t=(n,r=0,d=!0,c=void 0)=>{let m={depth:r,last:d,primitive:!0,key:JSON.stringify(c)};if(typeof n!="object")return Object.assign(m,{type:typeof n,value:JSON.stringify(n)});if(n===null)return Object.assign(m,{type:"null",value:"null"});if(Array.isArray(n)){let _=n.map((w,f)=>t(w,r+1,f===n.length-1));return Object.assign(m,{primitive:!1,type:"array",value:_})}else{let _=Object.keys(n),w=_.map((f,S)=>t(n[f],r+1,S===_.length-1,f));return Object.assign(m,{primitive:!1,type:"object",value:w})}},o=C(!0),s=C(!1),u=X(()=>{if(l.kv)return l.kv;let n;try{l.raw?n=JSON.parse(l.raw):typeof l.data!="undefined"?n=l.data:(n="[Vue JSON Tree] No data passed.",console.warn(n))}catch(r){n="[Vue JSON Tree] Invalid raw JSON.",console.warn(n)}return t(n)}),a=n=>n>1?`${n} items`:n?"1 item":"no items";return(n,r)=>{const d=Dt("JsonTree",!0);return v(),T("span",{class:de(["json-tree",{"json-tree-root":p(u).depth===0}])},[p(u).primitive?(v(),T("span",Pa,[(v(!0),T(q,null,W(p(u).depth*2+3,c=>(v(),T("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),p(u).key?(v(),T("span",Oa,J(p(u).key),1)):j("",!0),p(u).key?(v(),T("span",Fa,":\xA0")):j("",!0),R("span",{class:de(["json-tree-value","json-tree-value-"+p(u).type]),title:`${p(u).value}`},J(`${p(u).value}`),11,Ba),p(u).last?j("",!0):(v(),T("span",qa,",")),Ga])):j("",!0),p(u).primitive?j("",!0):(v(),T("span",Ka,[R("span",{class:"json-tree-row json-tree-expando",onClick:r[0]||(r[0]=c=>o.value=!o.value),onMouseover:r[1]||(r[1]=c=>s.value=!0),onMouseout:r[2]||(r[2]=c=>s.value=!1)},[Ha,R("span",za,J(o.value?"-":"+"),1),(v(!0),T(q,null,W(p(u).depth*2+1,c=>(v(),T("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),p(u).key?(v(),T("span",Ja,J(p(u).key),1)):j("",!0),p(u).key?(v(),T("span",Wa,":\xA0")):j("",!0),R("span",Qa,J(p(u).type==="array"?"[":"{"),1),ie(R("span",{class:"json-tree-collapsed"},"\xA0/*\xA0"+J(a(p(u).value.length))+"\xA0*/\xA0",513),[[Qe,!o.value]]),ie(R("span",{class:"json-tree-close"},J(p(u).type==="array"?"]":"}"),513),[[Qe,!o.value]]),ie(R("span",Xa,",",512),[[Qe,!o.value&&!p(u).last]]),Ya],32),ie(R("span",Za,[(v(!0),T(q,null,W(p(u).value,(c,m)=>(v(),U(d,{key:m,kv:c,level:e.level},null,8,["kv","level"]))),128))],512),[[Qe,o.value]]),ie(R("span",el,[R("span",{class:de(["json-tree-ending",{"json-tree-paired":s.value}])},[(v(!0),T(q,null,W(p(u).depth*2+3,c=>(v(),T("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),R("span",tl,J(p(u).type==="array"?"]":"}"),1),p(u).last?j("",!0):(v(),T("span",ol,",")),nl],2)],512),[[Qe,o.value]])]))],2)}}}),al={class:"space-x-8 flex items-center dark:bg-[#202428]"},ll=["disabled","placeholder","onKeydown"],sl=G({props:{debugSession:null},setup(e){const l=e,{t}=Y(),o=C(""),s=C([]),u=X(()=>{var r;return!l.debugSession||((r=l.debugSession)==null?void 0:r.end)}),a=()=>g(this,null,function*(){if(!o.value)return;const r=yield Xn(o.value);o.value="",s.value.unshift(r)}),n=r=>{try{return JSON.parse(r)}catch(d){return r}};return(r,d)=>{var _;const c=be,m=mo;return v(),T(q,null,[R("div",al,[k(c,{class:de(["iconfont icon-a-nextstep2 dark:text-fff/86",p(u)?"":" animate-pulse animate-duration-1000"])},null,8,["class"]),ie(R("input",{"onUpdate:modelValue":d[0]||(d[0]=w=>o.value=w),disabled:!e.debugSession||((_=e.debugSession)==null?void 0:_.end),class:de(["outline-none w-full bg-transparent dark:text-fff/86",p(u)?"cursor-not-allowed":""]),placeholder:p(t)("common.inputCodeToExecuteTips"),onKeydown:ue(a,["enter"])},null,42,ll),[[so,o.value]])]),k(m,{class:"dark:bg-[#202428]"},{default:$(()=>[(v(!0),T(q,null,W(s.value,(w,f)=>(v(),T("div",{key:f},[k(Nt,{data:n(w)},null,8,["data"])]))),128))]),_:1})],64)}}});function il(e,l,t){const o=[];for(const s of e)o.push({range:new te.Range(s,1,s,1),options:{glyphMarginClassName:"kooboo-debug-breakpoint"}});return l!==void 0&&o.push({range:new te.Range(l,1,l,1),options:{isWholeLine:!0,className:"kooboo-debug-executing"}}),t!==void 0&&o.push({range:new te.Range(t,1,t,1),options:{glyphMarginClassName:"kooboo-debug-hover"}}),o}const rl=G({props:{modelValue:null,options:null,breakpoints:null,executing:null},emits:["update:modelValue","click"],setup(e,{emit:l}){const t=e,o=C(),s=jt();let u,a,n,r=C();ee(()=>t.modelValue,()=>{var c;u&&u.getValue()!==t.modelValue&&u.setValue((c=t.modelValue)!=null?c:"")});const d=()=>{if(!a)return;const c=u.getLineCount(),m=t.breakpoints.filter(_=>_<=c);n=a.deltaDecorations(n||[],il(m,t.executing,r.value))};return ee([()=>t.breakpoints.toString(),()=>t.modelValue,r,()=>t.executing],d),nt(()=>g(this,null,function*(){u=te.editor.createModel(t.modelValue,"typescript",te.Uri.file(s)),a=te.editor.create(o.value,Oe(ge(ge({},vo),t.options),{model:u,glyphMargin:!0,readOnly:!0,minimap:{enabled:!1}})),a.onMouseDown(c=>{var w,f,S,h;if(((f=(w=c==null?void 0:c.target)==null?void 0:w.detail)==null?void 0:f.glyphMarginLeft)===void 0||(h=(S=c==null?void 0:c.target)==null?void 0:S.detail)!=null&&h.isAfterLines)return;const m=c.target.position.lineNumber,_=a.getModel().getLineFirstNonWhitespaceColumn(m);l("click",{line:m,column:_})}),a.onMouseMove(c=>{var m,_;r.value=(_=(m=c==null?void 0:c.target)==null?void 0:m.position)==null?void 0:_.lineNumber}),d()})),At(()=>{u==null||u.dispose()}),ee(fo,c=>te.editor.setTheme(c?"vs-dark":"vs"),{immediate:!0}),(c,m)=>(v(),T("div",{ref_key:"container",ref:o,class:"w-full h-full min-h-300px min-w-400px monaco-editor bg-fff"},null,512))}}),ul={key:0,class:"h-full flex bg-fff"},dl={class:"flex-1 flex flex-col"},cl={class:"flex-1 text-m font-mono relative"},ml={class:"absolute inset-0"},pl={class:"h-238px border-t border-solid border-line dark:bg-[#202428] p-4 text-s font-mono"},vl={key:0,class:"w-300px border-l border-solid border-line relative"},fl=G({props:{id:null},emits:["setAction"],setup(e,{expose:l,emit:t}){const o=e,s=qe(),u=F(),a=C(),n=C();let r=!0;const d=C(o.id.replace(Ye,"")),c=()=>g(this,null,function*(){if(!!r){try{n.value=yield Wn(),n.value.currentCode&&!n.value.end&&(yield m(n.value.currentCode))}catch(b){console.log(b)}setTimeout(()=>g(this,null,function*(){yield c()}),500)}}),m=b=>g(this,null,function*(){b!==d.value&&(b&&(d.value=b),u.debugTab&&(a.value=yield s.getCode(d.value),u.debugTab.name=a.value.name,t("setAction","open",{visible:!!a.value.url})))}),_=()=>g(this,null,function*(){a.value=yield s.getCode(d.value)}),w=X(()=>n.value?n.value.breakpoints.filter(b=>b.source===d.value).map(b=>b.line):[]),f=X(()=>{var b,I,V;if(!((b=n.value)!=null&&b.end))return(V=(I=n.value)==null?void 0:I.debugInfo)==null?void 0:V.currentLine}),S=b=>g(this,null,function*(){!n.value||(n.value.breakpoints=yield Qn({source:d.value,line:b.line,column:b.column}))});io(()=>{r=!1}),m(),c(),l({load:m,reload:_,currentCode:d});const h=C(),i=C();return ee(()=>n.value,()=>{var b,I,V;h.value=(b=n.value)==null?void 0:b.exception,i.value=(V=(I=n.value)==null?void 0:I.debugInfo)==null?void 0:V.variables},{deep:!0}),(b,I)=>{const V=mo;return a.value?(v(),T("div",ul,[R("div",dl,[k(ja,{class:"border-b border-solid border-line","debug-session":n.value},null,8,["debug-session"]),R("div",cl,[R("div",ml,[k(rl,{modelValue:a.value.body,"onUpdate:modelValue":I[0]||(I[0]=x=>a.value.body=x),breakpoints:p(w),executing:p(f),onClick:S},null,8,["modelValue","breakpoints","executing"])])]),R("div",pl,[k(sl,{"debug-session":n.value},null,8,["debug-session"])])]),h.value||i.value?(v(),T("div",vl,[k(V,null,{default:$(()=>[h.value?(v(),U(Nt,{key:0,data:h.value},null,8,["data"])):i.value?(v(),U(Nt,{key:1,data:i.value},null,8,["data"])):j("",!0)]),_:1})])):j("",!0)])):j("",!0)}}}),no=oe.global.t,yl={name:"debug",icon:"icon-debugging",display:no("common.debug"),order:90,permission:"debug",actions:[{name:"refresh",display:no("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}}]},gl=G({setup(e,{expose:l}){const{t}=Y(),o=qe(),s=F(),u=C(),a=C(),n=m=>o.codes.filter(_=>{var w;return((w=_.codeType)==null?void 0:w.toLowerCase())===(m==null?void 0:m.toLowerCase())}),r=m=>{s.addTab({id:Ye+m.id,name:m.name,panel:fl,icon:"icon-debugging",actions:[{name:"refresh",display:t("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(this,null,function*(){var w,f;const _=yield(f=(w=F().activeTab)==null?void 0:w.panelInstance)==null?void 0:f.promise;!_||_.reload()})},{name:"open",visible:!1,display:t("common.preview"),icon:"icon-eyes",invoke:()=>g(this,null,function*(){var f,S;const _=yield(S=(f=F().activeTab)==null?void 0:f.panelInstance)==null?void 0:S.promise;if(!_)return;const w=o.codes.find(h=>h.id===_.currentCode);if(w){const{onPreview:h}=we();h(w.previewUrl)}})}]})},d=()=>{o.loadCodes()};ee(()=>s.debugTab,m=>g(this,null,function*(){u.value=yield m==null?void 0:m.panelInstance.promise}));const c=X(()=>{var _,w;var m=[{name:t("common.copyTitle"),invoke:f=>g(this,null,function*(){Ve(f.name)})}];return((w=(_=a.value)==null?void 0:_.payload)==null?void 0:w.codeType)=="Api"&&m.push({name:t("common.preview"),invoke:f=>g(this,null,function*(){const{onPreview:S}=we();S(f.previewUrl)})}),m});return l({load:d}),(m,_)=>(v(),T("div",null,[(v(!0),T(q,null,W(p(o).types,(w,f)=>(v(),T(q,{key:f},[n(f).length?(v(),U(re,{key:0,title:w,"expand-default":!0,permission:"debug"},{default:$(()=>[f==="pageScript"?(v(!0),T(q,{key:0},W(p(o).codes.filter(S=>S.codeType==="PageScript"),S=>{var h;return v(),U(ae,{id:S.id,key:S.id,class:de(((h=u.value)==null?void 0:h.currentCode)===S.id?"bg-blue/20 dark:text-fff/86":""),title:S.name,name:S.name,permission:"debug",onClick:i=>r(S),onContextmenu:H(i=>{var b;return(b=a.value)==null?void 0:b.openMenu(i,S)},["prevent","stop"])},null,8,["id","class","title","name","onClick","onContextmenu"])}),128)):(v(!0),T(q,{key:1},W(p(o).codesByType[f],S=>{var h;return v(),T(q,null,[S.children?(v(),U(Ne,{key:S.folderName+S.floor,data:S,permission:"debug","hidden-remove":"true",onClickHandle:_[0]||(_[0]=i=>r(i)),onClickContextMenu:i=>{var b;return(b=a.value)==null?void 0:b.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:S.id,key:S.id,class:de(((h=u.value)==null?void 0:h.currentCode)===S.id?"bg-blue/20 dark:text-fff/86":""),title:S.name,name:S.name,permission:"debug",padding:12+S.floor*6,onContextmenu:H(i=>{var b;return(b=a.value)==null?void 0:b.openMenu(i,S)},["prevent","stop"]),onClick:i=>r(S)},null,8,["id","class","title","name","padding","onContextmenu","onClick"]))],64)}),256))]),_:2},1032,["title"])):j("",!0)],64))),128)),k(Me,{ref_key:"contextMenu",ref:a,actions:p(c)},null,8,["actions"])]))}});var bl=Object.freeze(Object.defineProperty({__proto__:null,define:yl,default:gl},Symbol.toStringTag,{value:"Module"}));const Mo=oe.global.t,wl=()=>N.get(E("Form/External",!0)),_l=()=>N.get(E("Form/Embedded",!0)),kl=e=>N.post(E("Form/Deletes"),{ids:e},void 0,{successMessage:Mo("common.deleteSuccess")}),hl=e=>N.get(E("Form/GetEdit"),{id:e}),xl=e=>N.post(E("Form/post"),e),Cl=e=>N.post(E("Form/UpdateSetting"),e),$l=e=>N.get(E("Form/GetSetting"),{id:e}),Sl=e=>N.get(E("Form/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Vl=(e,l)=>N.get(E("Form/FormValues"),{id:e,pageNr:l,pageSize:30}),Tl=e=>N.post(E("Form/DeleteFormValues"),{ids:e},void 0,{successMessage:Mo("common.deleteSuccess")}),Io=Re("formStore",()=>{const e=ce(),l=F(),t=C([]),o=C([]),s=()=>g(void 0,null,function*(){t.value=yield wl()}),u=()=>g(void 0,null,function*(){o.value=yield _l()}),a=X(()=>l.getSplitNameData(t.value)),n=()=>Promise.all([s(),u()]),r=w=>g(void 0,null,function*(){yield kl(w),l.deleteTabs(w),n()}),d=w=>g(void 0,null,function*(){w=w||Z;const f=yield hl(w);return f.body||(f.body=""),f.id=w,f}),c=(w,f)=>g(void 0,null,function*(){w.body||(w.body=" ");const S=yield xl(w);return e.site.recordSiteLogVideo&&f&&(yield Be(S,f,w.isEmbedded)),S}),m=(w,f)=>g(void 0,null,function*(){w=w||Z;const S=yield Vl(w,f);return S.id=w,S}),_=w=>g(void 0,null,function*(){yield Tl(w)});return ee(()=>{var w;return(w=e.site)==null?void 0:w.id},()=>{o.value=[],t.value=[]}),{external:t,embedded:o,getExternalFormList:a,loadAll:n,deleteForms:r,getForm:d,updateForm:c,getFormValues:m,deleteFormValues:_}}),Ml={key:0,class:"h-full"},Il=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=Io(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getForm(o.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateForm(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))});ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0});const _=(w,f)=>g(this,null,function*(){yield d.promise,f?r.value.search(f,w):r.value.goToLine(w)});return c(),l({save:m,load:c,goToLine:_}),(w,f)=>a.value?(v(),T("div",Ml,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":f[0]||(f[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:f[1]||(f[1]=S=>p(u).addTabRecord(o.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Rl={key:0,class:"h-40px leading-10 dark:text-[#fffa]"},Ll=G({props:{model:null},setup(e,{expose:l}){const t=e,o=De(),{t:s}=Y(),u=C(),a=X(()=>{var r;return t.model.id&&t.model.id===Z&&!((r=t.model)!=null&&r.isEmbedded)}),n=X(()=>({name:a.value?[le(s("common.fieldRequiredTips")),_e(1,50),Te(),Ce(Sl,s("common.valueHasBeenTakenTips"))]:[]}));return l({validate:()=>{var r;return(r=u.value)==null?void 0:r.validate()}}),(r,d)=>{const c=me,m=pe,_=ve;return p(o).query.type==="embedded"?(v(),T("span",Rl,J(p(s)("common.embeddedForm")),1)):(v(),U(_,{key:1,ref_key:"form",ref:u,model:e.model,rules:p(n),onSubmit:d[1]||(d[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(m,{label:p(s)("common.formName"),prop:"name"},{default:$(()=>[k(c,{modelValue:e.model.name,"onUpdate:modelValue":d[0]||(d[0]=w=>e.model.name=w),class:"min-w-300px",disabled:!p(a),title:e.model.name,"data-cy":"form-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"]))}}}),vt=oe.global.t,Ul=()=>N.get(E("Page/all",!0)),El=e=>N.post(E("Page/Deletes"),{ids:e},void 0,{successMessage:vt("common.deleteSuccess")}),rd=()=>N.get(E("Page/DefaultRoute")),ud=e=>N.post(E("Page/DefaultRouteUpdate"),e,void 0,{successMessage:vt("common.saveSuccess")}),dd=e=>N.post(E("Page/ConvertFile"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},hiddenError:!0,successMessage:vt("common.importSuccess"),errorMessage:vt("common.importFailed"),keepShowErrorMessage:!0}),Ro=e=>N.get(E("Page/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Lo=(e,l,t)=>ka(e,l,t),cd=e=>N.post(E("Page/Copy"),e,void 0,{successMessage:vt("common.copySuccess")}),Nl=e=>N.post(E("Page/post"),e),Al=e=>N.post(E("Page/PostRichText"),e),Dl=(e,l)=>N.get(E("Page/GetEdit"),ge({id:e},l)),md=e=>N.get(E("Page/PageStructure"),{id:e}),pd=()=>N.get(E("Page/GetDesignTemplate"),{env:"production"}),vd=e=>N.get(E("GroupEdit/Tree"),{includeScript:e}),fd=(e,l)=>N.post(E("GroupEdit/Search"),{SearchParams:l,includeScript:e}),yd=()=>N.get(E("GroupEdit/GetSiteRunningTask")),gd=()=>N.get(E("GroupEdit/ViewNames")),bd=()=>N.get(E("GroupEdit/PageNames")),wd=()=>N.get(E("GroupEdit/BlockNames")),_d=e=>N.post(E("GroupEdit/GetOuterHtml"),{pages:e}),kd=e=>N.post(E("GroupEdit/GetInnerHtml"),{pages:e}),hd=e=>N.get(E(`GroupEdit/GetViewBody?name=${e}`)),xd=e=>N.get(E(`GroupEdit/GetHtmlBlockBody?name=${e}`)),Cd=(e,l)=>N.post(E("GroupEdit/EditOuterHtml"),{pages:e,NewBody:l}),$d=(e,l)=>N.post(E("GroupEdit/EditInnerHtml"),{pages:e,NewBody:l}),Sd=e=>N.post(E("GroupEdit/DeleteDom"),{pages:e}),Vd=(e,l,t,o)=>N.post(E("GroupEdit/ToHtmlBlock"),{pages:e,name:l,body:t,UseExisting:o}),Td=(e,l,t,o)=>N.post(E("GroupEdit/ToView"),{pages:e,viewName:l,body:t,UseExisting:o}),Md=e=>N.get(E(`GroupEdit/GetTaskStatus?TaskId=${e}`)),ft=Re("pageStore",()=>{const e=C([]),l=ce(),t=F(),o=X(()=>t.getSplitNameData(e.value.filter(m=>["Normal","Designer"].includes(m.type)&&m.layoutId===Z))),s=X(()=>t.getSplitNameData(e.value.filter(m=>m.layoutId!==Z))),u=X(()=>t.getSplitNameData(e.value.filter(m=>m.type==="RichText"))),a=()=>g(void 0,null,function*(){const m=yield Ul();return e.value=m,m}),n=m=>g(void 0,null,function*(){yield El(m),t.deleteTabs(m),a()}),r=(m,_)=>g(void 0,null,function*(){m.body||(m.body=" ");const w=yield Al(m);return l.site.recordSiteLogVideo&&_&&(yield Be(w,_)),w}),d=(m,_)=>g(void 0,null,function*(){const w=yield Dl(m||Z,_);return w.body||(w.body=""),w.urlPaths||(w.urlPaths={}),w.urlPath||(w.urlPath=""),w}),c=(m,_)=>g(void 0,null,function*(){m.enableDiffChecker=!0;const w=yield Nl(m);return l.site.recordSiteLogVideo&&_&&(yield Be(w,_)),Object.assign(m,yield d(w))});return ee(()=>{var m;return(m=l.site)==null?void 0:m.id},()=>{e.value=[]}),{list:e,deletePages:n,load:a,updateRichPage:r,getPage:d,updatePage:c,getNormalPage:o,getLayoutPage:s,getRichPage:u}}),jl=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const t=e,{t:o}=Y(),s=C(!0),u=ft(),a=C(),n=C({id:"",formId:"",method:"get",redirectUrl:"RefreshSelf()",setting:{},formSubmitter:"",enable:!1});$l(t.id).then(m=>{a.value=m,n.value.id=a.value.id,n.value.formId=a.value.formId,n.value.redirectUrl=a.value.redirectUrl,n.value.formSubmitter=a.value.formSubmitter,n.value.enable=a.value.enable,n.value.method=a.value.method||"get",n.value.setting=a.value.setting});const r=X(()=>{const m=[];m.push({key:"RefreshSelf()",value:o("common.refreshSelf")});for(const _ of u.list)m.push({key:_.path,value:_.name});return m}),d=()=>g(this,null,function*(){yield Cl(n.value),s.value=!1}),c=X(()=>{if(!a.value)return[];const m=a.value.availableSubmitters.find(_=>_.name===n.value.formSubmitter);return(m==null?void 0:m.settings)||[]});return u.load(),(m,_)=>{const w=Ft,f=pe,S=bo,h=wo,i=Bt,b=qt,I=me,V=ve,x=ye;return v(),T("div",{onClick:_[8]||(_[8]=H(()=>{},["stop"]))},[k(x,{"model-value":s.value,width:"600px","close-on-click-modal":!1,title:p(o)("common.formSetting"),onClosed:_[7]||(_[7]=y=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"form",action:"edit"},onConfirm:d,onCancel:_[6]||(_[6]=y=>s.value=!1)})]),default:$(()=>[a.value?(v(),U(V,{key:0,ref:"form","label-position":"top",model:n.value,onKeydown:ue(d,["enter"])},{default:$(()=>[k(f,{label:p(o)("common.enable")},{default:$(()=>[k(w,{modelValue:n.value.enable,"onUpdate:modelValue":_[0]||(_[0]=y=>n.value.enable=y),"data-cy":"enable"},null,8,["modelValue"])]),_:1},8,["label"]),n.value.enable?(v(),T(q,{key:0},[k(f,{label:p(o)("common.method")},{default:$(()=>[k(h,{modelValue:n.value.method,"onUpdate:modelValue":_[1]||(_[1]=y=>n.value.method=y),class:"el-radio-group--rounded"},{default:$(()=>[(v(),T(q,null,W(["get","post"],y=>k(S,{key:y,label:y,"data-cy":`method-${y}`},{default:$(()=>[Ae(J(y),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),k(f,{label:p(o)("common.redirectTo")},{default:$(()=>[k(b,{modelValue:n.value.redirectUrl,"onUpdate:modelValue":_[2]||(_[2]=y=>n.value.redirectUrl=y),class:"w-full",filterable:"","allow-create":"","default-first-option":"","data-cy":"redirect-dropdown"},{default:$(()=>[(v(!0),T(q,null,W(p(r),y=>(v(),U(i,{key:y.key,value:y.key,label:y.value,"data-cy":"redirect-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),k(f,{label:p(o)("common.submitter")},{default:$(()=>[k(b,{modelValue:n.value.formSubmitter,"onUpdate:modelValue":_[3]||(_[3]=y=>n.value.formSubmitter=y),class:"w-full","data-cy":"submitter-dropdown",onChange:_[4]||(_[4]=y=>n.value.setting={})},{default:$(()=>[(v(!0),T(q,null,W(a.value.availableSubmitters,y=>(v(),U(i,{key:y.name,value:y.name,label:y.name,"data-cy":"submitter-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),n.value.formSubmitter=="SubmitToExternal"?(v(),U(f,{key:0},{default:$(()=>[k(I,{modelValue:n.value.setting.url,"onUpdate:modelValue":_[5]||(_[5]=y=>n.value.setting.url=y),placeholder:"http://www.domain.com/receive","data-cy":"url"},null,8,["modelValue"])]),_:1})):(v(!0),T(q,{key:1},W(p(c),y=>(v(),U(f,{key:y.name,label:y.name},{default:$(()=>[k(b,{modelValue:n.value.setting[y.name.replace(y.name[0],y.name[0].toLocaleLowerCase())],"onUpdate:modelValue":M=>n.value.setting[y.name.replace(y.name[0],y.name[0].toLocaleLowerCase())]=M,class:"w-full",filterable:"","allow-create":"","default-first-option":"","data-cy":"submitter-object-dropdown"},{default:$(()=>[(v(!0),T(q,null,W(y.selectionValues,(M,L)=>(v(),U(i,{key:L,value:L,label:M,"data-cy":"submitter-object-opt"},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))],64)):j("",!0)]),_:1},8,["model","onKeydown"])):j("",!0)]),_:1},8,["model-value","title"])])}}}),Pl=["onKeydown"],ct=oe.global.t,Ol={name:"forms",icon:"icon-page",display:ct("common.form"),route:"forms",order:70,permission:"form",actions:[{name:"refresh",display:ct("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:ct("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"forms"}))}}]},dt=e=>{F().addTab({id:e.id,name:e.name,panel:Il,icon:"icon-page",actions:[{name:"save",display:ct("common.save"),visible:!1,icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,o;const l=yield(o=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:o.promise;!l||l.save()})},{name:"refresh",display:ct("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,o;const l=yield(o=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:o.promise;!l||l.load()})}]})},Fl=G({setup(e,{expose:l}){const{t}=Y(),o=Io(),s=C(!1),u=C(!1),a=C(""),n=C(),r=C(),d=C(),c=()=>{o.loadAll()},m=()=>g(this,null,function*(){r.value=yield o.getForm(),s.value=!0}),_=()=>g(this,null,function*(){yield n.value.validate();const h=yield o.updateForm(r.value);yield o.loadAll();const i=o.external.find(b=>b.id==h);i&&dt(i),s.value=!1}),w=h=>g(this,null,function*(){yield xe(),yield o.deleteForms([h])}),f=h=>{a.value=h,u.value=!0},S=[{name:t("common.copyTitle"),invoke:h=>g(this,null,function*(){Ve(h.name)})}];return l({load:c}),(h,i)=>{const b=be,I=ye;return v(),T("div",null,[k(re,{title:p(t)("common.external"),add:"","expand-default":!0,permission:"form",onOnAdd:m},{default:$(()=>[(v(!0),T(q,null,W(p(o).getExternalFormList,V=>(v(),T(q,null,[V.children?(v(),U(Ne,{key:V.folderName+V.floor,data:V,permission:"form","show-setting":!0,onClickHandle:i[0]||(i[0]=x=>dt(x)),onRemove:i[1]||(i[1]=x=>w(x)),onSetting:i[2]||(i[2]=x=>f(x)),onClickContextMenu:x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x.event,x.item)}},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:V.id,key:V.id,title:V.name,name:V.name,permission:"form",padding:12+V.floor*6,remove:"",onClick:x=>dt(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},{default:$(()=>[k(b,{class:"iconfont icon-a-setup hover:text-blue",onClick:x=>f(V.id)},null,8,["onClick"])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(t)("common.embedded"),"expand-default":!0,permission:"form"},{default:$(()=>[(v(!0),T(q,null,W(p(o).embedded,V=>(v(),U(ae,{id:V.id,key:V.id,title:V.name,permission:"form",remove:"",onClick:x=>dt(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},{default:$(()=>[k(b,{class:"iconfont icon-a-setup hover:text-blue",onClick:x=>f(V.id)},null,8,["onClick"])]),_:2},1032,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:i[5]||(i[5]=H(()=>{},["stop"]))},[k(I,{modelValue:s.value,"onUpdate:modelValue":i[4]||(i[4]=V=>s.value=V),width:"600px","close-on-click-modal":!1,title:p(t)("common.newForm"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:i[3]||(i[3]=V=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(_,["enter"])},[r.value?(v(),U(Ll,{key:0,ref_key:"form",ref:n,"label-position":"top",model:r.value},null,8,["model"])):j("",!0)],40,Pl)]),_:1},8,["modelValue","title"])]),u.value?(v(),U(jl,{key:0,id:a.value,modelValue:u.value,"onUpdate:modelValue":i[6]||(i[6]=V=>u.value=V)},null,8,["id","modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:d,actions:S},null,512)])}}});var Bl=Object.freeze(Object.defineProperty({__proto__:null,define:Ol,open:dt,default:Fl},Symbol.toStringTag,{value:"Module"}));const Uo=oe.global.t,Eo=(e,l)=>N.get(E("Layout/get"),ge({id:e},l)),ql=()=>N.get(E("Layout/list",!0)),Id=(e,l)=>N.post(E("Layout/Copy"),{id:e,name:l},void 0,{successMessage:Uo("common.copySuccess")}),Gl=e=>N.post(E("Layout/post"),e),Kl=e=>N.post(E("Layout/Deletes"),{ids:e},void 0,{successMessage:Uo("common.deleteSuccess")}),No=e=>N.get(E("Layout/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),ao=oe.global.t,Gt=Re("layoutStore",()=>{const e=ce(),l=F(),t=C([]),o=X(()=>l.getSplitNameData(t.value)),s=()=>g(void 0,null,function*(){t.value=yield ql()}),u=d=>({name:d?[]:[Te(),_e(1,50),le(ao("common.nameRequiredTips")),Ce(No,ao("common.layoutNameExistsTips"))]}),a=d=>g(void 0,null,function*(){yield Kl(d),l.deleteTabs(d),s()}),n=d=>g(void 0,null,function*(){const c=yield Eo(d||Z);return c.body||(c.body=""),c}),r=(d,c)=>g(void 0,null,function*(){d.enableDiffChecker=!0;const m=yield Gl(d);return e.site.recordSiteLogVideo&&c&&(yield Be(m,c)),Object.assign(d,yield n(m))});return ee(()=>{var d;return(d=e.site)==null?void 0:d.id},()=>{t.value=[]}),{load:s,list:t,deleteLayouts:a,getLayout:n,updateLayout:r,getRules:u,getLayoutList:o}}),Hl={key:0,class:"h-full"},zl=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=Gt(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getLayout(o.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateLayout(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))}),_=(w,f)=>g(this,null,function*(){yield d.promise,f?r.value.search(f,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,f)=>a.value?(v(),T("div",Hl,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":f[0]||(f[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:f[1]||(f[1]=S=>p(u).addTabRecord(o.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Jl=G({props:{model:null,editMode:{type:Boolean}},setup(e,{expose:l}){const t=e,{t:o}=Y(),s=C(),u=Ee(()=>({name:t.editMode?[]:[_e(1,50),le(o("common.nameRequiredTips")),Te(),Ce(No,o("common.layoutNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return e.model?(v(),U(c,{key:0,ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(o)("common.layoutName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.editMode,title:e.model.name,"data-cy":"layout-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])):j("",!0)}}}),Wl=["onKeydown"],mt=oe.global.t,Ql={name:"layouts",icon:"icon-layout",display:mt("common.layout"),route:"layouts",order:20,permission:"layout",actions:[{name:"refresh",display:mt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:mt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"layouts"}))}}]},_t=e=>{F().addTab({id:e.id,name:e.name,panel:zl,icon:"icon-layout",actions:[{name:"save",visible:!1,display:mt("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,o;const l=yield(o=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:o.promise;!l||l.save()})},{name:"refresh",display:mt("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,o;const l=yield(o=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:o.promise;!l||l.load()})}]})},Xl=G({setup(e,{expose:l}){const{t}=Y(),o=Gt(),s=C(!1),u=C(),a=C(),n=C(),r=()=>g(this,null,function*(){a.value=yield o.getLayout(),s.value=!0}),d=()=>g(this,null,function*(){yield u.value.validate();const w=yield o.updateLayout(a.value);_t(w),o.load(),s.value=!1}),c=w=>g(this,null,function*(){yield xe(),yield o.deleteLayouts([w])}),m=()=>{o.load()},_=[{name:t("common.copyTitle"),invoke:w=>g(this,null,function*(){Ve(w.name)})}];return l({load:m}),(w,f)=>{const S=ye;return v(),T("div",null,[k(re,{title:p(t)("common.list"),add:"","expand-default":!0,permission:"layout",onOnAdd:r},{default:$(()=>[(v(!0),T(q,null,W(p(o).getLayoutList,h=>(v(),T(q,null,[h.children?(v(),U(Ne,{key:h.folderName+h.floor,data:h,permission:"layout",onClickHandle:f[0]||(f[0]=i=>_t(i)),onRemove:f[1]||(f[1]=i=>c(i)),onClickContextMenu:i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:h.id,key:h.id,permission:"layout",title:h.name,name:h.name,padding:12+h.floor*6,remove:"",onClick:i=>_t(h),onRemove:i=>c(h.id),onContextmenu:H(i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i,h)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:f[4]||(f[4]=H(()=>{},["stop"]))},[k(S,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=h=>s.value=h),width:"600px","close-on-click-modal":!1,title:p(t)("common.newLayout"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:d,onCancel:f[2]||(f[2]=h=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(d,["enter"])},[a.value?(v(),U(Jl,{key:0,ref_key:"form",ref:u,"label-position":"top",model:a.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Wl)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:n,actions:_},null,512)])}}});var Yl=Object.freeze(Object.defineProperty({__proto__:null,define:Ql,open:_t,default:Xl},Symbol.toStringTag,{value:"Module"}));const ze=oe.global.t,Zl=()=>N.get(E("Menu/list",!0)),Ao=(e,l)=>N.get(E("Menu/getMenu"),{id:e,name:l}),es=e=>N.post(E("Menu/Deletes"),{ids:e},void 0,{successMessage:ze("common.deleteSuccess")}),ts=(e,l)=>N.post(E("Menu/Delete"),{rootId:e,id:l},void 0,{successMessage:ze("common.deleteSuccess")}),os=e=>N.post(E("Menu/Create"),{name:e},void 0,{successMessage:ze("common.addSuccess")}),ns=e=>N.get(E("Menu/isUniqueName"),{name:e},{hiddenError:!0,hiddenLoading:!0}),as=e=>N.post(E("Menu/CreateSub"),e,void 0,{successMessage:ze("common.saveSuccess")}),ls=e=>N.post(E("Menu/updateInfo"),e,void 0,{successMessage:ze("common.saveSuccess")}),ss=e=>N.post(E("Menu/UpdateTemplate"),e,void 0,{successMessage:ze("common.saveSuccess")}),Do=(e,l,t)=>N.post(E("Menu/Swap"),{rootId:e,ida:l,idb:t},void 0,{successMessage:ze("common.saveSuccess")}),jo=Re("menuStore",()=>{const e=ce(),l=F(),t=C([]),o=X(()=>l.getSplitNameData(t.value)),s=()=>g(void 0,null,function*(){t.value=yield Zl()}),u=r=>g(void 0,null,function*(){yield es(r),l.deleteTabs(r),s()}),a=r=>g(void 0,null,function*(){const d=yield os(r);return s(),d}),n=r=>g(void 0,null,function*(){return yield Ao(r)});return ee(()=>{var r;return(r=e.site)==null?void 0:r.id},()=>{t.value=[]}),{load:s,list:t,deleteMenus:u,getMenu:n,createMenu:a,getMenuList:o}}),is={class:"text-666 dark:text-fff/86 pr-8 pl-16 w-full border-line dark:border-444 rounded-normal border border-solid ellipsis bg-fff dark:bg-444","data-cy":"menu-item"},rs={class:"flex items-center text-m"},us={class:"space-x-8 flex"},ds=["title"],cs=["title"],ms=R("div",{class:"flex-1"},null,-1),ps={class:"p-8 cursor-move menu_move_handler","data-cy":"move"},vs={key:0,class:"pl-32 pr-24 mt-8 mb-16"},fs=G({props:{menu:null,id:null},emits:["reload","add","edit","template","delete"],setup(e,{emit:l}){const t=e,{t:o}=Y(),s=(u,a)=>g(this,null,function*(){const n=u.children[a.newIndex],r=u.children.splice(a.oldIndex,1)[0];u.children.splice(a.newIndex,0,r),yield Do(t.id,r.id,n.id),l("reload")});return(u,a)=>{var c,m,_;const n=be,r=Dt("MenuItem",!0),d=lt;return v(),T("div",is,[R("div",rs,[R("div",us,[R("p",{"data-cy":"menu-item-name",class:"max-w-300px ellipsis",title:e.menu.name},J(e.menu.name),9,ds),R("p",{class:"text-blue max-w-500px ellipsis","data-cy":"menu-item-url",title:e.menu.url},J(e.menu.url),9,cs)]),ms,(c=e.menu.children)!=null&&c.length?(v(),U(Xe,{key:0,icon:"icon-code",tip:p(o)("common.editTemplate"),"data-cy":"edit-item-template",onClick:a[0]||(a[0]=w=>u.$emit("template",e.menu))},null,8,["tip"])):j("",!0),(m=e.menu.children)!=null&&m.length?j("",!0):(v(),U(Xe,{key:1,permission:{feature:"menu",action:"edit"},icon:"icon-a-addto",tip:p(o)("common.add"),"data-cy":"add-sub-item",onClick:a[1]||(a[1]=w=>u.$emit("add",e.menu.id))},null,8,["tip"])),k(Xe,{permission:{feature:"menu",action:"edit"},icon:"icon-a-writein",tip:p(o)("common.edit"),"data-cy":"edit-item",onClick:a[2]||(a[2]=w=>u.$emit("edit",e.menu))},null,8,["tip"]),k(Xe,{permission:{feature:"menu",action:"edit"},class:"text-orange hover:text-orange",icon:"icon-delete",tip:p(o)("common.delete"),"data-cy":"delete-item",onClick:a[3]||(a[3]=w=>u.$emit("delete",e.menu.id))},null,8,["tip"]),R("div",ps,[k(n,{class:"iconfont icon-move text-16px"})])]),(_=e.menu.children)!=null&&_.length?(v(),T("div",vs,[k(p(_o),{"model-value":e.menu.children,group:e.menu.id,"item-key":e.id,class:"space-y-8 mb-8",handle:".menu_move_handler","data-cy":"sub-menu-item-wrapper",onSort:a[9]||(a[9]=w=>s(e.menu,w))},{item:$(({element:w})=>[k(r,{id:e.id,menu:w,onReload:a[4]||(a[4]=f=>u.$emit("reload")),onAdd:a[5]||(a[5]=f=>u.$emit("add",f)),onEdit:a[6]||(a[6]=f=>u.$emit("edit",f)),onTemplate:a[7]||(a[7]=f=>u.$emit("template",f)),onDelete:a[8]||(a[8]=f=>u.$emit("delete",f))},null,8,["id","menu"])]),_:1},8,["model-value","group","item-key"]),k(d,{circle:"",onClick:a[10]||(a[10]=w=>u.$emit("add",e.menu.id))},{default:$(()=>[k(n,{class:"text-blue iconfont icon-a-addto"})]),_:1})])):j("",!0)])}}}),ys={class:"flex justify-end"},gs=G({props:{modelValue:{type:Boolean},menu:null},emits:["update:modelValue","reload"],setup(e,{emit:l}){const t=e,{t:o}=Y(),s=C([]),u={name:[le(o("common.nameRequiredTips")),_e(1,50)],url:[]};_a("Page").then(f=>s.value=f);const a=pn(),n=C(!0),r=C(),d=C(t.menu.values);rn(()=>{a.default in d.value||(d.value[a.default]=t.menu.name)});const c=C({rootId:t.menu.rootId,parentId:t.menu.parentId,name:t.menu.name,url:t.menu.url,id:t.menu.id}),m=Ee(()=>{if(!!c.value)return ge(ge({},c.value),d.value)}),_=()=>g(this,null,function*(){yield r.value.validate();var f=Oe(ge({},c.value),{Values:JSON.stringify(d.value)});f.url||(f.url="#"),f.name=d.value[a.default],c.value.id?yield ls(f):yield as(f),n.value=!1,l("reload")}),w=f=>f===a.default?a.selected.length>1?o("common.name")+" - "+f+" ("+o("common.default")+")":o("common.name"):o("common.name")+" - "+f;return(f,S)=>{const h=me,i=pe,b=Bt,I=qt,V=ve,x=ye;return v(),U(x,{"model-value":n.value,width:"600px","close-on-click-modal":!1,title:p(o)("common.menuItem"),onClosed:S[2]||(S[2]=y=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:S[1]||(S[1]=y=>n.value=!1)})]),default:$(()=>[R("div",ys,[k(In)]),k(V,{ref_key:"form",ref:r,"label-position":"top",model:p(m),rules:p(u),onKeydown:ue(_,["enter"])},{default:$(()=>[(v(!0),T(q,null,W(p(a).selected,y=>(v(),U(i,{key:y,label:w(y),rules:p(u).name,prop:y},{default:$(()=>[k(h,{modelValue:d.value[y],"onUpdate:modelValue":M=>d.value[y]=M,"data-cy":"name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","rules","prop"]))),128)),k(i,{label:"URL",prop:"url"},{default:$(()=>[k(I,{modelValue:c.value.url,"onUpdate:modelValue":S[0]||(S[0]=y=>c.value.url=y),filterable:"","allow-create":"","default-first-option":"",class:"w-full","data-cy":"url-dropdown"},{default:$(()=>[(v(!0),T(q,null,W(s.value,y=>(v(),U(b,{key:y.id,value:y.name,label:y.name,"data-cy":"url-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["model-value","title"])}}}),bs={class:"flex space-x-8"},ws={class:"space-y-8 flex-1"},_s={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden","data-cy":"editor-wrapper"},ks={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden ml-32","data-cy":"editor-wrapper"},hs={class:"flex space-x-4 p-8"},xs={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden","data-cy":"editor-wrapper"},Cs={class:"w-400px bg-card dark:bg-444 rounded-normal flex flex-col"},$s={class:"p-8 font-bold"},Ss={class:"h-full p-8"},Vs={class:"overflow-auto h-374px","data-cy":"preview"},Ts=G({props:{modelValue:{type:Boolean},menu:null},emits:["update:modelValue","reload"],setup(e,{emit:l}){const t=e,{t:o}=Y(),s=C(),u={lineNumbersMinChars:2,minimap:{enabled:!1},renderLineHighlight:"none"},a={AnchorText:"{anchortext}",Href:"{href}",SubItems:"{items}",ActiveClass:"{activeclass:className}",ParentId:"{parentid}",CurrentId:"{currentid}"},n=C(!0),r=C({containerTop:t.menu.subItemContainer.split("{items}")[0],template:t.menu.subItemTemplate,containerBottom:t.menu.subItemContainer.split("{items}")[1]}),d=(w,f,S,h)=>{var b,I;let i=f;for(const V of w.children){let x=S;if(x.indexOf(a.Href)&&(x=x.split(a.Href).join(V.url?V.url:"#")),x.indexOf(a.AnchorText)&&(x=x.split(a.AnchorText).join(V.name)),x.indexOf(a.CurrentId)&&(x=x.split(a.CurrentId).join(V.id)),x.indexOf(a.ParentId)&&(x=x.split(a.ParentId).join(V.parentId)),x.indexOf("activeclass:")){const y=(b=(x.match(/{[\w\W]*?:([\w\W]*?)}/)||[])[1])==null?void 0:b.toString();y&&(x=x.split(`{activeclass:${y}}`).join(w.children[0]===V?`class="${y}"`:""))}if(x.indexOf(a.SubItems)&&((I=V.children)==null?void 0:I.length)){let y=d(V,V.subItemContainer.split("{items}")[0],V.subItemTemplate,V.subItemContainer.split("{items}")[1]);x=x.split(a.SubItems).join(y)}i+=x}return i+=h,i},c=X(()=>d(t.menu,r.value.containerTop,r.value.template,r.value.containerBottom)),m=w=>{var f;(f=s.value)==null||f.replace(w)},_=()=>g(this,null,function*(){yield ss({Id:t.menu.id,RootId:t.menu.rootId===Z?t.menu.id:t.menu.rootId,SubItemContainer:r.value.containerTop+"{items}"+r.value.containerBottom,SubItemTemplate:r.value.template}),n.value=!1,l("reload")});return(w,f)=>{const S=Mn,h=ye;return v(),U(h,{"model-value":n.value,"custom-class":"el-dialog",width:"1100px","close-on-click-modal":!1,title:p(o)("common.editTemplate"),onClosed:f[4]||(f[4]=i=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"menu",action:"edit"},onConfirm:_,onCancel:f[3]||(f[3]=i=>n.value=!1)})]),default:$(()=>[R("div",bs,[R("div",ws,[R("div",_s,[k(he,{modelValue:r.value.containerTop,"onUpdate:modelValue":f[0]||(f[0]=i=>r.value.containerTop=i),class:"min-h-96px h-96px",language:"html",options:u},null,8,["modelValue"])]),R("div",ks,[k(he,{ref_key:"editor",ref:s,modelValue:r.value.template,"onUpdate:modelValue":f[1]||(f[1]=i=>r.value.template=i),class:"min-h-96px h-173px",language:"html",options:u},null,8,["modelValue"]),R("div",hs,[(v(),T(q,null,W(a,(i,b)=>k(S,{key:b,size:"small",class:"rounded-full cursor-pointer",onClick:I=>m(i)},{default:$(()=>[Ae(J(b),1)]),_:2},1032,["onClick"])),64))])]),R("div",xs,[k(he,{modelValue:r.value.containerBottom,"onUpdate:modelValue":f[2]||(f[2]=i=>r.value.containerBottom=i),language:"html",class:"min-h-96px h-96px",options:u},null,8,["modelValue"])])]),R("div",Cs,[R("div",$s,J(p(o)("common.preview")),1),R("div",Ss,[R("pre",Vs,J(p(c)),1)])])])]),_:1},8,["model-value","title"])}}}),Ms={key:0},Is=G({props:{id:null},emits:["update:model"],setup(e,{expose:l,emit:t}){const o=e,{t:s}=Y(),u=ce(),a=C(),n=C(!1),r=C(!1),d=C(),c=()=>g(this,null,function*(){a.value=yield Ao(o.id,o.id),t("update:model",a.value)}),m=(h,i)=>g(this,null,function*(){const b=h.children[i.newIndex],I=h.children.splice(i.oldIndex,1)[0];h.children.splice(i.newIndex,0,I),yield Do(a.value.id,I.id,b.id),c()}),_=h=>{!u.hasAccess("menu","edit")||(d.value={parentId:h,rootId:a.value.id,name:"",url:"",values:{},urls:{}},n.value=!0)},w=h=>{!u.hasAccess("menu","edit")||(d.value=h,n.value=!0)},f=h=>g(this,null,function*(){!u.hasAccess("menu","edit")||(yield xe(),yield ts(a.value.id,h),c())}),S=h=>{d.value=h,r.value=!0};return l({onTemplateEdit:S}),c(),(h,i)=>{const b=be,I=lt,V=Xe;return a.value?(v(),T("div",Ms,[k(p(_o),{"model-value":a.value.children,group:a.value.id,"item-key":a.value.id,class:"space-y-8 mb-8",handle:".menu_move_handler","data-cy":"menu-item-wrapper",onSort:i[0]||(i[0]=x=>m(a.value,x))},{item:$(({element:x})=>[k(fs,{id:a.value.id,menu:x,onReload:c,onAdd:_,onDelete:f,onEdit:w,onTemplate:S},null,8,["id","menu"])]),_:1},8,["model-value","group","item-key"]),R("div",null,[a.value.children.length?(v(),U(V,{key:1,permission:{feature:"menu",action:"edit"},circle:"",icon:"icon-a-addto",tip:p(s)("common.addMenuItem"),"data-cy":"add-item",onClick:i[2]||(i[2]=x=>_(a.value.id))},null,8,["tip"])):(v(),U(Rn,{key:0},{button:$(()=>[k(I,{round:"",type:"primary",onClick:i[1]||(i[1]=x=>_(a.value.id))},{default:$(()=>[k(b,{class:"iconfont icon-a-addto"}),Ae(J(p(s)("common.createItemNow")),1)]),_:1})]),default:$(()=>[Ae(J(p(s)("common.createItemNowToCreateAItem"))+" ",1)]),_:1}))]),(v(),U(ro,{to:"body"},[n.value?(v(),U(gs,{key:0,modelValue:n.value,"onUpdate:modelValue":i[3]||(i[3]=x=>n.value=x),menu:d.value,onReload:c},null,8,["modelValue","menu"])):j("",!0),r.value?(v(),U(Ts,{key:1,modelValue:r.value,"onUpdate:modelValue":i[4]||(i[4]=x=>r.value=x),menu:d.value,onReload:c},null,8,["modelValue","menu"])):j("",!0)]))])):j("",!0)}}}),Rs={class:"h-full p-24"},Ls={class:"flex"},Us=R("div",{class:"flex-1"},null,-1),Es={class:"pb-8"},Ns=G({props:{id:null},setup(e){const{t:l}=Y(),t=C(),o=C();return(s,u)=>(v(),T("div",Rs,[R("div",Ls,[Us,R("div",Es,[k(Xe,{icon:"icon-code",class:"dark:text-fff/86",tip:p(l)("common.editTemplate"),"data-cy":"edit-template",onClick:u[0]||(u[0]=a=>t.value.onTemplateEdit(o.value))},null,8,["tip"])])]),k(Is,{id:e.id,ref_key:"inner",ref:t,"onUpdate:model":u[1]||(u[1]=a=>o.value=a)},null,8,["id"])]))}}),As=["onKeydown"],Ds=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue","created"],setup(e,{emit:l}){const{t}=Y(),o={name:[le(t("common.nameRequiredTips")),Te(),_e(1,50),Ce(ns,t("common.menuNameExistsTips"))]},s=C(!0),u=C(),a=jo(),n=C({name:""}),r=()=>g(this,null,function*(){yield u.value.validate();const d=yield a.createMenu(n.value.name);l("created",d),s.value=!1});return(d,c)=>{const m=me,_=pe,w=ve,f=ye;return v(),T("div",{onClick:c[4]||(c[4]=H(()=>{},["stop"]))},[k(f,{"model-value":s.value,width:"600px","close-on-click-modal":!1,title:p(t)("common.addMenu"),onClosed:c[3]||(c[3]=S=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:r,onCancel:c[2]||(c[2]=S=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(r,["enter"])},[k(w,{ref_key:"form",ref:u,"label-position":"top",model:n.value,rules:p(o),onSubmit:c[1]||(c[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(_,{label:p(t)("common.name"),prop:"name"},{default:$(()=>[k(m,{modelValue:n.value.name,"onUpdate:modelValue":c[0]||(c[0]=S=>n.value.name=S),"data-cy":"menu-name"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])],40,As)]),_:1},8,["model-value","title"])])}}}),Ut=oe.global.t,js={name:"menus",icon:"icon-menu",display:Ut("common.menu"),order:60,permission:"menu",actions:[{name:"refresh",display:Ut("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ut("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"menus"}))}}]},kt=e=>{F().addTab({id:e.id,name:e.name,panel:Ns,icon:"icon-menu"})},Ps=G({setup(e,{expose:l}){const{t}=Y(),o=jo(),s=C(!1),u=C(),a=()=>{o.load()},n=d=>g(this,null,function*(){yield xe(),yield o.deleteMenus([d])}),r=[{name:t("common.copyTitle"),invoke:d=>g(this,null,function*(){Ve(d.name)})}];return l({load:a}),(d,c)=>(v(),T("div",null,[k(re,{title:p(t)("common.list"),add:"","expand-default":!0,permission:"menu",onOnAdd:c[2]||(c[2]=m=>s.value=!0)},{default:$(()=>[(v(!0),T(q,null,W(p(o).getMenuList,m=>(v(),T(q,null,[m.children?(v(),U(Ne,{key:m.folderName+m.floor,data:m,permission:"menu",onClickHandle:c[0]||(c[0]=_=>kt(_)),onRemove:c[1]||(c[1]=_=>n(_)),onClickContextMenu:_=>{var w;return(w=u.value)==null?void 0:w.openMenu(_.event,_.item)}},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:m.id,key:m.id,permission:"menu",title:m.name,name:m.name,padding:12+m.floor*6,remove:"",onClick:_=>kt(m),onRemove:_=>n(m.id),onContextmenu:H(_=>{var w;return(w=u.value)==null?void 0:w.openMenu(_,m)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),s.value?(v(),U(Ds,{key:0,modelValue:s.value,"onUpdate:modelValue":c[3]||(c[3]=m=>s.value=m),onCreated:c[4]||(c[4]=m=>kt(m))},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:u,actions:r},null,512)]))}});var Os=Object.freeze(Object.defineProperty({__proto__:null,define:js,open:kt,default:Ps},Symbol.toStringTag,{value:"Module"}));const Fs=G({props:{model:null},emits:["save"],setup(e,{expose:l,emit:t}){const{t:o}=Y(),s=C(),u={name:[_e(1,50),le(o("common.nameRequiredTips")),go()]};return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return v(),U(c,{ref_key:"form",ref:s,"label-position":"top",model:e.model,rules:p(u),onSubmit:n[2]||(n[2]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(o)("common.name"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),"data-cy":"name",onKeydown:n[1]||(n[1]=ue(m=>t("save"),["enter"]))},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}});const Bs={key:0,class:"el-upload__tip ml-8"},qs={key:1,class:"mt-12 w-full"},Gs=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const{t}=Y(),o={name:[_e(1,50),le(t("common.nameRequiredTips")),go()],file:le(t("common.selectFileTips"))},s=C(!0),u=C(),a=C({name:"",file:null}),n=Se(),r=c=>{a.value.file=c},d=()=>g(this,null,function*(){yield u.value.validate();var c=new FormData;c.append("file",a.value.file.raw),c.append("name",a.value.name),yield ta(c),Pt(),s.value=!1,n.load()});return n.load(),ee(()=>a.value.file,()=>{a.value.file&&u.value.clearValidate("file")}),(c,m)=>{const _=me,w=pe,f=lt,S=Un,h=Ln,i=ve,b=ye;return v(),U(b,{modelValue:s.value,"onUpdate:modelValue":m[4]||(m[4]=I=>s.value=I),width:"600px","close-on-click-modal":!1,title:p(t)("common.import"),onClosed:m[5]||(m[5]=I=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{"confirm-label":p(t)("common.start"),onConfirm:d,onCancel:m[3]||(m[3]=I=>s.value=!1)},null,8,["confirm-label"])]),default:$(()=>[k(i,{ref_key:"form",ref:u,"label-position":"top",model:a.value,rules:o,onSubmit:m[2]||(m[2]=H(()=>{},["prevent"])),onKeydown:ue(d,["enter"])},{default:$(()=>[k(w,{label:p(t)("common.name"),prop:"name"},{default:$(()=>[k(_,{modelValue:a.value.name,"onUpdate:modelValue":m[0]||(m[0]=I=>a.value.name=I),"data-cy":"module-name"},null,8,["modelValue"])]),_:1},8,["label"]),k(w,{label:p(t)("common.file"),prop:"file"},{default:$(()=>[k(S,{"show-file-list":!1,action:"",accept:"application/zip","auto-upload":!1,"on-change":r,"data-cy":"upload"},{default:$(()=>[k(f,{type:"primary",round:"",plain:""},{default:$(()=>[Ae(J(p(t)("common.selectFile")),1)]),_:1})]),_:1}),a.value.file?j("",!0):(v(),T("div",Bs,J(p(t)("common.compressedPackageFileFormat")),1)),a.value.file?(v(),T("div",qs,[k(h,{title:a.value.file.name,type:"info",onClose:m[1]||(m[1]=I=>a.value.file=null)},null,8,["title"])])):j("",!0)]),_:1},8,["label"])]),_:1},8,["model","onKeydown"])]),_:1},8,["modelValue","title"])}}});var Ks=ko(Gs,[["__scopeId","data-v-38caff42"]]);const Hs=["onKeydown"],zs=["src"],Js=G({setup(e){const{t:l}=Y(),t=un(),o=Se(),s=C(!1),u=C(!1),a=C(),n=C(),r=C(),d=C(!1);let c=C();const m=()=>g(this,null,function*(){n.value={name:""},s.value=!0}),_=()=>g(this,null,function*(){yield a.value.validate(),yield o.createModule(n.value.name),s.value=!1}),w=h=>g(this,null,function*(){yield xe(),yield o.deleteModules([h])}),f=h=>{o.editModule(h),t.push(ke({name:"dev-mode",query:{activity:"modules",moduleId:h}}))},S=X(()=>{var i,b;var h=[{name:l("common.copyTitle"),invoke:I=>g(this,null,function*(){Ve(I.name)})}];return(b=(i=r.value)==null?void 0:i.payload)!=null&&b.backendViewUrl&&h.push({name:l("common.backend"),invoke:I=>g(this,null,function*(){c.value=I.backendViewUrl,d.value=!0})}),h});return(h,i)=>{const b=be,I=ye,V=at("hasPermission");return v(),T(q,null,[k(re,{title:p(l)("common.list"),add:"","expand-default":!0,permission:"module",onOnAdd:m},{bar:$(()=>[ie(k(b,{class:"iconfont icon-a-Cloudupload hover:text-blue",onClick:i[0]||(i[0]=x=>u.value=!0)},null,512),[[V,{feature:"module",action:"edit",effect:"hiddenIcon"}]])]),default:$(()=>[(v(!0),T(q,null,W(p(o).list,x=>(v(),U(ae,{id:x.id,key:x.id,title:x.name,remove:"",permission:"module",onRemove:y=>w(x.id),onClick:y=>f(x.id),onContextmenu:H(y=>{var M;return(M=r.value)==null?void 0:M.openMenu(y,x)},["prevent","stop"])},null,8,["id","title","onRemove","onClick","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:i[3]||(i[3]=H(()=>{},["stop"]))},[k(I,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=x=>s.value=x),width:"600px","close-on-click-modal":!1,title:p(l)("common.newModule"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:i[1]||(i[1]=x=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(_,["enter"])},[n.value?(v(),U(Fs,{key:0,ref_key:"form",ref:a,model:n.value},null,8,["model"])):j("",!0)],40,Hs)]),_:1},8,["modelValue","title"])]),u.value?(v(),U(Ks,{key:0,modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=x=>u.value=x)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:r,actions:p(S)},null,8,["actions"]),k(I,{modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=x=>d.value=x),width:"1000px","close-on-click-modal":!1,"custom-class":"el-dialog--zero-padding",title:p(l)("common.manage"),onClosed:i[6]||(i[6]=x=>d.value=!1)},{default:$(()=>[R("iframe",{src:p(c),class:"w-full h-500px"},null,8,zs)]),_:1},8,["modelValue","title"])],64)}}}),Ws={class:"h-full"},Qs=G({props:{id:null,params:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=C(""),u=Pe(),a=Se(),n=()=>g(this,null,function*(){s.value=yield aa(o.params.file.objectType,o.params.moduleId,o.params.file.name),u.init(s.value)}),r=()=>g(this,null,function*(){!s.value||(yield So(o.params.file.objectType,o.params.moduleId,o.params.file.name,s.value),u.init(s.value),t("changed",!1),t("setAction","save",{visible:!1}))}),d=Ee(()=>o.params.file.name==="Module.config"),c=Ee(()=>{var _;if(o.params.file.objectType=="code"||o.params.file.objectType=="api"){const w=(_=a.list.find(S=>S.id==o.params.moduleId))==null?void 0:_.name;let f=o.params.file.name;return`file:///node_modules/@types/module:${w}/${f}.ts`}return d.value?`memory:///module:${o.params.moduleId}/${o.params.file.name}`:`memory:///${jt()}`}),m=Ee(()=>o.params.file.objectType==="css"?"css":o.params.file.objectType==="js"?"javascript":o.params.file.objectType==="view"||o.params.file.objectType==="backend"?"html":o.params.file.objectType==="api"||o.params.file.objectType==="code"?"typescript":o.params.file.name==="Module.config"?"json":o.params.file.name==="Dashboard.js"||o.params.file.name==="Event.js"?"typescript":"");return ee(()=>s.value,()=>{t("changed",u.changed(s.value)),t("setAction","save",{visible:u.changed(s.value)})},{deep:!0}),n(),l({save:r,load:n}),(_,w)=>(v(),T("div",Ws,[k(he,{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=f=>s.value=f),uri:p(c),language:p(m),"k-script":""},null,8,["modelValue","uri","language"])]))}}),Xs={class:"h-full"},Ys={class:"ellipsis w-120px h-24 leading-6"},Zs=G({props:{id:null,name:null,params:null},setup(e){const l=e,{t}=Y(),o=()=>{St(l.params.url+"?__content_type=application/octet-stream")};return(s,u)=>{const a=lt,n=ho;return v(),T("div",Xs,[k(n,{icon:"info",title:p(t)("common.canNotOpenFile")},{"sub-title":$(()=>[R("p",null,J(p(t)("common.canNotOpenFileTip")),1)]),extra:$(()=>{var r;return[(r=e.params)!=null&&r.url?(v(),U(a,{key:0,round:"",plain:"",type:"primary",onClick:o},{default:$(()=>[R("span",Ys,J(p(t)("common.downloadThisFile")),1)]),_:1})):j("",!0)]}),_:1},8,["title"])])}}}),ei=G({props:{id:null,name:null,params:null},emits:["changed"],setup(e,{expose:l,emit:t}){const o=e,s=C(),u=C();nt(()=>{const n=ge(ge({},o),o.params);u.value=n});const a=()=>g(this,null,function*(){yield Vo(o.params.type,o.params.moduleId,o.name,s.value.split("base64,")[1]),t("changed",!1)});return ee(()=>s.value,()=>{t("changed",!0)}),l({save:a}),(n,r)=>u.value?(v(),U(p(Nn),{key:0,base64:s.value,"onUpdate:base64":r[0]||(r[0]=d=>s.value=d),name:u.value.name,url:u.value.url},null,8,["base64","name","url"])):j("",!0)}});const ti={class:"relative group flex items-center"},oi=["accept","onChange"],ni=["onKeydown"],ai={class:"w-full flex space-x-4"},li=G({setup(e){const{t:l}=Y(),t=Se(),o=ce(),s=F(),u=C(!1),a=C(),n=C(),{onPreview:r}=we(),d={name:[le(l("common.nameRequiredTips")),_e(1,50),Te()]},c=C({name:"",extension:""}),m=C(),_=x=>g(this,null,function*(){m.value=x,c.value.extension=x.defaultExtension,u.value=!0}),w=()=>g(this,null,function*(){yield a.value.validate();let x=c.value.name;yield t.createModuleFile(x,m.value);const y=t.files.find(M=>{var L;return M.name==c.value.name+M.extension&&M.objectType==((L=m.value)==null?void 0:L.name)});y&&i(y),u.value=!1}),f=(x,y,M)=>g(this,null,function*(){yield xe(),yield t.deleteModuleFile(x,y),s.deleteTab(M)}),S=x=>{x.isBinary?h(x):i(x)},h=x=>{s.addTab({id:x.id,name:x.name,panel:x.objectType==="img"?ei:Zs,icon:"icon-classification",params:{url:x.previewUrl,type:x.objectType,moduleId:t.editingModule}})},i=x=>{const y=t.types.find(L=>L.name==x.objectType),M={id:x.id,name:x.name,panel:Qs,icon:"icon-classification",params:{type:y,file:x,moduleId:t.editingModule},actions:[{name:"save",visible:!1,icon:"icon-preservation",display:l("common.save"),invoke:()=>g(this,null,function*(){var O,D;const L=yield(D=(O=F().activeTab)==null?void 0:O.panelInstance)==null?void 0:D.promise;!L||L.save()})},{name:"refresh",display:l("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(this,null,function*(){var O,D;const L=yield(D=(O=F().activeTab)==null?void 0:O.panelInstance)==null?void 0:D.promise;!L||L.load()})}]};x.objectType!=="root"&&x.objectType!=="code"&&M.actions.push({name:"open",display:l("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(this,null,function*(){r(x.previewUrl)})}),s.addTab(M)};function b(x,y){var M=x.target.files[0];if(!!M){var L=new FileReader;L.readAsDataURL(M),L.onload=function(O){var D=O.target.result;t.uploadModuleFile(M.name,D.split("base64,")[1],y)}}}function I(){c.value={name:"",extension:""}}const V=X(()=>{var y,M,L,O;var x=[{name:l("common.copyTitle"),invoke:D=>g(this,null,function*(){Ve(D.name)})}];return((M=(y=n.value)==null?void 0:y.payload)==null?void 0:M.previewUrl)&&((O=(L=n.value)==null?void 0:L.payload)==null?void 0:O.objectType)!="root"&&x.push({name:l("common.preview"),invoke:D=>g(this,null,function*(){r(D.previewUrl)})}),x});return(x,y)=>{var A;const M=be,L=En,O=me,D=pe,P=ve,B=ye;return v(),T("div",null,[(v(!0),T(q,null,W(p(t).types,K=>(v(),U(re,{key:K.name,title:K.displayName,add:K.isText&&K.name!=="root","expand-default":!0,permission:"module",onOnAdd:ne=>_(K)},{bar:$(()=>[R("div",ti,[K.isBinary&&p(o).hasAccess("module","edit")?(v(),U(M,{key:0,class:"iconfont icon-a-Cloudupload group-hover:text-blue","data-cy":"import"})):j("",!0),R("input",{class:"!cursor-pointer absolute inset-0 !opacity-0 bg-green overflow-hidden",type:"file",title:" ",accept:K.name=="img"?"image/*":"","data-cy":"upload",onChange:ne=>b(ne,K)},null,40,oi)])]),default:$(()=>[(v(!0),T(q,null,W(p(t).files.filter(ne=>ne.objectType===K.name),ne=>(v(),U(ae,{id:ne.id,key:ne.name,title:ne.name,remove:ne.objectType!=="root",permission:"module",onRemove:Le=>f(ne.name,ne.objectType,ne.id),onClick:Le=>S(ne),onContextmenu:H(Le=>{var yt;return(yt=n.value)==null?void 0:yt.openMenu(Le,ne)},["prevent","stop"])},null,8,["id","title","remove","onRemove","onClick","onContextmenu"]))),128))]),_:2},1032,["title","add","onOnAdd"]))),128)),(v(),U(ro,{to:"body"},[R("div",{onClick:y[4]||(y[4]=H(()=>{},["stop"]))},[k(B,{modelValue:u.value,"onUpdate:modelValue":y[3]||(y[3]=K=>u.value=K),width:"600px","close-on-click-modal":!1,title:p(l)("common.newModuleType",{type:(A=m.value)==null?void 0:A.displayName}),"destroy-on-close":"",onClose:I},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:y[2]||(y[2]=K=>u.value=!1)})]),default:$(()=>{var K,ne;return[((K=m.value)==null?void 0:K.displayName)==="View"||((ne=m.value)==null?void 0:ne.displayName)==="Backend"?(v(),U(L,{key:0,class:"-mx-32 -mt-24 mb-12",title:p(l)("common.moduleViewEntrance"),content:p(l)("common.moduleViewEntranceTips")},null,8,["title","content"])):j("",!0),R("div",{onKeydown:ue(w,["enter"])},[c.value?(v(),U(P,{key:0,ref_key:"form",ref:a,"label-position":"top",model:c.value,rules:d,onSubmit:y[1]||(y[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(D,{label:p(l)("common.name"),prop:"name"},{default:$(()=>[R("div",ai,[k(O,{modelValue:c.value.name,"onUpdate:modelValue":y[0]||(y[0]=Le=>c.value.name=Le),class:"flex-1","data-cy":"module-file-name"},null,8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model"])):j("",!0)],40,ni)]}),_:1},8,["modelValue","title"]),k(Me,{ref_key:"contextMenu",ref:n,actions:p(V)},null,8,["actions"])])]))])}}});var si=ko(li,[["__scopeId","data-v-645d2160"]]);const wt=oe.global.t,ii={name:"modules",icon:"icon-classification",display:wt("common.modules"),order:100,permission:"module",actions:[{name:"back",display:wt("common.back"),icon:"icon-go-back",visible:!1,invoke(){se.push(ke({name:"dev-mode",query:{activity:"modules"}})),Se().exitEditModule()}},{name:"refresh",display:wt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:wt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"modules"}))}}]},ri=G({setup(e,{expose:l}){const t=Se(),o=F(),s=ce(),u=De(),a=C([]),n=()=>{t.load(),r()},r=()=>g(this,null,function*(){var d;!s.hasAccess("module","view")||(a.value=yield Co(),u.query.moduleId&&u.query.activity==="modules"&&(t.editModule(u.query.moduleId),o.activeActivity&&(o.activeActivity.panelDisplay=(d=a.value.find(c=>c.id===u.query.moduleId))==null?void 0:d.name)))});return ee(()=>u.query.moduleId,()=>{u.query.moduleId&&r()},{immediate:!0}),l({load:n}),(d,c)=>(v(),T("div",null,[p(t).editingModule&&p(t).types.length?(v(),U(si,{key:0})):j("",!0),p(t).editingModule?j("",!0):(v(),U(Js,{key:1}))]))}});var ui=Object.freeze(Object.defineProperty({__proto__:null,define:ii,default:ri},Symbol.toStringTag,{value:"Module"}));function Po(e){return{id:e.id,name:e.name,body:e.body,url:e.urlPath,title:e.title,cacheByVersion:e.cacheByVersion,cacheMinutes:e.cacheMinutes,cacheQueryKeys:e.cacheQueryKeys,enableCache:e.enableCache,published:e.published}}var di=(e=>(e.TagName="TagName",e.Id="Id",e.Class="Class",e))(di||{}),ci=(e=>(e.Equal="Equal",e.StartWith="StartWith",e.Contains="Contains",e))(ci||{});const mi={key:0,class:"h-full"},We=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=ft(),u=F(),a=C(),n=Pe((f,S)=>{if(!(f==="urlPath"&&S))return S}),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getPage(o.id),d.resolve(null),n.init(a.value)}),m=f=>g(this,null,function*(){!a.value||(a.value.urlPath=f.urlPath)}),_=()=>g(this,null,function*(){!a.value||(yield s.updatePage(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))}),w=(f,S)=>g(this,null,function*(){yield d.promise,S?r.value.search(S,f):r.value.goToLine(f)});return ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:_,load:c,goToLine:w,updateModel:m}),(f,S)=>a.value?(v(),T("div",mi,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":S[0]||(S[0]=h=>a.value.body=h),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:S[1]||(S[1]=h=>p(u).addTabRecord(o.id,h,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),pi={key:0,class:"h-full"},st=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=ft(),u=F(),a=C(),n=Pe((f,S)=>{if(!["url","published","title"].includes(f))return S}),r=C(),d=new $e,c=()=>g(this,null,function*(){const f=yield s.getPage(o.id);d.resolve(null),a.value=Po(f),n.init(a.value)}),m=f=>g(this,null,function*(){!a.value||(a.value.url=f.path,a.value.title=f.title,a.value.published=f.online)}),_=()=>g(this,null,function*(){!a.value||(yield s.updateRichPage(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))}),w=(f,S)=>g(this,null,function*(){yield d.promise,S?r.value.search(S,f):r.value.goToLine(f)});return ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:_,load:c,goToLine:w,updateModel:m}),(f,S)=>a.value?(v(),T("div",pi,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":S[0]||(S[0]=h=>a.value.body=h),language:"html",uri:p(je).file(a.value.id),onMonacoLoadComplete:S[1]||(S[1]=h=>p(u).addTabRecord(o.id,h,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),vi=G({props:{model:null,oldUrlPath:null},setup(e,{expose:l}){const t=e,{t:o}=Y(),s=C(),u=n=>{!t.model||t.model.urlPath||(t.model.urlPath=`/${n}`)},a=X(()=>({name:[t.model.id===Z?[_e(1,50),le(o("common.nameRequiredTips")),Ce(Ro,o("common.thePageNameAlreadyExists"))]:[]],urlPath:[le(o("common.urlRequiredTips")),t.oldUrlPath===t.model.urlPath?"":Ce(n=>Lo(n,t.oldUrlPath),o("common.urlOccupied"))]}));return l({validate:()=>{var n;return(n=s.value)==null?void 0:n.validate()}}),(n,r)=>{const d=me,c=pe,m=ve;return v(),U(m,{ref_key:"form",ref:s,model:e.model,rules:p(a),onSubmit:r[4]||(r[4]=H(()=>{},["prevent"]))},{default:$(()=>[k(c,{label:p(o)("common.pageName"),prop:"name"},{default:$(()=>[k(d,{modelValue:e.model.name,"onUpdate:modelValue":r[0]||(r[0]=_=>e.model.name=_),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"page-name",onInput:r[1]||(r[1]=_=>e.model.name=e.model.name.replace(/\s+/g,"")),onChange:u},null,8,["modelValue","disabled","title"])]),_:1},8,["label"]),k(c,{label:"URL",prop:"urlPath"},{default:$(()=>[k(d,{modelValue:e.model.urlPath,"onUpdate:modelValue":r[2]||(r[2]=_=>e.model.urlPath=_),class:"min-w-300px","data-cy":"url",onInput:r[3]||(r[3]=_=>e.model.urlPath=e.model.urlPath.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])}}}),fi=G({props:{model:null,oldUrl:null},setup(e,{expose:l}){const t=e,{t:o}=Y(),s=C(),u=n=>{!t.model||t.model.url||(t.model.url=`/${n}`)},a=X(()=>({name:t.model.id!==Z?[]:[_e(1,50),le(o("common.nameRequiredTips")),Ce(Ro,o("common.thePageNameAlreadyExists"))],url:[le(o("common.urlRequiredTips")),t.oldUrl===t.model.url?"":Ce(n=>Lo(n,t.oldUrl),o("common.urlOccupied"))],title:[le(o("common.titleRequiredTips"))]}));return l({validate:()=>{var n;return(n=s.value)==null?void 0:n.validate()}}),(n,r)=>{const d=me,c=pe,m=Ft,_=ve;return v(),U(_,{ref_key:"form",ref:s,"label-position":"top",model:e.model,rules:p(a),onSubmit:r[6]||(r[6]=H(()=>{},["prevent"]))},{default:$(()=>[k(c,{label:p(o)("common.pageName"),prop:"name"},{default:$(()=>[k(d,{modelValue:e.model.name,"onUpdate:modelValue":r[0]||(r[0]=w=>e.model.name=w),class:"min-w-325px",title:e.model.name,disabled:e.model.id!==p(Z),"data-cy":"page-name",onInput:r[1]||(r[1]=w=>e.model.name=e.model.name.replace(/\s+/g,"")),onChange:u},null,8,["modelValue","title","disabled"])]),_:1},8,["label"]),k(c,{label:"URL",prop:"url"},{default:$(()=>[k(d,{modelValue:e.model.url,"onUpdate:modelValue":r[2]||(r[2]=w=>e.model.url=w),class:"min-w-325px","data-cy":"url",onInput:r[3]||(r[3]=w=>e.model.url=e.model.url.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1}),k(c,{label:p(o)("common.title"),prop:"title"},{default:$(()=>[k(d,{modelValue:e.model.title,"onUpdate:modelValue":r[4]||(r[4]=w=>e.model.title=w),class:"min-w-325px","data-cy":"title"},null,8,["modelValue"])]),_:1},8,["label"]),Ke(n.$slots,"default"),k(c,{label:p(o)("page.online")},{default:$(()=>[k(m,{modelValue:e.model.published,"onUpdate:modelValue":r[5]||(r[5]=w=>e.model.published=w)},null,8,["modelValue"])]),_:1},8,["label"])]),_:3},8,["model","rules"])}}}),yi=["onKeydown"],et=oe.global.t,gi={name:"pages",icon:"icon-copy",display:et("common.page"),route:"pages",order:0,permission:"pages",actions:[{name:"refresh",display:et("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:et("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"pages"}))}}]},Ue=(e,l)=>{if(e.type==="Designer"){const t=yo(e.id,e.layoutId);St(se.resolve(t).href);return}F().addTab({id:e.id,name:e.name,panel:l,icon:"icon-copy",actions:[{name:"save",visible:!1,display:et("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.save()})},{name:"refresh",visible:!0,display:et("common.refresh"),icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.load()})},{name:"open",visible:!0,display:et("common.preview"),icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const t=ft();let o=t.list.find(s=>s.id===e.id);if(o||(yield t.load(),o=t.list.find(s=>s.id===e.id)),o){const{onPreview:s}=we();s(o.previewUrl)}})}]})},bi=G({setup(e,{expose:l}){const{t}=Y(),o=De(),s=ft(),u=Gt(),a=C(!1),n=C(),r=C(),d=C(),c=C(!1);let m=C("normal");const _=C(),w=C(),f=new on,S=ce(),h=()=>g(this,null,function*(){d.value=yield s.getPage(),d.value.published=!0,m.value="normal",a.value=!0}),i=B=>g(this,null,function*(){d.value=yield s.getPage(),d.value.published=!0;const A=yield Eo(B),K=_n(A.name,A.body);d.value.body=kn(K),m.value="layout",a.value=!0}),b=()=>g(this,null,function*(){m.value="rich",d.value={id:Z,body:"",title:"",name:"",url:"",cacheByVersion:!1,cacheMinutes:3,enableCache:!1,cacheQueryKeys:" ",published:!0},a.value=!0}),I=(B,A)=>g(this,null,function*(){m.value=A,d.value=yield s.getPage(B),_.value=d.value.urlPath,A==="rich"&&(d.value=Po(d.value)),a.value=!0}),V=()=>g(this,null,function*(){if(m.value==="rich"){yield r.value.validate();const B=yield s.updateRichPage(d.value);yield s.load();const A=s.list.find(K=>K.id==B);A&&Ue(A,st),P(A)}else{yield n.value.validate();const B=yield s.updatePage(d.value);B.type!=="Designer"&&Ue(B,We),s.load(),P(B)}a.value=!1}),x=B=>g(this,null,function*(){yield xe(),yield s.deletePages([B])}),y=()=>{s.load(),u.load()},M=B=>{let A=se.resolve(ke({name:"inline-design",query:{path:B.path,access_token:f.get("jwt_token"),inline_design_lang:nn(),scheme:localStorage.getItem("vueuse-color-scheme")}})).href;return A=dn(S.site.baseUrl,A),A},L=C(!1),O=X(()=>{const B=[{show:!0,name:t("common.copyTitle"),invoke:A=>g(this,null,function*(){Ve(A.name)})},{show:!0,name:t("common.preview"),invoke:A=>g(this,null,function*(){const{onPreview:K}=we();K(A.previewUrl)})}];return L.value||B.push({show:!0,name:t("common.settings"),invoke:A=>g(this,null,function*(){St(se.resolve(ke({name:A.type==="RichText"?"rich-page-edit":A.layoutId===Z?"page-setting":"layout-page-setting",query:{id:A.id,layoutId:A.layoutId===Z?void 0:A.layoutId}})).href)})}),B.push({show:S.hasAccess("pages","edit"),name:t("common.inlineEditor"),invoke:A=>g(this,null,function*(){const{onPreview:K}=we();K(M(A))})}),B});function D(B,A){var K;L.value=A.type==="Designer",(K=w.value)==null||K.openMenu(B,A)}l({load:y});const P=He("updateTabModel");return(B,A)=>{var Ht;const K=be,ne=Vt,Le=Tt,yt=ye,gt=at("hasPermission");return v(),T(q,null,[k(re,{ref:"collapse",permission:"pages",title:p(t)("common.normalPage"),add:"","expand-default":!0,onOnAdd:h},{default:$(()=>[(v(!0),T(q,null,W(p(s).getNormalPage,z=>(v(),T(q,null,[z.children?(v(),U(Ne,{ref_for:!0,ref:"reSubMenu",key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[0]||(A[0]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[1]||(A[1]=Q=>x(Q)),onEdit:A[2]||(A[2]=Q=>I(Q.id,"normal")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,We),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"normal")},null,8,["onClick"]),[[gt,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(t)("common.layoutPage"),"expand-default":!0,permission:"pages"},{bar:$(()=>[p(u).list.length?(v(),U(Le,{key:0,trigger:"click",onCommand:i,onVisibleChange:A[3]||(A[3]=z=>c.value=z)},{dropdown:$(()=>[(v(!0),T(q,null,W(p(u).list,z=>(v(),U(ne,{key:z.id,command:z.id},{default:$(()=>[Ae(J(z.name),1)]),_:2},1032,["command"]))),128))]),default:$(()=>[ie(k(K,{class:de(["iconfont icon-a-addto opacity-0 group-hover:opacity-100 hover:text-blue",c.value?"opacity-100":""])},null,8,["class"]),[[gt,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:1})):j("",!0)]),default:$(()=>[(v(!0),T(q,null,W(p(s).getLayoutPage,z=>(v(),T(q,null,[z.children?(v(),U(Ne,{key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[4]||(A[4]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[5]||(A[5]=Q=>x(Q)),onEdit:A[6]||(A[6]=Q=>I(Q.id,"layout")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,We),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"layout")},null,8,["onClick"]),[[gt,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(t)("common.richTextPage"),add:"","expand-default":!0,permission:"pages",onOnAdd:b},{default:$(()=>[(v(!0),T(q,null,W(p(s).getRichPage,z=>(v(),T(q,null,[z.children?(v(),U(Ne,{key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[7]||(A[7]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[8]||(A[8]=Q=>x(Q)),onEdit:A[9]||(A[9]=Q=>I(Q.id,"rich")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,st),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"rich")},null,8,["onClick"]),[[gt,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:A[12]||(A[12]=H(()=>{},["stop"]))},[k(yt,{modelValue:a.value,"onUpdate:modelValue":A[11]||(A[11]=z=>a.value=z),width:"600px","close-on-click-modal":!1,title:((Ht=d.value)==null?void 0:Ht.id)==p(Z)?p(t)("common.newPage"):p(t)("common.editPage"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:V,onCancel:A[10]||(A[10]=z=>a.value=!1)})]),default:$(()=>[d.value?(v(),T("div",{key:0,onKeydown:ue(V,["enter"])},[p(m)==="rich"?(v(),U(fi,{key:0,ref_key:"richForm",ref:r,"old-url":_.value,"label-position":"top",model:d.value},null,8,["old-url","model"])):(v(),U(vi,{key:1,ref_key:"form",ref:n,"old-url-path":_.value,"label-position":"top",model:d.value},null,8,["old-url-path","model"]))],40,yi)):j("",!0)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:w,actions:p(O).filter(z=>z.show===!0)},null,8,["actions"])],64)}}});var wi=Object.freeze(Object.defineProperty({__proto__:null,define:gi,open:Ue,default:bi},Symbol.toStringTag,{value:"Module"}));const Oo=oe.global.t,_i=()=>N.get(E("Script/External",!0)),ki=()=>N.get(E("Script/Embedded",!0)),hi=e=>N.get(E("Script/Get"),{id:e}),xi=e=>N.post(E("Script/Update"),e),Ci=e=>N.post(E("Script/Deletes"),{ids:e},void 0,{successMessage:Oo("common.deleteSuccess")}),$i=e=>N.post(E("Upload/Script"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},successMessage:Oo("common.uploadSuccess")}),Si=e=>N.get(E("Script/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Fo=oe.global.t,Bo=e=>N.get(E(`ResourceGroup/${e}`,!0)),qo=e=>N.post(E("ResourceGroup/Update"),e,void 0,{successMessage:Fo("common.saveSuccess")}),Go=e=>N.post(E("ResourceGroup/Deletes"),{ids:e},void 0,{successMessage:Fo("common.deleteSuccess")}),Ko=(e,l)=>N.get(E("ResourceGroup/isUniqueName"),{name:e,type:l},{hiddenLoading:!0,hiddenError:!0}),Ho=e=>N.get(E("ResourceGroup/Get"),{id:e}),Mt=Re("scriptStore",()=>{const e=ce(),l=F(),t=C([]),o=C([]),s=C([]),u=X(()=>{const i=[];return i.push(...t.value.map(b=>({id:b.id,name:b.name,href:b.routeName,fullPath:b.fullUrl}))),i.push(...o.value.map(b=>({id:b.id,name:b.name,href:b.relativeUrl,fullPath:b.previewUrl}))),i}),a=()=>g(void 0,null,function*(){t.value=yield _i()}),n=()=>g(void 0,null,function*(){o.value=yield Bo("Script")}),r=()=>g(void 0,null,function*(){s.value=yield ki()}),d=()=>{a(),n(),r()},c=i=>Ho(i),m=i=>g(void 0,null,function*(){yield qo(i),n()}),_=i=>g(void 0,null,function*(){yield Go(i),l.deleteTabs(i),n()}),w=i=>g(void 0,null,function*(){const b=new FormData;b.append("file",i),yield $i(b),a()}),f=i=>g(void 0,null,function*(){const b=yield hi(i);return b.body||(b.body=""),b}),S=(i,b)=>g(void 0,null,function*(){i.enableDiffChecker=!0;const I=yield xi(i);return e.site.recordSiteLogVideo&&b&&(yield Be(I,b,i.isEmbedded)),Object.assign(i,yield f(I))}),h=i=>g(void 0,null,function*(){yield Ci(i),l.deleteTabs(i),d()});return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},()=>{t.value=[],s.value=[],o.value=[]}),{external:t,embedded:s,group:o,all:u,getGroup:c,updateGroup:m,deleteGroups:_,uploadScript:w,deleteScripts:h,getScript:f,updateScript:S,loadAll:d,loadEmbedded:r,loadExternal:a,loadGroups:n}}),Vi={key:0,class:"h-full"},Ti=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=Mt(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getScript(o.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateScript(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))}),_=(w,f)=>g(this,null,function*(){yield d.promise,f?r.value.search(f,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,f)=>a.value?(v(),T("div",Vi,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":f[0]||(f[0]=S=>a.value.body=S),language:"javascript",uri:p(je).from({scheme:"memory",path:a.value.id}),onMonacoLoadComplete:f[1]||(f[1]=S=>p(u).addTabRecord(o.id,S,"javascript"))},null,8,["modelValue","uri"])])):j("",!0)}});const Mi={class:"p-24"},Ii={class:"flex items-center"},Ri={key:0,class:"w-100px !h-40px flex items-center justify-center"},Li={class:"max-w-400px truncate"},Ui={key:0},Ei=R("div",null,null,-1),zo=G({props:{id:null,hiddenName:{type:Boolean}},emits:["save"],setup(e,{expose:l,emit:t}){const o=e,{t:s}=Y(),u=Mt(),a=C(),n=C({id:o.id||Z,name:"",typeName:"Script",children:[]}),r=X(()=>n.value.id!==Z),d=()=>g(this,null,function*(){n.value=yield u.getGroup(n.value.id)}),c=X(()=>{const h=[];for(const i of u.external)n.value.children.some(b=>b.routeId===i.routeId)||h.push({name:i.name,routeId:i.routeId,url:i.routeName});return h}),m=X(()=>{const h={name:[_e(1,50),le(s("common.nameRequiredTips")),Te(),{asyncValidator(b,I,V){return g(this,null,function*(){try{yield Ko(I,"script")}catch(x){V(Error(s("common.nameExist")))}})},trigger:"blur"}]};return r.value&&delete h.name,h}),_=()=>g(this,null,function*(){var h;yield(h=a.value)==null?void 0:h.validate(),yield u.updateGroup(n.value)}),w=h=>{const i=c.value.find(b=>b.routeId===h);i&&n.value.children.push(i)},f=h=>{const i=n.value.children.splice(h.oldIndex,1)[0];n.value.children.splice(h.newIndex,0,i)},S=h=>{const i=n.value.children.findIndex(b=>b.routeId===h);n.value.children.splice(i,1)};return n.value.id!==Z&&d(),l({save:_}),(h,i)=>{const b=me,I=pe,V=ve,x=be,y=lt,M=Vt,L=Ot,O=Tt;return v(),T("div",Mi,[e.hiddenName?j("",!0):(v(),U(V,{key:0,ref_key:"form",ref:a,"label-position":"top",model:n.value,rules:p(m),onSubmit:i[1]||(i[1]=H(()=>{},["prevent"])),onKeydown:i[2]||(i[2]=ue(D=>t("save"),["enter"]))},{default:$(()=>[k(I,{label:p(s)("common.name"),prop:"name"},{default:$(()=>[k(b,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value.name=D),disabled:p(r),"data-cy":"group-name"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),k(O,{trigger:"click","max-height":"300px",onCommand:w},{dropdown:$(()=>[Object.keys(p(c)).length==0?(v(),T("div",Ri,[R("span",null,J(p(s)("common.noData")),1)])):(v(),U(L,{key:1},{default:$(()=>[(v(!0),T(q,null,W(p(c),D=>(v(),U(M,{key:D.routeId,command:D.routeId,"data-cy":"script-opt"},{default:$(()=>[R("div",Li,[R("span",null,J(D.name),1),D.url?(v(),T("span",Ui,"("+J(D.url)+")",1)):j("",!0)])]),_:2},1032,["command"]))),128))]),_:1}))]),default:$(()=>[k(y,{round:"",class:"shadow-s-10 border-none","data-cy":"add-script"},{default:$(()=>[R("div",Ii,[R("span",null,J(p(s)("common.addScript")),1),k(x,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})])]),_:1})]),_:1}),k(xo,{class:"!px-0",list:n.value.children,"display-prop":"name","id-prop":"routeId",onSort:f,onDelete:S},{bottom:$(()=>[Ei]),_:1},8,["list"])])}}}),Ni={class:"h-full"},Ai=G({props:{id:null},setup(e,{expose:l}){const t=C();return l({save:()=>g(this,null,function*(){t.value.save()})}),(s,u)=>(v(),T("div",Ni,[k(zo,{id:e.id,ref_key:"inner",ref:t,"hidden-name":""},null,8,["id"])]))}}),Di=G({props:{model:null},setup(e,{expose:l}){const t=e,{t:o}=Y(),s=C(),u=X(()=>({name:t.model.id!==Z?"":[_e(1,64),le(o("common.nameRequiredTips")),Te(),Ce(Si,o("common.scriptNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return v(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(o)("common.scriptName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"script-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),ji=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const{t}=Y(),o=C(!0),s=C(),u=()=>g(this,null,function*(){yield s.value.save(),o.value=!1});return(a,n)=>{const r=ye;return v(),T("div",{onClick:n[2]||(n[2]=H(()=>{},["stop"]))},[k(r,{"model-value":o.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:p(t)("common.scriptGroup"),onClosed:n[1]||(n[1]=d=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"script",action:"edit"},onConfirm:u,onCancel:n[0]||(n[0]=d=>o.value=!1)})]),default:$(()=>[k(zo,{id:e.id,ref_key:"inner",ref:s,class:"p-32",onSave:u},null,8,["id"])]),_:1},8,["model-value","title"])])}}}),Pi=["onKeydown"],tt=oe.global.t,Oi={name:"scripts",icon:"icon-js",display:tt("common.script"),order:40,permission:"script",actions:[{name:"refresh",display:tt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:tt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"scripts"}))}}]},ht=e=>{const l=[{name:"save",visible:!1,display:tt("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.save()})},{name:"refresh",display:tt("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.load()})}];e.ownerObjectId===Z&&l.push({name:"open",display:tt("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const t=Mt();let o=t.all.find(s=>s.id===e.id);if(o||(yield Promise.all([t.loadExternal(),t.loadGroups()]),o=t.all.find(s=>s.id===e.id)),o){const{onPreview:s}=we();s(o.fullPath)}})}),F().addTab({id:e.id,name:e.name,panel:Ti,icon:"icon-js",actions:l})},Fi=G({setup(e,{expose:l}){const{t}=Y(),o=Mt(),s=F(),u=C(!1),a=C(!1),n=C(),r=C(),d=C(),c=i=>{const b=[{name:"save",visible:!1,display:t("common.save"),icon:"icon-preservation",invoke:()=>g(this,null,function*(){var V,x;const I=yield(x=(V=F().activeTab)==null?void 0:V.panelInstance)==null?void 0:x.promise;!I||I.save()})}];i.previewUrl&&b.push({name:"open",display:t("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>{const{onPreview:I}=we();I(i.previewUrl)}}),s.addTab({id:i.id,name:i.name,panel:Ai,icon:"icon-js",actions:b})},m=()=>g(this,null,function*(){d.value={id:Z,name:"",body:"",extension:"js",isEmbedded:!1,ownerObjectId:void 0},u.value=!0}),_=()=>g(this,null,function*(){yield n.value.validate();const i=yield o.updateScript(d.value);ht(i),o.loadExternal(),u.value=!1}),w=i=>g(this,null,function*(){yield xe(),yield o.deleteScripts([i])}),f=i=>g(this,null,function*(){yield xe(),o.deleteGroups([i])}),S=()=>{o.loadAll()},h=X(()=>{var I,V,x,y,M,L;var i=[{name:t("common.copyTitle"),invoke:O=>g(this,null,function*(){Ve(O.name)})}],b=((V=(I=r.value)==null?void 0:I.payload)==null?void 0:V.fullUrl)||((y=(x=r.value)==null?void 0:x.payload)==null?void 0:y.previewUrl);return b&&!((L=(M=r.value)==null?void 0:M.payload)!=null&&L.isEmbedded)&&i.push({name:t("common.preview"),invoke:O=>g(this,null,function*(){const{onPreview:D}=we();D(b)})}),i});return l({load:S}),(i,b)=>{const I=ye;return v(),T("div",null,[k(re,{title:p(t)("common.external"),add:"","expand-default":!0,permission:"script",onOnAdd:m},{default:$(()=>[(v(!0),T(q,null,W(p(o).external,V=>(v(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>ht(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=r.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(t)("common.embedded"),"expand-default":!0,permission:"script"},{default:$(()=>[(v(!0),T(q,null,W(p(o).embedded,V=>(v(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>ht(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=r.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(t)("common.group"),add:"","expand-default":!0,permission:"script",onOnAdd:b[0]||(b[0]=V=>a.value=!0)},{default:$(()=>[(v(!0),T(q,null,W(p(o).group,V=>(v(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>c(V),onRemove:x=>f(V.id),onContextmenu:H(x=>{var y;return(y=r.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:b[3]||(b[3]=H(()=>{},["stop"]))},[k(I,{modelValue:u.value,"onUpdate:modelValue":b[2]||(b[2]=V=>u.value=V),width:"600px","close-on-click-modal":!1,title:p(t)("common.newScript"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:b[1]||(b[1]=V=>u.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(_,["enter"])},[d.value?(v(),U(Di,{key:0,ref_key:"form",ref:n,"label-position":"top",model:d.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Pi)]),_:1},8,["modelValue","title"])]),a.value?(v(),U(ji,{key:0,modelValue:a.value,"onUpdate:modelValue":b[4]||(b[4]=V=>a.value=V)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:r,actions:p(h)},null,8,["actions"])])}}});var Bi=Object.freeze(Object.defineProperty({__proto__:null,define:Oi,open:ht,default:Fi},Symbol.toStringTag,{value:"Module"}));const qi={class:"highlight"},Gi={key:0,class:"active"},Ki=G({props:{light:{default:()=>({background:"#f0c1a3",color:"#616161"})},dark:{default:()=>({background:"#595961",color:"#f8f8f2"})},keyword:null,text:null,maxLength:{default:16},pattern:{default:"all"},start:null,end:null},setup(e){const l=e;an(n=>({"65c4ab22":l.dark.background,d61c1e22:l.dark.color,"5008cfec":l.light.background,"4ff6d9f2":l.light.color}));const t=C([]),o=C([]);function s(n,r){var d=new RegExp(r,"i"),c=n.search(d),m=[];return c!==-1?(m.push(n.substring(0,c)),m.push(n.substring(c+r.length))):m.push(n),m}function u(n,r){var d=new RegExp(r,"i"),c=n.match(d);return c?[c[0]]:[]}ee(()=>l,a,{immediate:!0,deep:!0});function a(){if(!!(l.text&&l.keyword)){if(l.start!==void 0){t.value=s(l.text,l.keyword),o.value=u(l.text,l.keyword);return}if(l.pattern==="first"){const n=l.text.match(new RegExp(l.keyword,"i"));if(n===null){t.value=[l.text];return}o.value=[n[0]];const r=l.text.slice(0,n.index),d=l.text.slice(n.index+l.keyword.length);if(n.index===0){t.value=["",d];return}let c=l.maxLength-l.keyword.length;if(c<0){t.value=["...",d];return}n.index<=c?t.value=[r,d]:t.value=["..."+r.slice(-c).slice(3),d]}else l.pattern==="all"&&(t.value=l.text.split(new RegExp(l.keyword,"i")),o.value=l.text.match(new RegExp(l.keyword,"ig")))}}return(n,r)=>(v(),T("span",qi,[(v(!0),T(q,null,W(t.value,(d,c)=>{var m;return v(),T(q,{key:c},[R("span",null,J(d),1),c+1!==((m=t.value)==null?void 0:m.length)?(v(),T("span",Gi,J(o.value[c]),1)):j("",!0)],64)}),128))]))}}),Hi=(e,l,t)=>N.get(E("CodeSearch/Search"),{keyword:e,isRegex:l,ignoreCase:t}),zi={class:"text-s px-8 py-4 flex items-center bg-gray/30 dark:bg-[#333] space-x-4 dark:text-fff/86"},Ji=["placeholder"],Wi=["title"],Qi=["title"],Xi=["onClick"],Yi=["title"],Zi={key:1,class:"text-s text-999 break-all p-4","data-cy":"no-search-result"},lo=oe.global.t,er={name:"code search",icon:"icon-search",display:lo("common.search"),route:"layouts",order:85,permission:"code",actions:[{name:"refresh",display:lo("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).onSearch()})}}]},tr=G({setup(e,{expose:l}){const t=He(po),{t:o}=Y(),s=F(),u=qe(),a=De(),n=C(),r=C(""),d=C(""),c=()=>g(this,null,function*(){if(r.value=d.value.trim(),!r.value){w();return}if(u.isRegex)try{RegExp(r.value)}catch(h){return}n.value=yield Hi(r.value,u.isRegex,u.ignoreCase)}),m=cn(c,1e3);ee(()=>[d.value,u.ignoreCase,u.isRegex],()=>{m()});const _=(h,i)=>g(this,null,function*(){var V,x,y,M;const b={id:h.id,name:h.name,params:h.params,type:h.type};if(b.type==="Page"&&((V=b.params)==null?void 0:V.type)===3){const L=yo(b.id,(x=b.params)==null?void 0:x.layout);St(se.resolve(L).href);return}t(b);const I=yield(M=(y=s.activeTab)==null?void 0:y.panelInstance)==null?void 0:M.promise;!(I!=null&&I.goToLine)||(i!==void 0?(I.goToLine(i,r.value),s.setActiveSearch(h.id+"-"+String(i))):(I.goToLine(1,r.value),s.setActiveSearch(h.id)))}),w=()=>{var h;r.value="",d.value="",n.value=void 0,(h=f.value)==null||h.focus()},f=C(),S=()=>{uo(()=>{var h,i;d.value?(h=f.value)==null||h.select():(i=f.value)==null||i.focus()})};return nt(S),ee(()=>a.query.activity,h=>{h==="code search"&&S()}),l({onSearch:c}),Fe("matchCase",()=>u.ignoreCase=!u.ignoreCase),Fe("useRegularExpression",()=>{u.isRegex=!u.isRegex}),(h,i)=>{var V,x;const b=be,I=Ki;return v(),T("div",null,[R("div",zi,[k(b,{class:"iconfont icon-search text-666 dark:text-fff/86"}),ie(R("input",{ref_key:"inputKeywordEl",ref:f,"onUpdate:modelValue":i[0]||(i[0]=y=>d.value=y),class:"outline-none w-full bg-transparent",placeholder:p(o)("common.inputKeyword"),"data-cy":"search",onClick:i[1]||(i[1]=H(()=>{},["stop"]))},null,8,Ji),[[so,d.value]]),R("span",{class:de(["cursor-pointer",{"text-blue":!p(u).ignoreCase}]),title:p(o)("common.matchCase"),onClick:i[2]||(i[2]=y=>p(u).ignoreCase=!p(u).ignoreCase)},"Aa",10,Wi),R("span",{class:de(["cursor-pointer",{"text-blue":p(u).isRegex}]),title:p(o)("common.useRegularExpression"),onClick:i[3]||(i[3]=y=>p(u).isRegex=!p(u).isRegex)},".*",10,Qi),d.value?(v(),U(b,{key:0,class:"iconfont icon-delete5 text-666/50 dark:text-fff/50 cursor-pointer",onClick:w})):j("",!0)]),(V=n.value)!=null&&V.length?(v(!0),T(q,{key:0},W(n.value,y=>(v(),U(ae,{key:y.id,id:y.id,title:y.name,"ignore-search":"",permission:"search",onClick:M=>_(y)},{collapse:$(()=>[(v(!0),T(q,null,W(y.matched,M=>(v(),T("div",{key:M.lineNumber+M.summary,class:de(["cursor-pointer hover:bg-blue/30 px-8",p(s).activeSearch===y.id+"-"+String(M.lineNumber+1)?"bg-blue/30":""]),onClick:H(L=>_(y,M.lineNumber+1),["stop"])},[R("p",{class:"text-s text-666 ellipsis cursor-default select-none pointer-events-none",title:M.summary,"data-cy":"line-summary"},[Ae(J(M.lineNumber+1)+": ",1),k(I,{keyword:r.value,text:M.summary,pattern:"all",start:M.start,end:M.end},null,8,["keyword","text","start","end"])],8,Yi)],10,Xi))),128))]),_:2},1032,["id","title","onClick"]))),128)):((x=n.value)==null?void 0:x.length)===0?(v(),T("p",Zi,J(p(o)("common.searchResultEmpty",{keyword:r.value})),1)):j("",!0)])}}});var or=Object.freeze(Object.defineProperty({__proto__:null,define:er,default:tr},Symbol.toStringTag,{value:"Module"}));const Jo=oe.global.t,nr=()=>N.get(E("Style/External",!0)),ar=()=>N.get(E("Style/Embedded",!0)),lr=e=>N.get(E("Style/Get"),{id:e}),sr=e=>N.post(E("Style/Update"),e),ir=e=>N.post(E("Style/Deletes"),{ids:e},void 0,{successMessage:Jo("common.deleteSuccess")}),rr=e=>N.post(E("Upload/Style"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},successMessage:Jo("common.uploadSuccess")}),ur=e=>N.get(E("Style/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),dr=oe.global.t,It=Re("styleStore",()=>{const e=ce(),l=F(),t=C([]),o=C([]),s=C([]),u=X(()=>{const i=[];return i.push(...t.value.map(b=>({id:b.id,name:b.name,href:b.routeName,fullPath:b.fullUrl}))),i.push(...o.value.map(b=>({id:b.id,name:b.name,href:b.relativeUrl,fullPath:b.previewUrl}))),i}),a=()=>g(void 0,null,function*(){t.value=yield nr()}),n=()=>g(void 0,null,function*(){o.value=yield Bo("Style")}),r=()=>g(void 0,null,function*(){s.value=yield ar()}),d=()=>{a(),n(),r()},c=i=>Ho(i),m=i=>g(void 0,null,function*(){yield qo(i),n()}),_=i=>g(void 0,null,function*(){yield Go(i),l.deleteTabs(i),n()}),w=i=>g(void 0,null,function*(){const b=i.name,I=new FormData;b.indexOf(".")>-1&&b.split(".").reverse()[0]==="css"?(I.append("file",i),yield rr(I),a()):co.error(dr("common.fileFormatIsIncorrect"))}),f=i=>g(void 0,null,function*(){const b=yield lr(i);return b.body||(b.body=""),b}),S=(i,b)=>g(void 0,null,function*(){i.enableDiffChecker=!0;const I=yield sr(i);return e.site.recordSiteLogVideo&&b&&(yield Be(I,b,i.isEmbedded)),Object.assign(i,yield f(I))}),h=i=>g(void 0,null,function*(){yield ir(i),l.deleteTabs(i),d()});return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},()=>{t.value=[],s.value=[],o.value=[]}),{external:t,group:o,embedded:s,all:u,getGroup:c,updateGroup:m,deleteGroups:_,uploadStyle:w,deleteStyles:h,getStyle:f,updateStyle:S,loadAll:d,loadEmbedded:r,loadExternal:a,loadGroups:n}}),cr={key:0,class:"h-full"},mr=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=It(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getStyle(o.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateStyle(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))}),_=(w,f)=>g(this,null,function*(){yield d.promise,f?r.value.search(f,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,f)=>a.value?(v(),T("div",cr,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":f[0]||(f[0]=S=>a.value.body=S),language:"css",uri:p(je).from({scheme:"memory",path:a.value.id}),onMonacoLoadComplete:f[1]||(f[1]=S=>p(u).addTabRecord(o.id,S,"css"))},null,8,["modelValue","uri"])])):j("",!0)}});const pr={class:"p-24"},vr={class:"flex items-center"},fr={key:0,class:"w-100px !h-40px flex items-center justify-center dark:text-fff/86"},yr={class:"max-w-400px truncate"},gr={key:0},br=R("div",null,null,-1),Wo=G({props:{id:null,hiddenName:{type:Boolean}},emits:["save"],setup(e,{expose:l,emit:t}){const o=e,{t:s}=Y(),u=It(),a=C(),n=C({id:o.id||Z,name:"",typeName:"Style",children:[]}),r=X(()=>n.value.id!==Z),d=()=>g(this,null,function*(){n.value=yield u.getGroup(n.value.id)}),c=X(()=>{const h=[];for(const i of u.external)n.value.children.some(b=>b.routeId===i.routeId)||h.push({name:i.name,routeId:i.routeId,url:i.routeName});return h}),m=X(()=>{const h={name:[_e(1,50),Te(),le(s("common.nameRequiredTips")),{asyncValidator(b,I,V){return g(this,null,function*(){try{yield Ko(I,"style")}catch(x){V(Error(s("common.nameExist")))}})},trigger:"blur"}]};return r.value&&delete h.name,h}),_=()=>g(this,null,function*(){var h;yield(h=a.value)==null?void 0:h.validate(),yield u.updateGroup(n.value)}),w=h=>{const i=c.value.find(b=>b.routeId===h);i&&n.value.children.push(i)},f=h=>{const i=n.value.children.splice(h.oldIndex,1)[0];n.value.children.splice(h.newIndex,0,i)},S=h=>{const i=n.value.children.findIndex(b=>b.routeId===h);n.value.children.splice(i,1)};return n.value.id!==Z&&d(),l({save:_}),(h,i)=>{const b=me,I=pe,V=ve,x=be,y=lt,M=Vt,L=Ot,O=Tt;return v(),T("div",pr,[e.hiddenName?j("",!0):(v(),U(V,{key:0,ref_key:"form",ref:a,"label-position":"top",model:n.value,rules:p(m),onSubmit:i[1]||(i[1]=H(()=>{},["prevent"])),onKeydown:i[2]||(i[2]=ue(D=>t("save"),["enter"]))},{default:$(()=>[k(I,{label:p(s)("common.name"),prop:"name"},{default:$(()=>[k(b,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value.name=D),disabled:p(r),"data-cy":"group-name"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),k(O,{trigger:"click","max-height":"300px",onCommand:w},{dropdown:$(()=>[Object.keys(p(c)).length==0?(v(),T("div",fr,[R("span",null,J(p(s)("common.noData")),1)])):(v(),U(L,{key:1},{default:$(()=>[(v(!0),T(q,null,W(p(c),D=>(v(),U(M,{key:D.routeId,command:D.routeId,"data-cy":"style-opt"},{default:$(()=>[R("div",yr,[R("span",null,J(D.name),1),D.url?(v(),T("span",gr,"("+J(D.url)+")",1)):j("",!0)])]),_:2},1032,["command"]))),128))]),_:1}))]),default:$(()=>[k(y,{round:"",class:"shadow-s-10 border-none","data-cy":"add-style"},{default:$(()=>[R("div",vr,[R("span",null,J(p(s)("common.addStyle")),1),k(x,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})])]),_:1})]),_:1}),k(xo,{class:"!px-0",list:n.value.children,"display-prop":"name","id-prop":"routeId",onSort:f,onDelete:S},{bottom:$(()=>[br]),_:1},8,["list"])])}}}),wr={class:"h-full bg-fff dark:bg-[#141414]"},_r=G({props:{id:null},setup(e,{expose:l}){const t=C();return l({save:()=>g(this,null,function*(){t.value.save()})}),(s,u)=>(v(),T("div",wr,[k(Wo,{id:e.id,ref_key:"inner",ref:t,"hidden-name":""},null,8,["id"])]))}}),kr=G({props:{model:null},setup(e,{expose:l}){const t=e,{t:o}=Y(),s=C(),u=X(()=>({name:t.model.id!==Z?"":[_e(1,64),le(o("common.nameRequiredTips")),Te(),Ce(ur,o("common.styleNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return v(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(o)("common.styleName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"style-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),hr=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const{t}=Y(),o=C(!0),s=C(),u=()=>g(this,null,function*(){yield s.value.save(),o.value=!1});return(a,n)=>{const r=ye;return v(),T("div",{onClick:n[2]||(n[2]=H(()=>{},["stop"]))},[k(r,{"model-value":o.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:p(t)("common.styleGroup"),onClosed:n[1]||(n[1]=d=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"style",action:"edit"},onConfirm:u,onCancel:n[0]||(n[0]=d=>o.value=!1)})]),default:$(()=>[k(Wo,{id:e.id,ref_key:"inner",ref:s,onSave:u},null,8,["id"])]),_:1},8,["model-value","title"])])}}}),xr={class:"font-bold dark:text-fff/86"},Cr=R("div",{class:"flex-1"},null,-1),$r={class:"font-bold dark:text-fff/86"},Sr=R("div",{class:"flex-1"},null,-1),Vr={class:"flex items-center w-full"},Tr={class:"font-bold text-666 flex-1"},Mr={key:0,class:"border-l-2 border-blue/50 pl-8"},Ir={class:"flex items-center w-full"},Rr={class:"text-666 flex-1"},Lr={class:"flex items-center w-full"},Ur={class:"text-666 flex-1"},Er={class:"flex items-center w-full"},Nr={class:"font-bold text-666 flex-1"},Ar={key:1,class:"border-l-2 border-blue/50 pl-8"},Dr={class:"text-666"},jr={class:"text-s"},Pr={class:"text-666"},Or={class:"text-s"},Fr=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const t=ce(),o=C(JSON.parse(JSON.stringify(t.site))),{t:s}=Y(),u=C(!0),a=C(),n=()=>g(this,null,function*(){if(o.value.unocssSettings.enable)try{JSON.parse(o.value.unocssSettings.config),r()}catch(d){co.error(s("common.codeFormatIsIncorrect"));return}else r()}),r=()=>g(this,null,function*(){yield vn(o.value),t.loadSite(),t.loadSites(),u.value=!1});return(d,c)=>{const m=Ft,_=pe,w=he,f=me,S=ve,h=ye;return v(),U(h,{"model-value":u.value,width:"800px","close-on-click-modal":!1,title:p(s)("common.style"),onClosed:c[11]||(c[11]=i=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:n,onCancel:c[10]||(c[10]=i=>u.value=!1)})]),default:$(()=>[k(S,{ref_key:"form",ref:a,"label-position":"top",onKeydown:ue(n,["enter"])},{default:$(()=>[k(_,null,{default:$(()=>[R("span",xr,J(p(s)("common.JsCssCompression")),1),Cr,k(m,{modelValue:o.value.enableJsCssCompress,"onUpdate:modelValue":c[0]||(c[0]=i=>o.value.enableJsCssCompress=i),"data-cy":"js-css-compress"},null,8,["modelValue"])]),_:1}),k(_,null,{default:$(()=>[R("span",$r,J(p(s)("common.JsCssBrowserCache")),1),Sr,k(m,{modelValue:o.value.enableJsCssBrowerCache,"onUpdate:modelValue":c[1]||(c[1]=i=>o.value.enableJsCssBrowerCache=i),"data-cy":"js-css-cache"},null,8,["modelValue"])]),_:1}),k(_,null,{default:$(()=>[R("div",Vr,[R("span",Tr,J(p(s)("settings.atomicCss")),1),k(m,{modelValue:o.value.unocssSettings.enable,"onUpdate:modelValue":c[2]||(c[2]=i=>o.value.unocssSettings.enable=i)},null,8,["modelValue"])])]),_:1}),o.value.unocssSettings.enable?(v(),T("div",Mr,[k(_,null,{default:$(()=>[R("div",Ir,[R("span",Rr,J(p(s)("settings.disableSsr")),1),k(m,{modelValue:o.value.unocssSettings.disableSsr,"onUpdate:modelValue":c[3]||(c[3]=i=>o.value.unocssSettings.disableSsr=i)},null,8,["modelValue"])])]),_:1}),k(_,null,{default:$(()=>[R("div",Lr,[R("span",Ur,J(p(s)("settings.resetDefaultStyle")),1),k(m,{modelValue:o.value.unocssSettings.resetStyle,"onUpdate:modelValue":c[4]||(c[4]=i=>o.value.unocssSettings.resetStyle=i)},null,8,["modelValue"])])]),_:1}),k(_,null,{default:$(()=>[R("div",{class:"h-300px w-full",onKeydown:c[6]||(c[6]=H(()=>{},["stop"]))},[k(w,{modelValue:o.value.unocssSettings.config,"onUpdate:modelValue":c[5]||(c[5]=i=>o.value.unocssSettings.config=i),language:"json"},null,8,["modelValue"])],32)]),_:1})])):j("",!0),k(_,null,{default:$(()=>[R("div",Er,[R("span",Nr,J(p(s)("common.enableCssSplitByMedia")),1),k(m,{modelValue:o.value.enableCssSplitByMedia,"onUpdate:modelValue":c[7]||(c[7]=i=>o.value.enableCssSplitByMedia=i)},null,8,["modelValue"])])]),_:1}),o.value.enableCssSplitByMedia?(v(),T("div",Ar,[k(_,{class:"w-800px"},{default:$(()=>[R("div",null,[R("p",Dr,J(p(s)("common.maxWidthForMobileBrowser")),1),R("p",jr," ("+J(p(s)("common.maxWidthForMobileBrowserDetail"))+") ",1)]),k(f,{modelValue:o.value.mobileMaxWidth,"onUpdate:modelValue":c[8]||(c[8]=i=>o.value.mobileMaxWidth=i),class:"w-500px","data-cy":"max-width"},null,8,["modelValue"])]),_:1}),k(_,{class:"w-900px"},{default:$(()=>[R("div",null,[R("p",Pr,J(p(s)("common.minWidthForDesktopBrowser")),1),R("p",Or," ("+J(p(s)("common.minWidthForDesktopBrowserDetail"))+") ",1)]),k(f,{modelValue:o.value.desktopMinWidth,"onUpdate:modelValue":c[9]||(c[9]=i=>o.value.desktopMinWidth=i),class:"w-500px","data-cy":"min-width"},null,8,["modelValue"])]),_:1})])):j("",!0)]),_:1},8,["onKeydown"])]),_:1},8,["model-value","title"])}}}),Br=["onKeydown"],Ge=oe.global.t,qr={name:"styles",icon:"icon-css",display:Ge("common.style"),order:30,permission:"style",actions:[{name:"settings",display:Ge("common.settings"),icon:"icon-a-setup",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).showSettings()})}},{name:"refresh",display:Ge("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ge("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"styles"}))}}]},xt=e=>{const l=[{name:"save",visible:!1,display:Ge("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.save()})},{name:"refresh",display:Ge("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,s;const t=yield(s=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:s.promise;!t||t.load()})}];e.ownerObjectId===Z&&l.push({name:"open",display:Ge("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const t=It();let o=t.all.find(s=>s.id===e.id);if(o||(yield Promise.all([t.loadExternal(),t.loadGroups()]),o=t.all.find(s=>s.id===e.id)),o){const{onPreview:s}=we();s(o.fullPath)}})}),F().addTab({id:e.id,name:e.name,panel:mr,icon:"icon-css",actions:l})},Gr=G({setup(e,{expose:l}){const{t}=Y(),o=It(),s=F(),u=C(!1),a=C(!1),n=C(!1),r=C(),d=C(),c=C(),m=I=>{const V=[{name:"save",visible:!1,display:t("common.save"),icon:"icon-preservation",invoke:()=>g(this,null,function*(){var y,M;const x=yield(M=(y=F().activeTab)==null?void 0:y.panelInstance)==null?void 0:M.promise;!x||x.save()})}];I.previewUrl&&V.push({name:"open",display:t("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>{const{onPreview:x}=we();x(I.previewUrl)}}),s.addTab({id:I.id,name:I.name,panel:_r,icon:"icon-css",actions:V})},_=()=>g(this,null,function*(){c.value={id:Z,name:"",body:"",extension:"css",isEmbedded:!1,ownerObjectId:void 0},u.value=!0}),w=()=>g(this,null,function*(){yield r.value.validate();const I=yield o.updateStyle(c.value);xt(I),o.loadExternal(),u.value=!1}),f=I=>g(this,null,function*(){yield xe(),yield o.deleteStyles([I])}),S=I=>g(this,null,function*(){yield xe(),o.deleteGroups([I])}),h=()=>{o.loadAll()},i=X(()=>{var x,y,M,L,O,D;var I=[{name:t("common.copyTitle"),invoke:P=>g(this,null,function*(){Ve(P.name)})}],V=((y=(x=d.value)==null?void 0:x.payload)==null?void 0:y.fullUrl)||((L=(M=d.value)==null?void 0:M.payload)==null?void 0:L.previewUrl);return V&&!((D=(O=d.value)==null?void 0:O.payload)!=null&&D.isEmbedded)&&I.push({name:t("common.preview"),invoke:P=>g(this,null,function*(){const{onPreview:B}=we();B(V)})}),I});function b(){n.value=!0}return l({load:h,showSettings:b}),(I,V)=>{const x=ye;return v(),T("div",null,[k(re,{title:p(t)("common.external"),add:"","expand-default":!0,permission:"style",onOnAdd:_},{default:$(()=>[(v(!0),T(q,null,W(p(o).external,y=>(v(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:M=>xt(y),onRemove:M=>f(y.id),onContextmenu:H(M=>{var L;return(L=d.value)==null?void 0:L.openMenu(M,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(t)("common.embedded"),"expand-default":!0,permission:"style"},{default:$(()=>[(v(!0),T(q,null,W(p(o).embedded,y=>(v(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:M=>xt(y),onRemove:M=>f(y.id),onContextmenu:H(M=>{var L;return(L=d.value)==null?void 0:L.openMenu(M,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(t)("common.group"),add:"","expand-default":!0,permission:"style",onOnAdd:V[0]||(V[0]=y=>a.value=!0)},{default:$(()=>[(v(!0),T(q,null,W(p(o).group,y=>(v(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:M=>m(y),onRemove:M=>S(y.id),onContextmenu:H(M=>{var L;return(L=d.value)==null?void 0:L.openMenu(M,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:V[3]||(V[3]=H(()=>{},["stop"]))},[k(x,{modelValue:u.value,"onUpdate:modelValue":V[2]||(V[2]=y=>u.value=y),width:"600px","close-on-click-modal":!1,title:p(t)("common.newStyle"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:V[1]||(V[1]=y=>u.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(w,["enter"])},[c.value?(v(),U(kr,{key:0,ref_key:"form",ref:r,"label-position":"top",model:c.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Br)]),_:1},8,["modelValue","title"])]),a.value?(v(),U(hr,{key:0,modelValue:a.value,"onUpdate:modelValue":V[4]||(V[4]=y=>a.value=y)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:d,actions:p(i)},null,8,["actions"]),n.value?(v(),U(Fr,{key:1,modelValue:n.value,"onUpdate:modelValue":V[5]||(V[5]=y=>n.value=y)},null,8,["modelValue"])):j("",!0)])}}});var Kr=Object.freeze(Object.defineProperty({__proto__:null,define:qr,open:xt,default:Gr},Symbol.toStringTag,{value:"Module"}));const Qo=oe.global.t,Hr=()=>N.get(E("View/list",!0)),zr=e=>N.post(E("View/Deletes"),{ids:e},void 0,{successMessage:Qo("common.deleteSuccess")}),Rd=(e,l)=>N.post(E("View/Copy"),{id:e,name:l},void 0,{successMessage:Qo("common.copySuccess")}),Jr=e=>N.get(E("View/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Wr=e=>N.post(E("View/post"),e),Qr=e=>N.get(E("View/get"),{id:e}),Kt=Re("viewStore",()=>{const e=ce(),l=F(),t=C([]),o=X(()=>l.getSplitNameData(t.value)),s=()=>g(void 0,null,function*(){t.value=yield Hr()}),u=r=>g(void 0,null,function*(){yield zr(r),l.deleteTabs(r),s()}),a=r=>g(void 0,null,function*(){r=r||Z;const d=yield Qr(r);return d.body||(d.body=""),d.id=r,d}),n=(r,d)=>g(void 0,null,function*(){r.enableDiffChecker=!0;const c=yield Wr(r);return e.site.recordSiteLogVideo&&d&&(yield Be(c,d)),Object.assign(r,yield a(c))});return ee(()=>{var r;return(r=e.site)==null?void 0:r.id},()=>{t.value=[]}),{load:s,list:t,deleteViews:u,getView:a,updateView:n,getViews:o}}),Xr={key:0,class:"h-full"},Yr=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:t}){const o=e,s=Kt(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getView(o.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateView(a.value,u.saveTabRecord(o.id)),n.init(a.value),t("changed",!1),t("setAction","save",{visible:!1}))}),_=(w,f)=>g(this,null,function*(){yield d.promise,f?r.value.search(f,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{t("changed",n.changed(a.value)),t("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,f)=>a.value?(v(),T("div",Xr,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":f[0]||(f[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:f[1]||(f[1]=S=>p(u).addTabRecord(o.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Zr=G({props:{model:null},setup(e,{expose:l}){const t=e,{t:o}=Y(),s=C(),u=Ee(()=>({name:t.model.id!==Z?[]:[Te(),_e(1,50),le(o("common.nameRequiredTips")),Ce(Jr,o("common.viewNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return v(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(o)("common.viewName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"view-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),eu=["onKeydown"],ot=oe.global.t,tu={name:"views",icon:"icon-view",display:ot("common.view"),route:"views",order:10,permission:"view",actions:[{name:"refresh",display:ot("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:ot("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"views"}))}}]},Ct=e=>{F().addTab({id:e.id,name:e.name,panel:Yr,icon:"icon-view",actions:[{name:"save",visible:!1,display:ot("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,o;const l=yield(o=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:o.promise;!l||l.save()})},{name:"refresh",visible:!0,display:ot("common.refresh"),icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,o;const l=yield(o=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:o.promise;!l||l.load()})},{name:"open",display:ot("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const l=Kt();let t=l.list.find(o=>o.id===e.id);if(t||(yield l.load(),t=l.list.find(o=>o.id===e.id)),t){const{onPreview:o}=we();o(t.preview)}})}]})},ou=G({setup(e,{expose:l}){const{t}=Y(),o=Kt(),s=C(!1),u=C(),a=C(),n=C(),r=()=>g(this,null,function*(){a.value=yield o.getView(),s.value=!0}),d=()=>g(this,null,function*(){yield u.value.validate();const w=yield o.updateView(a.value);Ct(w),o.load(),s.value=!1}),c=w=>g(this,null,function*(){yield xe(),yield o.deleteViews([w])}),m=()=>{o.load()},_=[{name:t("common.copyTitle"),invoke:w=>g(this,null,function*(){Ve(w.name)})},{name:t("common.preview"),invoke:w=>g(this,null,function*(){const{onPreview:f}=we();f(w.preview)})}];return l({load:m}),(w,f)=>{const S=ye;return v(),T("div",null,[k(re,{title:p(t)("common.list"),add:"","expand-default":!0,permission:"view",onOnAdd:r},{default:$(()=>[(v(!0),T(q,null,W(p(o).getViews,h=>(v(),T(q,null,[h.children?(v(),U(Ne,{key:h.folderName+h.floor,data:h,permission:"view",onClickHandle:f[0]||(f[0]=i=>Ct(i)),onRemove:f[1]||(f[1]=i=>c(i)),onClickContextMenu:i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(v(),U(ae,{id:h.id,key:h.id,permission:"view",title:h.name,name:h.name,padding:12+h.floor*6,remove:"",onClick:i=>Ct(h),onRemove:i=>c(h.id),onContextmenu:H(i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i,h)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:f[4]||(f[4]=H(()=>{},["stop"]))},[k(S,{modelValue:s.value,"onUpdate:modelValue":f[3]||(f[3]=h=>s.value=h),width:"600px","close-on-click-modal":!1,title:p(t)("common.newView"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:d,onCancel:f[2]||(f[2]=h=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(d,["enter"])},[a.value?(v(),U(Zr,{key:0,ref_key:"form",ref:u,"label-position":"top",model:a.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,eu)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:n,actions:_},null,512)])}}});var nu=Object.freeze(Object.defineProperty({__proto__:null,define:tu,open:Ct,default:ou},Symbol.toStringTag,{value:"Module"}));function au(e,l,t){let o=0,s=[],u=null;const a=ce();e===""&&(e=Date.now().toString());function n(m,_){l=m,t=_,r()}function r(){!a.site.recordSiteLogVideo||!l||!t||(o=0,s=[],u=new An(e,l,t),u.bindStoreCallback(m=>{m.order=o++,s.push(m)}),u.open(),u.on())}function d(){return u==null||u.dispose(),u=null,s}function c(){var _;const m=s;if(o=0,s=[],u==null||u.open(),m.length){const w=(_=m.find(f=>f.type==="Open"))==null?void 0:_.text;return typeof w!="string"||w===(l==null?void 0:l.getValue())?"":JSON.stringify(m)}else return""}return{bindMonaco:n,on:r,off:d,save:c}}const Et={"../views/dev-mode/side-panels/code-panel.vue":Ea,"../views/dev-mode/side-panels/debug-panel.vue":bl,"../views/dev-mode/side-panels/form-panel.vue":Bl,"../views/dev-mode/side-panels/layout-panel.vue":Yl,"../views/dev-mode/side-panels/menu-panel.vue":Os,"../views/dev-mode/side-panels/module-panel.vue":ui,"../views/dev-mode/side-panels/page-panel.vue":wi,"../views/dev-mode/side-panels/script-panel.vue":Bi,"../views/dev-mode/side-panels/search-panel.vue":or,"../views/dev-mode/side-panels/style-panel.vue":Kr,"../views/dev-mode/side-panels/view-panel.vue":nu},F=Re("devModeStore",()=>{const e=C([]),l=C(),t=ce(),o=C([]),s=C(),u=C(""),a={},n=(y,M,L)=>{var O,D;if(y){for(let P=0;P<y.length;P++)if(((O=y[P].name)==null?void 0:O.toLocaleLowerCase())===(M==null?void 0:M.toLocaleLowerCase())&&((D=y[P].folderName)==null?void 0:D.toLocaleLowerCase())===(M==null?void 0:M.toLocaleLowerCase()))return y[P].children;return y.push({name:M,folderName:M,children:[],floor:L+1}),y[y.length-1].children}},r=y=>{var M;return(M=y.reduce((L,O)=>{const D=O.name.split(".").filter(B=>B!=="");if(D.length>1&&["html","css","js","ts"].includes(D[D.length-1].toLowerCase())){const B=D.pop();D[D.length-1]=D[D.length-1]+"."+B}let P=L;for(let B=0;B<D.length-1;B++)P=n(P,D[B],B);return P&&P.push(Oe(ge({},O),{tabName:D[D.length-1],floor:D.length?D.length:1})),L},[]))==null?void 0:M.sort((L,O)=>L.id&&!O.id?1:!L.id&&O.id?-1:0)},d=X(()=>e.value.find(y=>y.id.startsWith(Ye))),c=y=>{y.panelInstance=new $e,y.id.startsWith(Ye)?_(y):m(y)},m=y=>{const M=e.value.find(L=>L.id===y.id);M?l.value=M:(y.panel=Rt(y.panel),e.value.push(y),l.value=y)},_=y=>g(void 0,null,function*(){d.value?(l.value=d.value,(yield l.value.panelInstance.promise).load(y.id.replace(Ye,""))):(y.panel=Rt(y.panel),e.value.push(y),l.value=y)}),w=y=>{const M=e.value.find(O=>O.id===y);if(!M)return;const L=e.value.findIndex(O=>O.id===M.id);M===l.value&&(l.value=e.value[L===0?1:L-1]),e.value.splice(L,1),x(y)},f=y=>{for(const M of y)w(M)},S=()=>g(void 0,null,function*(){e.value=[],o.value=[];const y=[];s.value=void 0,l.value=void 0,yield uo();for(const M in Et){const L=Et[M].define;L&&(L.permission==="debug"?t.hasAccess("code","debug"):t.hasAccess(L.permission))&&y.push(Oe(ge({},JSON.parse(JSON.stringify(L))),{actions:L.actions,panel:Rt(Et[M].default),panelInstance:new $e}))}o.value=y.sort((M,L)=>M.order-L.order),s.value=o.value[0]}),h=()=>g(void 0,null,function*(){if(!s.value)return;const y=yield s.value.panelInstance.promise;y.load&&y.load()}),i=(y,M)=>g(void 0,null,function*(){const L=o.value.find(O=>O.name===y);!L||(s.value=L,s.value.init||(s.value.init=!0,yield h()),y==="modules"&&se.currentRoute.value.query.activity==="modules"&&M?(se.push(ke({name:"dev-mode",query:{activity:"modules"}})),Se().exitEditModule()):se.replace({name:se.currentRoute.value.name,query:Oe(ge({},se.currentRoute.value.query),{activity:y})}))}),b=y=>{u.value=y},I=(y,M,L)=>{e.value.find(D=>D.id===y)&&(a[y]=au(y,M,L),a[y].on())},V=y=>{var M;return((M=a[y])==null?void 0:M.save())||""},x=y=>{var M;(M=a[y])==null||M.off(),delete a[y]};return ee(()=>{var y;return(y=t.site)==null?void 0:y.id},S,{immediate:!0}),{tabs:e,activeTab:l,addTab:c,deleteTab:w,deleteTabs:f,debugTab:d,activities:o,activeActivity:s,selectActivity:i,activeSearch:u,setActiveSearch:b,getSplitNameData:r,loadActivePanel:h,addTabRecord:I,saveTabRecord:V,removeTabRecord:x}});export{Is as $,yd as A,Se as B,Fs as C,aa as D,id as E,ld as F,sd as G,au as H,Ks as I,vi as J,It as K,Mt as L,pd as M,Eo as N,ci as O,Po as P,fi as Q,Nt as R,di as S,Id as T,Kt as U,Rd as V,Io as W,jl as X,jo as Y,Ds as Z,he as _,ft as a,ji as a0,hr as a1,Fr as a2,qe as a3,Hi as a4,Jl as a5,Zr as a6,Ll as a7,Di as a8,kr as a9,Va as aa,Me as ab,ei as ac,Zs as ad,ut as ae,dt as af,Ct as ag,_t as ah,kt as ai,xt as aj,ht as ak,Ue as al,st as am,We as an,Gt as b,dd as c,ud as d,_d as e,gd as f,rd as g,hd as h,Jr as i,wd as j,xd as k,Vd as l,kd as m,$d as n,Cd as o,Lo as p,Sd as q,bd as r,Ro as s,Td as t,F as u,md as v,cd as w,Md as x,fd as y,vd as z};
