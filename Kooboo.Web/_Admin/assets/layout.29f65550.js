var C=(m,k,s)=>new Promise((t,n)=>{var c=l=>{try{e(s.next(l))}catch(u){n(u)}},d=l=>{try{e(s.throw(l))}catch(u){n(u)}},e=l=>l.done?t(l.value):Promise.resolve(l.value).then(c,d);e((s=s.apply(m,k)).next())});import{S as z}from"./search-input.5b2e8d23.js";import{g as A,w as G}from"./i18n.bcd18f8a.js";import{d as J,g as p,i as g,o as i,j as _,w as f,f as h,u as v,b as E,a as V,b6 as P,t as Q,cg as W,k as y,F as X,r as D,e as Y,ch as Z}from"./url.8f5ec20c.js";/* empty css                                                          */import{E as ee}from"./index.4972d853.js";import{E as oe}from"./windi.19264205.js";import{E as le,a as te}from"./index.6d22f937.js";import{E as ae}from"./index.ec6ad7db.js";import{E as re}from"./index.79f78425.js";import{E as se}from"./index.d4a6b2d5.js";const ne={class:"mx-32 flex justify-between space-x-16"},ue={class:"flex justify-between"},ie={style:{flex:"3"}},ce=["infinite-scroll-disabled"],de=["innerHTML"],xe=J({props:{modelValue:{type:Boolean},providers:null,fetchData:null},emits:["update:modelValue","list-changed"],setup(m,{expose:k,emit:s}){const t=m,n=p(!1),c=p(!1),{t:d}=A(),e=p({provider:"",keyword:"",pageNr:1}),l=p([]),u=p();g(()=>t.providers,()=>{var o;e.value.provider=(o=t.providers[0])==null?void 0:o.value}),g(()=>l.value,o=>s("list-changed",o));const w=()=>C(this,null,function*(){var a;if(e.value.keyword.trim()=="")return;n.value=!0;const o=yield t.fetchData(e.value);n.value=!1,c.value=o.hasMore,e.value.pageNr<=1?(l.value=o.list,(a=u==null?void 0:u.value)==null||a.scrollTo(0,0)):l.value=[...l.value,...o.list]}),x=Z(w,1e3);function S(){!e.value.keyword||n.value||(e.value.pageNr++,w())}function b(){e.value.pageNr=1,c.value=!0,n.value=!0,e.value.keyword&&x()}function M(){var o;e.value.pageNr=1,e.value.provider=(o=t.providers[0])==null?void 0:o.value,c.value=!0}function B(o){e.value.keyword=o,w()}function R(){var o;e.value.keyword="",e.value.provider=(o=t.providers[0])==null?void 0:o.value,e.value.pageNr=1,l.value=[],s("update:modelValue",!1)}const L=o=>"<span style='color:rgba(34, 150, 243, 1)'>"+o+"</span>";k({loadMore:S,reset:M,search:B});const N=p();return g(()=>t.modelValue,o=>{o&&setTimeout(()=>{N.value.focus()},0)}),(o,a)=>{const j=oe,F=le,H=te,U=ae,$=z,K=re,O=se,q=ee;return i(),_(O,{"model-value":m.modelValue,width:t.providers.length>1?"800px":"600px","close-on-click-modal":!1,title:v(d)("common.search"),"custom-class":"search_dialog",onClosed:R,"onUpdate:modelValue":a[2]||(a[2]=r=>s("update:modelValue",r))},{default:f(()=>[h("div",ne,[t.providers.length>1?(i(),_(U,{key:0,style:{flex:"1"},placement:"top","show-after":300,content:v(d)("common.selectSourceTips")},{default:f(()=>[E(H,{modelValue:e.value.provider,"onUpdate:modelValue":a[0]||(a[0]=r=>e.value.provider=r),onChange:b},{default:f(()=>[(i(!0),V(X,null,P(m.providers,({value:r,label:I,url:T})=>(i(),_(F,{key:r,value:r,label:I,"data-cy":r},{default:f(()=>[h("div",ue,[h("div",null,Q(I),1),h("div",null,[T?(i(),_(j,{key:0,class:"text-blue iconfont icon-link1",onClick:G(pe=>v(W)(T),["stop"])},null,8,["onClick"])):y("",!0)])])]),_:2},1032,["value","label","data-cy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["content"])):y("",!0),h("div",ie,[E($,{ref_key:"searchInputRef",ref:N,modelValue:e.value.keyword,"onUpdate:modelValue":a[1]||(a[1]=r=>e.value.keyword=r),class:"w-full",placeholder:v(d)("common.searchKeywordTip"),"data-cy":"search",onInput:b,onSearch:v(x)},null,8,["modelValue","placeholder","onSearch"])])]),!l.value||!l.value.length?D(o.$slots,"placeholder",{key:0}):y("",!0),E(K,{ref_key:"scrollbarRef",ref:u,class:"mt-8","max-height":"45vh",style:{height:"100%"}},{default:f(()=>[Y((i(),V("div",{"infinite-scroll-disabled":!c.value,"infinite-scroll-distance":50},[l.value&&l.value.length>0?D(o.$slots,"default",{key:0,list:l.value,keyword:e.value.keyword}):y("",!0),!n.value&&l.value&&e.value.keyword&&l.value.length==0?(i(),V("div",{key:1,class:"px-32 leading-4 text-center mt-8 whitespace-normal","data-cy":"no-search-result",innerHTML:v(d)("common.searchResultEmpty",{keyword:L(e.value.keyword)})},null,8,de)):y("",!0)],8,ce)),[[q,S]])]),_:3},512)]),_:3},8,["model-value","width","title"])}}});export{xe as _};
