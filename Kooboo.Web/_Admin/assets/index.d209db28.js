var f=(B,a,d)=>new Promise((_,N)=>{var k=g=>{try{m(d.next(g))}catch(V){N(V)}},b=g=>{try{m(d.throw(g))}catch(V){N(V)}},m=g=>g.done?_(g.value):Promise.resolve(g.value).then(k,b);m((d=d.apply(B,a)).next())});import{_ as fe}from"./icon-button.0e134c9b.js";import{S as _e}from"./search-input.9d340a13.js";import{_ as ge}from"./k-table.c13bd7f5.js";import{c as he,G as ye,g as oe,a as be,b as ae,d as ke,e as xe,r as Ce,f as Ne,h as Ve,i as De}from"./index.7c7fa606.js";import{u as Ie}from"./use-date.55b953fa.js";import{_ as we}from"./action-tag.06e33d33.js";import{_ as Ee}from"./object-type-tag.046f35b1.js";import{g as le,o as Te}from"./i18n.25caaace.js";import{a as $e}from"./index.7247b296.js";import{a as z,r as te,m as Se,d as Re,s as He,i as Le}from"./validate.f3c0b03b.js";import{x as Fe,E as Ue}from"./main.1c3b59e3.js";import{_ as Be}from"./index.50326354.js";import{_ as qe}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Me}from"./index.f571dfc9.js";import{E as Ye,a as je}from"./index.94998415.js";import{E as ne,a as se}from"./index.960b9732.js";import{E as Ae}from"./index.a5d96e5a.js";import{d as ie,g as c,i as G,o as u,j as y,w as n,b as l,u as o,f as S,a as R,b6 as Y,F as U,cd as Oe,J as Pe,k as D,aH as $,t as C,ch as Ke}from"./url.8f5ec20c.js";import{u as ze}from"./replace-all.b35629e7.js";import{B as Ge}from"./breadcrumb.bcaeaf75.js";import{_ as Je}from"./index.a74b77e8.js";import{s as Qe}from"./confirm.629bcef4.js";import{E as We}from"./index.93cb5a2c.js";import{E as Xe}from"./index.e9f8834a.js";import{E as Ze}from"./index.158cdd11.js";import{E as eo}from"./index.5388dbc8.js";import{E as oo}from"./windi.a815125a.js";import{E as ao}from"./index.84e4a218.js";import"./index.0c2ced08.js";import"./index.f9c89813.js";/* empty css                                                                 */import"./sortable.esm.a99254e8.js";import"./index.a9a077b4.js";import"./isEqual.2e410d13.js";import"./_baseIsEqual.0a4e01e5.js";import"./error.7e8331f1.js";import"./index.2e51d36e.js";import"./index.1e7e06b8.js";import"./event.776e7e11.js";import"./index.5b499f72.js";import"./style.1b77b3a2.js";import"./toNumber.6efebd6a.js";import"./dayjs.min.2044f1dd.js";import"./index.878e2bbf.js";import"./index.adb17f32.js";import"./index.b065185c.js";import"./index.ab12ea9e.js";import"./index.b1b64a44.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./isNil.98bb3b88.js";import"./_baseClone.885c975f.js";import"./index.c6488b3c.js";import"./scroll.0cf77af8.js";import"./debounce.730e1961.js";import"./index.c93fe8e7.js";import"./validator.9b0d789f.js";import"./index.1d16d007.js";import"./focus-trap.81e4fb05.js";import"./refs.d2253dd4.js";/* empty css                                                               */import"./plugin-vue_export-helper.41ffa612.js";import"./main.esm.8d4b9329.js";import"./editor.main.d2800f63.js";import"./dark.bb3c8a6e.js";import"./logo-transparent.1566007e.js";import"./index.60799c00.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./index.e3f90979.js";const to={class:"flex items-center justify-between"},lo=ie({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(B,{emit:a}){const d=B,{t:_}=le(),N=c(),k=c(!0),b=c(),m=c({id:d.id,siteName:"",subDomain:"",rootDomain:""}),g=c(!1),V=c(!1),s={subDomain:[z(_("common.subDomainRequiredTips")),te(1,63),Se,Re(m.value)],siteName:[te(1,50),z(_("common.nameRequiredTips")),He(),Le(Fe,_("common.siteNameExistsTips"))],rootDomain:z(_("common.rootDomainRequiredTips"))};$e().then(h=>{N.value=h,N.value.length&&(m.value.rootDomain=N.value[0].domainName)});const x=()=>f(this,null,function*(){yield b.value.validate(),yield he(m.value),k.value=!1});return G(()=>m.value.subDomain,()=>{g.value||(m.value.siteName=m.value.subDomain)}),G(()=>m.value.siteName,()=>{V.value||(m.value.subDomain=m.value.siteName)}),(h,p)=>{const q=Me,L=Ye,j=ne,A=se,M=je,O=Ae;return u(),y(O,{"model-value":k.value,width:"600px","close-on-click-modal":!1,title:o(_)("common.checkoutSite"),onClosed:p[6]||(p[6]=v=>a("update:modelValue",!1))},{footer:n(()=>[l(Be,{"confirm-label":o(_)("common.start"),onConfirm:x,onCancel:p[5]||(p[5]=v=>k.value=!1)},null,8,["confirm-label"])]),default:n(()=>[l(M,{ref_key:"form",ref:b,"label-position":"top",model:m.value,rules:o(s),onKeydown:Te(x,["enter"])},{default:n(()=>[l(L,{label:o(_)("common.siteName"),prop:"siteName"},{default:n(()=>[l(q,{modelValue:m.value.siteName,"onUpdate:modelValue":p[0]||(p[0]=v=>m.value.siteName=v),class:"w-255px","data-cy":"siteName",onInput:p[1]||(p[1]=v=>g.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),S("div",to,[l(L,{label:o(_)("common.domain"),prop:"subDomain",class:"w-255px"},{default:n(()=>[l(q,{modelValue:m.value.subDomain,"onUpdate:modelValue":p[2]||(p[2]=v=>m.value.subDomain=v),"data-cy":"subdomain",onInput:p[3]||(p[3]=v=>V.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),l(L,{prop:"rootDomain",class:"mt-30px"},{default:n(()=>[l(A,{modelValue:m.value.rootDomain,"onUpdate:modelValue":p[4]||(p[4]=v=>m.value.rootDomain=v),class:"flex-1"},{default:n(()=>[(u(!0),R(U,null,Y(N.value,v=>(u(),y(j,{key:v.domainName,value:v.domainName,label:"."+v.domainName,"data-cy":"root-domain-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["model-value","title"])}}});var no=qe(lo,[["__scopeId","data-v-600c0bc6"]]);const so={class:"p-24"},io={class:"flex space-x-16 mt-16"},mo={key:0},uo=["title","onClick"],ro={"data-cy":"username"},co={"data-cy":"last-modified"},po={key:1,class:"shadow-s-10 rounded-normal overflow-hidden flex flex-col bg-fff dark:bg-[#303030] mt-16"},vo={class:"flex justify-center items-center h-full"},Sa=ie({setup(B){const{t:a}=le(),d=c(),_=c(0),N=Oe(),k=c(!1),b=c(),m=c(),g=c(),V=c(),s=c({startDate:"",endDate:"",userId:"",name:"",storeName:"",actionType:"",pageNr:1}),x=c([s.value.startDate,s.value.endDate]),h=t=>f(this,null,function*(){t&&typeof t=="number"&&(s.value.pageNr=t),s.value.name=s.value.name.trim(),d.value=yield oe(s.value)}),p=t=>f(this,null,function*(){yield xe(t.map(i=>i.id)),yield h(),yield M()}),q=t=>f(this,null,function*(){yield Ce(t.id),yield h(),yield M()}),L=t=>f(this,null,function*(){_.value=t.id,k.value=!0}),j=t=>f(this,null,function*(){yield Ne(t.id)}),A=t=>f(this,null,function*(){yield Ve(t.map(i=>i.id))}),M=()=>f(this,null,function*(){b.value=yield ae(),m.value=b.value.editType}),O=()=>{x.value=["",""],Object.keys(s.value).forEach(t=>{t!=="name"&&(t!=="pageMr"?s.value[t]="":s.value[t]=1)}),s.value.name?s.value.name="":h(1)},v=()=>f(this,null,function*(){yield Qe(a("common.cleanLogTips"));const t=yield be();K(t)}),me=Ke(()=>h(1),1e3);G(()=>s.value.name,()=>{s.value.name?me():h(1)});const J=()=>f(this,null,function*(){d.value=yield oe(s.value),b.value=yield ae(),g.value=b.value.storeName,m.value=b.value.editType,V.value=b.value.user});J();const ue=()=>{x.value&&x.value.some(t=>t!==null)?(s.value.startDate=x.value[0].toString(),s.value.endDate=x.value[1].toString()):(s.value.startDate="",s.value.endDate=""),h(1)};function re(t){return f(this,null,function*(){const i=yield De(t),I=JSON.parse(i);P.value&&P.value.load(t,I)})}const P=c(null),r=c({id:"",totalItem:0,finishedItems:0,isFinished:!0});function K(t){return f(this,null,function*(){if(t&&(r.value.id=t,r.value.isFinished=!1),!r.value.id){r.value.totalItem=0,r.value.finishedItems=0,r.value.isFinished=!0;return}const{totalItem:i,finishedItems:I,isFinished:H}=yield ke(r.value.id);H?(Ue.success(a("common.logCleaningInProgress")),r.value.id="",r.value.totalItem=0,r.value.finishedItems=0,r.value.isFinished=!0,yield J()):(r.value.totalItem=i,r.value.finishedItems=I,r.value.isFinished=H)})}const Q=c();return Q.value=setInterval(()=>f(this,null,function*(){r.value.isFinished||K()}),3e3),ye().then(t=>{t&&t.id&&!t.isFinished&&K(t.id)}),Pe(()=>{clearInterval(Q.value)}),(t,i)=>{var X,Z,ee;const I=ne,H=se,ce=We,pe=_e,w=Xe,F=Ze,E=eo,W=fe,de=oo,ve=ao;return u(),R(U,null,[S("div",so,[l(Ge,{name:o(a)("common.siteLogs")},null,8,["name"]),S("div",io,[l(H,{modelValue:s.value.storeName,"onUpdate:modelValue":i[0]||(i[0]=e=>s.value.storeName=e),placeholder:o(a)("common.objectType"),clearable:"",class:"w-180px",onChange:i[1]||(i[1]=e=>h(1))},{default:n(()=>[(u(!0),R(U,null,Y(g.value,e=>(u(),y(I,{key:e.key,label:e.value,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(H,{modelValue:s.value.actionType,"onUpdate:modelValue":i[2]||(i[2]=e=>s.value.actionType=e),placeholder:o(a)("common.action"),clearable:"",class:"w-140px",onChange:i[3]||(i[3]=e=>h(1))},{default:n(()=>[(u(!0),R(U,null,Y(m.value,e=>(u(),y(I,{key:e.key,label:e.value,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(H,{modelValue:s.value.userId,"onUpdate:modelValue":i[4]||(i[4]=e=>s.value.userId=e),placeholder:o(a)("common.user"),clearable:"",class:"w-160px",onChange:i[5]||(i[5]=e=>h(1))},{default:n(()=>[(u(!0),R(U,null,Y(V.value,e=>(u(),y(I,{key:e.key,label:e.value,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(ce,{modelValue:x.value,"onUpdate:modelValue":i[6]||(i[6]=e=>x.value=e),type:"datetimerange","unlink-panels":!0,format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm","range-separator":o(a)("common.to"),"start-placeholder":o(a)("common.startTime"),"end-placeholder":o(a)("common.endTime"),class:"h-40px max-w-460px",editable:!1,onChange:ue},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"]),l(pe,{modelValue:s.value.name,"onUpdate:modelValue":i[7]||(i[7]=e=>s.value.name=e),placeholder:o(a)("common.logItem"),class:"w-250px h-10"},null,8,["modelValue","placeholder"]),l(w,{class:"rounded-full","data-cy":"reset",onClick:O},{default:n(()=>[$(C(o(a)("common.reset")),1)]),_:1}),l(w,{class:"rounded-full","data-cy":"cleanLog",disabled:!((Z=(X=d.value)==null?void 0:X.list)!=null&&Z.length),onClick:v},{default:n(()=>[$(C(o(a)("common.cleanLog")),1)]),_:1},8,["disabled"])]),r.value.isFinished?(u(),R("div",mo,[d.value?(u(),y(o(ge),{key:0,data:(ee=d.value)==null?void 0:ee.list,"show-check":"","hide-delete":"",pagination:{currentPage:d.value.pageNr,pageCount:d.value.totalPages,pageSize:d.value.pageSize},class:"mt-16",onChange:h},{bar:n(({selected:e})=>[e.length>0?(u(),y(F,{key:0,placement:"top",content:o(a)("common.undoChangeTip")},{default:n(()=>[l(w,{round:"","data-cy":"undo-changes",onClick:T=>p(e)},{default:n(()=>[$(C(e.length===1?o(a)("common.undoChange"):o(a)("common.undoChanges")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):D("",!0),e.length===1?(u(),y(F,{key:1,placement:"top",content:o(a)("common.restoreTip")},{default:n(()=>[l(w,{round:"","data-cy":"restore-to-point",onClick:T=>q(e[0])},{default:n(()=>[$(C(o(a)("common.restore")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):D("",!0),e.length===1?(u(),y(F,{key:2,placement:"top",content:o(a)("common.checkoutTip")},{default:n(()=>[l(w,{round:"","data-cy":"checkout",onClick:T=>L(e[0])},{default:n(()=>[$(C(o(a)("common.checkout")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):D("",!0),e.length===1?(u(),y(F,{key:3,placement:"top",content:o(a)("common.exportChangesTip")},{default:n(()=>[l(w,{round:"","data-cy":"export-changes",onClick:T=>j(e[0])},{default:n(()=>[$(C(o(a)("common.exportChanges")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):D("",!0),e.length>0?(u(),y(F,{key:4,placement:"top",content:o(a)("common.exportItemTip")},{default:n(()=>[l(w,{round:"","data-cy":"export-item",onClick:T=>A(e)},{default:n(()=>[$(C(e.length===1?o(a)("common.exportItem"):o(a)("common.exportItems")),1)]),_:2},1032,["onClick"])]),_:2},1032,["content"])):D("",!0)]),default:n(()=>[l(E,{label:"ID",prop:"id",width:"80px"}),l(E,{label:o(a)("common.logItem")},{default:n(({row:e})=>[S("span",{title:e.itemName,class:"ellipsis text-blue cursor-pointer","data-cy":"log-item",onClick:T=>o(N).push(o(ze)({name:"log-versions",query:{keyHash:e.keyHash,storeNameHash:e.storeNameHash,tableNameHash:e.tableNameHash}}))},C(e.itemName),9,uo)]),_:1},8,["label"]),l(E,{label:o(a)("common.objectType"),width:"200px"},{default:n(({row:e})=>[l(Ee,{type:e.storeName},null,8,["type"])]),_:1},8,["label"]),l(E,{label:o(a)("common.action"),width:"120px"},{default:n(({row:e})=>[l(we,{type:e.actionType},null,8,["type"])]),_:1},8,["label"]),l(E,{label:o(a)("common.user"),width:"150px"},{default:n(({row:e})=>[S("span",ro,C(e.userName),1)]),_:1},8,["label"]),l(E,{label:o(a)("common.lastModified"),width:"180px"},{default:n(({row:e})=>[S("span",co,C(o(Ie)(e.lastModified)),1)]),_:1},8,["label"]),l(E,{align:"right",width:"120px"},{default:n(({row:e})=>[e.hasVideo?(u(),y(W,{key:0,icon:"icon-ve-video",tip:o(a)("common.playVideo"),permission:{feature:"site",action:"log"},onClick:T=>re(e.id)},null,8,["tip","onClick"])):D("",!0),l(W,{icon:"icon-time",tip:o(a)("common.versions"),permission:{feature:"site",action:"log"},"data-cy":"versions",onClick:T=>t.$router.goLogVersions(e.keyHash,e.storeNameHash,e.tableNameHash)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data","pagination"])):D("",!0)])):(u(),R("div",po,[S("div",vo,[l(ve,{title:o(a)("common.taskIsExecuting"),"sub-title":o(a)("common.cleanLogRemaining",{total:r.value.totalItem,count:r.value.finishedItems})},{icon:n(()=>[l(de,{class:"iconfont icon-bufenchenggong text-56px text-green"})]),_:1},8,["title","sub-title"])])]))]),l(Je,{onReady:i[8]||(i[8]=e=>P.value=e)}),k.value?(u(),y(no,{key:0,id:_.value,modelValue:k.value,"onUpdate:modelValue":i[9]||(i[9]=e=>k.value=e)},null,8,["id","modelValue"])):D("",!0)],64)}}});export{Sa as default};
