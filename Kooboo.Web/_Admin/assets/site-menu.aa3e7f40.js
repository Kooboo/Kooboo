var G=(i,s,e)=>new Promise((o,u)=>{var _=m=>{try{a(e.next(m))}catch(v){u(v)}},n=m=>{try{a(e.throw(m))}catch(v){u(v)}},a=m=>m.done?o(m.value):Promise.resolve(m.value).then(_,n);a((e=e.apply(i,s)).next())});import{_ as Z}from"./preload-helper.13a99eb0.js";import{_ as ee,a as te}from"./kmail-button.36b5d9a0.js";import{g as z,w as H}from"./i18n.48bd28ac.js";import{d as D,M as R,c as N,N as V,u as r,o as l,j as b,w as f,b as p,n as I,f as x,t as C,a as k,b6 as q,F as L,aH as Q,k as $,cd as ie,g as O,h as oe,J as ne,i as se}from"./url.2e6a77c4.js";import{u as B,s as re,a as ae,b as me,c as le,E as ue,r as ce}from"./main.ea42d807.js";import{E as J}from"./windi.a5b0b048.js";import{E as de,a as pe,b as fe}from"./index.eb382e96.js";import{u as ve}from"./replace-all.7cf5f327.js";import{n as _e}from"./guid.c1a40312.js";import{c as U}from"./cloneDeep.ff43c1f8.js";import{_ as xe}from"./plugin-vue_export-helper.21dcd24c.js";import{E as K}from"./index.a439b087.js";import{E as be}from"./index.77edae39.js";import{E as he,a as ye}from"./index.aa73e4df.js";import{_ as Me,a as ke,D as ge}from"./code-conflict.3f6cebc6.js";import{E as Se}from"./index.c5fde138.js";import"./light-switch.b4bd549c.js";import"./dark.ddf8665a.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.31f26a0f.js";import"./index.f5a869bb.js";import"./index.2bc50276.js";import"./index.ff0264f3.js";import"./index.379e80ad.js";import"./focus-trap.23f44899.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./dropdown.0507a1c7.js";import"./index.fcc3ea42.js";import"./refs.4001ce17.js";import"./avatar.d0cba173.js";import"./logo-transparent.1566007e.js";import"./index.d75a71d9.js";import"./email.196eb60e.js";import"./index.8b079f71.js";import"./index.50c16ae5.js";import"./aria.75ec5909.js";import"./index.ad581bad.js";import"./error.7e8331f1.js";import"./_baseClone.adbc92f5.js";import"./_baseIsEqual.c0d7e77a.js";import"./event.776e7e11.js";import"./index.6855d037.js";import"./isEqual.f1ae9fb3.js";import"./dev-mode.c4133b5a.js";import"./use-shortcuts.21ce2d8e.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./config.9fb52765.js";import"./page.831d1a45.js";import"./validate.efc4a5c0.js";import"./index.aba77680.js";import"./index.6d45a031.js";import"./index.60af85f4.js";import"./style.19d0c187.js";import"./toNumber.574be4f1.js";import"./index.99c4f65d.js";import"./index.fc90f5ad.js";import"./index.603c1365.js";import"./scroll.f51de5d8.js";import"./validator.e2869aba.js";import"./use-copy-text.a346ed23.js";import"./index.c6df1b45.js";import"./index.0f940e7f.js";import"./classCompletion.a22e38a6.js";import"./vuedraggable.umd.5840ebc7.js";import"./toggleComment.5b29ca87.js";import"./use-save-tip.04d9878f.js";import"./confirm.e2c924ff.js";import"./index.a731e53b.js";import"./index.cbddf8eb.js";import"./index.695d0284.js";import"./index.0d2684bf.js";import"./debounce.61c67278.js";import"./index.064c7de9.js";import"./index.c4e9b529.js";import"./icon-button.3313e42d.js";import"./index.8262f5ef.js";import"./index.66d5d547.js";import"./index.232e741a.js";import"./index.af90dc36.js";import"./index.470f0e7e.js";import"./index.deca86b5.js";import"./alert.583ccfe6.js";import"./index.fafb14b3.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.118b18f5.js";/* empty css                                                          */import"./file.b0d4cc6e.js";import"./use-date.01b82ce0.js";import"./dayjs.min.0a66969b.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.82732353.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.f6d26366.js";import"./image-editor.846c8dc6.js";import"./main.esm.5190fb65.js";import"./index.f01d4ffd.js";import"./index.968f79fd.js";import"./diff.dece7d27.js";const we=["src"],Ae=D({props:{item:null},setup(i){const s=R(),e=B(),o=N(()=>n=>{if(n.advanced===void 0)return!0;let a=JSON.parse(JSON.stringify(e.site.visibleAdvancedMenus));return a===null?!0:!!a.includes(n.name)}),u=N(()=>n=>!e.site.visibleAdvancedMenus||n.items.some(a=>!a.advanced)?!0:n.items.some(a=>e.site.visibleAdvancedMenus.includes(a.name)));function _(n){return typeof n.queryBuilder=="function"?n.queryBuilder(n,s):{SiteId:s.query.SiteId}}return(n,a)=>{const m=J,v=V("SubMenu",!0),S=de,w=pe,g=V("router-link");return i.item.items.length&&r(u)(i.item)?(l(),b(S,{key:0,index:i.item.id},{title:f(()=>[p(m,{class:I(["iconfont",i.item.icon])},null,8,["class"]),x("span",null,C(i.item.display),1)]),default:f(()=>[(l(!0),k(L,null,q(i.item.items,t=>(l(),b(v,{key:t.id,item:t},null,8,["item"]))),128))]),_:1},8,["index"])):i.item.name?(l(),b(g,{key:1,to:{name:i.item.name.toLowerCase(),query:_(i.item),params:i.item.params}},{default:f(()=>[r(o)(i.item)?(l(),b(w,{key:0,index:i.item.routeMenuName?i.item.name.toLowerCase()+i.item.routeMenuName:i.item.name.toLowerCase()},{default:f(()=>[i.item.routeMenuName&&i.item.icon?(l(),k("img",{key:0,class:"w-18px h-18px mr-8",src:i.item.icon},null,8,we)):(l(),b(m,{key:1,class:I(["iconfont",[i.item.icon,{"!w-18px":!i.item.icon}]])},null,8,["class"])),Q(" "+C(i.item.display),1)]),_:1},8,["index"])):$("",!0)]),_:1},8,["to"])):$("",!0)}}}),Ee={class:"transform scale-75 origin-left"},Ce=["title"],$e={class:"text-999 dark:text-fff/60 text-s transform"},Ne=D({setup(i){const{t:s}=z(),e=ie(),o=R();var u=B();return(_,n)=>{const a=J;return l(),k("div",{class:"flex items-center px-5 pt-16 pb-12 border-b border-solid border-line dark:border-444 cursor-pointer space-x-12","data-cy":"dashboard",onClick:n[0]||(n[0]=m=>r(e).push(r(ve)({name:"dashboard"})))},[p(a,{class:I(["iconfont text-size-28px text-blue",r(o).name==="dashboard"?"icon-home2":"icon-home"])},null,8,["class"]),x("div",Ee,[x("p",{class:"text-2l ellipsis max-w-150px dark:text-fff/86",title:r(u).site.displayName},C(r(u).site.displayName),9,Ce),x("p",$e,C(r(s)("common.currentSite")),1)])])}}}),Ie=B();function j(i){var e,o,u,_,n,a,m,v,S,w,g;const s=[];for(const t of i)if((e=t.meta)!=null&&e.menu){const c={name:(o=t.name)==null?void 0:o.toString(),items:[],display:t.meta.menu.display,id:_e(),permission:(_=(u=t.meta)==null?void 0:u.menu)==null?void 0:_.permission,advanced:(n=t.meta)!=null&&n.advanced?(a=t.meta)==null?void 0:a.advanced:void 0,icon:(v=(m=t.meta)==null?void 0:m.menu)==null?void 0:v.icon,queryBuilder:(w=(S=t.meta)==null?void 0:S.menu)==null?void 0:w.queryBuilder,routeMenuName:(g=t.meta)==null?void 0:g.menu.name};t.children&&c.items.push(...j(t.children)),s.push(c)}else t.children&&s.push(...j(t.children));return s}function W(i){const s=[];for(const e of i){const o=U(e);(!o.permission||Ie.hasAccess(o.permission.feature,o.permission.action))&&(s.push(o),o.items=W(o.items))}return s}const Be={class:"w-202px h-full relative bg-fff z-10 dark:bg-[#252526]"},qe={class:"text-[#303133] dark:text-999"},Le={class:"p-26px pb-16"},De={class:"flex justify-between items-center mb-8 dark:text-999"},Re={class:"text-12px text-666 dark:text-999"},Ve=["data-cy"],Oe=D({setup(i){const s=R(),e=B(),{t:o}=z(),u=O(!1),_=O(),n=N(()=>{var c;const t=j(re);for(const d of e.moduleMenus){let h=t;d.parent&&(h=(c=t.find(A=>A.routeMenuName==d.parent))==null?void 0:c.items),h&&h.push({id:d.id,display:d.name,name:"module menu",routeMenuName:d.id,items:[],icon:d.icon,queryBuilder(){return{url:d.url,SiteId:s.query.SiteId}},params:{module:d.id}})}return t}),a=N(()=>e.isAdmin?n.value:e.permissions?W(n.value):[]),m=N(()=>e.firstActiveMenu?e.firstActiveMenu:s.meta.activeMenu?s.meta.activeMenu:s.name=="module menu"?s.name+s.params.module:s.name),v=t=>{var c,d;if(e.site.visibleAdvancedMenus===null||(c=e.site.visibleAdvancedMenus)!=null&&c.includes(t.name))return!0;if(((d=e.site.visibleAdvancedMenus)==null?void 0:d.length)===0)return!1;if(!t.advanced)return!0},S=t=>{var c,d;if(e.site.visibleAdvancedMenus===null){let h=a.value.filter(y=>y.advanced===!0),A=[];h.forEach(y=>{A=A.concat(y.items)}),e.site.visibleAdvancedMenus=A.filter(y=>y.name!==t&&y.advanced===!0).map(y=>y.name)}else(c=e.site.visibleAdvancedMenus)!=null&&c.includes(t)?e.site.visibleAdvancedMenus=e.site.visibleAdvancedMenus.filter(h=>h!==t):(d=e.site.visibleAdvancedMenus)==null||d.push(t);w()},w=()=>G(this,null,function*(){yield ae(e.site.visibleAdvancedMenus)}),g=t=>{!_.value.contains(t.target)&&u.value&&(u.value=!1)};return oe(()=>{window.addEventListener("click",g)}),ne(()=>{window.removeEventListener("click",g)}),(t,c)=>{const d=fe,h=K,A=J,y=be,X=he,Y=ye;return l(),k("aside",Be,[p(h,{class:"pb-14"},{default:f(()=>[p(Ne),p(d,{"default-active":r(m)},{default:f(()=>[(l(!0),k(L,null,q(r(a),M=>(l(),b(Ae,{key:M.id,item:M},null,8,["item"]))),128))]),_:1},8,["default-active"])]),_:1}),x("div",{class:I(["absolute bottom-0 left-0 right-0 h-[56px] flex items-center px-5 hover:bg-[#d3eafd] dark:hover:bg-[#18222c] cursor-pointer text-444 dark:text-999",u.value?"bg-[#d3eafd]  dark:bg-[#18222c]":""]),"data-cy":"edit-menu",onClick:c[0]||(c[0]=H(M=>u.value=!u.value,["stop"]))},[p(A,{class:"iconfont icon-a-writein3 text-18px text-999 text-opacity-60 mr-8"}),x("span",qe,C(r(o)("common.editMenu")),1)],2),x("div",{ref_key:"editMenuBox",ref:_,class:I(["absolute inset-0 left-210px w-250px h-full bg-fff shadow-s-10",u.value?"block":"hidden"])},[p(h,{class:"dark:bg-[#252526]"},{default:f(()=>[x("div",Le,[x("div",De,[x("h1",null,C(r(o)("common.editMenu")),1),p(A,{class:"iconfont icon-close cursor-pointer hover:text-blue text-14px",title:r(o)("common.close"),onClick:c[1]||(c[1]=H(M=>u.value=!u.value,["stop"]))},null,8,["title"])]),x("span",Re,C(r(o)("common.editMenuTips")),1)]),p(Y,{class:"editMenu pt-8"},{default:f(()=>[(l(!0),k(L,null,q(r(a).filter(M=>M.advanced===!0),M=>(l(),b(X,{key:M.id,title:M.display},{default:f(()=>[(l(!0),k(L,null,q(r(U)(M.items).sort((E,P)=>{var T,F;return Number((T=E.advanced)!=null?T:!1)-Number((F=P.advanced)!=null?F:!1)}),E=>(l(),k("div",{key:E.id,class:"py-8 px-44px flex items-center justify-between dark:text-999","data-cy":E.name},[p(y,{"model-value":v(E),disabled:!E.advanced,onChange:P=>S(E.name)},{default:f(()=>[Q(C(E.display),1)]),_:2},1032,["model-value","disabled","onChange"])],8,Ve))),128))]),_:2},1032,["title"]))),128))]),_:1})]),_:1})],2)])}}});var je=xe(Oe,[["__scopeId","data-v-4859e556"]]);const ze={key:1,class:"h-full flex flex-col bg-[#f3f5f5] dark:bg-[#1e1e1e]"},Je={key:0,class:"flex-1 overflow-hidden relative"},Pe={class:"absolute inset-0 left-202px"},Vi=D({setup(i){const{t:s}=z(),e=R(),o=me(),u=B(),_=le(),n=O(!1),a=m=>{n.value=m};return se(()=>e.query.SiteId,m=>{m&&n.value&&(ue({message:s("common.siteChangingSuccess"),type:"success"}),n.value=!1),ce.addRoute({name:"test",path:"/sites/test",component:()=>Z(()=>import("./module-index.6a975075.js"),["assets/module-index.6a975075.js","assets/url.2e6a77c4.js","assets/windi.a5b0b048.js","assets/windi.084c7d94.css","assets/i18n.48bd28ac.js"]),meta:{menu:{display:"aaa",icon:"icon-media1"}}})}),(m,v)=>{const S=V("router-view"),w=K,g=Se;return l(),b(g,{locale:r(o).locale},{default:f(()=>[r(_).show?(l(),b(Me,{key:0})):$("",!0),r(u).site?(l(),k("div",ze,[p(r(te),{class:"pl-40px"},{left:f(()=>[r(o).limitSite?$("",!0):(l(),b(ke,{key:0,onChange:v[0]||(v[0]=t=>a(t))})),p(ge),r(o).limitSite?$("",!0):(l(),b(ee,{key:1}))]),right:f(()=>[]),_:1}),r(o).header?(l(),k("div",Je,[p(je,{class:"absolute inset-0 right-auto"}),x("div",Pe,[p(w,{id:"main-scrollbar",class:"w-full"},{default:f(()=>[(l(),b(S,{key:m.$route.name}))]),_:1})])])):$("",!0)])):$("",!0)]),_:1},8,["locale"])}}});export{Vi as default};
