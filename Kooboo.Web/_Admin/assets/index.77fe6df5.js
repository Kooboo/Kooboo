var A=(_,d,s)=>new Promise((r,C)=>{var V=e=>{try{y(s.next(e))}catch(E){C(E)}},S=e=>{try{y(s.throw(e))}catch(E){C(E)}},y=e=>e.done?r(e.value):Promise.resolve(e.value).then(V,S);y((s=s.apply(_,d)).next())});import{_ as oe}from"./icon-button.74ccc970.js";import{_ as ae}from"./k-table.b1a54b80.js";import{a as B}from"./replace-all.56d2c1f7.js";import{d as I}from"./main.9fdfea92.js";import{d as le,g as G,w as P,o as j}from"./i18n.a87944a4.js";import{u as ne}from"./use-date.f1258183.js";import{u as ie}from"./use-operation-dialog.4f6d7533.js";import{e as re}from"./guid.c1a40312.js";import{a as F,r as me,l as ue,H as se}from"./validate.bb56f9e3.js";import{_ as de}from"./dev-mode.acf56c3e.js";import{_ as ce}from"./index.f0d5f031.js";import{U as pe}from"./editor.main.d2800f63.js";import{E as fe}from"./index.6f16842c.js";import{E as ve}from"./index.178b9e08.js";import{E as _e,a as ye}from"./index.9fd79879.js";import{E as he,a as be}from"./index.7c862087.js";import{E as J}from"./windi.6360286d.js";import{E as Q}from"./index.361e2245.js";import{E as Ce}from"./index.c003dfa1.js";import{d as W,g as R,c as z,i as Ve,o as u,j as f,w as n,b as l,u as i,k as D,a as w,b7 as $,aI as x,t as v,F as N,f as U,H as ge,h as ke,b8 as we,e as Ee}from"./url.4cb47a7a.js";import{B as Ue}from"./breadcrumb.f4d80c95.js";import{b as Ae}from"./confirm.b60b5d2f.js";import{E as Ne}from"./index.b38edc72.js";import{c as $e}from"./cloneDeep.c5011aa2.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.7b8c5aef.js";import"./index.4f90a917.js";import"./index.4d568055.js";import"./sortable.esm.a99254e8.js";import"./index.c6da2706.js";import"./isEqual.4cab74e3.js";import"./_baseIsEqual.dc9e64c4.js";import"./error.7e8331f1.js";import"./index.42922617.js";import"./event.776e7e11.js";import"./index.f15f695e.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./dayjs.min.ccc40d4f.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./use-shortcuts.ff4b1f52.js";import"./index.fd96ea36.js";import"./userWorker.b3a6730b.js";import"./config.1e73f9c3.js";import"./dark.9459c47b.js";import"./page.881ec888.js";import"./index.f2c1b903.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./validator.b5df2420.js";import"./index.c86a187b.js";import"./dropdown.86d3a7fb.js";import"./refs.3132cbdb.js";import"./use-copy-text.ec245a13.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./use-save-tip.e3dc783a.js";import"./index.6918f0a5.js";import"./vuedraggable.umd.af323a53.js";import"./index.f154d010.js";import"./index.b9a74c44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./alert.d2815716.js";import"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./index.0e5d639d.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";import"./index.e3f90979.js";import"./_baseClone.b8903935.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";const X=le.global.t,xe=()=>I.get(B("Authentication/list")),Re=_=>I.post(B("Authentication/Deletes"),_,void 0,{successMessage:X("common.deleteSuccess")}),Se=_=>I.post(B("Authentication/post"),_,void 0,{successMessage:X("common.saveSuccess")}),Te=()=>I.get(B("Authentication/GetTypes")),qe=_=>I.get(B("Authentication/isUniqueName"),{name:_},{hiddenLoading:!0,hiddenError:!0}),De={class:"w-full space-y-4"},Be=W({props:{modelValue:{type:Boolean},current:null},emits:["save-success"],setup(_,{emit:d}){const s=_,{t:r}=G(),{visible:C,handleClose:V}=ie(s,d),S=()=>({id:re,name:"",matcher:"None",action:"None",failedAction:"None",customCodeName:"",customCode:`// sample code.. 
// if (k.request.url.indexOf('/api') == 0) {
//     var token = k.request.headers.get('Authorization');
//     if (token != 'abc123') k.response.unauthorized()
// }`,httpCode:401,url:"/",conditions:[]}),y=R(),e=R({}),E={name:[F(r("common.nameRequiredTips")),me(1,50),ue(),{asyncValidator(o,a,k){return A(this,null,function*(){try{yield qe(a),k()}catch(b){k(Error(r("common.valueHasBeenTakenTips")))}})},trigger:"blur"}],httpCode:[F(r("common.httpCodeRequiredTips")),se],url:[F(r("common.urlRequiredTips"))],options:[{validator(o,a,k){e.value.conditions.length===0?k(new Error(r("common.fieldRequiredTips"))):k()},trigger:"blur"}]},m=z(()=>!s.current),c=z(()=>{var o,a;return(m.value?r("common.create"):r("common.edit"))+((o=s.current)!=null&&o.name?": "+((a=s.current)==null?void 0:a.name):"")}),h=R();Ve(()=>s.modelValue,o=>A(this,null,function*(){var a;o&&(h.value||(h.value=yield Te()),(a=y.value)==null||a.resetFields(),s.current?e.value=s.current:e.value=S())}));function H(o){e.value.conditions.splice(o,1)}function g(){var o;e.value.conditions.push({left:"url",operator:"=",right:""}),(o=y.value)==null||o.clearValidate("options")}function M(){return A(this,null,function*(){var o;yield(o=y.value)==null?void 0:o.validate(),yield Se(e.value),V(),d("save-success")})}return(o,a)=>{const k=ve,b=_e,T=he,q=be,L=J,O=Q,Z=fe,ee=ye,te=Ce;return u(),f(te,{modelValue:i(C),"onUpdate:modelValue":a[11]||(a[11]=t=>ge(C)?C.value=t:null),width:"650px","close-on-click-modal":!1,title:i(c),onClose:i(V)},{footer:n(()=>[l(ce,{permission:{feature:"authentication",action:"edit"},onConfirm:M,onCancel:i(V)},null,8,["onCancel"])]),default:n(()=>[h.value?(u(),f(ee,{key:0,ref_key:"form",ref:y,rules:E,model:e.value,"label-position":"top",onSubmit:a[10]||(a[10]=P(()=>{},["prevent"])),onKeydown:j(M,["enter"])},{default:n(()=>[i(m)?(u(),f(b,{key:0,prop:"name",label:i(r)("common.name")},{default:n(()=>[l(k,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.name=t),"data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0),l(b,{prop:"matcher",label:i(r)("common.matcher")},{default:n(()=>[l(q,{modelValue:e.value.matcher,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.matcher=t),class:"w-full","data-cy":"matcher"},{default:n(()=>[(u(!0),w(N,null,$(h.value.matcher,t=>(u(),f(T,{key:t.name,value:t.name,"data-cy":"matcher-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.matcher==="Condition"?(u(),f(b,{key:1,prop:"options"},{default:n(()=>[U("div",De,[(u(!0),w(N,null,$(e.value.conditions,(t,K)=>(u(),w("div",{key:K,class:"flex items-center space-x-4"},[l(q,{modelValue:t.left,"onUpdate:modelValue":p=>t.left=p,class:"w-120px","data-cy":"condition-left"},{default:n(()=>[(u(),w(N,null,$(["url","method"],p=>l(T,{key:p,value:p,"data-cy":"condition-left-opt"},{default:n(()=>[x(v(p),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(q,{modelValue:t.operator,"onUpdate:modelValue":p=>t.operator=p,class:"w-150px","data-cy":"condition-operater"},{default:n(()=>[(u(),w(N,null,$([{label:"=",value:"="},{label:"!=",value:"!="},{label:"Contains",value:"contains"},{label:"Not contains",value:"notcontains"},{label:"Starts with",value:"startwith"},{label:"Not starts with",value:"notstartwith"}],p=>l(T,{key:p.value,value:p.value,label:p.label,"data-cy":"condition-operater-opt"},null,8,["value","label"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(b,{prop:"conditions."+K+".right",rules:i(F)(i(r)("common.valueRequiredTips"))},{default:n(()=>[l(k,{modelValue:t.right,"onUpdate:modelValue":p=>t.right=p,"data-cy":"condition-right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),U("div",null,[l(O,{circle:"","data-cy":"remove-condition",onClick:p=>H(K)},{default:n(()=>[l(L,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),l(O,{circle:"",onClick:a[2]||(a[2]=t=>g())},{default:n(()=>[l(L,{class:"iconfont icon-a-addto text-blue","data-cy":"add-condition"})]),_:1})])]),_:1})):D("",!0),l(b,{prop:"action",label:i(r)("common.action")},{default:n(()=>[l(q,{modelValue:e.value.action,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.action=t),class:"w-full","data-cy":"action"},{default:n(()=>[(u(!0),w(N,null,$(h.value.action,t=>(u(),f(T,{key:t.name,value:t.name,"data-cy":"action-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.action==="CustomCode"?(u(),f(b,{key:2,prop:"customCodeName",label:i(r)("common.code")},{default:n(()=>[l(de,{modelValue:e.value.customCode,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.customCode=t),class:"h-200px",language:"typescript","k-script":"",uri:i(pe).file(e.value.id),onKeydown:a[5]||(a[5]=j(P(()=>{},["stop"]),["enter"]))},null,8,["modelValue","uri"])]),_:1},8,["label"])):(u(),w(N,{key:3},[l(b,{prop:"failedAction",label:i(r)("common.failedAction")},{default:n(()=>[l(q,{modelValue:e.value.failedAction,"onUpdate:modelValue":a[6]||(a[6]=t=>e.value.failedAction=t),class:"w-full","data-cy":"failed-action"},{default:n(()=>[(u(!0),w(N,null,$(h.value.failedAction,t=>(u(),f(T,{key:t.name,value:t.name,"data-cy":"failed-action-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.failedAction==="ResultCode"?(u(),f(b,{key:0,prop:"httpCode",label:i(r)("common.httpCode")},{default:n(()=>[l(Z,{modelValue:e.value.httpCode,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value.httpCode=t),placeholder:i(r)("common.httpCode"),"data-cy":"http-code"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):D("",!0),e.value.failedAction==="Redirect"?(u(),f(b,{key:1,prop:"url",label:i(r)("common.url")},{default:n(()=>[l(k,{modelValue:e.value.url,"onUpdate:modelValue":a[8]||(a[8]=t=>e.value.url=t),"data-cy":"redirect-url",onInput:a[9]||(a[9]=t=>e.value.url=e.value.url.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0)],64))]),_:1},8,["model","onKeydown"])):D("",!0)]),_:1},8,["modelValue","title","onClose"])}}}),Ie={class:"p-24"},Me={class:"flex items-center py-24 space-x-16"},Fe=["title"],He={"data-cy":"matcher"},Ke={"data-cy":"action"},Le={"data-cy":"failed-action"},Oe={class:"ellipsis","data-cy":"parameters"},Bo=W({setup(_){const{t:d}=G(),s=R([]),r=R(!1),C=R();ke(()=>{V()});function V(){return A(this,null,function*(){s.value=(yield xe()).sort((m,c)=>m.lastModified>c.lastModified?-1:1)})}function S(m){return m.action==="CustomCode"?m.customCode+"":m.failedAction==="ResultCode"?m.httpCode+"":m.failedAction==="Redirect"?m.url:""}function y(m){return m.matcher!=="Condition"?m.matcher:m.conditions.map(c=>`${c.left} ${c.operator} '${c.right}'`).join(" && ")}function e(m){return A(this,null,function*(){yield Ae(m.length);const c=m.map(h=>h.id);yield Re({ids:c}),V()})}function E(m){return A(this,null,function*(){C.value=m?$e(m):void 0,r.value=!0})}return(m,c)=>{const h=J,H=Q,g=Ne,M=oe,Y=we("hasPermission");return u(),w("div",Ie,[l(Ue,{name:i(d)("common.authentication")},null,8,["name"]),U("div",Me,[Ee((u(),f(H,{round:"","data-cy":"create",onClick:c[0]||(c[0]=o=>E())},{default:n(()=>[l(h,{class:"iconfont icon-a-addto"}),x(" "+v(i(d)("common.create")),1)]),_:1})),[[Y,{feature:"authentication",action:"edit"}]])]),l(i(ae),{data:s.value,"show-check":"",permission:{feature:"authentication",action:"delete"},onDelete:e},{default:n(()=>[l(g,{label:i(d)("common.name"),width:"150"},{default:n(({row:o})=>[U("span",{class:"ellipsis",title:o.name,"data-cy":"name"},v(o.name),9,Fe)]),_:1},8,["label"]),l(g,{label:i(d)("common.matcher")},{default:n(({row:o})=>[U("span",He,v(y(o)),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.action"),width:"150"},{default:n(({row:o})=>[U("span",Ke,v(o.action),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.failedAction"),width:"150"},{default:n(({row:o})=>[U("span",Le,v(o.action==="CustomCode"?"CustomCode":o.failedAction),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.parameters"),width:"180"},{default:n(({row:o})=>[U("div",Oe,v(S(o)),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.lastModified"),width:"180"},{default:n(({row:o})=>[x(v(i(ne)(o.lastModified)),1)]),_:1},8,["label"]),l(g,{width:"70",align:"right"},{default:n(({row:o})=>[l(M,{icon:"icon-a-setup",tip:i(d)("common.setting"),"data-cy":"setting",onClick:a=>E(o)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data"]),l(Be,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=o=>r.value=o),current:C.value,onSaveSuccess:V},null,8,["modelValue","current"])])}}});export{Bo as default};
