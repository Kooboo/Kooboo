var ve=Object.defineProperty,ye=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ee=(c,e,s)=>e in c?ve(c,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[e]=s,G=(c,e)=>{for(var s in e||(e={}))Ce.call(e,s)&&ee(c,s,e[s]);if(Z)for(var s of Z(e))xe.call(e,s)&&ee(c,s,e[s]);return c},te=(c,e)=>ye(c,he(e));var F=(c,e,s)=>new Promise((V,b)=>{var r=i=>{try{y(s.next(i))}catch(g){b(g)}},C=i=>{try{y(s.throw(i))}catch(g){b(g)}},y=i=>i.done?V(i.value):Promise.resolve(i.value).then(r,C);y((s=s.apply(c,e)).next())});import{_ as be}from"./k-table.d4486972.js";import{_ as ke}from"./icon-button.3313e42d.js";import{d as Q,g as I,c as N,h as ae,o as f,j as B,w as l,b as n,u as o,a as $,f as S,k as z,b7 as le,e as se,aH as j,t as w,F as O,M as we,cd as Se,N as Ve,b6 as oe}from"./url.2e6a77c4.js";import{B as Ee}from"./breadcrumb.80c136b8.js";import{g as W,o as $e,w as Ie}from"./i18n.48bd28ac.js";import{u as ne}from"./replace-all.7cf5f327.js";import{a as Pe,b as Be,u as De,f as Te,m as Fe}from"./commerce.f8d3336c.js";import{b as Ne}from"./confirm.e2c924ff.js";import{_ as re}from"./index.a731e53b.js";import{S as ze}from"./search-input.67dfc984.js";import{f as Ae}from"./product.c1a83798.js";import{u as ie}from"./useFields.2c414714.js";import{_ as X}from"./index.4a51c2b7.js";import{E as Me}from"./index.77edae39.js";import{E as Y,a as me}from"./index.b494e80e.js";import{E as ce}from"./index.a439b087.js";import{E as Re}from"./index.7034978e.js";import{E as ue}from"./index.c4e9b529.js";import{E as de}from"./windi.a5b0b048.js";import{E as pe}from"./index.2bc50276.js";import{E as _e}from"./index.379e80ad.js";import{b as Ue}from"./useLabels.456dfc28.js";import{g as Le}from"./main.ea42d807.js";import{c as qe,g as K}from"./string.955a924b.js";import{c as Ke}from"./index.0d2684bf.js";import"./sortable.esm.a99254e8.js";import"./index.695d0284.js";import"./event.776e7e11.js";import"./index.ff0264f3.js";import"./error.7e8331f1.js";import"./index.8262f5ef.js";import"./index.fcc3ea42.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.99c4f65d.js";import"./index.fc90f5ad.js";import"./isNil.98bb3b88.js";import"./index.603c1365.js";import"./scroll.f51de5d8.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.23f44899.js";import"./validator.e2869aba.js";/* empty css                                                                 */import"./isEmpty.dc565ae5.js";import"./_baseIsEqual.c0d7e77a.js";import"./search-provider.68dc3c2c.js";import"./toNumber.574be4f1.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./style.19d0c187.js";import"./_baseUniq.c69c2d82.js";import"./use-operation-dialog.f0f37a10.js";import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.118b18f5.js";import"./file.b0d4cc6e.js";import"./validate.efc4a5c0.js";import"./index.d75a71d9.js";import"./index.aba77680.js";import"./index.6d45a031.js";import"./index.31f26a0f.js";import"./index.60af85f4.js";import"./index.6855d037.js";import"./_baseClone.adbc92f5.js";import"./isEqual.f1ae9fb3.js";import"./folder.8308bb9d.js";import"./use-date.01b82ce0.js";import"./dayjs.min.0a66969b.js";import"./relations-tag.a09361ff.js";import"./page.831d1a45.js";import"./guid.c1a40312.js";import"./use-copy-text.a346ed23.js";import"./index.500e98ec.js";import"./browser.6147bf52.js";import"./throttle.041b2553.js";import"./debounce.61c67278.js";import"./_createCompounder.591d8488.js";import"./color-picker.770bc088.js";import"./index.ae716322.js";import"./position.c0f844a3.js";import"./index.064c7de9.js";import"./image-cover.5aa60066.js";import"./media-dialog.00ce8f4f.js";import"./media.56507018.js";import"./index.4db7adae.js";/* empty css                                                          *//* empty css                                                          */import"./layout.7d98e9c1.js";import"./index.d971d096.js";import"./utils.6985c8b2.js";import"./index.0e262df3.js";import"./use-file-upload.82732353.js";import"./index.470f0e7e.js";import"./index.deca86b5.js";import"./index.a47bd154.js";import"./index.be352e91.js";import"./file.e38b2555.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.f6d26366.js";import"./index.968f79fd.js";import"./dropdown.0507a1c7.js";import"./refs.4001ce17.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";const je={key:0},He={class:"flex items-center pb-12 space-x-16"},Ge=S("div",{class:"flex-1"},null,-1),Je={class:"text-center"},Oe=Q({props:{excludes:null,modelValue:{type:Boolean}},emits:["update:modelValue","selected"],setup(c,{emit:e}){const s=c,{getColumns:V}=ie(),b=V([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]),{t:r}=W(),C=I(!0),y=I({pageIndex:1,pageSize:30,keyword:"",excludes:s.excludes}),i=I(),g=N(()=>i.value?i.value.list:[]);function D(p){return F(this,null,function*(){y.value.pageIndex=p,i.value=yield Ae(y.value),i.value.list=i.value.list.map(_=>te(G({},_),{selected:!1}))})}const k=N(()=>g.value.some(p=>p.selected)&&g.value.some(p=>!p.selected)),h=N(()=>g.value.length&&g.value.every(p=>p.selected));function T(p){g.value.forEach(_=>_.selected=p)}ae(()=>{D(1)});function U(){e("selected",g.value.filter(p=>p.selected)),C.value=!1}return(p,_)=>{const A=ze,M=Me,L=Y,q=me,m=ce,t=Re,a=re,u=ue;return f(),B(u,{"model-value":C.value,width:"800px",title:o(r)("common.selectProduct"),"close-on-click-modal":!1,onClosed:_[3]||(_[3]=d=>e("update:modelValue",!1))},{footer:l(()=>[n(a,{disabled:!o(g).some(d=>d.selected),onConfirm:U,onCancel:_[2]||(_[2]=d=>C.value=!1)},null,8,["disabled"])]),default:l(()=>{var d,x,P;return[i.value?(f(),$("div",je,[S("div",He,[Ge,n(A,{modelValue:y.value.keyword,"onUpdate:modelValue":_[0]||(_[0]=E=>y.value.keyword=E),class:"w-248px",onKeydown:_[1]||(_[1]=$e(Ie(E=>D(1),["prevent"]),["enter"]))},null,8,["modelValue"])]),n(m,{"max-height":"400px"},{default:l(()=>[n(q,{data:o(g),class:"el-table--gray"},{default:l(()=>[n(L,{width:"60",align:"center"},{header:l(()=>[n(M,{size:"large",class:"!block !h-20px",indeterminate:o(k),"model-value":o(h),onChange:T},null,8,["indeterminate","model-value"])]),default:l(({row:E})=>[n(M,{modelValue:E.selected,"onUpdate:modelValue":J=>E.selected=J,size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(X,{columns:o(b)},null,8,["columns"])]),_:1},8,["data"])]),_:1}),S("div",Je,[n(t,{class:"py-8",layout:"prev, pager, next","hide-on-single-page":"","page-size":(d=i.value)==null?void 0:d.pageSize,"current-page":(x=i.value)==null?void 0:x.pageIndex,total:(P=i.value)==null?void 0:P.count,onCurrentChange:D},null,8,["page-size","current-page","total"])])])):z("",!0)]}),_:1},8,["model-value","title"])}}}),Qe={class:"space-y-12"},We={class:"flex items-center"},Xe=Q({props:{editable:{type:Boolean},categoryId:null,modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(c,{emit:e}){const s=c,{t:V}=W(),b=I(!0),r=I(),C=I(!1),{getColumns:y}=ie(),i=y([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]);Pe(s.categoryId).then(k=>{r.value=k});function g(k){var h;(h=r.value)==null||h.push(...k)}function D(){return F(this,null,function*(){yield Be(s.categoryId,r.value.map(k=>k.id)),b.value=!1,e("reload")})}return(k,h)=>{var t;const T=de,U=pe,p=_e,_=Y,A=me,M=ce,L=re,q=ue,m=le("hasPermission");return f(),$(O,null,[n(q,{"model-value":b.value,width:"850px",title:o(V)("common.products"),"close-on-click-modal":!1,onClosed:h[2]||(h[2]=a=>e("update:modelValue",!1))},{footer:l(()=>[n(L,{onConfirm:D,onCancel:h[1]||(h[1]=a=>b.value=!1)})]),default:l(()=>[S("div",Qe,[c.editable?se((f(),B(U,{key:0,round:"",onClick:h[0]||(h[0]=a=>C.value=!0)},{default:l(()=>[S("div",We,[n(T,{class:"mr-16 iconfont icon-a-addto"}),j(" "+w(o(V)("common.addProduct")),1)])]),_:1})),[[m,{feature:"productCategories",action:"edit"}]]):z("",!0),n(M,{"max-height":"400px"},{default:l(()=>[n(A,{data:r.value,class:"el-table--gray"},{default:l(()=>[n(X,{columns:o(i)},null,8,["columns"]),c.editable?(f(),B(_,{key:0,align:"right",width:"60"},{default:l(({row:a})=>[n(p,{placement:"top",content:o(V)("common.delete")},{default:l(()=>[n(T,{class:"iconfont icon-delete hover:text-blue text-l",onClick:u=>r.value=r.value.filter(d=>d.id!=a.id)},null,8,["onClick"])]),_:2},1032,["content"])]),_:1})):z("",!0)]),_:1},8,["data"])]),_:1})])]),_:1},8,["model-value","title"]),C.value?(f(),B(Oe,{key:0,modelValue:C.value,"onUpdate:modelValue":h[3]||(h[3]=a=>C.value=a),excludes:(t=r.value)==null?void 0:t.map(a=>a.id),onSelected:g},null,8,["modelValue","excludes"])):z("",!0)],64)}}}),Ye={class:"p-24"},Ze={class:"flex items-center py-24 space-x-16"},et={class:"flex items-center"},tt={class:"flex items-center"},ot={class:"text-black dark:text-[#cfd3dc]"},nt={class:"inline-flex flex-wrap gap-4"},at={key:0,class:"text-s"},lt={key:0},st={key:1,class:"text-s"},sn=Q({setup(c){const{t:e}=W(),s=we(),V=Se(),b=s.meta.title,r=De(),C=I(),y=I(!1),i=I(r.settings);r.loadSettings().then(()=>{i.value=r.settings});const{getFieldDisplayName:g}=Ue(),D=Le(),k={image:{width:80}},h={"min-width":180},T=N(()=>{var m;return((m=A.value)==null?void 0:m.length)>1}),U=N(()=>T.value);function p(m){return F(this,null,function*(){yield Ne(m.length),yield Te(m.map(t=>t.id)),r.loadCategories()})}const _=N(()=>{var a;const m=(a=i.value.categoryCustomFields)!=null?a:[];let t=m.filter(u=>u.isSummaryField);return t.length||(t=m.slice(0,2)),t.map(u=>({name:qe(u.name),displayName:g(u),controlType:u.type,multipleValue:u.multiple,attrs:G(G({},h),K(k,u.name))}))}),A=N(()=>{var m;return((m=r.categories)!=null?m:[]).map(t=>{var u;const a=(u=K(t,"customData"))!=null?u:{};for(const d of _.value)if(!K(t,d.name)){const x=K(a,d.name);if(!x)continue;t[d.name]=K(x,D.default)}return t})});function M(m){C.value=m,y.value=!0}function L(m,t){return F(this,null,function*(){const{newIndex:a,oldIndex:u}=t;if(a===void 0||u===void 0||u===a)return;const d=m[a],x=m[a+1],P=m[a-1],E={source:d.id,prevId:x==null?void 0:x.id,nextId:P==null?void 0:P.id};yield Fe(E),r.loadCategories()})}function q(){return F(this,null,function*(){r.loadCategories()})}return ae(()=>F(this,null,function*(){r.loadCategories()})),(m,t)=>{const a=de,u=pe,d=Ke,x=_e,P=Ve("router-link"),E=ke,J=Y,fe=be,ge=le("hasPermission");return f(),$("div",Ye,[n(Ee,{name:o(b)},null,8,["name"]),S("div",Ze,[se((f(),B(u,{round:"",onClick:t[0]||(t[0]=v=>o(V).push(o(ne)({name:"product category create"})))},{default:l(()=>[S("div",et,[n(a,{class:"mr-16 iconfont icon-a-addto"}),j(" "+w(o(e)("common.create")),1)])]),_:1})),[[ge,{feature:"productCategories",action:"edit"}]])]),n(fe,{data:o(A),"show-check":"",draggable:o(T),"row-key":"id",onDelete:p,onSorted:L,onSortChange:q,onChange:t[1]||(t[1]=()=>o(r).loadCategories())},{default:l(()=>[n(X,{columns:o(_)},{title:l(({row:v})=>[S("div",tt,[S("span",ot,w(v.title),1)])]),tags:l(({row:v})=>[S("div",nt,[(f(!0),$(O,null,oe(v.tags,(R,H)=>(f(),B(d,{key:H,round:"",size:"small",type:"warning"},{default:l(()=>[j(w(R),1)]),_:2},1024))),128))])]),productCount:l(({row:v})=>[n(d,{round:"",class:"cursor-pointer",type:"success",onClick:R=>M(v)},{default:l(()=>[j(w(v.productCount),1)]),_:2},1032,["onClick"])]),condition:l(({row:v})=>[v.type=="Automated"?(f(),$("div",at,[(f(!0),$(O,null,oe(v.condition.items,(R,H)=>(f(),$("div",{key:H},[H>0?(f(),$("span",lt,w(v.condition.isAny?o(e)("common.or"):o(e)("common.and")),1)):z("",!0),j(" "+w(R.option)+" "+w(R.method)+" "+w(R.value),1)]))),128))])):(f(),$("span",st,w(o(e)("common.manual")),1))]),_:1},8,["columns"]),n(J,{align:"right",width:"100",fixed:"right"},{default:l(({row:v})=>[n(P,{to:o(ne)({name:"product category edit",query:{id:v.id}}),class:"mx-8"},{default:l(()=>[n(x,{placement:"top",content:o(e)("common.edit")},{default:l(()=>[n(a,{class:"iconfont icon-a-writein hover:text-blue text-l"})]),_:1},8,["content"])]),_:2},1032,["to"]),o(U)?(f(),B(E,{key:0,icon:"icon-move js-sortable cursor-move",tip:o(e)("common.move"),"data-cy":"move"},null,8,["tip"])):z("",!0)]),_:1})]),_:1},8,["data","draggable"]),y.value?(f(),B(Xe,{key:0,modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=v=>y.value=v),"category-id":C.value.id,editable:C.value.type=="Manual",onReload:t[3]||(t[3]=v=>o(r).loadCategories())},null,8,["modelValue","category-id","editable"])):z("",!0)])}}});export{sn as default};
