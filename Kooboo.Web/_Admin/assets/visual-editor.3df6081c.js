var J=(e,t,o)=>new Promise((u,p)=>{var v=C=>{try{w(o.next(C))}catch(D){p(D)}},M=C=>{try{w(o.throw(C))}catch(D){p(D)}},w=C=>C.done?u(C.value):Promise.resolve(C.value).then(v,M);w((o=o.apply(e,t)).next())});import{g as x,c as A,K as Z,d as ae,o as b,a as S,u as s,F as O,f as h,m as T,t as N,k as Y,b6 as ge,b3 as Ne,b1 as Oe,I as K,i as he,h as ye,aW as Fe,b as _e,w as we,n as Ce,j as Ge}from"./url.8f5ec20c.js";import"./replace-all.d441bf14.js";import"./vue.esm-bundler.8965fe82.js";import{w as _,g as ke,h as ze,m as Je}from"./i18n.bcd18f8a.js";import{i as W,e as xe,a as $e,b as Ke,c as be,p as Qe,d as pe,g as Xe,s as ve}from"./index.edadf6a1.js";import{e as Ye}from"./guid.c1a40312.js";import{c as B}from"./cloneDeep.060340c1.js";import{i as te}from"./isEmpty.8640792d.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import{o as q}from"./style.9c8f6403.js";import{V as Me}from"./vuedraggable.umd.7929a3b6.js";import{d as Se}from"./debounce.730e1961.js";import{o as Ze}from"./omitBy.da11f041.js";import"./string.75b81683.js";import"./pickBy.705899be.js";import"./_basePickBy.0604ed3c.js";import"./_baseClone.eeff2792.js";import"./_baseIsEqual.547729d3.js";import"./pick.80c375ab.js";import"./_createCompounder.2027fb34.js";import"./last.e7aa49db.js";import"./index.50c16ae5.js";import"./toNumber.6efebd6a.js";function P(e,t,o){window.parent.postMessage({type:`ve-${t}`,group:o!=null?o:"",item:e?B(e):null},"*")}function et(){return{children:[],htmlStr:"",id:Ye,name:"PAGE",props:{},propDefines:[],type:"page"}}const Ie=x(0),De=x({baseUrl:"/",classic:!1}),le=x(et()),ee=x({}),L=x(),Re=A(()=>{var e,t;return(t=(e=L.value)==null?void 0:e.id)!=null?t:""}),se=x(),ie=x(),Be=x(),oe=x(),ne=x(),ce=x(),Q=x(),tt=A(()=>{var e,t;return(t=(e=Q.value)==null?void 0:e.id)!=null?t:""}),Ve=x(),Ae=x({}),ot=A(()=>{const e=[];if(!L.value||W(L.value))return e;let t=ee.value[Re.value];for(;t&&t.id&&(e.push(t),!W(t));)t=ee.value[t.id];return e});function de(e,t,o,u){ie.value=o,L.value=e!=null?e:void 0,se.value=u,Be.value=t==null?void 0:t.getBoundingClientRect();const p={meta:e!=null?e:void 0,context:u,group:o};P(p,"select",o)}function Ee(e,t,o){ce.value=o,Q.value=e!=null?e:void 0,Ve.value=t==null?void 0:t.getBoundingClientRect()}function nt(){ue(),Z(()=>{var t,o;const e=document.querySelector(`[data-id="${Re.value}"]`);e&&de((t=L.value)!=null?t:null,e,(o=ie.value)!=null?o:"",se.value)})}function at(){ue(),Z(()=>{var t,o;const e=document.querySelector(`[data-id="${tt.value}"]`);e&&Ee((t=Q.value)!=null?t:null,e,(o=ce.value)!=null?o:"")})}function rt(){L.value=void 0,Q.value=void 0,de(null,null,"")}function Te(e,t){for(const o of e.children)t[o.id]=e,te(o.children)||Te(o,t)}function Pe(){const e={};Te(le.value,e),ee.value=e}function We(e){Ie.value++;const t=B(e);le.value=t,Pe()}function He(e){return!e||W(e)?e:He(ee.value[e.id])}function ue(e){if(!e||!ne.value||!W(ne.value.meta)){oe.value=e;return}oe.value=He(e)}function lt(e){ne.value=e}function st(e,t){const o=B(e);document.querySelectorAll("ve-placeholder").forEach(u=>{var v;const p=(v=u.getAttribute("k-placeholder"))!=null?v:"";xe(o,p)}),We(o),P(o,"ready"),De.value={baseUrl:t.baseUrl,classic:t.classic,rootMeta:o},Ae.value=t.i18n}function it(e){var t;return(t=Ae.value[e])!=null?t:e}function X(){return{rootKey:Ie,rootMeta:le,renderContext:De,activeItem:L,activeItemTree:ot,activeRect:Be,activeGroup:ie,activeContext:se,selectWidget:de,updateSelect:nt,updateHover:at,hoverItem:Q,hoverRect:Ve,hoverGroup:ce,resetMetaParentMaps:Pe,hoverWidget:Ee,dragToItem:oe,setDragToMeta:ue,setDragFromMeta:lt,resetHolder:rt,updateRootMeta:We,init:st,t:it}}const je=e=>(Ne("data-v-1d5622e3"),e=e(),Oe(),e),ct={class:"info"},dt={href:"javascript:;"},ut=je(()=>h("div",{class:"actions"},null,-1)),pt={class:"info"},vt=["onClick"],ft={class:"actions"},mt=["onClick"],gt=["onClick"],ht=je(()=>h("div",{class:"line"},"\xA0",-1)),yt={class:"tip"},_t=ae({setup(e){const{hoverItem:t,activeItem:o,activeRect:u,hoverRect:p,activeGroup:v,activeContext:M,activeItemTree:w,dragToItem:C,selectWidget:D,t:R}=X(),H=A(()=>{const n=u.value;if(!n)return;const r=document.documentElement.getBoundingClientRect(),i=n.top-r.top,f=n.left-r.left,d=`${n.width}px`;return{border:{height:`${n.height}px`,width:d,top:`${i}px`,left:`${f}px`},control:{width:d,top:`${i+n.height}px`,left:`${f}px`}}}),E=A(()=>{const n=p.value;if(!n)return;const r=document.documentElement.getBoundingClientRect(),i=n.top-r.top,f=n.left-r.left,d=`${n.width}px`;return{border:{height:`${n.height}px`,width:d,top:`${i}px`,left:`${f}px`},control:{width:d,top:`${i+n.height}px`,left:`${f}px`}}}),j=A(()=>{var d;if(!C.value)return null;const n=(d=document.querySelector(`[data-id="${C.value.id}"]`))==null?void 0:d.getBoundingClientRect();if(!n)return null;const r=document.documentElement.getBoundingClientRect(),i=n.top-r.top,f=n.left-r.left;return{width:`${n.width}px`,top:`${i+n.height}px`,left:`${f}px`}});function g(){const n={meta:o.value,context:M.value,group:v.value};P(n,"copy",v.value)}function F(){const n={meta:o.value,context:M.value,group:v.value};P(n,"delete",v.value)}function G(n){var i,f,d,I;const r=document.querySelector(`[data-id="${n.id}"]`);!r||(W(n)||$e(n)?D(n,r,(i=v.value)!=null?i:""):D(n,r,(f=v.value)!=null?f:"",{id:n.id,rowId:(d=M.value)==null?void 0:d.rowId,columnId:(I=M.value)==null?void 0:I.columnId}))}function m(n){return Ke(n)?`${R(n.type)}: ${n.name}`:R(n.type)}return(n,r)=>{var i;return b(),S(O,null,[s(t)&&s(E)&&s(t).id!==((i=s(o))==null?void 0:i.id)?(b(),S(O,{key:0},[h("div",{class:"ve-select-holder hover",style:T(s(E).border)},"\xA0",4),h("div",{class:"ve-widget-controls hover",style:T(s(E).control)},[h("div",ct,[h("ul",null,[h("li",null,[h("a",dt,N(m(s(t))),1)])])]),ut],4)],64)):Y("",!0),s(o)&&s(H)?(b(),S(O,{key:1},[h("div",{class:"ve-select-holder active",style:T(s(H).border)}," \xA0 ",4),h("div",{class:"ve-widget-controls active",style:T(s(H).control)},[h("div",pt,[h("ul",null,[h("li",null,[h("a",{href:"javascript:;",class:"current",onClick:r[0]||(r[0]=_(()=>{},["stop"]))},N(m(s(o))),1)]),(b(!0),S(O,null,ge(s(w),f=>(b(),S("li",{key:f.id},[h("a",{href:"javascript:;",onClick:_(d=>G(f),["stop"])},N(s(R)(f.type)),9,vt)]))),128))])]),h("div",ft,[s(o).type!=="column"?(b(),S(O,{key:0},[h("button",{onClick:_(g,["stop"])},N(s(R)("common.copy")),9,mt),h("button",{class:"delete",onClick:_(F,["stop"])},N(s(R)("common.delete")),9,gt)],64)):Y("",!0)])],4)],64)):Y("",!0),s(C)&&s(j)?(b(),S("div",{key:2,class:"ve-select-holder drag",style:T(s(j))},[ht,h("div",yt,N(s(R)("ve.dragItHere")),1)],4)):Y("",!0)],64)}}});var wt=re(_t,[["__scopeId","data-v-1d5622e3"]]);function Ct(e){return J(this,null,function*(){be(e);const{renderContext:t}=X();e.htmlStr=yield Qe(e,t.value)})}const kt=["onClick"],xt=["data-content-after","data-id","onClick","onMouseenter","onDragenter"],$t=["innerHTML"],bt=ae({props:{kPlaceholder:null,modelValue:null,row:null,column:null},emits:["update:modelValue","add-row","update:row","update:column"],setup(e,{emit:t}){const o=e,{t:u}=ke(),p=x([]),v=A(()=>{var m;return(m=o.kPlaceholder)!=null?m:""}),M=x(),{selectWidget:w,hoverWidget:C,updateSelect:D,setDragToMeta:R}=X();function H(m,n){const r=B(n.__draggable_context.element);m.setData("application/json",JSON.stringify(r))}const E=Se(function(){const m=B(o.modelValue);m.children=B(K(p.value)),t("update:modelValue",m)},500);he(()=>p.value,E,{deep:!0});const j=new ResizeObserver(()=>{D()});ye(()=>{var n,r;p.value=(r=(n=o.modelValue)==null?void 0:n.children)!=null?r:[];const m=M.value;q(m,"dragover",i=>{i.preventDefault(),i.stopPropagation()}),q(m,"drop",i=>J(this,null,function*(){var U;i.preventDefault(),i.stopPropagation();const f=i,d=JSON.parse(f.dataTransfer.getData("application/json"));if(W(d)){t("add-row",d);return}if(d.id)return;yield Ct(d);const I=(U=f.target)==null?void 0:U.getAttribute("data-id");if(I){const a=p.value.findIndex(l=>l.id===I);if(a>-1){p.value.splice(a+1,0,d);return}}p.value.push(d)})),q(window,"message",i=>J(this,null,function*(){var I,U,a,l,c;const d=i.data;if(!(!((I=d.type)!=null&&I.startsWith("in-"))||d.group!==v.value)&&d.type==="in-update-dom"){const{meta:y,context:k}=d.context;if(W(y)&&y.id===((U=o.row)==null?void 0:U.id)){t("update:row",B(y));return}if($e(y)&&y.id===((a=o.column)==null?void 0:a.id)){t("update:modelValue",B(y));return}const{rowId:V,columnId:$}=k!=null?k:{};if(V!==((l=o.row)==null?void 0:l.id)||$!==((c=o.column)==null?void 0:c.id))return;p.value=p.value.map(z=>z.id===d.context.meta.id?B(y):z),Z(()=>{const z=document.querySelector(`[data-id="${y.id}"]`);z&&w(y,z,v.value,k)})}})),Z(()=>{j.observe(m)})}),Fe(()=>{j.unobserve(M.value)});function g(m,n){const r=n==null?void 0:n.target;C(m,r,v.value)}function F(m,n){const r=n.target;!(r!=null&&r.getAttribute("data-id"))||w(m,r,v.value,{id:m.id,rowId:o.row.id,columnId:o.column.id})}function G(){P("widgets","switch-tab",v.value)}return(m,n)=>(b(),S("div",{ref_key:"root",ref:M,class:"ve-column-root",onClick:_(G,["stop"])},[_e(s(Me),{class:Ce(["ve-column-container",{"ve-empty":!p.value.length}]),"data-placeholder":s(u)("ve.dropContentBlocksHere"),list:p.value,group:"ve","item-key":"id","set-data":H,onChange:s(E),onEnd:s(D)},{item:we(({element:r})=>[h("div",{"data-content-after":r.name,"data-id":r.id,"data-type":"wrapper",onClick:_(i=>F(r,i),["stop"]),onMouseenter:_(i=>g(r,i),["stop"]),onMouseout:n[0]||(n[0]=_(i=>g(null,i),["stop"])),onDragenter:_(i=>s(R)(r),["stop"])},[(b(),S("div",{key:r.id,"data-type":"element",innerHTML:r.htmlStr},null,8,$t))],40,xt)]),_:1},8,["class","data-placeholder","list","onChange","onEnd"])],8,kt))}});var Mt=re(bt,[["__scopeId","data-v-7408615c"]]);const St={class:"designer-root"},It=["onDrop","onClick"],Dt=["data-content-after","data-id","onClick","onMouseenter"],Rt=["data-id","onClick","onMouseenter"],Bt=ae({props:{kPlaceholder:null},setup(e){const t=e,{t:o}=ke(),u=A(()=>{var a;return(a=t.kPlaceholder)!=null?a:""}),p=A(()=>{var l;const{body:a}=Xe((l=w.value.props)!=null?l:{},!1);return Ze(a,(c,y)=>y.startsWith("background-"))}),v=x(),{rootKey:M,rootMeta:w,selectWidget:C,hoverWidget:D,updateRootMeta:R,updateSelect:H,resetMetaParentMaps:E,setDragToMeta:j}=X(),g=x([]);function F(){if(!g.value||te(g.value)){const a=xe(w.value,u.value);g.value=a.children}te(g.value)&&(g.value=pe()),P(K(g.value),"init",u.value)}function G(a,l){const c=B(l.__draggable_context.element);a.setData("application/json",JSON.stringify(c))}function m(a){const l=document.createElement("div");return ve(l,a),l.getAttribute("style")}function n(a){const l=document.createElement("div");return l.style.setProperty("width",`${a.props.widthPercent}%`),ve(l,a),l.getAttribute("style")}function r(){w.value.children=w.value.children.map(a=>(a.name===u.value&&(a.children=K(g.value)),K(a))),P(w.value,"sync"),E()}he(()=>g.value,Se(function(){r()},500),{deep:!0});function i(a,l){if(!a.id&&(be(a),W(a)))if(l){const c=g.value.findIndex(y=>y.id===l.id);g.value.splice(c+1,0,a)}else g.value.push(a)}ye(()=>{q(window,"message",a=>J(this,null,function*(){var y,k,V;const c=a.data;!((y=c.type)!=null&&y.startsWith("in-"))||c.group!==u.value||c.type==="in-sync"&&(R(c.context),g.value=(V=(k=w.value.children.find($=>$.name===u.value))==null?void 0:k.children)!=null?V:pe())})),F()});function f(a,l){const c=l==null?void 0:l.target;D(a,c,u.value)}function d(a,l){C(a,l.target,u.value)}function I(){P("columns","switch-tab",u.value)}function U(a){a.preventDefault();const l=a,c=JSON.parse(l.dataTransfer.getData("application/json"));i(c)}return(a,l)=>(b(),S("div",St,[(b(),S("div",{key:s(M),ref_key:"root",ref:v,class:"ve-root ve-global",onDrop:_(U,["stop"]),onDragover:l[2]||(l[2]=_(()=>{},["stop","prevent"])),onDragenter:l[3]||(l[3]=_(c=>s(j)(),["stop"])),onClick:_(I,["stop"])},[(b(),Ge(s(Me),{key:s(w).id,class:Ce(["ve-row",{"ve-empty":!g.value.length}]),"data-placeholder":s(o)("ve.dropColumnBlocksHere"),list:g.value,group:"rows","item-key":"id",style:T(s(p)),"set-data":G,onChange:r,onEnd:s(H)},{item:we(({element:c,index:y})=>[h("div",{"data-content-after":c.name,"data-id":c.id,"data-type":"wrapper",style:T(m(c)),onClick:_(k=>d(c,k),["stop"]),onMouseenter:_(k=>f(c,k),["stop"]),onMouseout:l[1]||(l[1]=_(k=>f(null,null),["stop"]))},[(b(!0),S(O,null,ge(c.children,(k,V)=>(b(),S("div",{key:k.id,class:"ve-column-container",style:T(n(k)),"data-id":k.id,onClick:_($=>d(k,$),["stop"]),onMouseenter:_($=>f(k,$),["stop"]),onMouseout:l[0]||(l[0]=_($=>f(null,null),["stop"]))},[_e(Mt,{modelValue:c.children[V],"onUpdate:modelValue":$=>c.children[V]=$,row:g.value[y],"onUpdate:row":$=>g.value[y]=$,column:c.children[V],"onUpdate:column":$=>c.children[V]=$,"k-placeholder":s(u),onAddRow:$=>i($,c)},null,8,["modelValue","onUpdate:modelValue","row","onUpdate:row","column","onUpdate:column","k-placeholder","onAddRow"])],44,Rt))),128))],44,Dt)]),_:1},8,["class","data-placeholder","list","style","onEnd"]))],40,It))]))}});var Vt=re(Bt,[["__scopeId","data-v-4f4d9d56"]]);const{init:At,updateSelect:Et,updateHover:Tt,resetHolder:Ue,setDragToMeta:fe,setDragFromMeta:Pt,updateRootMeta:Wt}=X(),qe=ze({components:{VePlaceholder:Vt,VeBorder:wt}});Je(qe);let me=!1;window.loadDesign=function(e,t,o,u){var v;const p=K(e);if(At(p,{baseUrl:t.baseUrl,classic:(v=t.classic)!=null?v:!1,i18n:u}),!me){document.querySelectorAll("body script").forEach(C=>{C.setAttribute("defer","true"),document.head.appendChild(C)});const w=document.createElement("ve-border");document.body.appendChild(w),qe.mount(document.getElementById("app")||document.body),me=!0}Le(o)};q(window,"click",()=>{Ue(),window.parent.postMessage({type:"ve-layout"})});q(window,"scroll",()=>{Et(),Tt()});q(window,"message",e=>{var u;const t=e,o=(u=t==null?void 0:t.data)==null?void 0:u.type;if(o==="in-page-style"){const{cssText:p,meta:v}=t.data.context;Le(p),v&&Wt(v)}else o==="in-reset-holder"?Ue():o==="in-reset-drag"?fe():o==="in-dragging-item"&&(fe(),Pt(t.data.context))});function Le(e){let t=document.head.querySelector("#designer-page-style");if(e){if(!t){t=document.createElement("style"),t.setAttribute("id","designer-page-style"),t.innerHTML=e,document.head.appendChild(t);return}t.innerHTML=e;return}t&&document.head.removeChild(t)}
