var ie=Object.defineProperty,ue=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var R=(o,t,e)=>t in o?ie(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,j=(o,t)=>{for(var e in t||(t={}))de.call(t,e)&&R(o,e,t[e]);if(F)for(var e of F(t))me.call(t,e)&&R(o,e,t[e]);return o},N=(o,t)=>ue(o,ce(t));var A=(o,t,e)=>new Promise((f,l)=>{var v=y=>{try{d(e.next(y))}catch(b){l(b)}},p=y=>{try{d(e.throw(y))}catch(b){l(b)}},d=y=>y.done?f(y.value):Promise.resolve(y.value).then(v,p);d((e=e.apply(o,t)).next())});import{b as pe,_ as fe,a as ye,c as ve,d as be,e as he}from"./basic.c91a088c.js";import{t as ge,b as Se}from"./replace-all.8fa5a83d.js";import{g as W}from"./i18n.97105311.js";import{E as Ee}from"./index.4587e608.js";import{E as Ve}from"./windi.539ebeab.js";import{E as Ue}from"./index.b09a9f00.js";import{g as w,c as P,cd as ke,M as Te,at as M,d as X,i as _e,o as S,a as B,F as D,b6 as Y,b as g,u as n,f as Ce,w as V,j as _,k as Q,r as Me}from"./url.2e6a77c4.js";import{j as $,k as H,m as Be,n as Z,c as Ie}from"./style.f835519e.js";import{K as ee,L as te,a as xe}from"./dev-mode.2a667dd5.js";import{g as ne,u as we}from"./main.52487121.js";import{n as le}from"./guid.c1a40312.js";import{r as Pe}from"./index.4733e729.js";import{E as Le,a as Ae}from"./index.5a459bfd.js";import{E as qe}from"./index.00cc1b15.js";import{E as De,a as He}from"./index.317a7f30.js";function $e(o){const t=[];if(!o)return t;const e=ee(),f=$(o,["link","style"]);for(const l of f){if(H(l,"link")){const v=l.getAttribute("rel"),p=l.getAttribute("href");if(v==="stylesheet"&&p){const d=e.all.find(y=>y.href===p);d&&t.push({el:l,content:d.name,id:d.id})}}H(l,"style")&&t.push({el:l,content:l.innerHTML,id:le()})}return t}function Ke(o){const t=[];if(!o)return t;const e=te(),f=$(o,["script"]);for(const l of f){const v=l.getAttribute("src");if(v){const p=e.all.find(d=>d.href===v);p&&t.push({el:l,content:p.name,id:p.id,position:G(l)})}else t.push({el:l,content:l.innerHTML,id:le(),position:G(l)})}return t}function Oe(o,t){const e=[];if(!o||!t)return e;const f=ne();for(const l of $(o,["meta"])){const v=l.getAttribute("charset"),p=l.getAttribute("property"),d=l.getAttribute("http-equiv"),y=l.getAttribute("name"),b=l.getAttribute("content");if(v){let s=t.find(h=>!!h.charset);s?(s.charset=v,s.el=l):s={charset:v,el:l},e.push(s)}if(d&&b){let s=t.find(h=>h.httpequiv===d);s?(s.content||(s.content={}),s.el=l):(s={httpequiv:d,content:{},el:l},s.content[f.default]=b),e.push(s)}if(y&&b){let s=t.find(h=>h.name===y);s?(s.content||(s.content={}),s.el=l):(s={name:y,content:{},el:l},s.content[f.default]=b),e.push(s)}if(p&&b){let s=t.find(h=>h.property===p);s?(s.content||(s.content={}),s.el=l):(s={property:p,content:{},el:l},s.content[f.default]=b),e.push(s)}}return e}function G(o){return Be(o).some(t=>H(t,"head"))?"head":"body"}const Fe=ee(),Re=te(),oe=xe(),k=w(),u=w(),je=P(()=>u.value?Z(u.value):""),q=P(()=>$e(u.value)),z=P(()=>Ke(u.value)),J=P(()=>{var o;return Oe(u.value,(o=k.value)==null?void 0:o.metas)});function Ne(o,t,e){u.value.body.innerHTML=Pe(o,t!=null?t:!1,e)}function Qe(o){let t=u.value.head.querySelector("#designer-page-style");if(o){if(!t){t=document.createElement("style"),t.setAttribute("id","designer-page-style"),t.innerHTML=o,u.value.head.appendChild(t);return}t.innerHTML=o;return}t&&u.value.head.removeChild(t)}function Ge(o,t){return A(this,null,function*(){var f,l;const e=yield oe.getPage(o,t);e.urlPath=(f=e.urlPath)!=null?f:"",e.name=(l=e.name)!=null?l:"",k.value=e,u.value=Ie(k.value.body)})}function ze(){const o=ke(),t=Te(),e=a=>{const m=q.value[a.oldIndex],i=q.value[a.newIndex].el;i!=null&&i.parentElement&&i.parentElement.insertBefore(m.el,a.oldIndex>a.newIndex?i:i.nextElementSibling),M(u)},f=a=>{if(!u.value)return;const m=Fe.all.find(i=>i.id===a);if(m){const i=u.value.createElement("link");i.rel="stylesheet",i.href=m.href,u.value.head.appendChild(i),M(u)}},l=(a,m)=>{const i=z.value.filter(I=>I.position===m),E=i[a.oldIndex],C=i[a.newIndex].el;C.parentElement&&C.parentElement.insertBefore(E.el,a.oldIndex>a.newIndex?C:C.nextElementSibling),M(u)},v=(a,m)=>{if(!u.value)return;const i=Re.all.find(E=>E.id===a);if(i){const E=u.value.createElement("script");E.src=i.href,m==="head"?u.value.head.appendChild(E):u.value.body.appendChild(E),M(u)}},p=a=>{!u.value||(a.remove(),M(u))},d=(a,m)=>{!u.value||(m&&m.parentElement?m.parentElement.insertBefore(a,m):u.value.head.appendChild(a),M(u))};return{init:Ge,setBody:Ne,setPageStyle:Qe,model:k,styles:q,scripts:z,metas:J,preview:je,sortStyle:e,insertStyle:f,sortScript:l,insertScript:v,deleteElement:p,insertElement:d,save:()=>A(this,null,function*(){if(!k.value||!u.value)return;k.value.body=Z(u.value),k.value.metas=J.value;const a=yield oe.updatePage(k.value);return o.replace({query:N(j({},t.query),{id:a.id})}),a}),updateTitle:a=>{!u.value||(u.value.title=a)},addOrUpdateMeta:a=>{const m=ne(),i=pe(a,m.default);a.el&&i?(d(i,a.el),p(a.el)):i&&k.value&&(k.value.metas.push(a),d(i))},deleteMeta:a=>{a.el&&p(a.el)}}}const Je={class:"px-24 py-16 space-y-4"},We=X({props:{modelValue:null},emits:["update:modelValue"],setup(o,{emit:t}){const e=o,{t:f}=W(),l=w(ge(e.modelValue)),v=p=>{l.value.splice(p,1)};return _e(()=>l.value,()=>{t("update:modelValue",Se(l.value))},{deep:!0}),(p,d)=>{const y=Ee,b=Ve,s=Ue;return S(),B("div",Je,[(S(!0),B(D,null,Y(l.value,(h,a)=>(S(),B("div",{key:a,class:"flex items-center space-x-4"},[g(y,{modelValue:h.key,"onUpdate:modelValue":m=>h.key=m,placeholder:n(f)("common.key"),"data-cy":"key"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),g(y,{modelValue:h.value,"onUpdate:modelValue":m=>h.value=m,placeholder:n(f)("common.value"),"data-cy":"value"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),Ce("div",null,[g(s,{circle:"","data-cy":"remove",onClick:m=>v(a)},{default:V(()=>[g(b,{class:"text-orange iconfont icon-delete"})]),_:2},1032,["onClick"])])]))),128)),g(s,{circle:"","data-cy":"add",onClick:d[0]||(d[0]=h=>l.value.push({key:"",value:""}))},{default:V(()=>[g(b,{class:"text-blue iconfont icon-a-addto"})]),_:1})])}}}),pt=X({props:{oldUrlPath:null,items:{default(){return["basic","HTMLMeta","parameters","style","scripts","cache"]}}},setup(o){const t=o,{model:e,updateTitle:f,deleteElement:l,styles:v,sortStyle:p,insertStyle:d,scripts:y,sortScript:b,insertScript:s,metas:h,addOrUpdateMeta:a,deleteMeta:m}=ze(),{t:i}=W(),E=w("basic"),C=we();return function(){var T,x;const r=(T=t.items)!=null?T:[];E.value=(x=r[0])!=null?x:"basic"}(),(I,r)=>{const T=Le,x=qe,ae=De,se=He,re=Ae;return n(e)?(S(),_(re,{key:0,modelValue:E.value,"onUpdate:modelValue":r[14]||(r[14]=U=>E.value=U)},{default:V(()=>[(S(!0),B(D,null,Y(o.items,U=>(S(),B(D,{key:U},[U==="basic"?(S(),_(T,{key:0,name:"basic",title:n(i)("common.basic")},{default:V(()=>[g(fe,{ref_for:!0,ref:"basicForm",url:n(e).urlPath,"onUpdate:url":r[0]||(r[0]=c=>n(e).urlPath=c),titles:n(e).contentTitle,"onUpdate:titles":r[1]||(r[1]=c=>n(e).contentTitle=c),published:n(e).published,"onUpdate:published":r[2]||(r[2]=c=>n(e).published=c),"old-url-path":o.oldUrlPath,"onUpdate:defaultTitle":n(f)},null,8,["url","titles","published","old-url-path","onUpdate:defaultTitle"])]),_:1},8,["title"])):U==="HTMLMeta"?(S(),_(T,{key:1,name:"HTMLMeta",title:n(i)("common.HTMLMeta")},{default:V(()=>[g(ye,{list:n(h),onDelete:n(m),onAddOrUpdate:n(a)},null,8,["list","onDelete","onAddOrUpdate"])]),_:1},8,["title"])):U==="parameters"?(S(),_(T,{key:2,name:"parameters",title:n(i)("common.parameters")},{default:V(()=>[g(We,{modelValue:n(e).parameters,"onUpdate:modelValue":r[3]||(r[3]=c=>n(e).parameters=c)},null,8,["modelValue"])]),_:1},8,["title"])):U==="style"?(S(),_(T,{key:3,name:"style",title:n(i)("common.style")},{default:V(()=>{var c,K,O;return[g(ve,{list:n(v),onSort:n(p),onInsert:n(d),onDelete:r[4]||(r[4]=L=>n(l)(L.el))},null,8,["list","onSort","onInsert"]),(O=(K=(c=n(C))==null?void 0:c.site)==null?void 0:K.unocssSettings)!=null&&O.enable?(S(),_(se,{key:0,"label-position":"top",class:"px-24"},{default:V(()=>[g(ae,{label:n(i)("common.disableUnocss")},{default:V(()=>[g(x,{modelValue:n(e).disableUnocss,"onUpdate:modelValue":r[5]||(r[5]=L=>n(e).disableUnocss=L)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})):Q("",!0)]}),_:1},8,["title"])):U==="scripts"?(S(),_(T,{key:4,name:"scripts",title:n(i)("common.scripts")},{default:V(()=>[g(be,{list:n(y),onSort:n(b),onDelete:r[6]||(r[6]=c=>n(l)(c.el)),onInsert:n(s)},null,8,["list","onSort","onInsert"])]),_:1},8,["title"])):U==="cache"?(S(),_(T,{key:5,name:"cache",title:n(i)("common.cache")},{default:V(()=>[g(he,{enable:n(e).enableCache,"onUpdate:enable":r[7]||(r[7]=c=>n(e).enableCache=c),enableVersion:n(e).cacheByVersion,"onUpdate:enableVersion":r[8]||(r[8]=c=>n(e).cacheByVersion=c),enableCulture:n(e).cacheByCulture,"onUpdate:enableCulture":r[9]||(r[9]=c=>n(e).cacheByCulture=c),versionType:n(e).cacheVersionType,"onUpdate:versionType":r[10]||(r[10]=c=>n(e).cacheVersionType=c),enableDevice:n(e).cacheByDevice,"onUpdate:enableDevice":r[11]||(r[11]=c=>n(e).cacheByDevice=c),minutes:n(e).cacheMinutes,"onUpdate:minutes":r[12]||(r[12]=c=>n(e).cacheMinutes=c),queryKeys:n(e).cacheQueryKeys,"onUpdate:queryKeys":r[13]||(r[13]=c=>n(e).cacheQueryKeys=c)},null,8,["enable","enableVersion","enableCulture","versionType","enableDevice","minutes","queryKeys"])]),_:1},8,["title"])):Me(I.$slots,U,{key:6})],64))),128))]),_:3},8,["modelValue"])):Q("",!0)}}});export{pt as _,ze as u};
