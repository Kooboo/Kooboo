var y=(g,m,o)=>new Promise((r,l)=>{var p=e=>{try{s(o.next(e))}catch(c){l(c)}},u=e=>{try{s(o.throw(e))}catch(c){l(c)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(p,u);s((o=o.apply(g,m)).next())});import{a as F,g as T,b as q,c as S,d as P}from"./user.4c2aab4d.js";import{a as C}from"./validate.f3c0b03b.js";import{_ as j}from"./index.50326354.js";import{g as w}from"./i18n.25caaace.js";import{E as z,a as A,c as H}from"./index.960b9732.js";import{E as L,a as O}from"./index.94998415.js";import{E as G}from"./index.a5d96e5a.js";import{d as I,g as _,o as d,j as b,w as n,b as a,u as i,a as E,b6 as x,F as V,b7 as J,f as B,e as K,aH as h,t as D,k as M}from"./url.8f5ec20c.js";import{E as Q}from"./windi.a815125a.js";import{E as W}from"./index.e9f8834a.js";import{_ as X}from"./k-table.c13bd7f5.js";import{B as Y}from"./breadcrumb.bcaeaf75.js";import{b as Z}from"./confirm.629bcef4.js";import{E as ee}from"./index.5388dbc8.js";import"./replace-all.b35629e7.js";import"./main.1c3b59e3.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./index.878e2bbf.js";import"./index.adb17f32.js";import"./index.b065185c.js";import"./index.ab12ea9e.js";import"./index.b1b64a44.js";import"./style.1b77b3a2.js";import"./toNumber.6efebd6a.js";import"./_baseIsEqual.0a4e01e5.js";import"./index.f571dfc9.js";import"./event.776e7e11.js";import"./index.1e7e06b8.js";import"./error.7e8331f1.js";import"./isNil.98bb3b88.js";import"./index.158cdd11.js";import"./focus-trap.81e4fb05.js";import"./event.53b2ad83.js";import"./index.c6488b3c.js";import"./index.f9c89813.js";import"./scroll.0cf77af8.js";import"./isEqual.2e410d13.js";import"./debounce.730e1961.js";import"./index.c93fe8e7.js";import"./validator.9b0d789f.js";import"./_baseClone.885c975f.js";import"./index.1d16d007.js";import"./refs.d2253dd4.js";import"./sortable.esm.a99254e8.js";import"./icon-button.0e134c9b.js";import"./index.0c2ced08.js";import"./index.a9a077b4.js";import"./index.2e51d36e.js";import"./index.5b499f72.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.60799c00.js";import"./aria.75ec5909.js";const oe=I({props:{modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(g,{emit:m}){const{t:o}=w(),r=_([]),l=_([]);F().then(v=>{r.value=v,r.value.length&&(e.value.userId=r.value[0].userId)}),T().then(v=>{l.value=v,l.value.length&&(e.value.role=l.value[0])});const p={userId:C(o("common.userRequired")),role:C(o("common.roleRequiredTips"))},u=_(!0),s=_(),e=_({userId:"",role:""}),c=()=>y(this,null,function*(){yield s.value.validate(),yield q(e.value),u.value=!1,m("reload")});return(v,f)=>{const U=z,$=A,k=L,N=O,R=G;return d(),b(R,{"model-value":u.value,width:"600px","close-on-click-modal":!1,title:i(o)("common.addUser"),onClosed:f[3]||(f[3]=t=>m("update:modelValue",!1))},{footer:n(()=>[a(j,{"confirm-label":i(o)("common.add"),onConfirm:c,onCancel:f[2]||(f[2]=t=>u.value=!1)},null,8,["confirm-label"])]),default:n(()=>[a(N,{ref_key:"form",ref:s,"label-position":"top",model:e.value,rules:i(p)},{default:n(()=>[a(k,{label:i(o)("common.availableUser"),prop:"userId"},{default:n(()=>[a($,{modelValue:e.value.userId,"onUpdate:modelValue":f[0]||(f[0]=t=>e.value.userId=t),class:"w-full","data-cy":"users"},{default:n(()=>[(d(!0),E(V,null,x(r.value,t=>(d(),b(U,{key:t.userId,value:t.userId,label:`${t.userName}<${t.email}>`,"data-cy":"user-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(k,{label:i(o)("common.role"),prop:"role"},{default:n(()=>[a($,{modelValue:e.value.role,"onUpdate:modelValue":f[1]||(f[1]=t=>e.value.role=t),class:"w-full","data-cy":"roles"},{default:n(()=>[(d(!0),E(V,null,x(l.value,t=>(d(),b(U,{key:t,value:t,label:t,"data-cy":"role-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}}),le={class:"flex items-center py-24 space-x-16"},te={class:"flex items-center"},ae=I({emits:["reload"],setup(g){const{t:m}=w(),o=_(!1);return(r,l)=>{const p=Q,u=W,s=J("hasPermission");return d(),E(V,null,[B("div",le,[K((d(),b(u,{round:"","data-cy":"add-user",onClick:l[0]||(l[0]=e=>o.value=!0)},{default:n(()=>[B("div",te,[a(p,{class:"mr-16 iconfont icon-a-addto"}),h(" "+D(i(m)("common.addUser")),1)])]),_:1})),[[s,{feature:"siteUser",action:"edit"}]])]),o.value?(d(),b(oe,{key:0,modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value=e),onReload:l[2]||(l[2]=e=>r.$emit("reload"))},null,8,["modelValue"])):M("",!0)],64)}}}),re={class:"p-24"},io=I({setup(g){const{t:m}=w(),o=_(),r=()=>y(this,null,function*(){o.value=yield S()}),l=p=>y(this,null,function*(){yield Z(p.length),yield P(p.map(u=>u.userId)),r()});return r(),(p,u)=>{var c;const s=ee,e=H;return d(),E("div",re,[a(Y,{name:i(m)("common.siteUser")},null,8,["name"]),a(ae,{onReload:r}),a(i(X),{data:(c=o.value)!=null?c:[],"show-check":"",permission:{feature:"siteUser",action:"delete"},onDelete:l},{default:n(()=>[a(s,{label:i(m)("common.username"),prop:"userName"},null,8,["label"]),a(s,{label:i(m)("common.email"),prop:"email"},null,8,["label"]),a(s,{label:i(m)("common.role")},{default:n(({row:v})=>[a(e,{size:"small",class:"rounded-full cursor-pointer","data-cy":"role"},{default:n(()=>[h(D(v.role),1)]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])])}}});export{io as default};
