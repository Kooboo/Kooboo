var y=(a,p,e)=>new Promise((u,o)=>{var _=d=>{try{s(e.next(d))}catch(m){o(m)}},v=d=>{try{s(e.throw(d))}catch(m){o(m)}},s=d=>d.done?u(d.value):Promise.resolve(d.value).then(_,v);s((e=e.apply(a,p)).next())});import{u as E,ab as ee,ae as te,af as oe,ag as ae,ah as ne,ai as se,aj as re,ak as ie,al as ce,am as le,an as pe}from"./dev-mode.acf56c3e.js";import{_ as Y}from"./icon-button.74ccc970.js";import{g as V,v as R,w as W}from"./i18n.a87944a4.js";import{u as de,i as me}from"./main.9fdfea92.js";import{d as B,g as S,N as ue,i as F,h as P,K as fe,e as q,u as b,o as c,a as h,b as x,j as A,w as O,f as T,c as ve,x as U,b3 as N,F as I,b7 as L,n as j,k as M,t as G,l as H,m as _e,b4 as be,b2 as he,L as X,ay as ye,aW as ke,cj as xe,ct as ge}from"./url.4cb47a7a.js";import{S as we}from"./search-input.2a27ef56.js";import{E as K}from"./windi.6360286d.js";import{s as Te}from"./request-access-limit.04cb7c98.js";import{_ as $e}from"./settings.d953b506.js";import{E as Q}from"./index.fd96ea36.js";import{_ as J}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Se}from"./index.d96452a6.js";import{u as Ce}from"./use-shortcuts.ff4b1f52.js";import{S as Ie}from"./sortable.esm.a99254e8.js";import{s as D}from"./confirm.b60b5d2f.js";import{o as Ae,a as Me}from"./config.1e73f9c3.js";import"./replace-all.56d2c1f7.js";import"./guid.c1a40312.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./preload-helper.13a99eb0.js";import"./dark.9459c47b.js";import"./page.881ec888.js";import"./validate.bb56f9e3.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseIsEqual.dc9e64c4.js";import"./index.9fd79879.js";import"./error.7e8331f1.js";import"./index.7b8c5aef.js";import"./_baseClone.b8903935.js";import"./isEqual.4cab74e3.js";import"./index.f2c1b903.js";import"./index.361e2245.js";import"./index.178b9e08.js";import"./event.776e7e11.js";import"./isNil.98bb3b88.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.50a00b7f.js";import"./validator.b5df2420.js";import"./index.4d568055.js";import"./index.c86a187b.js";import"./dropdown.86d3a7fb.js";import"./refs.3132cbdb.js";import"./use-copy-text.ec245a13.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./use-save-tip.e3dc783a.js";import"./index.f0d5f031.js";import"./index.6918f0a5.js";import"./index.f15f695e.js";import"./index.7c862087.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./index.c003dfa1.js";import"./vuedraggable.umd.af323a53.js";import"./index.f154d010.js";import"./index.42922617.js";import"./index.b9a74c44.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./alert.d2815716.js";import"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./index.0e5d639d.js";import"./cloneDeep.c5011aa2.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";import"./index.4f90a917.js";import"./index.50c16ae5.js";import"./tooltip.66155ff7.js";import"./list-editor.97a4c003.js";import"./index.6f16842c.js";import"./index.e3f90979.js";import"./index.7df1cda1.js";import"./key-value-editor.7ab17885.js";import"./dropdown-input.f2d4a501.js";import"./media-dialog.69c737ad.js";import"./breadcrumb.f4d80c95.js";import"./plugin-vue_export-helper.41ffa612.js";import"./media.e27599b4.js";import"./index.5ed58b47.js";import"./search-provider.ad425b7b.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./_baseUniq.d719bd5f.js";import"./use-operation-dialog.4f6d7533.js";import"./folder.8308bb9d.js";import"./relations-tag.b9cbe606.js";import"./index.b38edc72.js";import"./caret-bottom.ddd8dd91.js";import"./index.c33743a1.js";import"./browser.aedb6977.js";import"./throttle.1f6a079c.js";import"./index.c6da2706.js";import"./layout.b686c380.js";import"./index.765084fe.js";import"./position.7590de53.js";import"./utils.aa7941f8.js";import"./index.9fc39dc8.js";import"./index.1b4db5fb.js";import"./index.4d2ce883.js";import"./file.7f0748f1.js";import"./index.a55bb4ec.js";import"./index.2bbcbf2b.js";import"./editable-tags.1a16bc83.js";import"./index.bec063d7.js";import"./index.ac10ee42.js";import"./index.77bc9666.js";import"./country-and-region-codes.c36488d2.js";import"./index.fe920a26.js";import"./logo-transparent.1566007e.js";const Le={class:"absolute top-4 right-2px z-50 bg-fff dark:bg-[#252526]"},Be=B({emits:["search","active"],setup(a,{expose:p,emit:e}){const{t:u}=V(),o=S(""),_=S(),v=ue(),s=E();p({focus:()=>{_.value.focus()},clear:()=>{o.value=""}}),F(o,()=>{e("search",o.value.trim())});const f=S(!1),g=i=>y(this,null,function*(){var l;if(i.keyCode===70&&i.ctrlKey){if(((l=s.activeActivity)==null?void 0:l.name)==="code search")return;f.value=!0,_.value.focus(),i.preventDefault()}});P(()=>{document.addEventListener("keydown",g)}),fe(()=>{document.removeEventListener("keydown",g)});const n=()=>{f.value=!1,o.value=""};return F(()=>f.value,()=>{e("active",f.value)}),F(()=>{var i;return[(i=s.activeActivity)==null?void 0:i.name,v.query.moduleId]},()=>{f.value=!1,o.value=""}),(i,l)=>{var r;const k=we,t=K;return q((c(),h("div",Le,[x(k,{ref_key:"input",ref:_,modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=$=>o.value=$),placeholder:b(u)("common.searchFileName"),class:"h-28px w-180px mr-2px text-12px"},null,8,["modelValue","placeholder"]),x(t,{class:"iconfont icon-delete5 text-blue text-opacity-80 cursor-pointer text-12px",title:b(u)("common.close"),onClick:n},null,8,["title"])],512)),[[R,f.value&&((r=b(s).activeActivity)==null?void 0:r.name)!=="code search"]])}}}),Fe={class:"p-24 pb-150px"},je=B({setup(a,{expose:p}){return p({save:()=>y(this,null,function*(){Te()})}),(u,o)=>{const _=Q;return c(),A(_,null,{default:O(()=>[T("div",Fe,[x($e)])]),_:1})}}});const Z=a=>(be("data-v-0ccfe652"),a=a(),he(),a),De={class:"h-full bg-fff dark:bg-[#252526] dark:border-none flex border-r border-solid border-line dark:border-[#f00]"},Ee={class:"w-48px h-full dark:bg-[#333333] dark:border-none border-r border-line border-solid flex flex-col"},We=["data-cy","onClick"],Ne=Z(()=>T("div",{class:"flex-1"},null,-1)),Oe={class:"ellipsis h-36px text-black flex items-center pl-12 pr-4 dark:text-fff/60"},Ve={class:"ellipsis h-full leading-9","data-cy":"tab-title"},Re=Z(()=>T("div",{class:"flex-1"},null,-1)),qe={key:0,class:"-space-x-4 flex items-center"},Ke=B({setup(a){const{t:p}=V(),e=E(),u=S(),o=S(""),_=S(!1),v=de(),s=()=>{e.addTab({id:"setting",name:p("common.setting"),panel:je,icon:"icon-a-setup"})},d=ve(()=>{var f;return((f=e.activeActivity)==null?void 0:f.name)=="code search"});P(()=>{const f=U("activity");f?e.selectActivity(f):e.activeActivity.init||e.selectActivity(e.activeActivity.name)});const m=f=>{setTimeout(()=>{e.selectActivity(f,!0)},0)};return N("keyword",o),(f,g)=>{const n=K,i=Se,l=Y,k=Q;return c(),h("div",De,[T("div",Ee,[(c(!0),h(I,null,L(b(e).activities,t=>(c(),A(i,{key:t.name,class:"box-item",transition:"bounce","hide-after":0,content:t.display,placement:"right"},{default:O(()=>{var r;return[T("div",{class:j(["side-icon",t.name===((r=b(e).activeActivity)==null?void 0:r.name)?"bg-blue/10 !text-blue/87":""]),"data-cy":`tab-${t.name}`,onClick:$=>m(t.name)},[x(n,{class:j(["iconfont text-18px",t.icon])},null,8,["class"])],10,We)]}),_:2},1032,["content"]))),128)),Ne,b(v).hasAccess("site","edit")?(c(),h("div",{key:0,class:"side-icon","data-cy":"setting",onClick:s},[x(n,{class:"iconfont icon-a-setup"})])):M("",!0)]),T("div",{class:"w-200px h-full relative",onClick:g[3]||(g[3]=t=>!b(d)&&u.value&&u.value.focus())},[x(Be,{ref_key:"filterBar",ref:u,onActive:g[0]||(g[0]=t=>_.value=t),onSearch:g[1]||(g[1]=t=>o.value=t)},null,512),(c(!0),h(I,null,L(b(e).activities,t=>{var r,$,C;return q((c(),h("div",{key:t.name,class:"h-full flex flex-col"},[T("div",Oe,[T("span",Ve,G((r=t.panelDisplay)!=null?r:t.display),1),Re,t.actions?(c(),h("div",qe,[(c(!0),h(I,null,L(t.actions,w=>(c(),h(I,{key:w.name},[w.visible?(c(),A(l,{key:0,icon:w.icon,tip:w.display,class:"","data-cy":w.name,onClick:z=>w.invoke()},null,8,["icon","tip","data-cy","onClick"])):M("",!0)],64))),128))])):M("",!0)]),x(k,{class:"flex-1",style:_e({outline:_.value&&(($=b(e).activeActivity)==null?void 0:$.name)!=="code search"?"1px solid rgba(34, 150, 243,.5)":""}),onClick:g[2]||(g[2]=W(()=>{},["stop"]))},{default:O(()=>[(c(),A(H(t.panel),{ref_for:!0,ref:w=>t.panelInstance.resolve(w)},null,512))]),_:2},1032,["style"])],512)),[[R,t.name===((C=b(e).activeActivity)==null?void 0:C.name)]])}),128))])])}}});var ze=J(Ke,[["__scopeId","data-v-0ccfe652"]]);const Ue={class:"h-26px bg-gray/60 dark:bg-[#252526] text-s flex"},Pe=["onWheel"],Qe=["title","onClick","onContextmenu"],Xe={class:"w-4 h-4 rounded-full bg-444 dark:bg-[#fffa] absolute left-4"},Ye={class:"select-none ellipsis","data-cy":"file-name"},Ge={key:0,class:"flex items-center p-8 -space-x-4"},He=B({setup(a){const{t:p}=V(),e=E(),u=S(),o=S(),_=S();P(()=>{o.value&&Ie.create(o.value,{forceFallback:!0,filter:".icon-close",dragClass:"sortable-drag",fallbackTolerance:5})}),F(()=>e.tabs,()=>{X(()=>{u.value&&u.value.update()})},{deep:!0}),F(()=>e.activeTab,()=>{d()});function v(n){if(e.activeTab===n){d();return}e.activeTab=n}function s(n){var l;const i=(l=u.value)==null?void 0:l.$refs.wrap$;i&&(i.scrollLeft=i.scrollLeft+(n.deltaX+n.deltaY))}function d(){X(()=>{var i,l;const n=(i=o.value)==null?void 0:i.querySelector(".activeTab");if(n&&u.value){const k=u.value.$el.offsetWidth,t=n.offsetLeft,r=n.offsetLeft+n.offsetWidth,$=(l=u.value)==null?void 0:l.$refs.wrap$,C=$.scrollLeft;t>=C&&r<=k+C+1||($.scrollLeft=r-k+50)}})}const m=n=>y(this,null,function*(){n.changed&&(yield D(p("common.unsavedChangesLeaveTips"))),e.deleteTab(n.id)}),f=(n,i)=>y(this,null,function*(){n.some(k=>k.changed)&&(yield D(p("common.unsavedChangesLeaveTips"))),e.deleteTabs(i)}),g=[{name:p("common.close"),invoke:n=>y(this,null,function*(){n.changed&&(yield D(p("common.unsavedChangesLeaveTips"))),e.deleteTab(n.id)})},{name:p("common.closeToRight"),invoke:n=>y(this,null,function*(){const i=e.tabs.findIndex(t=>t.id===n.id),l=e.tabs.filter((t,r)=>r>i),k=l.map(t=>t.id);f(l,k)})},{name:p("common.closeOthers"),invoke:n=>y(this,null,function*(){const i=e.tabs.map(t=>t.id),l=e.tabs.filter(t=>t.id!=n.id),k=i.filter(t=>t!=n.id);f(l,k)})},{name:p("common.closeSaved"),invoke:()=>y(this,null,function*(){const i=e.tabs.filter(l=>!l.changed).map(l=>l.id);e.deleteTabs(i)})},{name:p("common.closeAll"),invoke:()=>y(this,null,function*(){const n=e.tabs.map(i=>i.id);f(e.tabs,n)})}];return(n,i)=>{var t;const l=K,k=Q;return c(),h("div",Ue,[T("div",{class:"whitespace-nowrap flex-1 overflow-hidden",onWheel:W(s,["prevent"])},[x(k,{ref_key:"scrollbar",ref:u},{default:O(()=>[T("div",{ref_key:"sortableWrap",ref:o,class:"h-26px"},[(c(!0),h(I,null,L(b(e).tabs,r=>{var $,C;return c(),h("div",{key:r.id,title:r.name,class:j(["group inline-flex h-full cursor-default items-center border-r border-solid border-line dark:border-transparent px-8 space-x-4 min-w-64 overflow-hidden max-w-280px relative",(($=b(e).activeTab)==null?void 0:$.id)===r.id?"bg-fff activeTab dark:bg-[#1e1e1e] dark:text-fff/86":"dark:bg-[#2d2d2d] dark:text-fff/60 hover:bg-black/10"]),"data-cy":"opened-file",onClick:w=>v(r),onContextmenu:W(w=>{var z;return(z=_.value)==null?void 0:z.openMenu(w,r)},["prevent","stop"])},[q(T("div",Xe,null,512),[[R,r.changed]]),x(l,{class:j(["iconfont",r.icon||"icon-code"])},null,8,["class"]),T("span",Ye,G(r.name),1),x(l,{class:j(["iconfont icon-close cursor-pointer hover:text-blue group-hover:opacity-100",((C=b(e).activeTab)==null?void 0:C.id)===r.id?"opacity-100":"opacity-0"]),"data-cy":"close",onClick:W(w=>m(r),["stop"])},null,8,["class","onClick"])],42,Qe)}),128))],512)]),_:1},512)],40,Pe),(t=b(e).activeTab)!=null&&t.actions?(c(),h("div",Ge,[(c(!0),h(I,null,L(b(e).activeTab.actions,r=>(c(),h(I,{key:r.name},[r.visible?(c(),A(Y,{key:0,tip:r.display,icon:r.icon,class:"!p-0 !text-m dark:text-fff/60",onClick:$=>r.invoke()},null,8,["tip","icon","onClick"])):M("",!0)],64))),128))])):M("",!0),x(ee,{ref_key:"contextMenu",ref:_,actions:g},null,512)])}}});var Je=J(He,[["__scopeId","data-v-37d8b64a"]]);const Ze={class:"h-full flex-1 relative overflow-hidden"},et={key:0,class:"absolute inset-0 flex items-center justify-center text-200px text-black/5 dark:bg-[#1e1e1e] dark:text-[#424242]"},tt={class:"h-[calc(100%-26px)] w-full dark:bg-[#1e1e1e]"},ot=B({setup(a){const p=E(),e=()=>y(this,null,function*(){var _;const o=yield(_=p.activeTab)==null?void 0:_.panelInstance.promise;o&&o.save&&o.save()}),u=(o,_,v)=>{var d;const s=(d=o.actions)==null?void 0:d.find(m=>m.name===_);if(s)for(const m in v)s[m]=v[m]};return Ce("save",e),(o,_)=>{const v=K;return c(),h("div",Ze,[b(p).tabs.length?M("",!0):(c(),h("div",et,[x(v,{class:"iconfont icon-code3"})])),b(p).tabs.length?(c(),A(Je,{key:1})):M("",!0),T("div",tt,[(c(!0),h(I,null,L(b(p).tabs,s=>{var d;return c(),A(ye,{key:s.id},[q((c(),A(H(s.panel),{id:s.id,ref_for:!0,ref:m=>s.panelInstance.resolve(m),name:s.name,params:s.params,onChanged:m=>s.changed=m,onSetAction:(m,f)=>u(s,m,f)},null,8,["id","name","params","onChanged","onSetAction"])),[[R,((d=b(p).activeTab)==null?void 0:d.id)===s.id]])],1024)}),128))])])}}});function at(){return{open(a){switch(a.type.toLowerCase()){case"page":ce({id:a.id,name:a.name},a.params.type==="RichText"?le:pe);break;case"script":ie({id:a.id,name:a.name,ownerObjectId:a.params.ownerObjectId});break;case"style":re({id:a.id,name:a.name,ownerObjectId:a.params.ownerObjectId});break;case"menu":se({id:a.id,name:a.name});break;case"layout":ne({id:a.id,name:a.name});break;case"view":ae({id:a.id,name:a.name});break;case"form":oe({id:a.id,name:a.name});break;case"code":te({id:a.id,name:a.name,codeType:a.params.codeType});break}}}}const nt={key:0,class:"h-full flex min-h-600px"},Fa=B({setup(a){const p=at(),e=v=>{me(u("common.resourceNotFound",{url:v}))},{t:u}=V(),o=E();return ke(()=>y(this,null,function*(){yield o.loadActivePanel()})),xe(v=>y(this,null,function*(){o.tabs.length&&v.name!="login"&&(yield D(u("common.leaveDevModeTip")),o.activeTab=void 0,o.tabs=[])})),ge((v,s)=>y(this,null,function*(){var d=U("siteId",v.query),m=U("siteId",s.query);o.tabs.length&&d!=m&&(yield D(u("common.leaveDevModeTip")),o.activeTab=void 0,o.tabs=[])})),N("updateTabModel",v=>y(this,null,function*(){var d,m;const s=yield(m=(d=o.tabs.find(f=>f.id===v.id))==null?void 0:d.panelInstance)==null?void 0:m.promise;!s||s.updateModel(v)})),N(Ae,p.open),N(Me,e),(v,s)=>b(o).activities.length?(c(),h("div",nt,[x(ze),x(ot)])):M("",!0)}});export{Fa as default};
