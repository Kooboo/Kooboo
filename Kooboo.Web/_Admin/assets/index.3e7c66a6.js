var P=(O,g,x)=>new Promise((s,I)=>{var _=w=>{try{T(x.next(w))}catch(F){I(F)}},U=w=>{try{T(x.throw(w))}catch(F){I(F)}},T=w=>w.done?s(w.value):Promise.resolve(w.value).then(_,U);T((x=x.apply(O,g)).next())});import{_ as oe}from"./icon-button.74ccc970.js";import{_ as ae}from"./k-table.b1a54b80.js";import{i as _e,p as be,g as ge,d as Ve,s as he}from"./content-folder.c0a1e8dd.js";import{u as ee}from"./replace-all.56d2c1f7.js";import{g as Y,w as te,o as ke}from"./i18n.a87944a4.js";import{u as xe}from"./use-operation-dialog.4f6d7533.js";import{g as Ce,a as we}from"./content-type.a215a231.js";import{a as W,s as Ee,r as Ue,l as Te,i as Fe}from"./validate.bb56f9e3.js";import{n as ne}from"./guid.c1a40312.js";import{E as de,a as se,c as Ie}from"./index.7c862087.js";import{E as re,a as ie}from"./index.9fd79879.js";import{E as ue}from"./index.178b9e08.js";import{E as me}from"./index.42922617.js";import{E as ce}from"./windi.6360286d.js";import{E as X}from"./index.361e2245.js";import{E as Ne}from"./index.7df1cda1.js";import{d as Z,g as N,c as J,i as H,o as i,j as b,w as o,b as e,a as E,b7 as z,F as R,u as l,aI as K,t as D,f as S,k as $,H as Se,N as $e,h as De,O as Re,b8 as Ae,e as Be}from"./url.4cb47a7a.js";import{_ as Oe}from"./index.f0d5f031.js";import{E as pe}from"./index.6918f0a5.js";import{E as qe,a as ze}from"./index.2bbcbf2b.js";import{E as Le,a as Me}from"./index.4d2ce883.js";import{E as fe}from"./index.b38edc72.js";import{E as Pe}from"./index.c003dfa1.js";import{_ as Ge}from"./relations-tag.b9cbe606.js";import{B as Ke}from"./breadcrumb.f4d80c95.js";import{b as je}from"./confirm.b60b5d2f.js";import{u as He}from"./main.9fdfea92.js";import{E as Je,a as Qe,b as We}from"./index.c86a187b.js";import{E as Xe}from"./index.d96452a6.js";import{c as le}from"./cloneDeep.c5011aa2.js";import"./index.4f90a917.js";import"./index.4d568055.js";import"./sortable.esm.a99254e8.js";import"./index.c6da2706.js";import"./isEqual.4cab74e3.js";import"./_baseIsEqual.dc9e64c4.js";import"./error.7e8331f1.js";import"./index.f15f695e.js";import"./event.776e7e11.js";import"./index.7b8c5aef.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./index.fd96ea36.js";import"./scroll.16983984.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./validator.b5df2420.js";import"./_baseClone.b8903935.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.c10802d9.js";import"./focus-trap.50a00b7f.js";import"./refs.3132cbdb.js";import"./page.881ec888.js";import"./index.f2c1b903.js";import"./aria.75ec5909.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./dropdown.86d3a7fb.js";const Ye={class:"flex-1 text-right"},Ze={class:"w-full"},el={class:"flex gap-4"},ll={class:"flex-1 text-right"},ol={key:1,class:"flex items-center space-x-4 mb-16"},al={class:"flex-1 text-right"},tl={class:"w-full"},nl=Z({props:{current:null,folders:null},setup(O,{expose:g}){const x=O,{t:s}=Y(),I=N(),_=N({}),U=J(()=>x.folders.filter(d=>!_.value.category.some(r=>r.folderId===d.id)&&!_.value.embedded.some(r=>r.folderId===d.id)).map(d=>d.id)),T=[W(s("common.fieldRequiredTips")),Ee(),{asyncValidator(V,d,r){_.value.category.concat(_.value.embedded).filter(t=>t.alias.toLowerCase()===d.toLowerCase()).length>=2?r(Error(s("common.valueHasBeenTakenTips"))):r()},trigger:"blur"}];H(()=>x.current,V=>{_.value=V,_.value.category.forEach(d=>d.oldMultiple=d.multiple)},{immediate:!0});function w(V){return x.folders.filter(d=>!d.isContent&&(d.id===V||U.value.includes(d.id)))}function F(V){_.value.category.splice(V,1)}function B(){_.value.category.push({folderId:U.value[0],alias:"",multiple:!1})}function n(V){var d=_.value.embedded.indexOf(V);_.value.embedded.splice(d,1)}function G(V){_.value.embedded.push({folderId:U.value[0],alias:"",group:V})}function A(V,d){for(const r of V)r.group=r.group.split("##name##")[0]+"##name##"+d}const L=J(()=>{var V=[];for(const r of _.value.embedded)if(r.index=_.value.embedded.indexOf(r),r.group){var d=V.find(f=>f.some(t=>t.group==r.group));d?d.push(r):V.push([r])}else V.push([r]);return V});return g({form:I}),(V,d)=>{const r=de,f=se,t=re,a=ue,k=me,u=ce,h=X,C=Ne,M=X,q=ie;return i(),b(q,{ref_key:"form",ref:I,model:_.value,"label-position":"top",class:"el-form--label-normal",onSubmit:d[3]||(d[3]=te(()=>{},["prevent"]))},{default:o(()=>[e(t,{label:l(s)("common.categoryFolders")},{default:o(()=>[(i(!0),E(R,null,z(_.value.category,(v,p)=>(i(),E("div",{key:p,class:"flex items-center space-x-4 mb-16"},[e(t,null,{default:o(()=>[e(f,{modelValue:v.folderId,"onUpdate:modelValue":y=>v.folderId=y,"data-cy":"category-folder-dropdown"},{default:o(()=>[(i(!0),E(R,null,z(w(v.folderId),y=>(i(),b(r,{key:y.id,label:y.displayName,value:y.id,"data-cy":"category-folder-opt"},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(t,{rules:T,prop:"category."+p+".alias"},{default:o(()=>[e(a,{modelValue:v.alias,"onUpdate:modelValue":y=>v.alias=y,placeholder:l(s)("common.alias"),class:"w-150px","data-cy":"category-folder-alias"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(t,{prop:"category."+p+".display"},{default:o(()=>[e(a,{modelValue:v.display,"onUpdate:modelValue":y=>v.display=y,placeholder:l(s)("common.displayName"),class:"w-150px"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(k,{modelValue:v.multiple,"onUpdate:modelValue":y=>v.multiple=y,disabled:v.oldMultiple,"data-cy":"multiple"},{default:o(()=>[K(D(l(s)("common.multiple")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),S("div",Ye,[e(h,{circle:"","data-cy":"remove-category-folder",onClick:y=>F(p)},{default:o(()=>[e(u,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),S("div",Ze,[l(U).length?(i(),b(h,{key:0,round:"",type:"primary","data-cy":"add-category-folder",onClick:d[0]||(d[0]=v=>B())},{default:o(()=>[e(u,{class:"iconfont icon-a-addto"}),K(" "+D(l(s)("common.addRelation")),1)]),_:1})):$("",!0)])]),_:1},8,["label"]),e(t,{label:l(s)("common.embeddedFolders")},{default:o(()=>[(i(!0),E(R,null,z(l(L),v=>(i(),E(R,{key:v[0].folderId},[v.some(p=>p.group)?(i(),b(C,{key:0,shadow:!1,class:"mb-16"},{header:o(()=>{var p;return[S("div",el,[e(a,{"model-value":((p=v[0].group)==null?void 0:p.split("##name##")[1])||"",placeholder:l(s)("common.groupName"),"data-cy":"embedded-folder-alias","onUpdate:modelValue":y=>A(v,y)},null,8,["model-value","placeholder","onUpdate:modelValue"])])]}),default:o(()=>[(i(!0),E(R,null,z(v,p=>(i(),E("div",{key:p.folderId,class:"flex items-center space-x-4 mb-16"},[e(t,null,{default:o(()=>[e(f,{modelValue:p.folderId,"onUpdate:modelValue":y=>p.folderId=y,class:"w-full","data-cy":"embedded-folder-dropdown"},{default:o(()=>[(i(!0),E(R,null,z(w(p.folderId),y=>(i(),b(r,{key:y.id,label:y.displayName,value:y.id,"data-cy":"embedded-folder-opt"},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(t,{rules:T,prop:"embedded."+p.index+".alias"},{default:o(()=>[e(a,{modelValue:p.alias,"onUpdate:modelValue":y=>p.alias=y,placeholder:l(s)("common.alias"),"data-cy":"embedded-folder-alias"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(t,{prop:"embedded."+p.index+".display"},{default:o(()=>[e(a,{modelValue:p.display,"onUpdate:modelValue":y=>p.display=y,placeholder:l(s)("common.displayName")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),S("div",ll,[e(h,{circle:"","data-cy":"remove-embedded-folder",onClick:y=>n(p)},{default:o(()=>[e(u,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),l(U).length?(i(),b(h,{key:0,circle:"","data-cy":"add-embedded-folder",class:"text-blue",onClick:p=>G(v[0].group)},{default:o(()=>[e(u,{class:"iconfont icon-a-addto"})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024)):(i(),E("div",ol,[e(t,null,{default:o(()=>[e(f,{modelValue:v[0].folderId,"onUpdate:modelValue":p=>v[0].folderId=p,class:"w-full","data-cy":"embedded-folder-dropdown"},{default:o(()=>[(i(!0),E(R,null,z(w(v[0].folderId),p=>(i(),b(r,{key:p.id,label:p.displayName,value:p.id,"data-cy":"embedded-folder-opt"},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(t,{rules:T,prop:"embedded."+v[0].index+".alias"},{default:o(()=>[e(a,{modelValue:v[0].alias,"onUpdate:modelValue":p=>v[0].alias=p,placeholder:l(s)("common.alias"),"data-cy":"embedded-folder-alias"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(t,{prop:"embedded."+v[0].index+".display"},{default:o(()=>[e(a,{modelValue:v[0].display,"onUpdate:modelValue":p=>v[0].display=p,placeholder:l(s)("common.displayName")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),S("div",al,[e(h,{circle:"","data-cy":"remove-embedded-folder",onClick:p=>n(v[0])},{default:o(()=>[e(u,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))],64))),128)),S("div",tl,[l(U).length?(i(),b(h,{key:0,round:"",type:"primary","data-cy":"add-embedded-folder",onClick:d[1]||(d[1]=v=>G())},{default:o(()=>[e(u,{class:"iconfont icon-a-addto"}),K(" "+D(l(s)("common.addRelation")),1)]),_:1})):$("",!0),l(U).length?(i(),b(M,{key:1,round:"",onClick:d[2]||(d[2]=v=>G(l(ne)()))},{default:o(()=>[e(u,{class:"iconfont icon-a-addto text-blue"}),K(" "+D(l(s)("common.addGroup")),1)]),_:1})):$("",!0)])]),_:1},8,["label"])]),_:1},8,["model"])}}}),dl={class:"grid grid-cols-2 gap-8"},sl={class:"grid grid-cols-2"},rl={class:"flex items-center space-x-4"},il=Z({props:{modelValue:{type:Boolean},current:null,folders:null,isContent:{type:Boolean}},emits:["create-success"],setup(O,{emit:g}){const x=O,{t:s}=Y(),{visible:I,handleClose:_}=xe(x,g),U=[{displayName:s("common.basicInfo"),value:"basic"},{displayName:s("common.relationFolders"),value:"relation"},{displayName:s("common.fields"),value:"fields"}],T=N("basic"),w=N(),F=N(),B=N(),n=N({}),G=J(()=>{const t={name:[W(s("common.fieldRequiredTips")),Ue(1,50),Te(),Fe(_e,s("common.folderNameExistsTips"))],contentTypeId:[W(s("common.fieldRequiredTips"))]};return n.value.sortable&&(t.sortField=[W(s("common.fieldRequiredTips"))]),t}),A=N([]),L=N(!0);H(()=>I.value,t=>{var a,k,u;t&&(V(),(a=F.value)==null||a.resetFields(),(u=(k=B.value)==null?void 0:k.form)==null||u.resetFields(),T.value="basic",x.current?(n.value=x.current,L.value=!1):(L.value=!0,n.value={pageSize:30,category:[],embedded:[]}))}),H(()=>{var t;return(t=n.value)==null?void 0:t.contentTypeId},t=>P(this,null,function*(){if(!t){A.value=[];return}const{properties:a}=yield Ce({id:t});A.value=a||[]})),H(()=>n.value.sortable,t=>{var a;t&&!n.value.sortField&&(n.value.sortField=(a=A.value[0])==null?void 0:a.name)}),H(()=>n.value.sortField,t=>{t==="dragAndDrop"&&(n.value.ascending=!1)});function V(){return P(this,null,function*(){var t;(t=w.value)!=null&&t.length||(w.value=yield we())})}function d(){return P(this,null,function*(){var t,a,k,u,h;try{yield(t=F.value)==null?void 0:t.validate()}catch(C){throw T.value="basic",C}try{yield(k=(a=B.value)==null?void 0:a.form)==null?void 0:k.validate()}catch(C){throw T.value="relation",C}yield be({id:n.value.id,displayName:n.value.displayName,name:n.value.name,contentTypeId:n.value.contentTypeId,category:(u=n.value.category)==null?void 0:u.map(C=>(C.display=C.display||C.alias,C)),embedded:(h=n.value.embedded)==null?void 0:h.map(C=>(C.display=C.display||C.alias,C)),hidden:n.value.hidden,sortable:n.value.sortable,sortField:n.value.sortable?n.value.sortField:"",ascending:n.value.ascending,pageSize:n.value.pageSize,isContent:x.isContent,fieldsOrder:n.value.fieldsOrder,group:n.value.group,previewUrl:n.value.previewUrl}),_(),g("create-success")})}const r=J(()=>{let t=[];if(!A.value||!n.value)return t;for(const u of A.value)!u.editable||t.push({name:u.name,display:u.displayName});for(const u of n.value.embedded)u.group?t.find(h=>h.name==u.group)||t.push({name:u.group,display:u.group.split("##name##")[1]}):t.push({name:u.alias,display:u.display});for(const u of n.value.category)t.push({name:u.alias,display:u.display});if(!n.value.fieldsOrder)return t;var a=[];for(const u of n.value.fieldsOrder){var k=t.find(h=>h.name==u);k&&(a.push(k),t=t.filter(h=>h.name!=u))}return a.push(...t),a});function f(t){return P(this,null,function*(){n.value.fieldsOrder=t.map(a=>a.name)})}return(t,a)=>{const k=ue,u=re,h=de,C=se,M=pe,q=qe,v=ze,p=ie,y=Le,Q=fe,m=oe,j=ae,ve=Me,ye=Pe;return i(),b(ye,{modelValue:l(I),"onUpdate:modelValue":a[13]||(a[13]=c=>Se(I)?I.value=c:null),width:"600px","close-on-click-modal":!1,title:l(s)("common.settings"),"custom-class":"el-dialog--zero-padding",onClose:l(_)},{footer:o(()=>[e(Oe,{permission:{feature:"contentType",action:"edit"},onConfirm:d,onCancel:l(_)},null,8,["onCancel"])]),default:o(()=>[e(ve,{modelValue:T.value,"onUpdate:modelValue":a[12]||(a[12]=c=>T.value=c)},{default:o(()=>[e(y,{label:l(U)[0].displayName,name:l(U)[0].value},{default:o(()=>[e(p,{ref_key:"form",ref:F,model:n.value,rules:l(G),"label-position":"top","validate-on-rule-change":!1,onSubmit:a[11]||(a[11]=te(()=>{},["prevent"])),onKeydown:ke(d,["enter"])},{default:o(()=>[L.value?(i(),b(u,{key:0,prop:"name",label:l(s)("common.name")},{default:o(()=>[e(k,{modelValue:n.value.name,"onUpdate:modelValue":a[0]||(a[0]=c=>n.value.name=c),"data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])):(i(),b(u,{key:1,label:l(s)("common.name")},{default:o(()=>[e(k,{modelValue:n.value.name,"onUpdate:modelValue":a[1]||(a[1]=c=>n.value.name=c),disabled:"","data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])),e(u,{prop:"displayName",label:l(s)("common.displayName")},{default:o(()=>[e(k,{modelValue:n.value.displayName,"onUpdate:modelValue":a[2]||(a[2]=c=>n.value.displayName=c),"data-cy":"display-name"},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{prop:"previewUrl",label:l(s)("common.previewUrl")},{default:o(()=>[e(k,{modelValue:n.value.previewUrl,"onUpdate:modelValue":a[3]||(a[3]=c=>n.value.previewUrl=c),"data-cy":"preview-url"},null,8,["modelValue"])]),_:1},8,["label"]),e(u,{prop:"contentTypeId",label:l(s)("common.contentType")},{default:o(()=>[e(C,{modelValue:n.value.contentTypeId,"onUpdate:modelValue":a[4]||(a[4]=c=>n.value.contentTypeId=c),class:"w-full",disabled:!L.value,"data-cy":"content-type-dropdown"},{default:o(()=>[(i(!0),E(R,null,z(w.value,c=>(i(),b(h,{key:c.id,label:c.name,value:c.id,"data-cy":"content-type-opt"},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),S("div",dl,[O.isContent?$("",!0):(i(),b(u,{key:0,label:l(s)("common.pageSize")},{default:o(()=>[e(C,{modelValue:n.value.pageSize,"onUpdate:modelValue":a[5]||(a[5]=c=>n.value.pageSize=c)},{default:o(()=>[(i(),E(R,null,z([10,30,50,100],c=>e(h,{key:c,label:c,value:c},null,8,["label","value"])),64)),e(h,{value:999999,label:l(s)("common.disablePaging")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])),e(u,{label:l(s)("common.group")},{default:o(()=>[e(k,{modelValue:n.value.group,"onUpdate:modelValue":a[6]||(a[6]=c=>n.value.group=c)},null,8,["modelValue"])]),_:1},8,["label"])]),S("div",sl,[O.isContent?$("",!0):(i(),b(u,{key:0,label:l(s)("common.sortable")},{default:o(()=>[e(M,{modelValue:n.value.sortable,"onUpdate:modelValue":a[7]||(a[7]=c=>n.value.sortable=c),disabled:!n.value.contentTypeId},null,8,["modelValue","disabled"])]),_:1},8,["label"])),e(u,{label:l(s)("common.hidden")},{default:o(()=>[e(M,{modelValue:n.value.hidden,"onUpdate:modelValue":a[8]||(a[8]=c=>n.value.hidden=c)},null,8,["modelValue"])]),_:1},8,["label"])]),n.value.sortable?(i(),b(u,{key:2,prop:"sortField",label:l(s)("common.sortField")},{default:o(()=>[e(v,{gutter:20,class:"w-full"},{default:o(()=>[e(q,{span:12},{default:o(()=>[e(C,{modelValue:n.value.sortField,"onUpdate:modelValue":a[9]||(a[9]=c=>n.value.sortField=c)},{default:o(()=>[(i(!0),E(R,null,z(A.value,c=>(i(),b(h,{key:c.name,label:c.displayName,value:c.name,"data-cy":"content-type-opt"},null,8,["label","value"]))),128)),e(h,{value:"dragAndDrop",label:l(s)("common.dragAndDrop")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),e(q,{span:12},{default:o(()=>[e(M,{modelValue:n.value.ascending,"onUpdate:modelValue":a[10]||(a[10]=c=>n.value.ascending=c),disabled:n.value.sortField==="dragAndDrop","active-text":l(s)("common.ascending"),"inactive-text":l(s)("common.descending")},null,8,["modelValue","disabled","active-text","inactive-text"])]),_:1})]),_:1})]),_:1},8,["label"])):$("",!0)]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["label","name"]),e(y,{label:l(U)[1].displayName,name:l(U)[1].value},{default:o(()=>[e(nl,{ref_key:"relationFolder",ref:B,current:n.value,folders:O.folders},null,8,["current","folders"])]),_:1},8,["label","name"]),e(y,{label:l(U)[2].displayName,name:l(U)[2].value},{default:o(()=>[e(j,{data:l(r),draggable:!0,"row-key":"name",onSorted:f},{default:o(()=>[e(Q,{label:l(s)("common.name")},{default:o(({row:c})=>[S("div",rl,D(c.display||c.name),1)]),_:1},8,["label"]),e(Q,{width:"150",align:"right"},{default:o(()=>[e(m,{icon:"icon-move js-sortable cursor-move",tip:l(s)("common.move"),"data-cy":"move"},null,8,["tip"])]),_:1})]),_:1},8,["data"])]),_:1},8,["label","name"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title","onClose"])}}}),ul={class:"p-24"},ml={class:"flex items-center py-24 space-x-16"},cl=S("div",{class:"flex-1"},null,-1),pl={key:0,class:"flex items-center text-s space-x-4 text-999"},fl={key:0},vl={key:1,class:"inline-flex items-center space-x-4 gap-8"},So=Z({setup(O){const{t:g}=Y(),x=He(),s=N([]),I=N(!1),_=N(),U=$e(),T=N(!1),w=N(!1),F=N([]);De(()=>{B()});function B(){return P(this,null,function*(){const d=yield ge();s.value=[],setTimeout(()=>{s.value=d.sort((r,f)=>{var t,a;return((t=r.order)!=null?t:0)<((a=f.order)!=null?a:0)?-1:1})})})}const n=J(()=>{let d=JSON.parse(JSON.stringify(T.value?s.value:s.value.filter(f=>!f.hidden)));for(var r=[];d.length;){const f=d.shift();if(!f)break;if(f.group){const t=d.filter(a=>a.group==f.group);if(t.length){const a=[f,...t];a.forEach(k=>k.isChildren=!0),r.push({isFolder:!0,group:f.group,name:f.name,displayName:f.group,children:a,id:ne()}),d=d.filter(k=>k.group!=f.group);continue}}r.push(f)}return r});function G(d){return P(this,null,function*(){yield je(d.length);const r=d.map(f=>f.id);yield Ve({ids:r}),B()})}function A(d){w.value=(d==null?void 0:d.isContent)||!1,x.hasAccess("contentType","edit")&&(I.value=!0,d?_.value=le(d):_.value=void 0)}function L(d){w.value=!0,x.hasAccess("contentType","edit")&&(I.value=!0,d?_.value=le(d):_.value=void 0)}function V(d){return P(this,null,function*(){const r=[];for(const f of d)if(!(!f||r.includes(f.name))&&(r.push(f.name),f.children))for(const t of f.children)r.includes(t.name)||r.push(t.name);yield he(r),B()})}return(d,r)=>{const f=ce,t=X,a=Je,k=Qe,u=We,h=pe,C=me,M=Re("router-link"),q=fe,v=Ie,p=oe,y=Xe,Q=Ae("hasPermission");return i(),E("div",ul,[e(Ke,{name:l(g)("common.contentFolders")},null,8,["name"]),S("div",ml,[e(u,{trigger:"click",class:"ml-10px",onCommand:r[0]||(r[0]=m=>m=="multi-content"?A():L())},{dropdown:o(()=>[e(k,null,{default:o(()=>[e(a,{command:"multi-content",disabled:!l(x).hasAccess("contentType","edit"),title:l(x).hasAccess("contentType","edit")?"":l(g)("common.noPermission"),"data-cy":"multi-content"},{default:o(()=>[S("span",null,D(l(g)("common.folder")),1)]),_:1},8,["disabled","title"]),e(a,{command:"single-content",disabled:!l(x).hasAccess("contentType","edit"),title:l(x).hasAccess("contentType","edit")?"":l(g)("common.noPermission"),"data-cy":"single-content"},{default:o(()=>[S("span",null,D(l(g)("common.singleContent")),1)]),_:1},8,["disabled","title"])]),_:1})]),default:o(()=>[Be((i(),b(t,{round:"","data-cy":"new-folder"},{default:o(()=>[e(f,{class:"iconfont icon-a-addto"}),S("span",null,D(l(g)("common.new")),1),e(f,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})]),_:1})),[[Q,{feature:"contentType",action:"edit"}]])]),_:1}),cl,s.value.some(m=>m.hidden)?(i(),E("div",pl,[S("div",null,D(l(g)("common.showAll")),1),e(h,{modelValue:T.value,"onUpdate:modelValue":r[1]||(r[1]=m=>T.value=m)},null,8,["modelValue"])])):$("",!0)]),e(l(ae),{selectedData:F.value,"onUpdate:selectedData":r[2]||(r[2]=m=>F.value=m),data:l(n),"show-check":"","custom-check":"",permission:{feature:"contentType",action:"edit"},draggable:".sortable-elements","row-key":"id","row-class-name":({row:m})=>m.isChildren?"":"sortable-elements",onDelete:G,onSorted:V},{default:o(()=>[e(q,{label:l(g)("common.name")},{default:o(({row:m})=>[m.isFolder?(i(),E("span",fl,D(m.displayName),1)):(i(),E("div",vl,[e(C,{size:"large","model-value":F.value.some(j=>j===m),"data-cy":"checkbox-label",onChange:()=>{F.value.includes(m)?F.value=F.value.filter(j=>j!==m):F.value.push(m)}},null,8,["model-value","onChange"]),e(M,{class:"ellipsis text-blue cursor-pointer",to:l(ee)({name:m.isContent?"content":"textcontentsbyfolder",query:{folder:m.id,id:m.defaultContentId,isContent:m.isContent}}),"data-cy":"name"},{default:o(()=>[K(D(m.displayName||m.name),1)]),_:2},1032,["to"]),m.hidden?(i(),b(f,{key:0,class:"text-20px iconfont icon-yincang-px- text-999/60"})):$("",!0)]))]),_:1},8,["label"]),e(q,{label:l(g)("common.usedBy")},{default:o(({row:m})=>[m.isFolder?$("",!0):(i(),b(Ge,{key:0,id:m.id,relations:m.relations,type:"ContentFolder"},null,8,["id","relations"]))]),_:1},8,["label"]),e(q,{label:l(g)("common.type"),width:"140",align:"center"},{default:o(({row:m})=>[m.isFolder?$("",!0):(i(),E(R,{key:0},[m.isContent?(i(),b(v,{key:0,type:"success",round:""},{default:o(()=>[K(D(l(g)("common.singleContent")),1)]),_:1})):(i(),b(v,{key:1,type:"warning",round:""},{default:o(()=>[K(D(l(g)("common.folder")),1)]),_:1}))],64))]),_:1},8,["label"]),e(q,{width:"150",align:"right"},{default:o(({row:m})=>[m.isFolder?$("",!0):(i(),E(R,{key:0},[m.type!=="RichText"?(i(),b(p,{key:0,permission:{feature:"contentType",action:"edit"},icon:"icon-a-setup",tip:l(g)("common.folderSetting"),"data-cy":"setting",onClick:j=>A(m)},null,8,["tip","onClick"])):$("",!0),l(x).hasAccess("contentType","edit")?(i(),b(M,{key:1,to:l(ee)({name:"contenttype",query:{id:m.contentTypeId,fromRouter:l(U).name}}),"data-cy":"edit-content-type",class:"mx-8"},{default:o(()=>[e(y,{placement:"top",content:l(g)("common.editContentType")},{default:o(()=>[e(f,{class:"iconfont icon-a-writein"})]),_:1},8,["content"])]),_:2},1032,["to"])):(i(),b(p,{key:2,permission:{feature:"contentType",action:"edit"},icon:"icon-a-writein",tip:l(g)("common.editContentType")},null,8,["tip"]))],64)),m.isChildren?$("",!0):(i(),b(p,{key:1,icon:"icon-move js-sortable cursor-move",tip:l(g)("common.move"),"data-cy":"move"},null,8,["tip"]))]),_:1})]),_:1},8,["selectedData","data","row-class-name"]),e(il,{modelValue:I.value,"onUpdate:modelValue":r[3]||(r[3]=m=>I.value=m),current:_.value,folders:s.value,"is-content":w.value,onCreateSuccess:B},null,8,["modelValue","current","folders","is-content"])])}}});export{So as default};
