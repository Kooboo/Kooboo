var ve=Object.defineProperty,ye=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Z=(u,t,s)=>t in u?ve(u,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[t]=s,K=(u,t)=>{for(var s in t||(t={}))he.call(t,s)&&Z(u,s,t[s]);if(Y)for(var s of Y(t))be.call(t,s)&&Z(u,s,t[s]);return u},ee=(u,t)=>ye(u,Ce(t));var B=(u,t,s)=>new Promise((k,h)=>{var r=m=>{try{y(s.next(m))}catch(w){h(w)}},g=m=>{try{y(s.throw(m))}catch(w){h(w)}},y=m=>m.done?k(m.value):Promise.resolve(m.value).then(r,g);y((s=s.apply(u,t)).next())});import{_ as xe}from"./k-table.f75c31cc.js";import{_ as ke}from"./icon-button.e30c79ea.js";import{d as O,g as $,c as T,h as ne,o as f,j as S,w as a,b as l,u as o,b7 as ae,a as V,f as D,e as le,aH as q,t as x,k as A,F as J,M as we,cd as Ee,N as Ve,b6 as te}from"./url.8f5ec20c.js";import{B as Se}from"./breadcrumb.79da4f07.js";import{g as Q}from"./i18n.2d8b30eb.js";import{u as oe}from"./replace-all.dd6016f2.js";import{a as $e,b as Ie,u as Pe,f as Be,m as De}from"./commerce.0424f5f4.js";import{b as Te}from"./confirm.617d359f.js";import{_ as se}from"./index.ed88cf90.js";import{b as Fe}from"./product.2c2b440b.js";import{u as re}from"./useFields.e93629df.js";import{_ as W,c as Ne}from"./index.4eb69dec.js";import{E as Ae}from"./index.4c9af567.js";import{E as X,a as ie}from"./index.bc06171b.js";import{E as me}from"./index.593106e3.js";import{E as ce}from"./index.a4ff385c.js";import{E as ue}from"./windi.bf752d69.js";import{E as de}from"./index.96970839.js";import{E as pe}from"./index.ec785feb.js";import{b as Le}from"./useLabels.937424e3.js";import{g as Me}from"./main.d8c6ef59.js";import{g as j}from"./string.75b81683.js";import{c as Re}from"./index.ab4ed870.js";import"./sortable.esm.a99254e8.js";import"./index.14993118.js";import"./index.0535d5fe.js";import"./isEqual.c3e9e9f4.js";import"./_baseIsEqual.2f38f7c3.js";import"./index.bb5499e2.js";import"./event.776e7e11.js";import"./index.a595fe6d.js";import"./error.7e8331f1.js";import"./isNil.98bb3b88.js";import"./index.0a83bb10.js";import"./index.e87fdc52.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.80a4dc1a.js";import"./index.bf8ed8c6.js";import"./scroll.54c27fbd.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.3f074800.js";import"./validator.1bcd6e6a.js";import"./isEmpty.11c614d1.js";import"./search-provider.e244950c.js";import"./toNumber.6efebd6a.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./style.ad574a57.js";import"./_baseUniq.2c27addc.js";import"./use-operation-dialog.fbfa9343.js";import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.a31db113.js";import"./file.52d8e05a.js";import"./validate.348f94d6.js";import"./index.37979027.js";import"./index.3dc39d21.js";import"./index.832f2769.js";import"./index.b3e4ff8e.js";import"./index.5af167df.js";import"./index.a141884f.js";import"./_baseClone.29a8cd97.js";import"./folder.8308bb9d.js";import"./use-date.28e9a8a3.js";import"./dayjs.min.35b12e7a.js";import"./relations-tag.b9c377a2.js";import"./page.c26fc024.js";import"./guid.c1a40312.js";import"./use-copy-text.67d6617b.js";import"./index.e483320a.js";import"./browser.8b21f9f4.js";import"./throttle.3f3ee457.js";import"./debounce.730e1961.js";import"./search-input.770da843.js";/* empty css                                                                 */import"./_createCompounder.2027fb34.js";import"./color-picker.2e8324a7.js";import"./index.9444b94a.js";import"./position.edbf0f94.js";import"./index.b68af8a1.js";import"./image-cover.a0855dc0.js";import"./media-dialog.c90392a5.js";import"./media.152ad1ab.js";import"./index.e56d78c4.js";/* empty css                                                          *//* empty css                                                          */import"./layout.4bc43a3b.js";import"./index.47676836.js";import"./utils.cd1dfe22.js";import"./index.8bd72af8.js";import"./use-file-upload.1cd07d1f.js";import"./index.06224119.js";import"./index.14aabd47.js";import"./index.fcc918d5.js";import"./index.3f972c9e.js";import"./file.8273cb50.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.7c6ede25.js";import"./refs.d2253dd4.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";const Ue=O({props:{excludes:null,modelValue:{type:Boolean}},emits:["update:modelValue","selected"],setup(u,{emit:t}){const s=u,{getColumns:k}=re(),h=k([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]),{t:r}=Q(),g=$(!0),y=$([]),m=T(()=>{let c=y.value;return s.excludes&&(c=c.filter(v=>!s.excludes.includes(v.id))),c});function w(){return B(this,null,function*(){var c=yield Fe();y.value=c.map(v=>ee(K({},v),{selected:!1}))})}const L=T(()=>m.value.some(c=>c.selected)&&m.value.some(c=>!c.selected)),b=T(()=>m.value.length&&m.value.every(c=>c.selected));function _(c){m.value.forEach(v=>v.selected=c)}ne(()=>{w()});function I(){t("selected",m.value.filter(c=>c.selected)),g.value=!1}return(c,v)=>{const P=Ae,F=X,M=ie,R=me,U=se,i=ce;return f(),S(i,{"model-value":g.value,width:"800px",title:o(r)("common.selectProduct"),"close-on-click-modal":!1,onClosed:v[1]||(v[1]=e=>t("update:modelValue",!1))},{footer:a(()=>[l(U,{disabled:!o(m).some(e=>e.selected),onConfirm:I,onCancel:v[0]||(v[0]=e=>g.value=!1)},null,8,["disabled"])]),default:a(()=>[l(R,{"max-height":"400px"},{default:a(()=>[l(M,{data:o(m),class:"el-table--gray"},{default:a(()=>[l(F,{width:"60",align:"center"},{header:a(()=>[l(P,{size:"large",class:"!block !h-20px",indeterminate:o(L),"model-value":o(b),onChange:_},null,8,["indeterminate","model-value"])]),default:a(({row:e})=>[l(P,{modelValue:e.selected,"onUpdate:modelValue":n=>e.selected=n,size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(W,{columns:o(h)},null,8,["columns"])]),_:1},8,["data"])]),_:1})]),_:1},8,["model-value","title"])}}}),ze={class:"space-y-12"},je={class:"flex items-center"},qe=O({props:{editable:{type:Boolean},categoryId:null,modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(u,{emit:t}){const s=u,{t:k}=Q(),h=$(!0),r=$(),g=$(!1),{getColumns:y}=re(),m=y([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]);$e(s.categoryId).then(b=>{r.value=b});function w(b){var _;(_=r.value)==null||_.push(...b)}function L(){return B(this,null,function*(){yield Ie(s.categoryId,r.value.map(b=>b.id)),h.value=!1,t("reload")})}return(b,_)=>{var e;const I=ue,c=de,v=pe,P=X,F=ie,M=me,R=se,U=ce,i=ae("hasPermission");return f(),V(J,null,[l(U,{"model-value":h.value,width:"850px",title:o(k)("common.products"),"close-on-click-modal":!1,onClosed:_[2]||(_[2]=n=>t("update:modelValue",!1))},{footer:a(()=>[l(R,{onConfirm:L,onCancel:_[1]||(_[1]=n=>h.value=!1)})]),default:a(()=>[D("div",ze,[u.editable?le((f(),S(c,{key:0,round:"",onClick:_[0]||(_[0]=n=>g.value=!0)},{default:a(()=>[D("div",je,[l(I,{class:"mr-16 iconfont icon-a-addto"}),q(" "+x(o(k)("common.addProduct")),1)])]),_:1})),[[i,{feature:"productCategories",action:"edit"}]]):A("",!0),l(M,{"max-height":"400px"},{default:a(()=>[l(F,{data:r.value,class:"el-table--gray"},{default:a(()=>[l(W,{columns:o(m)},null,8,["columns"]),u.editable?(f(),S(P,{key:0,align:"right",width:"60"},{default:a(({row:n})=>[l(v,{placement:"top",content:o(k)("common.delete")},{default:a(()=>[l(I,{class:"iconfont icon-delete hover:text-blue text-l",onClick:d=>r.value=r.value.filter(C=>C.id!=n.id)},null,8,["onClick"])]),_:2},1032,["content"])]),_:1})):A("",!0)]),_:1},8,["data"])]),_:1})])]),_:1},8,["model-value","title"]),g.value?(f(),S(Ue,{key:0,modelValue:g.value,"onUpdate:modelValue":_[3]||(_[3]=n=>g.value=n),excludes:(e=r.value)==null?void 0:e.map(n=>n.id),onSelected:w},null,8,["modelValue","excludes"])):A("",!0)],64)}}}),He={class:"p-24"},Ke={class:"flex items-center py-24 space-x-16"},Ge={class:"flex items-center"},Je={class:"flex items-center"},Oe={class:"text-black dark:text-[#cfd3dc]"},Qe={class:"inline-flex flex-wrap gap-4"},We={key:0,class:"text-s"},Xe={key:0},Ye={key:1,class:"text-s"},Wo=O({setup(u){const{t}=Q(),s=we(),k=Ee(),h=s.meta.title,r=Pe(),g=$(),y=$(!1),m=$(r.settings);r.loadSettings().then(()=>{m.value=r.settings});const{getFieldDisplayName:w}=Le(),L=Me(),b={image:{width:80}},_={"min-width":180},I=T(()=>{var i;return((i=F.value)==null?void 0:i.length)>1}),c=T(()=>I.value);function v(i){return B(this,null,function*(){yield Te(i.length),yield Be(i.map(e=>e.id)),r.loadCategories()})}const P=T(()=>{var n;const i=(n=m.value.categoryCustomFields)!=null?n:[];let e=i.filter(d=>d.isSummaryField);return e.length||(e=i.slice(0,2)),e.map(d=>({name:Ne(d.name),displayName:w(d),controlType:d.type,multipleValue:d.multiple,attrs:K(K({},_),j(b,d.name))}))}),F=T(()=>{var i;return((i=r.categories)!=null?i:[]).map(e=>{var d;const n=(d=j(e,"customData"))!=null?d:{};for(const C of P.value)if(!j(e,C.name)){const E=j(n,C.name);if(!E)continue;e[C.name]=j(E,L.default)}return e})});function M(i){g.value=i,y.value=!0}function R(i,e){return B(this,null,function*(){const{newIndex:n,oldIndex:d}=e;if(n===void 0||d===void 0||d===n)return;const C=i[n],E=i[n+1],z=i[n-1],G={source:C.id,prevId:E==null?void 0:E.id,nextId:z==null?void 0:z.id};yield De(G),r.loadCategories()})}function U(){return B(this,null,function*(){r.loadCategories()})}return ne(()=>B(this,null,function*(){r.loadCategories()})),(i,e)=>{const n=ue,d=de,C=Re,E=pe,z=Ve("router-link"),G=ke,fe=X,_e=xe,ge=ae("hasPermission");return f(),V("div",He,[l(Se,{name:o(h)},null,8,["name"]),D("div",Ke,[le((f(),S(d,{round:"",onClick:e[0]||(e[0]=p=>o(k).push(o(oe)({name:"product category create"})))},{default:a(()=>[D("div",Ge,[l(n,{class:"mr-16 iconfont icon-a-addto"}),q(" "+x(o(t)("common.create")),1)])]),_:1})),[[ge,{feature:"productCategories",action:"edit"}]])]),l(_e,{data:o(F),"show-check":"",draggable:o(I),"row-key":"id",onDelete:v,onSorted:R,onSortChange:U,onChange:e[1]||(e[1]=()=>o(r).loadCategories())},{default:a(()=>[l(W,{columns:o(P)},{title:a(({row:p})=>[D("div",Je,[D("span",Oe,x(p.title),1)])]),tags:a(({row:p})=>[D("div",Qe,[(f(!0),V(J,null,te(p.tags,(N,H)=>(f(),S(C,{key:H,round:"",size:"small",type:"warning"},{default:a(()=>[q(x(N),1)]),_:2},1024))),128))])]),productCount:a(({row:p})=>[l(C,{round:"",class:"cursor-pointer",type:"success",onClick:N=>M(p)},{default:a(()=>[q(x(p.productCount),1)]),_:2},1032,["onClick"])]),condition:a(({row:p})=>[p.type=="Automated"?(f(),V("div",We,[(f(!0),V(J,null,te(p.condition.items,(N,H)=>(f(),V("div",{key:H},[H>0?(f(),V("span",Xe,x(p.condition.isAny?o(t)("common.or"):o(t)("common.and")),1)):A("",!0),q(" "+x(N.option)+" "+x(N.method)+" "+x(N.value),1)]))),128))])):(f(),V("span",Ye,x(o(t)("common.manual")),1))]),_:1},8,["columns"]),l(fe,{align:"right",width:"120"},{default:a(({row:p})=>[l(z,{to:o(oe)({name:"product category edit",query:{id:p.id}}),class:"mx-8"},{default:a(()=>[l(E,{placement:"top",content:o(t)("common.edit")},{default:a(()=>[l(n,{class:"iconfont icon-a-writein hover:text-blue text-l"})]),_:1},8,["content"])]),_:2},1032,["to"]),o(c)?(f(),S(G,{key:0,icon:"icon-move js-sortable cursor-move",tip:o(t)("common.move"),"data-cy":"move"},null,8,["tip"])):A("",!0)]),_:1})]),_:1},8,["data","draggable"]),y.value?(f(),S(qe,{key:0,modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=p=>y.value=p),"category-id":g.value.id,editable:g.value.type=="Manual",onReload:e[3]||(e[3]=p=>o(r).loadCategories())},null,8,["modelValue","category-id","editable"])):A("",!0)])}}});export{Wo as default};
