var V=(u,m,a)=>new Promise((n,s)=>{var h=d=>{try{C(a.next(d))}catch(r){s(r)}},b=d=>{try{C(a.throw(d))}catch(r){s(r)}},C=d=>d.done?n(d.value):Promise.resolve(d.value).then(h,b);C((a=a.apply(u,m)).next())});import{_ as Ce}from"./diff.b033e0a3.js";import{g as O}from"./i18n.25caaace.js";import{n as ne,o as se,q as Ve,r as ue,t as xe,v as $e,w as Ie,x as Te,y as Se,z as Ne}from"./index.6fafe25e.js";import{C as Pe}from"./replace-all.b35629e7.js";import{g as S,d as Y,c as je,o as k,j as x,w as o,b as l,aH as P,t as f,u as e,f as p,a as L,F as H,k as N,x as q,b7 as X,e as M,i as ie,G as Le,b6 as R,l as ze,ch as De}from"./url.8f5ec20c.js";import{u as U}from"./use-date.55b953fa.js";import{E as Q}from"./index.e9f8834a.js";import{E as Ee}from"./index.a5d96e5a.js";import{S as He}from"./search-input.9d340a13.js";import{_ as Z}from"./icon-button.0e134c9b.js";import{_ as ee}from"./object-type-tag.046f35b1.js";import{_ as ae}from"./k-table.c13bd7f5.js";import{_ as te}from"./action-tag.06e33d33.js";import{s as A}from"./confirm.629bcef4.js";import{j as me}from"./windi.a815125a.js";import{E as oe}from"./index.5388dbc8.js";import{B as Be}from"./breadcrumb.bcaeaf75.js";import{i as ce}from"./main.1c3b59e3.js";import{E as Me,a as Ue}from"./index.960b9732.js";import{E as Oe}from"./index.93cb5a2c.js";import{E as Ye,a as Re}from"./index.4a9f2d0a.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./preload-helper.13a99eb0.js";import"./guid.c1a40312.js";import"./config.e9159c41.js";import"./dark.bb3c8a6e.js";import"./dayjs.min.2044f1dd.js";import"./index.1e7e06b8.js";import"./index.1d16d007.js";import"./error.7e8331f1.js";import"./scroll.0cf77af8.js";import"./index.f9c89813.js";import"./focus-trap.81e4fb05.js";import"./isNil.98bb3b88.js";import"./refs.d2253dd4.js";import"./event.776e7e11.js";/* empty css                                                                 */import"./plugin-vue_export-helper.21dcd24c.js";import"./index.f571dfc9.js";import"./index.158cdd11.js";import"./event.53b2ad83.js";import"./index.0c2ced08.js";import"./sortable.esm.a99254e8.js";import"./index.a9a077b4.js";import"./isEqual.2e410d13.js";import"./_baseIsEqual.0a4e01e5.js";import"./index.2e51d36e.js";import"./index.5b499f72.js";import"./logo-transparent.1566007e.js";import"./index.60799c00.js";import"./aria.75ec5909.js";import"./validator.9b0d789f.js";import"./index.c6488b3c.js";import"./debounce.730e1961.js";import"./toNumber.6efebd6a.js";import"./index.c93fe8e7.js";/* empty css                                                               */import"./plugin-vue_export-helper.41ffa612.js";import"./index.50c16ae5.js";import"./index.e3f90979.js";const z=S(!1);let G;const de=S(),B=S(),W=(u,m,a)=>V(void 0,null,function*(){return de.value=u,B.value=a,z.value=!0,G=new Pe,yield G.promise}),K=u=>{u?G.resolve():G.reject(),z.value=!1},Ae={class:"flex w-full"},Ge={class:"flex-1 flex gap-4 justify-center"},qe={class:"flex-1 flex gap-4 justify-center"},Qe={key:0,class:"flex p-8 gap-12"},Fe={class:"w-1/2 flex justify-center items-center rounded-normal border border-line"},Je=["src"],Ke={class:"w-1/2 flex justify-center items-center rounded-normal border border-line"},We=["src"],Xe=Y({props:{data:null,modelValue:{type:Boolean}},emits:["update:model-value"],setup(u,{emit:m}){const a=u,n=S(!0),s=je(()=>"remoteVersion"in a.data),{t:h}=O(),b=()=>V(this,null,function*(){s.value?yield ne(B.value,a.data.siteLogId,!0):yield se(B.value,a.data.currentSenderVersion,a.data.senderVersion,a.data.localLogId,!1),K(!0)}),C=()=>V(this,null,function*(){s.value?yield ne(B.value,a.data.siteLogId,!1):yield se(B.value,a.data.currentSenderVersion,a.data.senderVersion,a.data.localLogId,!0),K(!0)});return(d,r)=>{const $=Q,v=Ee;return k(),x(v,{modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=c=>n.value=c),width:"1200px","close-on-click-modal":!1,title:e(h)("common.versionConflict"),"destroy-on-close":"",onClosed:r[2]||(r[2]=c=>e(K)(!1))},{footer:o(()=>[l($,{round:"",onClick:b},{default:o(()=>[P(f(e(s)?e(h)("conflict.keepRemoteVersion"):e(h)("conflict.useRemoteVersion")),1)]),_:1}),l($,{type:"primary",round:"",onClick:C},{default:o(()=>[P(f(e(s)?e(h)("conflict.useLocalVersion"):e(h)("conflict.keepLocalVersion")),1)]),_:1})]),default:o(()=>[p("div",Ae,[p("div",Ge,[p("span",null,f(u.data.remoteUserName),1),p("span",null,f(e(U)(u.data.remoteTime)),1),p("span",null,f(e(h)("conflict.remote",{version:u.data.remoteVersion||u.data.senderVersion})),1)]),p("div",qe,[p("span",null,f(u.data.localUserName),1),p("span",null,f(e(U)(u.data.localTime)),1),p("span",null,f(e(h)("conflict.localReadOnly",{version:u.data.siteLogId||u.data.localLogId})),1)])]),u.data.hasConflict?(k(),L(H,{key:0},[u.data.isImage?(k(),L("div",Qe,[p("div",Fe,[p("img",{src:`data:image/png;base64, ${u.data.remoteBody}`},null,8,Je)]),p("div",Ke,[p("img",{src:`data:image/png;base64, ${u.data.localBody}`},null,8,We)])])):(k(),x(Ce,{key:1,modified:u.data.localBody,"onUpdate:modified":r[0]||(r[0]=c=>u.data.localBody=c),class:"w-full h-400px",original:u.data.remoteBody},null,8,["modified","original"]))],64)):N("",!0)]),_:1},8,["modelValue","title"])}}}),Ze={"data-cy":"name"},ea={"data-cy":"size"},aa={"data-cy":"last-modified"},ta={"data-cy":"username"},oa=Y({props:{conditions:null},setup(u,{expose:m}){const a=u,{t:n}=O(),s=S(),h=q("id");let b;const C=(v,c)=>V(this,null,function*(){let t=a.conditions;t.id=h,t.name=t.name.trim(),t.pageNr=c!=null?c:1,t.pageSize=50,s.value=yield Ve(t),v&&(b==null||b.close(),b=void 0)}),d=v=>V(this,null,function*(){yield A(n("common.pushConfirm")),$(),v=v.sort((t,I)=>t.id-I.id);try{for(const t of v){var c=yield ue(h,t.logId);c.hasConflict&&(yield W(c,!0,h))}}catch(t){console.log(t)}yield C(!0)}),r=v=>V(this,null,function*(){yield A(n("common.ignoreSiteLogConfirm")),yield xe(h,v.map(c=>c.logId)),yield C()});function $(){b||(b=me.service({background:"rgba(0, 0, 0, 0.5)"}))}return C(),m({load:C}),(v,c)=>{const t=Q,I=oe,T=ee,w=Z,j=X("hasPermission");return s.value?(k(),x(e(ae),{key:0,data:s.value.list,"show-check":"","hide-delete":"",pagination:{currentPage:s.value.pageNr,pageCount:s.value.totalPages,pageSize:s.value.pageSize},onChange:c[0]||(c[0]=g=>C(!0,g))},{bar:o(({selected:g})=>[g.length>0?M((k(),x(t,{key:0,class:"dark:bg-666",round:"","data-cy":"ignore",onClick:D=>r(g)},{default:o(()=>[P(f(e(n)("common.ignoreSelected")),1)]),_:2},1032,["onClick"])),[[j,{feature:"sync",action:"edit"}]]):N("",!0),g.length>0?M((k(),x(t,{key:1,class:"dark:bg-666",round:"","data-cy":"push",onClick:D=>d(g)},{default:o(()=>[P(f(e(n)("common.pushSelected")),1)]),_:2},1032,["onClick"])),[[j,{feature:"sync",action:"edit"}]]):N("",!0)]),default:o(()=>[l(I,{label:e(n)("common.logItem")},{default:o(({row:g})=>[p("span",Ze,f(g.name),1)]),_:1},8,["label"]),l(I,{label:e(n)("common.objectType"),width:"200px"},{default:o(({row:g})=>[l(T,{type:g.objectType},null,8,["type"])]),_:1},8,["label"]),l(I,{label:e(n)("common.action"),width:"120px"},{default:o(({row:g})=>[l(te,{type:g.changeType},null,8,["type"])]),_:1},8,["label"]),l(I,{label:e(n)("common.size"),width:"120px"},{default:o(({row:g})=>[p("span",ea,f(g.size),1)]),_:1},8,["label"]),l(I,{label:e(n)("common.lastModified"),align:"center"},{default:o(({row:g})=>[p("span",aa,f(e(U)(g.lastModified)),1)]),_:1},8,["label"]),l(I,{label:e(n)("common.user"),width:"150px"},{default:o(({row:g})=>[p("span",ta,f(g.user),1)]),_:1},8,["label"]),l(I,{align:"right",width:"80px"},{default:o(({row:g})=>[l(w,{icon:"icon-time",tip:e(n)("common.versions"),permission:{feature:"site",action:"log"},"data-cy":"versions",onClick:D=>v.$router.goLogVersions(g.keyHash,g.storeNameHash,g.tableNameHash)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data","pagination"])):N("",!0)}}}),la={"data-cy":"name"},na={"data-cy":"size"},sa={"data-cy":"last-modified"},ia={"data-cy":"user"},re=Y({props:{type:null,conditions:null},setup(u,{expose:m}){const a=u,n=S(),{t:s}=O(),h=q("id"),b=C=>V(this,null,function*(){let d=a.conditions;d.pageSize=30,d.SyncSettingId=h,d.pageNr=C,d.name=d.name.trim(),n.value=yield $e(a.type,d)});return b(),m({load:b}),(C,d)=>{var c;const r=oe,$=ee,v=Z;return n.value?(k(),x(e(ae),{key:0,data:(c=n.value)==null?void 0:c.list,pagination:{currentPage:n.value.pageNr,pageCount:n.value.totalPages,pageSize:n.value.pageSize},onChange:b},{default:o(()=>[l(r,{label:e(s)("common.logItem")},{default:o(({row:t})=>[p("span",la,f(t.name),1)]),_:1},8,["label"]),l(r,{label:e(s)("common.objectType"),width:"200px"},{default:o(({row:t})=>[l($,{type:t.objectType},null,8,["type"])]),_:1},8,["label"]),l(r,{label:e(s)("common.action"),width:"120px"},{default:o(({row:t})=>[l(te,{type:t.changeType},null,8,["type"])]),_:1},8,["label"]),l(r,{label:e(s)("common.size"),width:"120px"},{default:o(({row:t})=>[p("span",na,f(t.size),1)]),_:1},8,["label"]),l(r,{label:e(s)("common.lastModified"),width:"200px"},{default:o(({row:t})=>[p("span",sa,f(e(U)(t.lastModified)),1)]),_:1},8,["label"]),l(r,{label:e(s)("common.user"),width:"150px"},{default:o(({row:t})=>[p("span",ia,f(t.user),1)]),_:1},8,["label"]),l(r,{align:"right",width:"60px"},{default:o(({row:t})=>[l(v,{icon:"icon-time",tip:e(s)("common.versions"),permission:{feature:"site",action:"log"},"data-cy":"versions",onClick:I=>C.$router.goLogVersions(t.keyHash,t.storeNameHash,t.tableNameHash)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data","pagination"])):N("",!0)}}}),ca={"data-cy":"name"},ra={"data-cy":"size"},ua={"data-cy":"last-modified"},ma={"data-cy":"user"},da=Y({props:{conditions:null},setup(u,{expose:m}){const a=u,n=S(),{t:s}=O(),h=q("id"),b=d=>V(this,null,function*(){let r=a.conditions;r.SettingId=h,r.pageNr=d!=null?d:1,r.pageSize=30,n.value=yield Ie(r)});function C(d){return V(this,null,function*(){yield Te(h,d.map(r=>r.objectId)),b()})}return b(),m({load:b}),(d,r)=>{var T;const $=Q,v=oe,c=ee,t=Z,I=X("hasPermission");return n.value?(k(),x(e(ae),{key:0,"show-check":"",data:(T=n.value)==null?void 0:T.list,pagination:{currentPage:n.value.pageNr,pageCount:n.value.totalPages,pageSize:n.value.pageSize},"hide-delete":"",onChange:b},{bar:o(({selected:w})=>[w.length>0?M((k(),x($,{key:0,class:"dark:bg-666",round:"",onClick:j=>C(w)},{default:o(()=>[P(f(e(s)("common.undo")),1)]),_:2},1032,["onClick"])),[[I,{feature:"sync",action:"edit"}]]):N("",!0)]),default:o(()=>[l(v,{label:e(s)("common.logItem")},{default:o(({row:w})=>[p("span",ca,f(w.name),1)]),_:1},8,["label"]),l(v,{label:e(s)("common.objectType"),width:"200px"},{default:o(({row:w})=>[l(c,{type:w.objectType},null,8,["type"])]),_:1},8,["label"]),l(v,{label:e(s)("common.action"),width:"120px"},{default:o(({row:w})=>[l(te,{type:w.changeType},null,8,["type"])]),_:1},8,["label"]),l(v,{label:e(s)("common.size"),width:"120px"},{default:o(({row:w})=>[p("span",ra,f(w.size),1)]),_:1},8,["label"]),l(v,{label:e(s)("common.lastModified"),width:"200px"},{default:o(({row:w})=>[p("span",ua,f(e(U)(w.lastModified)),1)]),_:1},8,["label"]),l(v,{label:e(s)("common.user"),width:"150px"},{default:o(({row:w})=>[p("span",ma,f(w.user),1)]),_:1},8,["label"]),l(v,{align:"right",width:"60px"},{default:o(({row:w})=>[l(t,{icon:"icon-time",tip:e(s)("common.versions"),permission:{feature:"site",action:"log"},"data-cy":"versions",onClick:j=>d.$router.goLogVersions(w.keyHash,w.storeNameHash,w.tableNameHash)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data","pagination"])):N("",!0)}}}),pa={class:"flex space-x-16 mb-16 px-24"},fa={class:"relative"},va={class:"absolute top-6px right-24px z-50"},Vt=Y({setup(u){const{t:m}=O(),a=S({startDate:"",endDate:"",name:"",storeName:"",actionType:"",user:""}),n=S([a.value.startDate,a.value.endDate]),s=S(),h=S(),b=S(),C=S(),d={change:"local",pull:"in",push:"out",ignore:"ignore"},r=()=>V(this,null,function*(){s.value=yield Se($,d[c.value]),b.value=s.value.storeName,h.value=s.value.editType,C.value=s.value.user}),$=q("id"),v=[{value:"change",displayName:m("common.localChanges"),component:oa,conditions:a.value,tabInstance:null},{value:"pull",displayName:m("common.pullLogs"),component:re,type:"InItem",conditions:a.value,tabInstance:null},{value:"push",displayName:m("common.pushLogs"),component:re,type:"OutItem",conditions:a.value,tabInstance:null},{value:"ignore",displayName:m("common.ignoreLogs"),component:da,conditions:a.value,tabInstance:null}],c=S(v[0].value);let t;const I=()=>{c.value="pull"};ie(()=>a.value.name,()=>{a.value.name?w():T()}),ie(()=>c.value,()=>{j()});const T=()=>{var _;const y=(_=v.find(E=>E.value===c.value))==null?void 0:_.tabInstance;y&&y.load()},w=De(T,1e3);r();const j=()=>{n.value=["",""],Object.keys(a.value).forEach(y=>{y!=="name"&&(a.value[y]="")}),a.value.name?a.value.name="":T()},g=()=>{n.value&&n.value.some(y=>y!==null)?(a.value.startDate=n.value[0].toString(),a.value.endDate=n.value[1].toString()):(a.value.startDate="",a.value.endDate=""),T()};function D(){t||(t=me.service({background:"rgba(0, 0, 0, 0.5)"}))}const pe=()=>V(this,null,function*(){yield A(m("common.pullConfirm")),D(),yield ge()}),fe=()=>V(this,null,function*(){yield A(m("common.pushAllConfirm")),D(),yield ve()}),ve=()=>V(this,null,function*(){try{var y;do y=yield ue($),y.hasConflict&&(yield W(y,!0,$));while(!y.isFinish);c.value=="push"?T():c.value="push"}catch(_){_&&ce(_.message,!0)}t==null||t.close(),t=void 0}),ge=()=>V(this,null,function*(){try{let y;do y=yield Ne($,y==null?void 0:y.currentSenderVersion),y.hasConflict&&(yield W(y,!1,$));while(!y.isFinish);c.value=="pull"?T():c.value="pull"}catch(y){y&&ce(y.message,!0)}t==null||t.close(),t=void 0});return(y,_)=>{const E=Me,F=Ue,ye=Oe,_e=He,J=Q,he=Ye,be=Re,we=Xe,le=X("hasPermission");return k(),L("div",null,[l(Be,{class:"p-24","crumb-path":[{name:e(m)("common.sync"),route:{name:"sync"}},{name:e(m)("common.syncLogs")}]},null,8,["crumb-path"]),p("div",pa,[l(F,{modelValue:a.value.storeName,"onUpdate:modelValue":_[0]||(_[0]=i=>a.value.storeName=i),placeholder:e(m)("common.objectType"),class:"w-180px",clearable:"",onChange:T},{default:o(()=>[(k(!0),L(H,null,R(b.value,i=>(k(),x(E,{key:i.key,label:i.value,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(F,{modelValue:a.value.actionType,"onUpdate:modelValue":_[1]||(_[1]=i=>a.value.actionType=i),placeholder:e(m)("common.action"),class:"w-140px",clearable:"",onChange:T},{default:o(()=>[(k(!0),L(H,null,R(h.value,i=>(k(),x(E,{key:i.key,label:i.value,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(F,{modelValue:a.value.userId,"onUpdate:modelValue":_[2]||(_[2]=i=>a.value.userId=i),placeholder:e(m)("common.user"),clearable:"",class:"w-160px",onChange:T},{default:o(()=>[(k(!0),L(H,null,R(C.value,i=>(k(),x(E,{key:i.key,label:i.value,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(ye,{modelValue:n.value,"onUpdate:modelValue":_[3]||(_[3]=i=>n.value=i),type:"datetimerange","unlink-panels":!0,format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm","range-separator":e(m)("common.to"),"start-placeholder":e(m)("common.startTime"),"end-placeholder":e(m)("common.endTime"),class:"h-40px max-w-460px",editable:!1,onChange:g},null,8,["modelValue","range-separator","start-placeholder","end-placeholder"]),l(_e,{modelValue:a.value.name,"onUpdate:modelValue":_[4]||(_[4]=i=>a.value.name=i),placeholder:e(m)("common.logItem"),class:"w-300px h-10"},null,8,["modelValue","placeholder"]),l(J,{class:"rounded-full","data-cy":"clean",onClick:j},{default:o(()=>[P(f(e(m)("common.reset")),1)]),_:1})]),p("div",fa,[p("div",va,[M((k(),x(J,{round:"",class:"dark:bg-666","data-cy":"pushAll",onClick:_[5]||(_[5]=i=>fe())},{default:o(()=>[P(f(e(m)("common.push")),1)]),_:1})),[[le,{feature:"sync",action:"edit"}]]),M((k(),x(J,{round:"",class:"dark:bg-666","data-cy":"pull",onClick:_[6]||(_[6]=i=>pe())},{default:o(()=>[P(f(e(m)("common.pull")),1)]),_:1})),[[le,{feature:"sync",action:"edit"}]])]),l(be,{modelValue:c.value,"onUpdate:modelValue":_[7]||(_[7]=i=>c.value=i),onTabChange:r},{default:o(()=>[(k(),L(H,null,R(v,i=>l(he,{key:i.value,label:i.displayName,name:i.value},{default:o(()=>[c.value===i.value?(k(),x(ze(i.component),{key:0,ref_for:!0,ref:ke=>i.tabInstance=ke,type:i.type,conditions:i.conditions,onGoPull:I},null,8,["type","conditions"])):N("",!0)]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])]),e(z)?(k(),x(we,{key:0,modelValue:e(z),"onUpdate:modelValue":_[8]||(_[8]=i=>Le(z)?z.value=i:null),data:e(de)},null,8,["modelValue","data"])):N("",!0)])}}});export{Vt as default};
