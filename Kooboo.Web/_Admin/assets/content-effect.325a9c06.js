var A=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var M=(n,a,o)=>a in n?A(n,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[a]=o,b=(n,a)=>{for(var o in a||(a={}))Q.call(a,o)&&M(n,o,a[o]);if(I)for(var o of I(a))U.call(a,o)&&M(n,o,a[o]);return n},j=(n,a)=>G(n,H(a));var w=(n,a,o)=>new Promise((h,y)=>{var S=u=>{try{g(o.next(u))}catch(l){y(l)}},m=u=>{try{g(o.throw(u))}catch(l){y(l)}},g=u=>u.done?h(u.value):Promise.resolve(u.value).then(S,m);g((o=o.apply(n,a)).next())});import{S as W,g as X}from"./textContent.585a78c7.js";import{g as f,cd as Y,M as Z,E as z,i as ee,ch as te}from"./url.2e6a77c4.js";import{d as D}from"./dayjs.min.0a66969b.js";import{u as oe}from"./use-date.01b82ce0.js";import{c as C}from"./index.4a51c2b7.js";import{o as re}from"./omitBy.c7280540.js";import{i as se}from"./isEmpty.dc565ae5.js";function pe(n,a,o){const h=f([]),y=f([]),S=f(!1),m=f([]),g=Y(),u=Z(),l=z({currentPage:1,pageCount:0,pageSize:30}),O=f(""),x=f(""),q=f({}),B=f([]),c=f({prop:"",order:"ascending"});function P(){return w(this,null,function*(){O.value=x.value.trim(),yield E(1,l.pageSize)})}const K=te(P,1e3);ee(()=>x.value,()=>{K()});function N(r,t,e){const d=re(q.value,s=>se(s));if(O.value){const s={folderId:n,pageNr:r,pageSize:t!=null?t:30,keyword:O.value,categories:d,exclude:e};return c.value.prop&&(s.sortField=c.value.prop,s.ascending=c.value.order==="ascending"),W(s)}else{const s={folderId:n,pageNr:r,pageSize:t!=null?t:30,categories:d,exclude:e};return c.value.prop&&(s.sortField=c.value.prop,s.ascending=c.value.order==="ascending"),X(s)}}function E(r,t){return w(this,null,function*(){var d,s,i,p;r||(r=+((d=u.query.pageNr)!=null?d:1));const e=yield N(r,(s=t!=null?t:l.pageSize)!=null?s:30,o);B.value=(i=e.categories)!=null?i:[],m.value=((p=e.columns)!=null?p:[]).map(v=>(v.name=C(v.name),v)),y.value=e.list,R(e.list,m.value),l.currentPage=e.pageNr,l.pageCount=e.totalPages,l.pageSize=e.pageSize,a||g.replace({query:j(b({},u.query),{pageNr:r})})})}function R(r,t){h.value=r.map(e=>{const d={id:e.id,online:e.online,lastModified:e.lastModified,usedBy:e.usedBy,order:e.order};for(const s in e.textValues){let i=e.textValues[s];const p=t.find(v=>v.name==C(s));if(p!=null&&p.selectionOptions)try{const v=JSON.parse(p.selectionOptions);let T=[i];p.controlType=="CheckBox"&&(T=JSON.parse(i));const k=[];for(const V of T){const F=v.find($=>$.value==V);F?k.push(F.key):k.push(V)}i=k.join(",")}catch(v){}d[C(s)]=i,i&&D(i).isValid()&&i===D(i).toISOString()&&(d[C(s)]=oe(i))}return d}),S.value=!0}function J(){const{SiteId:r,folder:t}=u.query;return`${r}_TextContent_${t}`}function _(r){return w(this,null,function*(){var t;c.value.prop=(t=r.prop)!=null?t:"",c.value.order=r.order,localStorage.setItem(J(),JSON.stringify(c.value)),yield P()})}function L(){const r=localStorage.getItem(J());if(r){const{prop:t,order:e}=JSON.parse(r);c.value.prop=t,c.value.order=e}}return L(),{keywords:x,currentKeyword:O,pagination:l,list:h,rawList:y,columns:m,fetchList:E,columnLoaded:S,sortSetting:c,searchCategories:q,categoryOptions:B,onSortChanged:_,initSortSetting:L}}export{pe as u};
