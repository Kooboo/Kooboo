var N=(b,r,a)=>new Promise((e,n)=>{var f=c=>{try{u(a.next(c))}catch(L){n(L)}},p=c=>{try{u(a.throw(c))}catch(L){n(L)}},u=c=>c.done?e(c.value):Promise.resolve(c.value).then(f,p);u((a=a.apply(b,r)).next())});import{g as W,w as j,v as fe}from"./i18n.a87944a4.js";import{a as K}from"./replace-all.56d2c1f7.js";import{d as D,u as X,h as ve,b as le,k as G}from"./main.9fdfea92.js";import{_ as H}from"./k-table.b1a54b80.js";import{d as R,g as S,o as i,a as x,b as l,w as s,u as t,f as d,k as I,j as h,i as F,t as v,F as M,aI as P,cn as oe,A as ee,b7 as J,aA as se,e as _e,l as ge}from"./url.4cb47a7a.js";import{u as te}from"./use-date.f1258183.js";import{_ as ae}from"./index.f0d5f031.js";import{E as be}from"./index.42922617.js";import{E as ye}from"./index.6f16842c.js";import{E as ke,a as ne}from"./index.9fd79879.js";import{E as Le}from"./index.178b9e08.js";import{E as he}from"./index.79632b7d.js";import{E as ie}from"./index.c003dfa1.js";import{l as Se,b as $e,s as we}from"./request-access-limit.04cb7c98.js";import{E as Z}from"./index.b38edc72.js";import{c as Q,E as xe,a as Ve}from"./index.7c862087.js";import{E as re}from"./index.fd96ea36.js";import{E as ue}from"./index.bec063d7.js";import{E as ce}from"./windi.6360286d.js";import{E as me}from"./index.d96452a6.js";import{_ as Ie}from"./chart-js.aa2b427a.js";import{B as Ae}from"./breadcrumb.f4d80c95.js";import{E as Ce,a as Ee}from"./index.4d2ce883.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./sortable.esm.a99254e8.js";import"./icon-button.74ccc970.js";import"./index.361e2245.js";import"./index.7b8c5aef.js";import"./index.4f90a917.js";import"./index.4d568055.js";import"./index.c6da2706.js";import"./isEqual.4cab74e3.js";import"./_baseIsEqual.dc9e64c4.js";import"./error.7e8331f1.js";import"./index.f15f695e.js";import"./event.776e7e11.js";import"./dayjs.min.ccc40d4f.js";import"./isNil.98bb3b88.js";import"./index.e3f90979.js";import"./event.53b2ad83.js";import"./_baseClone.b8903935.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./focus-trap.50a00b7f.js";import"./refs.3132cbdb.js";import"./tooltip.66155ff7.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./index.6918f0a5.js";import"./validator.b5df2420.js";import"./list-editor.97a4c003.js";import"./index.7df1cda1.js";import"./debounce.4e0c106e.js";import"./toNumber.47eea968.js";import"./index.66319a92.js";import"./dropdown.86d3a7fb.js";import"./dark.9459c47b.js";import"./cloneDeep.c5011aa2.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";const Te=()=>D.get(K("VisitorLog/WeekNames")),Ue=b=>D.get(K("VisitorLog/TopPages"),{weekname:b}),Pe=b=>D.get(K("VisitorLog/TopBots"),{weekname:b}),ze=b=>D.get(K("VisitorLog/TopReferer"),{weekname:b}),Be=b=>D.get(K("VisitorLog/TopImages"),{weekname:b}),Ne=()=>D.get(K("VisitorLog/Monthly")),Re=(b,r)=>D.get(K("VisitorLog/errors"),{weekname:b,pageNr:r}),We=(b,r)=>D.get(K("VisitorLog/list"),{weekname:b,pageNr:r}),Ke=(b,r)=>D.get(K("VisitorLog/BotList"),{weekname:b,pageNr:r}),De={key:0,class:"pl-12 w-full"},Oe={key:0,class:"grid grid-cols-2"},qe={class:"space-y-4"},je={key:1,class:"grid grid-cols-2"},Fe={key:1,class:"pl-12 w-full"},Me={class:"pl-12 w-full"},He={class:"space-y-4"},de=R({props:{visitorLog:null},emits:["reload","update:modelValue"],setup(b,{emit:r}){const a=b,e=X(),{t:n}=W(),f=S(!0),p=S({permitLimit:10,withinSeconds:3}),u=S({permitLimit:10,withinSeconds:3}),c=S(e.site.accessLimitSettings.ipBlacklist.some(w=>w==a.visitorLog.clientIP)),L=e.site.rateLimitSettings.ipLimits[a.visitorLog.clientIP],U=S(!!L);L&&(p.value.permitLimit=L.permitLimit,p.value.withinSeconds=L.withinSeconds);const A=S(a.visitorLog.userAgent),V=S(a.visitorLog.userAgent),$=e.site.accessLimitSettings.blockUserAgentKeywords.find(w=>a.visitorLog.userAgent.indexOf(w)>-1),m=Object.keys(e.site.rateLimitSettings.userAgentLimits).find(w=>a.visitorLog.userAgent.indexOf(w)>-1);$&&(A.value=$),m&&(V.value=m,u.value.permitLimit=e.site.rateLimitSettings.userAgentLimits[m].permitLimit,u.value.withinSeconds=e.site.rateLimitSettings.userAgentLimits[m].withinSeconds);const _=S(!!$),k=S(!!m),E=()=>N(this,null,function*(){c.value&&!e.site.accessLimitSettings.ipBlacklist.find(w=>w==a.visitorLog.clientIP)?(e.site.accessLimitSettings.ipBlacklist.push(a.visitorLog.clientIP),e.site.accessLimitSettings.enable=!0):c.value||(e.site.accessLimitSettings.ipBlacklist=e.site.accessLimitSettings.ipBlacklist.filter(w=>w!=a.visitorLog.clientIP)),U.value?(e.site.rateLimitSettings.ipLimits[a.visitorLog.clientIP]=p.value,e.site.rateLimitSettings.enable=!0):delete e.site.rateLimitSettings.ipLimits[a.visitorLog.clientIP],_.value&&A.value&&!e.site.accessLimitSettings.blockUserAgentKeywords.find(w=>w==A.value)?(e.site.accessLimitSettings.blockUserAgentKeywords.push(A.value),e.site.accessLimitSettings.enable=!0):_.value||(e.site.accessLimitSettings.blockUserAgentKeywords=e.site.accessLimitSettings.blockUserAgentKeywords.filter(w=>w!=A.value)),k.value&&V.value?(e.site.rateLimitSettings.userAgentLimits[V.value]=u.value,e.site.rateLimitSettings.enable=!0):delete e.site.rateLimitSettings.userAgentLimits[V.value],f.value=!1,r("reload"),yield ve(e.site),e.loadSite()});return(w,y)=>{const O=be,z=ye,B=ke,q=Le,T=he,o=ne,C=ie;return i(),x("div",null,[l(C,{"model-value":f.value,width:"600px","close-on-click-modal":!1,title:t(n)("common.accessLimitSettings"),onClosed:y[11]||(y[11]=g=>r("update:modelValue",!1))},{footer:s(()=>[l(ae,{"confirm-label":t(n)("common.save"),onConfirm:E,onCancel:y[10]||(y[10]=g=>f.value=!1)},null,8,["confirm-label"])]),default:s(()=>[l(o,{"label-position":"top"},{default:s(()=>[l(B,{label:t(n)("common.rateLimit")},{default:s(()=>[t(e).site.rateLimitSettings.limitAllRequest?(i(),x("div",Fe,[l(T,{title:t(n)("commmon.limitAllRequestTip"),type:"warning",closable:!1},null,8,["title"])])):(i(),x("div",De,[d("div",null,[l(O,{modelValue:U.value,"onUpdate:modelValue":y[0]||(y[0]=g=>U.value=g),label:`${t(n)("common.limit")} ${b.visitorLog.clientIP} ${t(n)("common.request")}`},null,8,["modelValue","label"]),U.value?(i(),x("div",Oe,[l(B,{label:t(n)("common.withinSeconds")},{default:s(()=>[l(z,{modelValue:p.value.withinSeconds,"onUpdate:modelValue":y[1]||(y[1]=g=>p.value.withinSeconds=g),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(B,{label:t(n)("common.permitLimit")},{default:s(()=>[l(z,{modelValue:p.value.permitLimit,"onUpdate:modelValue":y[2]||(y[2]=g=>p.value.permitLimit=g),min:1},null,8,["modelValue"])]),_:1},8,["label"])])):I("",!0)]),d("div",qe,[l(O,{modelValue:k.value,"onUpdate:modelValue":y[3]||(y[3]=g=>k.value=g),label:`${t(n)("common.limit")} ${t(n)("common.userAgent")}`},null,8,["modelValue","label"]),k.value?(i(),h(q,{key:0,modelValue:V.value,"onUpdate:modelValue":y[4]||(y[4]=g=>V.value=g),modelModifiers:{trim:!0},type:"textarea",rows:3},null,8,["modelValue"])):I("",!0),k.value?(i(),x("div",je,[l(B,{label:t(n)("common.withinSeconds")},{default:s(()=>[l(z,{modelValue:u.value.withinSeconds,"onUpdate:modelValue":y[5]||(y[5]=g=>u.value.withinSeconds=g),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(B,{label:t(n)("common.permitLimit")},{default:s(()=>[l(z,{modelValue:u.value.permitLimit,"onUpdate:modelValue":y[6]||(y[6]=g=>u.value.permitLimit=g),min:1},null,8,["modelValue"])]),_:1},8,["label"])])):I("",!0)])]))]),_:1},8,["label"]),l(B,{label:t(n)("common.forbidden")},{default:s(()=>[d("div",Me,[d("div",null,[l(O,{modelValue:c.value,"onUpdate:modelValue":y[7]||(y[7]=g=>c.value=g),label:`${t(n)("common.forbidden")} ${b.visitorLog.clientIP} ${t(n)("common.request")}`},null,8,["modelValue","label"])]),d("div",He,[l(O,{modelValue:_.value,"onUpdate:modelValue":y[8]||(y[8]=g=>_.value=g),label:`${t(n)("common.forbidden")} ${t(n)("common.userAgent")}`},null,8,["modelValue","label"]),_.value?(i(),h(q,{key:0,modelValue:A.value,"onUpdate:modelValue":y[9]||(y[9]=g=>A.value=g),modelModifiers:{trim:!0},type:"textarea",rows:3},null,8,["modelValue"])):I("",!0)])])]),_:1},8,["label"])]),_:1})]),_:1},8,["model-value","title"])])}}}),pe=R({emits:["update:modelValue"],setup(b,{emit:r}){Se();const{t:a}=W(),e=S(!0),n=()=>N(this,null,function*(){e.value=!1,we()});return(f,p)=>{const u=ne,c=ie;return i(),x("div",null,[l(c,{"model-value":e.value,width:"600px","close-on-click-modal":!1,title:t(a)("common.requestAccessLimit"),onClosed:p[1]||(p[1]=L=>r("update:modelValue",!1))},{footer:s(()=>[l(ae,{"confirm-label":t(a)("common.save"),onConfirm:n,onCancel:p[0]||(p[0]=L=>e.value=!1)},null,8,["confirm-label"])]),default:s(()=>[l(u,{"label-position":"top"},{default:s(()=>[l($e)]),_:1})]),_:1},8,["model-value","title"])])}}}),Ze={"data-cy":"ip"},Ge=["title","href"],Je={"data-cy":"start-time"},Qe={class:"space-y-4"},Xe={key:0},Ye={class:"mr-4"},et={class:"mr-4"},tt={key:1},lt=["title"],ot={key:0,class:"text-s flex space-x-4 items-center"},st=["title"],at=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S(),n=X(),f=le(),p=S(!1),u=S(!1),c=S(),L=m=>N(this,null,function*(){e.value=yield We(r.week,m)}),U=m=>oe(ee(n.site.baseUrl,m));function A(m){var _,k,E,w,y;return`${m.clientInfo.os||""} ${((_=m.clientInfo)==null?void 0:_.platform)||""} ${((E=(k=m.clientInfo)==null?void 0:k.application)==null?void 0:E.name)||""} ${((y=(w=m.clientInfo)==null?void 0:w.application)==null?void 0:y.version)||""} ${(m==null?void 0:m.userAgent)||""}`}function V(m){if(!n.site.accessLimitSettings.enable)return!1;if(n.site.accessLimitSettings.ipBlacklist.includes(m.clientIP))return!0;for(const _ of n.site.accessLimitSettings.blockUserAgentKeywords)if(m.userAgent.indexOf(_)>-1)return!0;return!1}function $(m){if(!n.site.rateLimitSettings.enable)return!1;if(n.site.rateLimitSettings.limitAllRequest||n.site.rateLimitSettings.ipLimits[m.clientIP])return!0;for(const _ of Object.keys(n.site.rateLimitSettings.userAgentLimits))if(m.userAgent.indexOf(_)>-1)return!0;return!1}return F(()=>r.week,m=>{m&&L(1)},{immediate:!0}),(m,_)=>{var q;const k=Z,E=Q,w=re,y=ue,O=Q,z=ce,B=me;return i(),x("div",null,[e.value?(i(),h(t(H),{key:0,data:(q=e.value)==null?void 0:q.list,pagination:{currentPage:e.value.pageNr,pageCount:e.value.totalPages,pageSize:e.value.pageSize},onChange:L},{default:s(()=>{var T;return[l(k,{label:"IP",width:"140"},{default:s(({row:o})=>[d("span",Ze,v(o.clientIP),1)]),_:1}),(T=t(f).header)!=null&&T.isOnlineServer?(i(),x(M,{key:0},[l(k,{label:t(a)("common.state")},{default:s(({row:o})=>[o.state?(i(),h(E,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"state"},{default:s(()=>[P(v(o.state),1)]),_:2},1024)):I("",!0)]),_:1},8,["label"]),l(k,{label:t(a)("common.country")},{default:s(({row:o})=>[o.country?(i(),h(E,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"country"},{default:s(()=>[P(v(o.country),1)]),_:2},1024)):I("",!0)]),_:1},8,["label"])],64)):I("",!0),l(k,{label:t(a)("common.page")},{default:s(({row:o})=>[d("a",{title:o.url,class:"text-blue ellipsis",href:U(o.url),target:"_blank","data-cy":"page-url"},v(o.url),9,Ge)]),_:1},8,["label"]),l(k,{label:t(a)("common.startTime"),width:"180"},{default:s(({row:o})=>[d("span",Je,v(t(te)(o.begin)),1)]),_:1},8,["label"]),l(k,{label:t(a)("common.timeElapsed")},{default:s(({row:o})=>[l(y,{width:"auto",trigger:"hover",placement:"right","popper-style":"padding: 0;"},{reference:s(()=>[o.timeSpan?(i(),h(E,{key:0,type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(o.timeSpan)+" ms ",1)]),_:2},1024)):I("",!0)]),default:s(()=>[l(w,{"max-height":"98vh","view-style":"padding: 12px;"},{default:s(()=>{var C;return[d("div",Qe,[(C=o.entries)!=null&&C.length?(i(),x("table",Xe,[d("tbody",null,[(i(!0),x(M,null,J(o.entries,(g,Y)=>(i(),x("tr",{key:Y},[d("td",null,[d("span",Ye,v(g.name),1)]),d("td",null,[d("span",et,v(g.value),1)]),d("td",null,[l(E,{type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(new Date(g.endTime).getTime()-new Date(g.startTime).getTime())+" ms ",1)]),_:2},1024)])]))),128))])])):(i(),x("div",tt,v(t(a)("common.empty")),1))])]}),_:2},1024)]),_:2},1024)]),_:1},8,["label"]),l(k,{label:t(a)("common.referer")},{default:s(({row:o})=>[d("div",{class:"ellipsis",title:o.referer},v(o.refererHost),9,lt)]),_:1},8,["label"]),l(k,{label:t(a)("common.clientInfo")},{default:s(({row:o})=>{var C,g;return[o.clientInfo?(i(),x("div",ot,[(g=(C=o.clientInfo)==null?void 0:C.application)!=null&&g.isWebBrowser?(i(),h(O,{key:0,round:"",size:"small"},{default:s(()=>[P(v(t(a)("common.webBrowser")),1)]),_:1})):I("",!0),d("div",{class:"ellipsis",title:A(o)},v(A(o)),9,st)])):I("",!0)]}),_:1},8,["label"]),l(k,{label:t(a)("common.size"),width:"120"},{default:s(({row:o})=>[d("span",null,v(t(G)(o.size)),1)]),_:1},8,["label"]),l(k,{width:"48"},{header:s(()=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[l(z,{class:"iconfont icon-a-setup hover:text-blue text-l","data-cy":"inline-editor",onClick:_[0]||(_[0]=j(o=>u.value=!0,["prevent"]))})]),_:1},8,["content"])]),default:s(({row:o})=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[V(o)?(i(),h(z,{key:0,class:"iconfont icon-delete4 text-orange text-l",onClick:j(C=>{c.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):$(o)?(i(),h(z,{key:1,class:"iconfont icon-Tips text-[#e6a23c] text-l",onClick:j(C=>{c.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):(i(),h(z,{key:2,class:"iconfont icon-a-setup hover:text-blue text-l",onClick:j(C=>{c.value=o,p.value=!0},["prevent"])},null,8,["onClick"]))]),_:2},1032,["content"])]),_:1})]}),_:1},8,["data","pagination"])):I("",!0),(i(),h(se,{to:"body"},[d("div",null,[p.value&&e.value?(i(),h(de,{key:0,modelValue:p.value,"onUpdate:modelValue":_[1]||(_[1]=T=>p.value=T),"visitor-log":c.value,onReload:_[2]||(_[2]=T=>L(e.value.pageNr))},null,8,["modelValue","visitor-log"])):I("",!0)]),d("div",null,[u.value?(i(),h(pe,{key:0,modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=T=>u.value=T)},null,8,["modelValue"])):I("",!0)])]))])}}}),nt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=()=>N(this,null,function*(){e.value=yield Ue(r.week)});return F(()=>r.week,f=>{f&&n()},{immediate:!0}),(f,p)=>{const u=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(u,{label:t(a)("common.name")},{default:s(({row:c})=>[P(v(c.name),1)]),_:1},8,["label"]),l(u,{label:t(a)("common.size")},{default:s(({row:c})=>[P(v(t(G)(c.size)),1)]),_:1},8,["label"]),l(u,{label:t(a)("visitorLog.views"),prop:"count"},null,8,["label"])]),_:1},8,["data"])}}}),it=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=()=>N(this,null,function*(){e.value=yield ze(r.week)});return F(()=>r.week,f=>{f&&n()},{immediate:!0}),(f,p)=>{const u=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(u,{label:"URL",prop:"name"}),l(u,{label:t(a)("visitorLog.views"),prop:"count"},null,8,["label"])]),_:1},8,["data"])}}}),rt={class:"flex items-center"},ut={class:"w-80px h-44px mr-24 flex items-center justify-center"},ct=["src"],mt=["title"],dt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=X(),f=()=>N(this,null,function*(){e.value=yield Be(r.week)});return F(()=>r.week,p=>{p&&f()},{immediate:!0}),(p,u)=>{const c=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(c,{label:"URL"},{default:s(({row:L})=>[d("div",rt,[d("div",ut,[d("img",{src:t(ee)(t(n).site.baseUrl,L.thumbNail)},null,8,ct)]),d("span",{class:"text-l font-bold flex-1 ellipsis",title:L.name},v(L.name),9,mt)])]),_:1}),l(c,{label:t(a)("common.size")},{default:s(({row:L})=>[P(v(t(G)(L.size)),1)]),_:1},8,["label"]),l(c,{label:t(a)("visitorLog.views"),prop:"count",width:"100px",align:"center"},null,8,["label"])]),_:1},8,["data"])}}}),pt={class:"p-16 rounded-normal bg-fff dark:bg-444"},ft=R({setup(b){const r=S([]),a=S(!1),e=S({type:"bar",data:{labels:[],datasets:[{label:"PV",data:[],backgroundColor:["rgb(54, 162, 235,0.6)"]}]},options:{scales:{y:{beginAtZero:!0}}}});return(()=>N(this,null,function*(){if(r.value=yield Ne(),r.value.length<16)for(let f=0;f<16-r.value.length;f++)e.value.data.labels.push(""),e.value.data.datasets[0].data.push(0);e.value.data.labels.push(...r.value.map(f=>f.name)),e.value.data.datasets[0].data.push(...r.value.map(f=>f.count)),a.value=!0}))(),(f,p)=>(i(),x("div",pt,[d("div",null,[l(Ie,{height:"180",options:e.value},null,8,["options"])])]))}}),vt={"data-cy":"ip"},_t=["href"],gt={"data-cy":"start-time"},bt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S(),n=f=>N(this,null,function*(){e.value=yield Re(r.week,f)});return F(()=>r.week,f=>{f&&n(1)},{immediate:!0}),(f,p)=>{var c,L,U,A;const u=Z;return i(),h(t(H),{data:(c=e.value)==null?void 0:c.dataList,pagination:{currentPage:(L=e.value)==null?void 0:L.pageNr,pageCount:(U=e.value)==null?void 0:U.totalPages,pageSize:(A=e.value)==null?void 0:A.pageSize},onChange:n},{default:s(()=>[l(u,{label:"IP",width:"140"},{default:s(({row:V})=>[d("span",vt,v(V.clientIP),1)]),_:1}),l(u,{label:"URL"},{default:s(({row:V})=>[d("a",{class:"text-blue ellipsis",href:V.previewUrl,target:"_blank"},v(V.url),9,_t)]),_:1}),l(u,{label:t(a)("common.startTime"),width:"180"},{default:s(({row:V})=>[d("span",gt,v(t(te)(V.startTime)),1)]),_:1},8,["label"]),l(u,{label:t(a)("common.message"),prop:"message"},null,8,["label"]),l(u,{label:t(a)("common.status"),prop:"statusCode"},null,8,["label"])]),_:1},8,["data","pagination"])}}}),yt={"data-cy":"ip"},kt=["title","href"],Lt={"data-cy":"start-time"},ht={class:"space-y-4"},St={key:0},$t={class:"mr-4"},wt={class:"mr-4"},xt={key:1},Vt=["title"],It={key:0,class:"text-s flex space-x-4 items-center"},At=["title"],Ct=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S(),n=X(),f=le(),p=S(!1),u=S(!1),c=S(),L=m=>N(this,null,function*(){e.value=yield Ke(r.week,m)}),U=m=>oe(ee(n.site.baseUrl,m));function A(m){var _,k,E,w,y;return`${m.clientInfo.os||""} ${((_=m.clientInfo)==null?void 0:_.platform)||""} ${((E=(k=m.clientInfo)==null?void 0:k.application)==null?void 0:E.name)||""} ${((y=(w=m.clientInfo)==null?void 0:w.application)==null?void 0:y.version)||""} ${(m==null?void 0:m.userAgent)||""}`}function V(m){if(!n.site.accessLimitSettings.enable)return!1;if(n.site.accessLimitSettings.ipBlacklist.includes(m.clientIP))return!0;for(const _ of n.site.accessLimitSettings.blockUserAgentKeywords)if(m.userAgent.indexOf(_)>-1)return!0;return!1}function $(m){if(!n.site.rateLimitSettings.enable)return!1;if(n.site.rateLimitSettings.limitAllRequest||n.site.rateLimitSettings.ipLimits[m.clientIP])return!0;for(const _ of Object.keys(n.site.rateLimitSettings.userAgentLimits))if(m.userAgent.indexOf(_)>-1)return!0;return!1}return F(()=>r.week,m=>{m&&L(1)},{immediate:!0}),(m,_)=>{var q;const k=Z,E=Q,w=re,y=ue,O=Q,z=ce,B=me;return i(),x(M,null,[e.value?(i(),h(t(H),{key:0,data:(q=e.value)==null?void 0:q.list,pagination:{currentPage:e.value.pageNr,pageCount:e.value.totalPages,pageSize:e.value.pageSize},onChange:L},{default:s(()=>{var T;return[l(k,{label:"IP",width:"140"},{default:s(({row:o})=>[d("span",yt,v(o.clientIP),1)]),_:1}),(T=t(f).header)!=null&&T.isOnlineServer?(i(),x(M,{key:0},[l(k,{label:t(a)("common.state")},{default:s(({row:o})=>[o.state?(i(),h(E,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"state"},{default:s(()=>[P(v(o.state),1)]),_:2},1024)):I("",!0)]),_:1},8,["label"]),l(k,{label:t(a)("common.country")},{default:s(({row:o})=>[o.country?(i(),h(E,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"country"},{default:s(()=>[P(v(o.country),1)]),_:2},1024)):I("",!0)]),_:1},8,["label"])],64)):I("",!0),l(k,{label:t(a)("common.page")},{default:s(({row:o})=>[d("a",{title:o.url,class:"text-blue ellipsis",href:U(o.url),target:"_blank","data-cy":"page-url"},v(o.url),9,kt)]),_:1},8,["label"]),l(k,{label:t(a)("common.startTime"),width:"180"},{default:s(({row:o})=>[d("span",Lt,v(t(te)(o.begin)),1)]),_:1},8,["label"]),l(k,{label:t(a)("common.timeElapsed")},{default:s(({row:o})=>[l(y,{width:"auto",trigger:"hover",placement:"right","popper-style":"padding: 0;"},{reference:s(()=>[o.timeSpan?(i(),h(E,{key:0,type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(o.timeSpan)+" ms ",1)]),_:2},1024)):I("",!0)]),default:s(()=>[l(w,{"max-height":"98vh","view-style":"padding: 12px;"},{default:s(()=>{var C;return[d("div",ht,[(C=o.entries)!=null&&C.length?(i(),x("table",St,[d("tbody",null,[(i(!0),x(M,null,J(o.entries,(g,Y)=>(i(),x("tr",{key:Y},[d("td",null,[d("span",$t,v(g.name),1)]),d("td",null,[d("span",wt,v(g.value),1)]),d("td",null,[l(E,{type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(new Date(g.endTime).getTime()-new Date(g.startTime).getTime())+" ms ",1)]),_:2},1024)])]))),128))])])):(i(),x("div",xt,v(t(a)("common.empty")),1))])]}),_:2},1024)]),_:2},1024)]),_:1},8,["label"]),l(k,{label:t(a)("common.referer")},{default:s(({row:o})=>[d("div",{class:"ellipsis",title:o.referer},v(o.refererHost),9,Vt)]),_:1},8,["label"]),l(k,{label:t(a)("common.clientInfo")},{default:s(({row:o})=>{var C,g;return[o.clientInfo?(i(),x("div",It,[(g=(C=o.clientInfo)==null?void 0:C.application)!=null&&g.isWebBrowser?(i(),h(O,{key:0,round:"",size:"small"},{default:s(()=>[P(v(t(a)("common.webBrowser")),1)]),_:1})):I("",!0),d("div",{class:"ellipsis",title:A(o)},v(A(o)),9,At)])):I("",!0)]}),_:1},8,["label"]),l(k,{label:t(a)("common.size"),width:"120"},{default:s(({row:o})=>[d("span",null,v(t(G)(o.size)),1)]),_:1},8,["label"]),l(k,{width:"48"},{header:s(()=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[l(z,{class:"iconfont icon-a-setup hover:text-blue text-l","data-cy":"inline-editor",onClick:_[0]||(_[0]=j(o=>u.value=!0,["prevent"]))})]),_:1},8,["content"])]),default:s(({row:o})=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[V(o)?(i(),h(z,{key:0,class:"iconfont icon-delete4 text-orange text-l",onClick:j(C=>{c.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):$(o)?(i(),h(z,{key:1,class:"iconfont icon-Tips text-[#e6a23c] text-l",onClick:j(C=>{c.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):(i(),h(z,{key:2,class:"iconfont icon-a-setup hover:text-blue text-l",onClick:j(C=>{c.value=o,p.value=!0},["prevent"])},null,8,["onClick"]))]),_:2},1032,["content"])]),_:1})]}),_:1},8,["data","pagination"])):I("",!0),d("div",null,[(i(),h(se,{to:"body"},[d("div",null,[p.value&&e.value?(i(),h(de,{key:0,modelValue:p.value,"onUpdate:modelValue":_[1]||(_[1]=T=>p.value=T),"visitor-log":c.value,onReload:_[2]||(_[2]=T=>L(e.value.pageNr))},null,8,["modelValue","visitor-log"])):I("",!0)]),d("div",null,[u.value?(i(),h(pe,{key:0,modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=T=>u.value=T)},null,8,["modelValue"])):I("",!0)])]))])],64)}}}),Et=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=()=>N(this,null,function*(){e.value=yield Pe(r.week)});return F(()=>r.week,f=>{f&&n()},{immediate:!0}),(f,p)=>{const u=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(u,{label:t(a)("common.name")},{default:s(({row:c})=>[P(v(c.name),1)]),_:1},8,["label"]),l(u,{label:t(a)("common.size")},{default:s(({row:c})=>[P(v(t(G)(c.size)),1)]),_:1},8,["label"]),l(u,{label:t(a)("visitorLog.views"),prop:"count"},null,8,["label"])]),_:1},8,["data"])}}}),Tt={class:"p-24"},Ut={class:"absolute top-16 right-24"},Pt={class:"text-black dark:text-fff/86 mr-12"},Ml=R({setup(b){const{t:r}=W(),a=S([]),e=S(),n=S(!0);Te().then(u=>{var c;a.value=u.sort((L,U)=>{const A=L.key.split("-").map($=>parseInt($)),V=U.key.split("-").map($=>parseInt($));return A[0]===V[0]?V[1]-A[1]:V[0]-A[0]}),e.value=(c=u[0])==null?void 0:c.key});const f=[{displayName:r("common.visitors"),value:"All",component:at,showWeek:!0},{displayName:r("common.topPages"),value:"topPages",component:nt,showWeek:!0},{displayName:r("common.topReferer"),value:"topReferer",component:it,showWeek:!0},{displayName:r("common.topImages"),value:"topImages",component:dt,showWeek:!0},{displayName:r("common.chart"),value:"chart",component:ft,showWeek:!1},{displayName:r("common.errorList"),value:"errorList",component:bt,showWeek:!0},{displayName:r("common.bots"),value:"botList",component:Ct,showWeek:!0},{displayName:r("common.topBots"),value:"topBots",component:Et,showWeek:!0}],p=S(f[0].value);return F(()=>p.value,()=>{n.value=f.find(u=>u.value===p.value).showWeek}),(u,c)=>{const L=xe,U=Ve,A=Ce,V=Ee;return i(),x("div",null,[d("div",Tt,[l(Ae,{name:t(r)("common.visitorLogs")},null,8,["name"]),_e(d("div",Ut,[d("span",Pt,v(t(r)("common.week")),1),l(U,{modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=$=>e.value=$),class:"w-240px"},{default:s(()=>[(i(!0),x(M,null,J(a.value,$=>(i(),h(L,{key:$.key,value:$.key,label:$.value,"data-cy":"week-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])],512),[[fe,n.value]])]),l(V,{modelValue:p.value,"onUpdate:modelValue":c[1]||(c[1]=$=>p.value=$)},{default:s(()=>[(i(),x(M,null,J(f,$=>l(A,{key:$.value,label:$.displayName,name:$.value},{default:s(()=>[p.value===$.value&&e.value?(i(),h(ge($.component),{key:0,week:e.value},null,8,["week"])):I("",!0)]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}});export{Ml as default};
