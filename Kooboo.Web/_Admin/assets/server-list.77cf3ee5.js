var h=(k,m,p)=>new Promise((r,i)=>{var v=l=>{try{e(p.next(l))}catch(f){i(f)}},y=l=>{try{e(p.throw(l))}catch(f){i(f)}},e=l=>l.done?r(l.value):Promise.resolve(l.value).then(v,y);e((p=p.apply(k,m)).next())});import{_ as G}from"./k-table.c13bd7f5.js";import{B as K}from"./breadcrumb.bcaeaf75.js";import{g as q}from"./i18n.25caaace.js";import{A as O,B as j,g as J,C as M}from"./index.6fafe25e.js";import{w as Q}from"./main.1c3b59e3.js";import{e as W}from"./guid.c1a40312.js";import{_ as X}from"./index.50326354.js";import{a as T,s as Y,r as Z,u as ee}from"./validate.f3c0b03b.js";import{E as oe}from"./index.f571dfc9.js";import{E as ae,a as le}from"./index.94998415.js";import{E as te,a as re}from"./index.960b9732.js";import{E as ne,a as se}from"./index.5b499f72.js";import{E as me}from"./index.a5d96e5a.js";import{d as A,g as c,o as s,j as _,w as t,b as n,u as d,f as w,a as I,b6 as S,F as B,aH as z,t as x,k as D,b7 as ie,e as ue}from"./url.8f5ec20c.js";import{b as de}from"./confirm.629bcef4.js";import{E as pe}from"./windi.a815125a.js";import{E as ce}from"./index.e9f8834a.js";import{E as ve}from"./index.5388dbc8.js";import"./sortable.esm.a99254e8.js";import"./icon-button.0e134c9b.js";import"./index.158cdd11.js";import"./focus-trap.81e4fb05.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.1e7e06b8.js";import"./index.0c2ced08.js";import"./index.f9c89813.js";import"./index.a9a077b4.js";import"./isEqual.2e410d13.js";import"./_baseIsEqual.0a4e01e5.js";import"./error.7e8331f1.js";import"./index.2e51d36e.js";import"./event.776e7e11.js";import"./replace-all.b35629e7.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.c6488b3c.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./index.878e2bbf.js";import"./index.adb17f32.js";import"./index.b065185c.js";import"./index.ab12ea9e.js";import"./index.b1b64a44.js";import"./style.1b77b3a2.js";import"./toNumber.6efebd6a.js";import"./_baseClone.885c975f.js";import"./scroll.0cf77af8.js";import"./debounce.730e1961.js";import"./index.c93fe8e7.js";import"./validator.9b0d789f.js";import"./index.1d16d007.js";import"./refs.d2253dd4.js";import"./logo-transparent.1566007e.js";import"./index.60799c00.js";import"./aria.75ec5909.js";const fe={class:"flex items-center space-x-8 w-full"},_e={class:"flex items-center space-x-8 w-full"},be=A({props:{modelValue:{type:Boolean},organizations:null},emits:["update:modelValue","reload"],setup(k,{emit:m}){var u;const p=k,{t:r}=q(),i=c(!0),v=c(),y=c([]),e=c({id:W,name:"",serverUrl:"",orgId:(u=p.organizations.find(b=>b.isAdmin))==null?void 0:u.id}),l={name:[T(r("common.nameRequiredTips")),Y,Z(1,50)],serverUrl:[ee(r("common.urlInvalid")),T(r("common.serverUrlRequiredTips"))]},f=c([{key:"kooboo",value:"Kooboo"+r("common.online")},{key:"custom",value:r("common.custom")}]),V=c(f.value[0].key),E=()=>h(this,null,function*(){yield v.value.validate(),yield O(e.value),m("reload"),i.value=!1}),C=()=>h(this,null,function*(){if(!e.value.orgId)return;const b=p.organizations.find(a=>a.id==e.value.orgId);y.value=(yield j(e.value.orgId)).map(a=>(a.host=`http://${b.name}.${a.host}`,a))}),$=()=>{e.value.serverUrl=""};return C(),(b,a)=>{const U=oe,g=ae,R=te,N=re,F=ne,H=se,L=le,P=me;return s(),_(P,{"model-value":i.value,width:"600px","close-on-click-modal":!1,title:d(r)("common.addServer"),onClosed:a[6]||(a[6]=o=>m("update:modelValue",!1))},{footer:t(()=>[n(X,{disabled:!e.value.name||!e.value.serverUrl,onConfirm:E,onCancel:a[5]||(a[5]=o=>i.value=!1)},null,8,["disabled"])]),default:t(()=>[n(L,{ref_key:"form",ref:v,"label-position":"top",model:e.value,rules:d(l)},{default:t(()=>[n(g,{prop:"name",label:d(r)("common.name")},{default:t(()=>[n(U,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>e.value.name=o),placeholder:"kooboocn"},null,8,["modelValue"])]),_:1},8,["label"]),n(g,{label:d(r)("common.organization"),prop:"orgId",required:""},{default:t(()=>[w("div",fe,[n(N,{modelValue:e.value.orgId,"onUpdate:modelValue":a[1]||(a[1]=o=>e.value.orgId=o),class:"w-full",onChange:C},{default:t(()=>[(s(!0),I(B,null,S(k.organizations,o=>(s(),_(R,{key:o.id,label:o.displayName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["label"]),n(g,{label:d(r)("common.from")},{default:t(()=>[n(H,{modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=o=>V.value=o),class:"el-radio-group--rounded h-38px",onChange:$},{default:t(()=>[(s(!0),I(B,null,S(f.value,o=>(s(),_(F,{key:o.key,label:o.key},{default:t(()=>[z(x(o.value),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),V.value=="kooboo"?(s(),_(g,{key:0,prop:"serverUrl"},{default:t(()=>[w("div",_e,[n(N,{modelValue:e.value.serverUrl,"onUpdate:modelValue":a[3]||(a[3]=o=>e.value.serverUrl=o),class:"w-full"},{default:t(()=>[(s(!0),I(B,null,S(y.value,o=>(s(),_(R,{key:o.host,label:`${o.dataCenter} (${o.host})`,value:o.host},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})):D("",!0),V.value=="custom"?(s(),_(g,{key:1,prop:"serverUrl"},{default:t(()=>[n(U,{modelValue:e.value.serverUrl,"onUpdate:modelValue":a[4]||(a[4]=o=>e.value.serverUrl=o),placeholder:"https://www.kooboo.cn"},null,8,["modelValue"])]),_:1})):D("",!0)]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}}),ge={class:"p-24"},ye={class:"flex items-center py-24 space-x-16"},Ve={class:"flex items-center"},we={"data-cy":"remote-site"},ke={"data-cy":"server"},Io=A({setup(k){const{t:m}=q(),p=c([]),r=c(),i=c(!1),v=()=>h(this,null,function*(){const e=yield Promise.all([yield J(),yield Q()]);p.value=e[0].map(l=>(l.reserved&&(l.$DisabledSelect=!0),l)),r.value=e[1]});v();function y(e){return h(this,null,function*(){yield de();for(const l of e)yield M(l.id);v()})}return(e,l)=>{const f=pe,V=ce,E=ve,C=G,$=ie("hasPermission");return s(),I("div",ge,[n(K,{"crumb-path":[{name:d(m)("common.sync"),route:{name:"sync"}},{name:d(m)("common.server")}]},null,8,["crumb-path"]),w("div",ye,[ue((s(),_(V,{round:"",onClick:l[0]||(l[0]=u=>i.value=!0)},{default:t(()=>[w("div",Ve,[n(f,{class:"mr-16 iconfont icon-a-addto"}),z(" "+x(d(m)("common.addServer")),1)])]),_:1})),[[$,{feature:"sync",action:"edit"}]])]),n(C,{data:p.value,"show-check":"",permission:{feature:"sync",action:"delete"},onDelete:y},{default:t(()=>[n(E,{label:d(m)("common.name")},{default:t(({row:u})=>[w("span",we,x(u.name),1)]),_:1},8,["label"]),n(E,{label:d(m)("common.server")},{default:t(({row:u})=>[w("span",ke,x(u.serverUrl),1)]),_:1},8,["label"]),n(E,{label:d(m)("common.organization")},{default:t(({row:u})=>{var b,a,U;return[z(x((U=(a=(b=r.value)==null?void 0:b.find(g=>g.id==u.orgId))==null?void 0:a.displayName)!=null?U:"-"),1)]}),_:1},8,["label"])]),_:1},8,["data"]),i.value&&r.value?(s(),_(be,{key:0,modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=u=>i.value=u),organizations:r.value,onReload:v},null,8,["modelValue","organizations"])):D("",!0)])}}});export{Io as default};
