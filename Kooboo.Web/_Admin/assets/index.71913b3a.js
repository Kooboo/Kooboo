var M=(b,s,i)=>new Promise((v,_)=>{var r=t=>{try{u(i.next(t))}catch(m){_(m)}},e=t=>{try{u(i.throw(t))}catch(m){_(m)}},u=t=>t.done?v(t.value):Promise.resolve(t.value).then(r,e);u((i=i.apply(b,s)).next())});import{_ as ie}from"./k-table.7d05e82e.js";import{_ as re}from"./icon-button.315b6443.js";import{g as T,o as Y,w as Z}from"./i18n.bcd18f8a.js";import{r as ee,a as z,l as oe}from"./validate.238a9986.js";import{E as J}from"./index.5cbbc5d7.js";import{E as j,a as P}from"./index.6d63eb53.js";import{d as B,g as y,o as f,j as k,w as n,b as l,u as a,i as q,aH as R,t as C,a as S,k as E,b6 as O,f as $,F as A,ch as ue,ce as me,N as de,G as ce}from"./url.8f5ec20c.js";import{_ as G}from"./index.7a75fca3.js";import{c as pe,i as fe,a as _e,s as ve,g as le,b as ye,u as ge,d as Ve,e as ke,f as he,h as we,j as be}from"./mail-module.8dec960b.js";import{E as L}from"./index.d4a6b2d5.js";import{i as xe,E as $e}from"./main.582f9de6.js";import{_ as Me}from"./plugin-vue_export-helper.21dcd24c.js";import{E as W}from"./index.aec72f69.js";import{E as Ee}from"./index.ff00fbd6.js";import{E as Ce}from"./index.79dc05e0.js";import{S as Se}from"./search-input.5b2e8d23.js";import{i as X}from"./style.9c8f6403.js";import{E as De}from"./index.7a30c6dd.js";import{E as Ue}from"./index.79f78425.js";import{b as Ie,s as Fe}from"./confirm.eadb49f1.js";import{E as te}from"./index.373c837a.js";import{E as Re}from"./index.0a8d3d17.js";import{E as Te,a as Be}from"./index.6d22f937.js";import{m as Le}from"./marked.esm.30e9f73c.js";import{_ as Ne}from"./index.47274d5a.js";import{E as He}from"./windi.19264205.js";import{E as Ke}from"./index.b83a1079.js";import"./sortable.esm.a99254e8.js";import"./index.564bc658.js";import"./index.c80f5028.js";import"./isEqual.11d86bcc.js";import"./_baseIsEqual.547729d3.js";import"./error.7e8331f1.js";import"./index.daafc4da.js";import"./index.05e21f33.js";import"./event.776e7e11.js";import"./index.59b1471f.js";import"./index.ec6ad7db.js";import"./focus-trap.eafcfd1f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.3a977dfb.js";import"./index.2341329b.js";import"./index.bda83f28.js";import"./replace-all.d441bf14.js";import"./index.bff48780.js";import"./index.649f6c77.js";import"./index.a32fb6e5.js";import"./_baseClone.eeff2792.js";import"./index.a3d8335f.js";import"./scroll.4888a9e9.js";import"./refs.d2253dd4.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./index.57a23e6d.js";/* empty css                                                                 */import"./toNumber.6efebd6a.js";import"./logo-transparent.1566007e.js";import"./index.10f642b2.js";import"./aria.75ec5909.js";import"./validator.b73911a9.js";import"./index.e3f90979.js";import"./debounce.730e1961.js";import"./index.9a83ee01.js";const ze=B({props:{model:null},emits:["save"],setup(b,{expose:s,emit:i}){const{t:v}=T(),_=y(),r={name:[ee(1,50),z(v("common.nameRequiredTips")),oe()]};return s({validate:()=>{var e;return(e=_.value)==null?void 0:e.validate()}}),(e,u)=>{const t=J,m=j,d=P;return f(),k(d,{ref_key:"form",ref:_,"label-position":"top",model:b.model,rules:a(r),onSubmit:u[2]||(u[2]=Z(()=>{},["prevent"]))},{default:n(()=>[l(m,{label:a(v)("common.name"),prop:"name"},{default:n(()=>[l(t,{modelValue:b.model.name,"onUpdate:modelValue":u[0]||(u[0]=w=>b.model.name=w),"data-cy":"name",onKeydown:u[1]||(u[1]=Y(w=>i("save"),["enter"]))},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),qe=B({props:{modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(b,{emit:s}){const{t:i}=T(),v=y(!0),_=y(),r=y({name:""}),e=()=>M(this,null,function*(){yield _.value.validate(),yield pe(r.value.name),v.value=!1,s("reload")});return(u,t)=>{const m=L;return f(),k(m,{"model-value":v.value,width:"600px","close-on-click-modal":!1,title:a(i)("common.create"),onClosed:t[1]||(t[1]=d=>s("update:modelValue",!1))},{footer:n(()=>[l(G,{onConfirm:e,onCancel:t[0]||(t[0]=d=>v.value=!1)})]),default:n(()=>[l(ze,{ref_key:"form",ref:_,model:r.value,onSave:e},null,8,["model"])]),_:1},8,["model-value","title"])}}});const Oe={key:0,class:"el-upload__tip ml-8"},Ae={key:1,class:"mt-12 w-full"},Je=B({props:{modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(b,{emit:s}){const{t:i}=T(),v={name:[ee(1,50),z(i("common.nameRequiredTips")),oe()],file:z(i("common.selectFileTips"))},_=y(!0),r=y(),e=y({name:"",file:null}),u=m=>{e.value.file=m},t=()=>M(this,null,function*(){yield r.value.validate();var m=new FormData;m.append("file",e.value.file.raw),m.append("name",e.value.name);try{yield fe(m),s("reload")}catch(d){throw xe(i("common.importError"),!0),Error()}_.value=!1});return q(()=>e.value.file,()=>{e.value.file&&r.value.clearValidate("file")}),(m,d)=>{const w=J,U=j,I=W,g=Ee,x=Ce,D=P,F=L;return f(),k(F,{modelValue:_.value,"onUpdate:modelValue":d[4]||(d[4]=p=>_.value=p),width:"600px","close-on-click-modal":!1,title:a(i)("common.import"),onClosed:d[5]||(d[5]=p=>s("update:modelValue",!1))},{footer:n(()=>[l(G,{"confirm-label":a(i)("common.start"),onConfirm:t,onCancel:d[3]||(d[3]=p=>_.value=!1)},null,8,["confirm-label"])]),default:n(()=>[l(D,{ref_key:"form",ref:r,"label-position":"top",model:e.value,rules:v,onSubmit:d[2]||(d[2]=Z(()=>{},["prevent"])),onKeydown:Y(t,["enter"])},{default:n(()=>[l(U,{label:a(i)("common.name"),prop:"name"},{default:n(()=>[l(w,{modelValue:e.value.name,"onUpdate:modelValue":d[0]||(d[0]=p=>e.value.name=p),"data-cy":"module-name"},null,8,["modelValue"])]),_:1},8,["label"]),l(U,{label:a(i)("common.file"),prop:"file"},{default:n(()=>[l(g,{"show-file-list":!1,action:"",accept:"application/zip","auto-upload":!1,"on-change":u,"data-cy":"upload"},{default:n(()=>[l(I,{type:"primary",round:"",plain:""},{default:n(()=>[R(C(a(i)("common.selectFile")),1)]),_:1})]),_:1}),e.value.file?E("",!0):(f(),S("div",Oe,C(a(i)("common.compressedPackageFileFormat")),1)),e.value.file?(f(),S("div",Ae,[l(x,{title:e.value.file.name,type:"info",onClose:d[1]||(d[1]=p=>e.value.file=null)},null,8,["title"])])):E("",!0)]),_:1},8,["label"])]),_:1},8,["model","onKeydown"])]),_:1},8,["modelValue","title"])}}});var je=Me(Je,[["__scopeId","data-v-d2f0639e"]]);const Pe=["title"],Ge={class:"flex-1 text-l font-bold ellipsis"},We=["innerHTML"],Qe=["innerHTML"],Xe=["innerHTML"],Ye=B({props:{list:null,modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(b,{emit:s}){const i=b,{t:v}=T(),_=y(!0),r=y(),e=y(""),u=y(),t=y(),d=ue(()=>M(this,null,function*(){u.value=void 0,r.value=e.value.trim(),e.value.trim()!==""&&(u.value=yield ve(r.value.trim()),u.value.forEach(g=>{g.installed=U(g.title)}))}),1e3),w=g=>M(this,null,function*(){g.loading=!0,_e(g.packageId,g.title).then(()=>{g.installed=!0,s("reload")}).catch(()=>{g.installed=!1,$e.error(v("common.installationFailed"))}).finally(()=>{g.loading=!1})}),U=g=>i.list.map(D=>D.name).includes(g),I=g=>"<span style='color:rgba(34, 150, 243, 1)'>"+g+"</span>";return q(()=>e.value,()=>{d()}),q(()=>_.value,g=>{g&&setTimeout(()=>{t.value.focus()},0)},{immediate:!0}),(g,x)=>{const D=Se,F=W,p=De,o=Ue,h=L;return f(),k(h,{"model-value":_.value,width:"600px","close-on-click-modal":!1,title:a(v)("common.search"),"custom-class":"search_dialog",onClosed:x[1]||(x[1]=V=>s("update:modelValue",!1))},{default:n(()=>[l(D,{ref_key:"searchInputRef",ref:t,modelValue:e.value,"onUpdate:modelValue":x[0]||(x[0]=V=>e.value=V),class:"w-536px ml-32px",placeholder:a(v)("common.searchKeywordTip"),"data-cy":"search"},null,8,["modelValue","placeholder"]),l(o,{class:"mt-8","max-height":"50vh"},{default:n(()=>[(f(!0),S(A,null,O(u.value,V=>(f(),S("div",{key:V.packageId,class:"hover:bg-[#EFF6FF] dark:hover:bg-666 px-32"},[$("div",{class:"flex items-center pt-12 pb-4",title:V.title+`
`+V.description},[$("div",Ge,[$("p",{class:"ellipsis h-auto","data-cy":"module-name",innerHTML:a(X)(V.title,e.value)},null,8,We),$("p",{class:"font-light text-m text-999 p-4 ellipsis","data-cy":"module-description",innerHTML:a(X)(V.description,e.value)},null,8,Qe)]),l(F,{type:"primary",size:"small",disabled:V.loading||V.installed,loading:V.loading,round:"","data-cy":"install",onClick:Q=>w(V)},{default:n(()=>[R(C(V.installed?a(v)("common.hasInstall"):a(v)("common.install")),1)]),_:2},1032,["disabled","loading","onClick"])],8,Pe),l(p,{class:"m-0"})]))),128)),u.value&&r.value&&u.value.length==0?(f(),S("div",{key:0,class:"px-32 leading-4 text-center mt-8 whitespace-normal","data-cy":"no-search-result",innerHTML:a(v)("common.searchResultEmpty",{keyword:I(r.value)})},null,8,Xe)):E("",!0)]),_:1})]),_:1},8,["model-value","title"])}}}),Ze={key:0},eo={class:"text-m font-bold ellipsis"},oo=["title"],lo=B({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(b,{emit:s}){const i=b,{t:v}=T(),_=y(!0),r=y(),e=y({});M(this,null,function*(){var t=yield le("root",i.id,"module.config");r.value=JSON.parse(t);const m=yield ye(i.id);if(m)e.value=JSON.parse(m);else if(r.value.settingDefines)for(const d of r.value.settingDefines)e.value[d.name]=d.defaultValue});const u=()=>M(this,null,function*(){r.value.setting=e.value,yield ge(i.id,JSON.stringify(e.value,null,2)),_.value=!1});return(t,m)=>{const d=te,w=Re,U=Te,I=Be,g=J,x=j,D=P,F=L;return f(),k(F,{"model-value":_.value,width:"600px","close-on-click-modal":!1,title:a(v)("common.setting"),onClosed:m[1]||(m[1]=p=>s("update:modelValue",!1))},{footer:n(()=>[l(G,{onConfirm:u,onCancel:m[0]||(m[0]=p=>_.value=!1)})]),default:n(()=>[l(D,{"label-position":"top"},{default:n(()=>{var p;return[(p=r.value)!=null&&p.settingDefines?(f(),S("div",Ze,[(f(!0),S(A,null,O(r.value.settingDefines,o=>(f(),k(x,{key:o.name},{label:n(()=>[$("p",eo,[R(C(o.display||o.name),1),$("span",{class:"font-normal text-s px-4",title:o.description},C(o.description),9,oo)])]),default:n(()=>[o.type==="switch"?(f(),k(d,{key:0,modelValue:e.value[o.name],"onUpdate:modelValue":h=>e.value[o.name]=h},null,8,["modelValue","onUpdate:modelValue"])):o.type==="number"?(f(),k(w,{key:1,modelValue:e.value[o.name],"onUpdate:modelValue":h=>e.value[o.name]=h,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])):o.type==="select"?(f(),k(I,{key:2,modelValue:e.value[o.name],"onUpdate:modelValue":h=>e.value[o.name]=h,modelModifiers:{number:!0},class:"w-full"},{default:n(()=>[(f(!0),S(A,null,O(o.options,(h,V)=>(f(),k(U,{key:V,label:h,value:h},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(f(),k(g,{key:3,modelValue:e.value[o.name],"onUpdate:modelValue":h=>e.value[o.name]=h,modelModifiers:{number:!0},type:o.type=="textarea"?"textarea":""},null,8,["modelValue","onUpdate:modelValue","type"]))]),_:2},1024))),128))])):E("",!0)]}),_:1})]),_:1},8,["model-value","title"])}}}),to={class:"px-12"},ao=B({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(b,{emit:s}){const i=b,{t:v}=T(),_=y(!0),r=y("");le("root",i.id,"Readme.md").then(u=>{r.value=Le.parse(u)});const e=me(()=>`<div style="padding:10px;">${r.value}<div>`);return(u,t)=>{const m=L;return f(),k(m,{"custom-class":"el-dialog--zero-padding","model-value":_.value,width:"1000px","close-on-click-modal":!1,title:a(v)("common.description"),onClosed:t[0]||(t[0]=d=>s("update:modelValue",!1))},{default:n(()=>[$("div",to,[l(Ne,{class:"h-400px",content:a(e)},null,8,["content"])])]),_:1},8,["model-value","title"])}}}),no={class:"p-24"},so={class:"flex items-center pb-24 space-x-16"},io={class:"flex items-center"},ro={class:"flex items-center"},uo={class:"flex items-center"},mo={class:"text-blue cursor-pointer"},co=["src"],xl=B({setup(b){const{t:s}=T(),i=y([]),v=y(!1),_=y(!1),r=y(!1),e=y(!1),u=y(!1),t=y(!1),m=y();let d=y();function w(){return M(this,null,function*(){i.value=yield Ve()})}w();function U(p){return M(this,null,function*(){yield Ie(p.length),yield ke(p.map(o=>o.id)),w()})}const I=p=>M(this,null,function*(){yield he(p.id,!p.online),w()}),g=p=>{we(p)},x=p=>M(this,null,function*(){yield Fe(s("common.shareModuleConfirm")),yield be(p)}),D=p=>{m.value=p,e.value=!0},F=p=>{m.value=p,u.value=!0};return(p,o)=>{const h=He,V=W,Q=de("router-link"),H=Ke,ae=te,K=re,ne=ie,se=L;return f(),S("div",no,[$("div",so,[l(V,{round:"","data-cy":"create-module",onClick:o[0]||(o[0]=c=>v.value=!0)},{default:n(()=>[$("div",io,[l(h,{class:"mr-16 iconfont icon-a-addto"}),R(" "+C(a(s)("common.create")),1)])]),_:1}),l(V,{round:"","data-cy":"import",onClick:o[1]||(o[1]=c=>_.value=!0)},{default:n(()=>[$("div",ro,[l(h,{class:"mr-16 iconfont icon-a-Pullin"}),R(" "+C(a(s)("common.import")),1)])]),_:1}),l(V,{round:"","data-cy":"search",onClick:o[2]||(o[2]=c=>r.value=!0)},{default:n(()=>[$("div",uo,[l(h,{class:"mr-16 iconfont icon-search"}),R(" "+C(a(s)("common.search")),1)])]),_:1})]),l(ne,{data:i.value,"show-check":"",onDelete:U},{default:n(()=>[l(H,{label:a(s)("common.name")},{default:n(({row:c})=>[l(Q,{to:{name:"mail-module-editor",query:{id:c.id}},"data-cy":"name"},{default:n(()=>[$("span",mo,C(c.name),1)]),_:2},1032,["to"])]),_:1},8,["label"]),l(H,{label:a(s)("common.online"),width:"150"},{default:n(({row:c})=>[l(ae,{"model-value":c.online,"data-cy":"online",onClick:N=>I(c)},null,8,["model-value","onClick"])]),_:1},8,["label"]),l(H,{width:"100",label:a(s)("common.backend")},{default:n(({row:c})=>[c.backendViewUrl?(f(),k(V,{key:0,size:"small",type:"primary",round:"","data-cy":"",onClick:N=>{ce(d)?d.value=c.backendViewUrl:d=c.backendViewUrl,t.value=!0}},{default:n(()=>[R(C(a(s)("common.manage")),1)]),_:2},1032,["onClick"])):E("",!0)]),_:1},8,["label"]),l(H,{align:"right",width:"180px",prop:"creationDate"},{default:n(({row:c})=>[l(K,{icon:"icon-a-setup",tip:a(s)("common.settings"),"data-cy":"setting",onClick:N=>D(c.id)},null,8,["tip","onClick"]),l(K,{icon:"icon-page",tip:a(s)("common.description"),"data-cy":"description",onClick:N=>F(c.id)},null,8,["tip","onClick"]),l(K,{icon:"icon-share",tip:a(s)("common.export"),"data-cy":"export",onClick:N=>g(c.name)},null,8,["tip","onClick"]),l(K,{icon:"icon-link !bg-transparent",tip:a(s)("common.share"),"data-cy":"share",onClick:N=>x(c.id)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data"]),v.value?(f(),k(qe,{key:0,modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=c=>v.value=c),onReload:w},null,8,["modelValue"])):E("",!0),_.value?(f(),k(je,{key:1,modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=c=>_.value=c),onReload:w},null,8,["modelValue"])):E("",!0),e.value?(f(),k(lo,{key:2,id:m.value,modelValue:e.value,"onUpdate:modelValue":o[5]||(o[5]=c=>e.value=c)},null,8,["id","modelValue"])):E("",!0),r.value?(f(),k(Ye,{key:3,modelValue:r.value,"onUpdate:modelValue":o[6]||(o[6]=c=>r.value=c),list:i.value,onReload:w},null,8,["modelValue","list"])):E("",!0),u.value?(f(),k(ao,{key:4,id:m.value,modelValue:u.value,"onUpdate:modelValue":o[7]||(o[7]=c=>u.value=c)},null,8,["id","modelValue"])):E("",!0),l(se,{modelValue:t.value,"onUpdate:modelValue":o[8]||(o[8]=c=>t.value=c),width:"1000px","close-on-click-modal":!1,"custom-class":"el-dialog--zero-padding",title:a(s)("common.manage"),onClosed:o[9]||(o[9]=c=>t.value=!1)},{default:n(()=>[t.value?(f(),S("iframe",{key:0,src:a(d),class:"w-full h-500px"},null,8,co)):E("",!0)]),_:1},8,["modelValue","title"])])}}});export{xl as default};
