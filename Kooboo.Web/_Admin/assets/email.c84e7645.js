var c=(t,g,y)=>new Promise((M,h)=>{var x=r=>{try{w(y.next(r))}catch(m){h(m)}},N=r=>{try{w(y.throw(r))}catch(m){h(m)}},w=r=>r.done?M(r.value):Promise.resolve(r.value).then(x,N);w((y=y.apply(t,g)).next())});import{f as re}from"./main.1c3b59e3.js";import{g as $,a as le,b as C,L as j,c as B,m as oe,d as ie,e as F}from"./index.878e2bbf.js";import{g as ue}from"./index.7247b296.js";import{M as de,g as o,c as W,i as H,K as ce}from"./url.8f5ec20c.js";var fe="/_Admin/assets/attachment_image.21eccfb8.svg",me="/_Admin/assets/attachment_media.e18d5ece.svg",ve="/_Admin/assets/attachment_rar.1175f0b2.svg",ge="/_Admin/assets/attachment_default.d0863d95.svg",pe="/_Admin/assets/attachment_document.eaafcdc1.svg";const Le=re("emailStore",()=>{const t=de(),g=o(!1),y=o([]),M=o([]),h=o([]),x=o([]),N=o(),w=o([]),r=o([]),m=o(),d=o(""),O=o(),V=o(),z=o(),Z=localStorage.getItem("isHasNewMessage"),K=o([]),A=o(),p=o(),f=o(),G=o(0),I=o(),k=["inbox","sent","drafts","spam","trash"],J=o(0),P=W(()=>{var s,n,l;if(t.query.flag)return;if(A.value)return A.value;let e=(s=t.name)!=null?s:"",a="";return t.query.folder&&(e=t.query.folder.toString().toLowerCase()),t.name==="folder"||t.query.folder==="folder"?a=(n=t.query.folderName)!=null?n:"":a=(l=t.query.address)!=null?l:"",e.toString()+a.toString()});function X(e){const a=[];return e.forEach(s=>{const n=s.name.split("/");let l=a,i="";n.forEach((u,v)=>{i=i?`${i}/${u}`:u;const E=l.find(S=>S.name===i);if(E)l=E.items;else{const S={id:s.id,name:i,count:v===n.length-1?s.count:0,displayName:u,unRead:v===n.length-1?s.unRead:0,floor:v,items:[]};l.push(S),l=S.items}})}),a}const L=W(()=>{var a,s;return t.name==="folder"||t.query.folder==="folder"?(a=t.query.folderName)!=null&&a.toString()?(s=t.query.folderName)==null?void 0:s.toString():"":void 0}),Y=()=>c(void 0,null,function*(){y.value=yield ue()}),T=()=>c(void 0,null,function*(){w.value=yield $("sent"),V.value=w.value.map(e=>e.unRead).reduce((e,a)=>e+a,0)}),U=e=>c(void 0,null,function*(){var a;M.value=yield $(void 0,e?!0:void 0),N.value=(a=M.value.filter(s=>s.isDefault&&s.addressType!=="Wildcard")[0])==null?void 0:a.address,O.value=M.value.map(s=>s.unRead).reduce((s,n)=>s+n,0)}),q=e=>c(void 0,null,function*(){e?e==="sent"?yield T():(e==="inbox"||e==="addresses")&&(yield U()):(yield T(),yield U())}),b=()=>c(void 0,null,function*(){h.value=yield le(),z.value=h.value.map(e=>e.unRead).reduce((e,a)=>e+a,0),x.value=X(h.value)}),_=()=>c(void 0,null,function*(){var s,n,l,i;const e=(l=(n=r.value[((s=r.value)==null?void 0:s.length)-1])==null?void 0:n.id)!=null?l:-1;let a;t.query.flag==="advanced"&&f.value||(a=yield C((i=L.value)!=null?i:d.value,L.value?void 0:m.value,e,p.value||"")),a&&r.value.push(...a),d.value==="inbox"&&(I.value=yield j())}),Q=e=>c(void 0,null,function*(){var n,l,i;const a=r.value.length,s=[];for(;a;){const u=(l=(n=s[s.length-1])==null?void 0:n.id)!=null?l:-1;let v;t.query.flag==="advanced"&&f.value?v=yield B(u,f.value):v=yield C((i=L.value)!=null?i:d.value,L.value?void 0:m.value,u,p.value||"",!0);const E=v;if(!v.length||(s.push(...E),s.length>=a)||a<=30)break}d.value==="inbox"&&(I.value=yield j()),r.value=s,e?q():e===!1&&q(d.value)}),D=(e="")=>c(void 0,null,function*(){var n,l;const a=[];let s;e==="advanced"&&f.value?s=yield B(-1,f.value):s=yield C((n=L.value)!=null?n:d.value,L.value?void 0:m.value,-1,p.value||""),d.value==="inbox"&&(I.value=yield j()),a.push(...s),r.value=a,r.value.length&&(yield ce(),(l=document.getElementById(r.value[0].id.toString()))==null||l.scrollIntoView())}),ee=(e,a)=>c(void 0,null,function*(){for(let s=0;s<e.length;s++)r.value.forEach(n=>{n.id===e[s]&&(n.read=a)});yield oe(e,a)}),ae=(e,a)=>{const s=e.find(u=>u.read===!1),n=e.find(u=>u.folderName==="inbox"&&u.read===!1),l=e.find(u=>u.folderName==="sent"&&u.read===!1),i=e.find(u=>!k.includes(u.folderName)&&u.read===!1);(a==="inbox"||a==="sent")&&s&&q(a),!k.includes(a)&&s&&b(),l&&a!=="sent"&&q("sent"),n&&a!=="inbox"&&q("inbox"),i&&k.includes(a)&&b()},se=e=>c(void 0,null,function*(){r.value=r.value.filter(a=>!e.map(s=>s.id).includes(a.id)),r.value.length?r.value.length<30&&(yield Q()):yield D()});function R(e,a){return c(this,null,function*(){yield ie(e.map(s=>s.id),a)})}const te=(e,a)=>c(void 0,null,function*(){if(a==="trash")yield F(e.map(s=>s.id));else if(a==="search"){const s=e,n=s.filter(i=>i.folderName==="trash"),l=s.filter(i=>i.folderName!=="trash");n.length&&(yield F(n.map(i=>i.id))),l.length&&(yield R(l,"trash"))}else yield R(e,"trash")}),ne=e=>{const a=["gif","jpg","jpeg","png","webp","svg+xml"],s=["zip","x-rar-compressed"],n=["xlsx","csv","pdf","css","javascript","html","json","vnd.openxmlformats-officedocument.wordprocessingml.document","vnd.openxmlformats-officedocument.presentationml.presentation","vnd.ms-powerpoint","msword","vnd.ms-excel","vnd.openxmlformats-officedocument.spreadsheetml.sheet","plain"],l=["mp4","mpeg"];return a.includes(e)?fe:s.includes(e)?ve:n.includes(e)?pe:l.includes(e)?me:ge};return H([m,d],(e,a)=>c(void 0,null,function*(){if(!(t.matched[0].path!=="/kmail"&&t.matched[0].path!=="/kmail-settings"||t.name==="calendar")&&d.value&&d.value!=="compose"&&d.value!=="addresses"){if(r.value=[],K.value=[],(d.value==="inbox"&&g.value||d.value==="sent"&&g.value)&&(yield q(d.value)),a[1]==="addresses"&&t.query.folderName&&(yield _(),yield b()),g.value=!0,t.query.folderName)return;d.value==="folder"&&(yield b()),yield _()}})),H(()=>t.query.folderName,(e,a)=>{t.name!=="compose"&&(!g.value&&!t.query.folderName||t.name!=="folder"&&a&&!e||(p.value="",f.value=null,D(),b()))},{immediate:!0}),H(()=>t.name,()=>{var e,a;t.query.flag?t.query.flag==="advanced"?f.value={startDate:(e=t.query)==null?void 0:e.startDate,endDate:(a=t.query)==null?void 0:a.endDate,dateType:Number(t.query.dateType),searchFolder:t.query.searchFolder,from:t.query.from,keyword:t.query.keyword,position:t.query.position,readOrUnread:Number(t.query.readOrUnread),to:t.query.to}:t.query.keyword&&(p.value=t.query.keyword):(f.value=null,p.value=""),t.name==="compose"&&(g.value=!0),t.matched[0].path!=="/kmail"&&(p.value="",f.value=null,g.value=!1)},{immediate:!0}),{domainList:y,addressList:M,folderList:h,sentAddressList:w,address:m,folder:d,sentUnreadCount:V,inboxUnreadCount:O,folderUnreadCount:z,messageList:r,loadDomains:Y,loadAddress:q,loadFolders:b,loadSentAddressList:T,loadInboxAddressList:U,loadMessage:_,move:R,markRead:ee,deleteEmails:te,refreshMessageList:D,reload:Q,isShowNewMessageLogo:Z,selectedMessage:K,messageKeyword:p,getAttachmentType:ne,firstActiveMenu:A,searchModel:f,defaultAddress:N,preLatestId:I,folderMenuTree:x,activeName:P,searchEmailsCount:G,notFolderOptions:k,reloadMessageList:se,updateUnreadCount:ae,justViewMessageId:J}});export{Le as u};
