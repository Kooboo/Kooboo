var Xo=Object.defineProperty,Yo=Object.defineProperties;var Zo=Object.getOwnPropertyDescriptors;var zt=Object.getOwnPropertySymbols;var en=Object.prototype.hasOwnProperty,tn=Object.prototype.propertyIsEnumerable;var Jt=(e,l,o)=>l in e?Xo(e,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[l]=o,ge=(e,l)=>{for(var o in l||(l={}))en.call(l,o)&&Jt(e,o,l[o]);if(zt)for(var o of zt(l))tn.call(l,o)&&Jt(e,o,l[o]);return e},Oe=(e,l)=>Yo(e,Zo(l));var g=(e,l,o)=>new Promise((t,s)=>{var u=r=>{try{n(o.next(r))}catch(d){s(d)}},a=r=>{try{n(o.throw(r))}catch(d){s(d)}},n=r=>r.done?t(r.value):Promise.resolve(r.value).then(u,a);n((o=o.apply(e,l)).next())});import{w as H,d as oe,g as Y,v as Qe,o as ue,p as so,C as on,Y as nn,Q as an}from"./i18n.48bd28ac.js";import{d as G,M as De,g as C,a3 as ln,h as nt,aW as io,i as ee,b7 as at,o as f,a as M,f as R,b as k,n as de,t as J,r as Ke,e as ie,j as U,k as j,m as $t,c as X,B as He,u as p,J as At,ce as Ee,w as $,b6 as W,F as q,aH as Ae,cf as sn,N as Dt,aV as rn,az as ro,cd as un,cg as St,c0 as dn,ch as cn,K as uo,D as Rt}from"./url.2e6a77c4.js";import{E as be}from"./windi.a5b0b048.js";import{d as N,e as mn,f as Re,u as ce,r as se,D as Ye,g as pn,E as co,h as vn}from"./main.ea42d807.js";import{a as E,C as $e,i as Wt,u as ke}from"./replace-all.7cf5f327.js";import{e as Z,n as jt}from"./guid.c1a40312.js";import{u as Fe}from"./use-shortcuts.21ce2d8e.js";import{E as mo}from"./index.a439b087.js";import{m as te,M as Pt,D as fn,k as yn,P as gn,_ as bn}from"./userWorker.b3a6730b.js";import{o as po,a as wn,c as vo}from"./config.9fb52765.js";import{d as fo}from"./dark.ddf8665a.js";import{u as we,g as yo,l as _n,a as kn}from"./page.831d1a45.js";import{E as Vt,a as Ot,b as Tt}from"./index.f5a869bb.js";import{c as Ve}from"./use-copy-text.a346ed23.js";import{s as Be}from"./index.c6df1b45.js";import{g as hn,a as xn,u as Cn,b as $n,_ as go}from"./index.0f940e7f.js";import{r as Sn,b as Vn,a as Qt}from"./toggleComment.5b29ca87.js";import{d as Tn}from"./style.19d0c187.js";import{U as je}from"./editor.main.d2800f63.js";import{u as Pe}from"./use-save-tip.04d9878f.js";import{r as _e,a as le,s as Te,i as Ce,l as bo}from"./validate.efc4a5c0.js";import{E as me}from"./index.fc90f5ad.js";import{E as pe,a as ve}from"./index.6855d037.js";import{b as xe}from"./confirm.e2c924ff.js";import{_ as fe}from"./index.a731e53b.js";import{E as Ft}from"./index.cbddf8eb.js";import{E as wo,a as _o}from"./index.695d0284.js";import{E as Bt,b as Mn,a as qt,c as In}from"./index.0d2684bf.js";import{E as ye}from"./index.c4e9b529.js";import{_ as Xe}from"./icon-button.3313e42d.js";import{V as ko}from"./vuedraggable.umd.5840ebc7.js";import{E as lt}from"./index.2bc50276.js";import{_ as Rn}from"./index.66d5d547.js";import{G as Ln}from"./index.232e741a.js";import{_ as ho}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Un}from"./index.af90dc36.js";import{E as En}from"./index.470f0e7e.js";import{_ as Nn}from"./alert.583ccfe6.js";import{E as xo}from"./index.fafb14b3.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.118b18f5.js";/* empty css                                                          */import"./file.b0d4cc6e.js";import"./use-date.01b82ce0.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.82732353.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.f6d26366.js";import{I as An}from"./image-editor.846c8dc6.js";import{M as Dn}from"./main.esm.5190fb65.js";import{g as jn}from"./index.f01d4ffd.js";const Pn={class:"group-collapse"},On={class:"flex-1","data-cy":"folder"},Fn={class:"transition-all opacity-0 flex items-center space-x-8"},re=G({props:{title:null,add:{type:Boolean},expandDefault:{type:Boolean},permission:null},emits:["onAdd"],setup(e){const l=e,o=De(),t=C(l.expandDefault||!1),s=C(),u=C();let a;const n=()=>g(this,null,function*(){var d;const r=u.value?`${(d=u.value)==null?void 0:d.scrollHeight}px`:void 0;r!==s.value&&(s.value=r,t.value=!0)});return ln(n),nt(()=>{a=new MutationObserver(n),a.observe(u.value,{childList:!0,subtree:!0})}),io(()=>{a==null||a.disconnect()}),ee(()=>o.query.activity,()=>{n()}),(r,d)=>{const c=be,m=at("hasPermission");return f(),M("div",Pn,[R("div",{class:"h-26px flex items-center px-12 text-s bg-gray/60 dark:bg-[#333] dark:text-fff/86 space-x-8 not-last:border-b not-last:border-solid not-last:border-gray/50 not-last:dark:border-opacity-20 cursor-pointer",onClick:d[2]||(d[2]=H(_=>t.value=!t.value,["stop"]))},[k(c,{class:de(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",t.value?"rotate-180 ":"rotate-0"]),"data-cy":"expand"},null,8,["class"]),R("span",On,J(e.title),1),R("div",{class:"flex items-center space-x-8 collapse-bar",onClick:d[1]||(d[1]=H(()=>{},["stop"]))},[R("div",Fn,[Ke(r.$slots,"bar"),e.add?ie((f(),U(c,{key:0,class:"iconfont icon-a-addto hover:text-blue","data-cy":"add",onClick:d[0]||(d[0]=_=>r.$emit("onAdd"))},null,512)),[[m,{feature:e.permission,action:"edit",effect:"hiddenIcon"}]]):j("",!0)])])]),R("div",{style:$t({height:t.value?s.value:"0px"}),class:"overflow-hidden transition-all duration-200"},[R("div",{ref_key:"body",ref:u},[Ke(r.$slots,"default")],512)],4)])}}}),Bn=oe.global.t,qn=e=>N.get(E("Code/ListByType",!0),{codeType:e}),Gn=()=>N.get(E("Code/CodeType")),Kn=(e,l)=>N.get(E("Code/GetEdit"),{codeType:e,id:l}),Hn=e=>N.get(E("Code/GetByName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),zn=e=>N.post(E("Code/post"),e),Jn=e=>N.post(E("Code/Deletes"),{ids:e},void 0,{successMessage:Bn("common.deleteSuccess")}),Wn=e=>N.get(E("Code/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Qn=()=>N.get(E("Debugger/GetSession"),void 0,{hiddenLoading:!0,hiddenError:!0}),Xt=()=>N.get(E("Debugger/StartSession"),void 0,{hiddenLoading:!0}),Xn=e=>N.post(E("Debugger/SetBreakPoint"),e,void 0,{hiddenLoading:!0}),Ie=e=>N.get(E("Debugger/Step"),{action:e},{hiddenLoading:!0}),Yn=e=>N.post(E("Debugger/execute"),{jsStatement:e},void 0,{hiddenLoading:!0}),pt=oe.global.t,Co=()=>N.get(E("ScriptModule/list",!0)),Zn=e=>N.post(E("ScriptModule/create"),{name:e},void 0,{successMessage:pt("common.createSuccess")}),ea=e=>N.post(E("ScriptModule/Deletes"),{ids:e},void 0,{successMessage:pt("common.deleteSuccess")}),td=(e,l)=>N.post(E("ScriptModule/UpdateStatus"),{moduleId:e,status:l}),ta=()=>N.get(E("ScriptModule/ResourceType")),od=e=>{mn.get(E("/ScriptModule/export"),{params:{name:e},responseType:"blob",timeout:1e3*60*30}).then(l=>{Tn(l)})},oa=e=>N.post(E("/ScriptModule/Import"),e,void 0,{timeout:1e3*60*30,hiddenLoading:!0,hiddenError:!0,successMessage:pt("common.importSuccess"),errorMessage:pt("common.importFailed"),keepShowErrorMessage:!0}),nd=e=>N.post(E("ScriptModule/share"),{id:e},void 0,{successMessage:pt("common.shareSuccess")}),$o=oe.global.t,na=e=>N.get(E("ModuleFiles/AllFiles"),{moduleid:e}),So=(e,l,o,t)=>N.post(E("ModuleFiles/UpdateText"),{moduleid:l,folder:"/",fileName:o,content:t,objectType:e}),Vo=(e,l,o,t)=>N.post(E("ModuleFiles/UpdateBinary"),{moduleid:l,folder:"/",fileName:o,base64:t,objectType:e},void 0,{hiddenError:!0,successMessage:$o("common.uploadSuccess")}),aa=(e,l,o)=>N.post(E("ModuleFiles/Remove"),{moduleid:l,fileName:o,folder:"/",objectType:e},void 0,{successMessage:$o("common.deleteSuccess")}),la=(e,l,o)=>N.post(E("ModuleFiles/GetText"),{moduleid:l,fileName:o,folder:"/",objectType:e}),sa=(e,l,o)=>N.post(E("ModuleFiles/GetTextByName"),{moduleName:l,fileName:o,folder:"/",objectType:e},void 0,{hiddenError:!0,hiddenLoading:!0}),ia=oe.global.t,Se=Re("moduleStore",()=>{const e=ce(),l=De(),o=F(),t=C([]),s=C([]),u=C(),a=C([]),n=C(!1);e.site&&ta().then(i=>s.value=i);const r=()=>g(void 0,null,function*(){if(u.value){const i=yield na(u.value);a.value=i.map(b=>Oe(ge({},b),{id:`${u.value}_${b.objectType}_${b.fullName}`}))}else t.value=yield Co(),n.value=!0}),d=(i,b)=>g(void 0,null,function*(){yield So(b.name,u.value,i," "),yield r()}),c=(i,b,I)=>g(void 0,null,function*(){yield Vo(I.name,u.value,i,b),r()}),m=(i,b)=>g(void 0,null,function*(){var I;if(yield aa(b,u.value,i),b=="code"){const V=(I=t.value.find(y=>y.id==u.value))==null?void 0:I.name,x=te.editor.getModel(je.parse(`file:///node_modules/@types/module:${V}/${i}.ts`));x&&x.dispose()}r()}),_=i=>g(void 0,null,function*(){yield ea(i),Pt(),r()}),w=i=>g(void 0,null,function*(){yield Zn(i),r()}),v=i=>{var b;if(u.value=i,o.activeActivity){const I=(b=o.activeActivity.actions)==null?void 0:b.find(V=>V.name==="back");I&&(I.visible=!0)}a.value=[],r()},S=()=>{var i;if(n.value=!1,u.value=void 0,o.activeActivity){o.activeActivity.panelDisplay=ia("common.modules");const b=(i=o.activeActivity.actions)==null?void 0:i.find(I=>I.name==="back");b&&(b.visible=!1)}a.value=[]},h=()=>{S(),r()};return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},S),ee(()=>l==null?void 0:l.query.moduleId,S),{load:r,list:t,createModule:w,deleteModules:_,types:s,editingModule:u,editModule:v,files:a,createModuleFile:d,deleteModuleFile:m,uploadModuleFile:c,exitEditModule:h,reset:S,modulesInitialized:n}}),qe=Re("codeStore",()=>{const e=ce(),l=F(),o=C(),t=C(!1),s=C(!0),u=C({}),a=C([]),n=C(!1),r=X(()=>{const v={};for(const S in u.value)v[S]=l.getSplitNameData(a.value.filter(h=>h.codeType.toLowerCase()===(S==null?void 0:S.toLowerCase())));return v}),d=()=>g(void 0,null,function*(){!e.site||(a.value=yield qn("all"),n.value=!0)}),c=v=>g(void 0,null,function*(){yield Jn(v);for(const S of v){const h=a.value.find(i=>i.id==S);if(h){const i=te.editor.getModel(je.file(`${h.name||h.id}.ts`));i&&i.dispose()}}l.deleteTabs(v),d()}),m=(v,S)=>g(void 0,null,function*(){v.url||(v.url=""),v.enableDiffChecker=!0;const h=yield zn(v);return e.site.recordSiteLogVideo&&S&&(yield Be(h,S,v.isEmbedded)),Object.assign(v,yield _(h))}),_=(v,S,h)=>g(void 0,null,function*(){var I,V;v=v!=null?v:Z;const i=yield Kn(S||"all",v),b={id:i.id,name:i.name||"",body:i.body||"",config:i.config,url:i.url,eventType:i.eventType||h,codeType:i.codeType||S,version:i.version,scriptType:i.scriptType,isEmbedded:i.isEmbedded,isDecrypted:i.isDecrypted};return((I=b.codeType)==null?void 0:I.toLowerCase())==="event"&&!b.eventType&&(b.eventType="RouteFinding"),((V=b.codeType)==null?void 0:V.toLowerCase())==="api"&&!b.url&&(b.url=""),b});return ee(()=>{var v;return(v=e.site)==null?void 0:v.id},()=>{a.value=[],n.value=!1,Se().reset(),Pt()}),e.hasAccess("code","view")&&Gn().then(v=>u.value=v),{types:u,codes:a,codesInitialized:n,deleteCodes:c,updateCode:m,getCode:_,loadCodes:d,keywords:o,scriptTypes:[{key:"Classic",value:"Classic"},{key:"Module",value:"Module"}],ignoreCase:s,isRegex:t,codesByType:r}}),ra={key:0},ua=["title"],da={class:"ml-8px ellipsis flex-1","data-cy":"file-name"},ca={class:"pl-12 pr-4"},ae=G({props:{id:null,icon:null,title:null,remove:{type:Boolean},ignoreSearch:{type:Boolean},permission:null,padding:null,hasExpandRow:{type:Boolean},name:null},emits:["remove"],setup(e){const l=e,o=F(),t=De(),s=X(()=>{var n;return t.query.activity==="code search"?o.activeSearch===l.id:((n=o.activeTab)==null?void 0:n.id)===l.id}),u=He("keyword"),a=X(()=>{var n;return(n=l.name)!=null?n:l.title});return(n,r)=>{const d=be,c=at("hasPermission");return e.ignoreSearch||!p(u)||p(a).toLowerCase().indexOf(p(u).toLowerCase())>-1?(f(),M("div",ra,[R("div",{class:de(["group cursor-pointer h-26px flex items-center text-s space-x-4 group hover:bg-blue/30 pr-12",p(s)?"bg-blue/20 dark:text-fff/86":"dark:text-fff/60"]),title:e.title,style:$t(e.hasExpandRow?{paddingLeft:e.padding+"px"}:{paddingLeft:"18px"})},[k(d,{class:de(["iconfont",e.icon||"icon-code3"])},null,8,["class"]),R("div",da,J(e.title),1),R("div",{class:de(["transition-all ease-in-out opacity-0 group-hover:opacity-100 space-x-8",p(s)?"opacity-100":""]),onClick:r[1]||(r[1]=H(()=>{},["stop"]))},[Ke(n.$slots,"default"),e.remove?ie((f(),U(d,{key:0,class:"iconfont icon-delete hover:text-orange","data-cy":"delete",onClick:r[0]||(r[0]=m=>n.$emit("remove"))},null,512)),[[c,{feature:e.permission,action:"delete",effect:"hiddenIcon"}]]):j("",!0)],2)],14,ua),R("div",ca,[Ke(n.$slots,"collapse")])])):j("",!0)}}});var ma=`interface AlertOptions {\r
  title: string;\r
  body: string;\r
  width: string;\r
}\r
\r
interface CurrentMail {\r
  send: () => void;\r
  saveDraft: () => void;\r
  cancel: () => void;\r
  alert: (options: AlertOptions) => void;\r
  subject: string;\r
  to: string;\r
  html: string;\r
  from: string;\r
  dark: boolean;\r
  onDark: (value: boolean) => void;\r
}\r
\r
namespace KScript {\r
  declare interface k {\r
    currentMail: CurrentMail;\r
  }\r
}\r
\r
// declare const currentMail: CurrentMail;\r
`;let Yt=!1,To=!1,it={},rt={};const pa=["indexeddb","mysql","sqlserver","sqlite","mongo","sql","localdatabase","localsqlite"],va=[".find('",".findall('",".query('",".orderby('",".orderbydescending('",".where('"],fa=[">",">=","<","<=","=","==","!=","contains","startwith"],ya=[".skip(",".take(",".count("];function ga(e,l){let o=l.lineNumber;for(;o>0;){const t=e.getValueInRange({startLineNumber:o,startColumn:e.getLineFirstNonWhitespaceColumn(o),endLineNumber:o,endColumn:e.getLineFirstNonWhitespaceColumn(o)+1}),s=e.getValueInRange({startLineNumber:o-1,startColumn:e.getLineLastNonWhitespaceColumn(o===1?1:o-1),endLineNumber:o-1,endColumn:e.getLineLastNonWhitespaceColumn(o===1?1:o-1)+1});if(t==="."||s===".")o--;else break}return e.getValueInRange({startLineNumber:o,startColumn:1,endLineNumber:l.lineNumber,endColumn:l.column})}function Zt(e){return e.map(function(l){return{label:l,kind:te.languages.CompletionItemKind.Property,documentation:l,insertText:l,preselect:!0}})}function ba(e){To=e,it={},rt={},!Yt&&(Yt=!0,te.languages.registerCompletionItemProvider("typescript",{triggerCharacters:['"',"'","`"," ","(","."],provideCompletionItems(t,s){return g(this,null,function*(){return{suggestions:yield eo(t,s)}})}}),te.languages.registerCompletionItemProvider("html",{triggerCharacters:['"',"'","`"," ","(","."],provideCompletionItems(t,s){return g(this,null,function*(){const u=t.getLanguageIdAtPosition(s.lineNumber,s.column),a={suggestions:[]};return u=="javascript"&&(a.suggestions=yield eo(t,s)),a})}}))}function eo(e,l){return g(this,null,function*(){if(!To)return[];let o=ga(e,l).replace(/\s+/g,"").toLowerCase();const t=pa.find(a=>bt(o,["k.db."+a,"k.module."+a]));if(!t)return[];if(!it[t]){const a=Se();it[t]=yield hn(t,a.editingModule)}if(to(o,[`k.db.${t}.`,`k.module.${t}.`]))return Zt(it[t]);o=o.replace(/\"+/g,"'").replace(/\`+/g,"'");const s=it[t].find(function(a){return bt(o,[`k.db.${t}.${a}`,`k.module.${t}.${a}`,`k.db.${t}.gettable('${a}')`,`k.module.${t}.gettable('${a}')`])});if(!s)return[];const u=`${t}_${s}`;if(!rt[u]){const a=Se();rt[u]=yield xn(t,s,a.editingModule)}if(bt(o,va)&&!bt(o,ya)){const a=to(o,rt[u].map(n=>n.toLowerCase()));return Zt(a?fa:rt[u])}return[]})}function bt(e,l){for(const o of l)if(e.indexOf(o)>-1)return!0}function to(e,l){for(const o of l)if(e.endsWith(o))return!0}let oo=!1;function wa(){oo||(oo=!0,te.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"http://www.kooboo.com/module-setting-schema.json",fileMatch:["*/module.config"],schema:{type:"object",properties:{name:{type:"string"},version:{type:"string"},description:{type:"string"},settingDefines:{type:"array",items:{$ref:"http://www.kooboo.com/module-setting-define-schema.json"}},setting:{type:"object"}},required:["name","version"]}},{uri:"http://www.kooboo.com/module-setting-define-schema.json",schema:{type:"object",properties:{name:{type:"string"},type:{enum:["input","textarea","switch","number","select"]},defaultValue:{type:["string","number","null","boolean"]},description:{type:"string"},options:{type:"array",items:{type:["string","number","boolean"]}},display:{type:"string"}},required:["name","type"]}}]}))}const _a=e=>N.post(E("Route/Resolve"),{url:e}),ka=e=>N.get(E("Route/ListByType"),{type:e}),ha=(e,l)=>N.get(E("Route/IsUniqueName"),{name:e,oldName:l},{hiddenLoading:!0,hiddenError:!0});let Lt;function xa(e,l,o){if(!Lt){const t=e._codeEditorService.doOpenEditor.bind(e._codeEditorService);Lt=(s,u)=>{if(t(s,u),typeof l!="function"&&typeof o!="function")return;const{path:a,query:n}=u.resource,r=`${a}${n?"?"+n:""}`;_a(a).then(d=>{d?typeof l=="function"&&l(d):typeof o=="function"&&o(r)}).catch(()=>{typeof o=="function"&&o(r)})}}return Lt}function Ca(e,l,o){const t=e;t._codeEditorService.doOpenEditor=xa(t,l,o).bind(t._codeEditorService)}const he=G({props:{modelValue:null,language:null,kScript:{type:Boolean},kmail:{type:Boolean},options:null,uri:null,module:{type:Boolean}},emits:["update:modelValue","monacoLoadComplete"],setup(e,{expose:l,emit:o}){const t=e,s=C(),u=jt();let a,n;const r=new $e,d=ce(),c=qe(),m=Se(),_=F(),w=He(po),v=He(wn);l({focus:()=>g(this,null,function*(){yield r.promise,n==null||n.focus()}),goToLine:T=>g(this,null,function*(){var D,P;yield r.promise;const L=T||((D=n==null?void 0:n.getModel())==null?void 0:D.getLineCount())||0,O=((P=n==null?void 0:n.getModel())==null?void 0:P.getLineLength(L))||0;n==null||n.revealLineInCenter(L),n==null||n.setPosition({column:O+1,lineNumber:L}),n==null||n.focus()}),goto:T=>g(this,null,function*(){yield r.promise,n==null||n.setSelection(T),n==null||n.revealRangeInCenter(T)}),search:(T,L)=>g(this,null,function*(){var P,B;yield r.promise;let O;const D=(B=(P=n==null?void 0:n.getModel())==null?void 0:P.findMatches(T,!1,!1,!1,null,!1))==null?void 0:B.map(A=>(Number.isInteger(L)&&!O&&A.range.startLineNumber===L&&(O=A.range),{selectionStartLineNumber:A.range.startLineNumber,selectionStartColumn:A.range.startColumn,positionLineNumber:A.range.endLineNumber,positionColumn:A.range.endColumn}));O?(n==null||n.setSelection(O),n==null||n.revealRangeInCenter(O)):(D&&(n==null||n.setSelections(D)),D&&(n==null||n.revealLineInCenter(D[0].selectionStartLineNumber))),n==null||n.focus()}),format:()=>g(this,null,function*(){var T;yield(T=n==null?void 0:n.getAction("editor.action.formatDocument"))==null?void 0:T.run()}),replace:T=>g(this,null,function*(){var L=n==null?void 0:n.getSelection();if(!!L){var O=new te.Range(L.startLineNumber,L.startColumn,L.endLineNumber,L.endColumn);n==null||n.executeEdits("",[{range:O,text:T}])}})}),ee(()=>t.modelValue,()=>{var T;a&&a.getValue()!==t.modelValue&&a.setValue((T=t.modelValue)!=null?T:"")}),fn(()=>g(this,null,function*(){var T,L,O,D,P;if((L=(T=_.activeTab)==null?void 0:T.params)!=null&&L.moduleId){const B=(P=(D=(O=_.activeTab)==null?void 0:O.params)==null?void 0:D.file)==null?void 0:P.name;return m.files.filter(A=>A.objectType=="code"&&A.name!=B).map(A=>`./${A.name}`)}else{const B=c.codes.filter(K=>K.codeType=="CodeBlock").map(K=>`./${K.name}`),A=m.list.map(K=>`module:${K.name}`);return[...B,...A]}}));const x=["JSON","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","parseFloat","parseInt"];bn((T,L,O)=>(L==null?void 0:L.type)=="attribute"&&L.start==L.end?{suggestions:[],snippet:!1}:(L==null?void 0:L.type)!="content"&&(L==null?void 0:L.type)!="attribute"?{suggestions:O,snippet:!0}:{suggestions:O.filter(P=>{var A,K;if(P.kind=="keyword"||P.name=="globalThis"||P.name=="undefined"||P.name=="Vue")return!1;if(x.includes(P.name))return!0;var B=((A=P.kindModifiers)==null?void 0:A.indexOf("declare"))>-1;return!(((K=P.kindModifiers)==null?void 0:K.indexOf("deprecated"))>-1||B&&P.sortText==="15"&&(P.kind=="var"||P.kind=="module"||P.kind=="class"||P.kind=="function"))}),snippet:!1}),nt(()=>g(this,null,function*(){var D,P,B;d.site&&(yn(A=>g(this,null,function*(){let K=te.Uri.parse(A).path;if(K=K.substring(1,K.length-3),!K)throw new Error("empty path");if(K.startsWith("node_modules")){K=K.split("module:")[1];const ne=K.split("/")[0];let Le=K.split("/")[1];return yield sa("code",ne,Le)}else return(yield Hn(K)).body})),c.codesInitialized||c.loadCodes(),m.modulesInitialized||m.load());let T="";t.kScript&&(T=yield Cn()),t.language=="html"&&(yield $n());let L=t.uri;typeof L=="string"&&(L=te.Uri.parse(L)),L||(L=te.Uri.from({scheme:"memory",path:u})),a=te.editor.getModel(L),a?a.setValue((D=t.modelValue)!=null?D:""):a=te.editor.createModel((P=t.modelValue)!=null?P:"",t.language,L);function O(A,K){A=="javascript"&&Wt(K)&&K.length>10&&setTimeout(()=>{te.editor.setModelLanguage(a,"json")},1e3),t.language=="javascript"&&A=="json"&&(!Wt(K)||!(K!=null&&K.trim()))&&setTimeout(()=>{te.editor.setModelLanguage(a,"javascript")},1e3)}a.onDidChangeContent(()=>{const A=a.getValue(),K=a.getLanguageId();O(K,A),o("update:modelValue",A)}),n=te.editor.create(s.value,Oe(ge(ge({},vo),t.options),{model:a})),O(t.language,(B=t.modelValue)!=null?B:""),Sn(n),ba(t.kScript),wa(),Vn(n),t.kScript&&Qt(T,"default.d.ts"),t.kmail&&Qt(ma,"kmail.d.ts"),Ca(n,w,v),o("monacoLoadComplete",n),r.resolve(null)})),At(()=>{!a||(a.uri.scheme=="memory"&&a.dispose(),a.uri.toString()=="file:///00000000-0000-0000-0000-000000000000"&&a.dispose())});let y;return ee(()=>d.site,()=>{var T,L;if(!((L=(T=d.site)==null?void 0:T.unocssSettings)!=null&&L.enable)){y&&y();return}y=gn(JSON.parse(d.site.unocssSettings.config))},{immediate:!0,deep:!0}),ee(fo,T=>te.editor.setTheme(T?"vs-dark":"vs"),{immediate:!0}),(T,L)=>(f(),M("div",{ref_key:"container",ref:s,class:"w-full h-full min-h-300px min-w-400px monaco-editor bg-fff"},null,512))}}),$a={key:0,class:"h-full relative"},Sa={key:0,class:"absolute inset-0 flex items-center justify-center"},Va=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),u=qe(),a=F(),n=C(),r=Pe((i,b)=>{if(!((i==="url"||i==="scriptType")&&b))return b}),d=C(!1),c=C(),m=new $e,_=()=>g(this,null,function*(){n.value=yield u.getCode(t.id),m.resolve(null),r.init(n.value)}),w=()=>g(this,null,function*(){!n.value||n.value.isDecrypted||(yield u.updateCode(n.value,a.saveTabRecord(t.id)),r.init(n.value),o("changed",!1),o("setAction","save",{visible:!1}))}),v=i=>g(this,null,function*(){!n.value||(n.value.url=i.url,n.value.scriptType=i.scriptType)}),S=(i,b)=>g(this,null,function*(){yield m.promise,b?c.value.search(b,i):c.value.goToLine(i)});ee(()=>n.value,()=>{o("changed",r.changed(n.value)),o("setAction","save",{visible:r.changed(n.value)})},{deep:!0}),_(),l({save:w,load:_,config:d,goToLine:S,updateModel:v});const h=X(()=>{if(!!n.value)return`${n.value.name||n.value.id}.ts`});return At(()=>{if(!h.value)return;const i=te.editor.getModel(te.Uri.file(h.value)),b=r.getValue();i&&b&&i.setValue(JSON.parse(b).body)}),(i,b)=>{const I=xo;return n.value?(f(),M("div",$a,[n.value.isDecrypted?(f(),M("div",Sa,[k(I,{icon:"error",title:p(s)("common.codeEncryptedTip")},null,8,["title"])])):(f(),U(he,{key:1,ref_key:"editor",ref:c,modelValue:n.value.body,"onUpdate:modelValue":b[0]||(b[0]=V=>n.value.body=V),language:"typescript",uri:p(te).Uri.file(p(h)),"k-script":"",onMonacoLoadComplete:b[1]||(b[1]=V=>p(a).addTabRecord(t.id,V,"typescript"))},null,8,["modelValue","uri"]))])):j("",!0)}}}),Ta=G({props:{model:null,editMode:{type:Boolean}},setup(e,{expose:l}){const o=e,t=qe(),{t:s}=Y(),u=C(),a=Ee(()=>({name:o.editMode?[]:[_e(1,50),le(s("common.nameRequiredTips")),Te(),Ce(Wn,s("common.codeNameExistsTips"))],url:[le(s("common.urlRequiredTips"))]})),n=c=>{o.model&&!o.model.url&&(o.model.url=`/${c}`)},r=C();nt(()=>g(this,null,function*(){var c;if(((c=o.model.codeType)==null?void 0:c.toLocaleLowerCase())==="event"){const m=yield jn();r.value=[...new Set(m.map(_=>_.category))].map(_=>({category:_,events:m.filter(w=>w.category===_)}))}}));const d=C(!1);return ee(()=>o.model.url,c=>{d.value||o.editMode||(o.model.name=sn(c))}),l({validate:()=>{var c;return(c=u.value)==null?void 0:c.validate()}}),(c,m)=>{const _=me,w=pe,v=Bt,S=Mn,h=qt,i=wo,b=_o,I=ve;return e.model?(f(),U(I,{key:0,ref_key:"form",ref:u,model:e.model,rules:p(a),onSubmit:m[5]||(m[5]=H(()=>{},["prevent"]))},{default:$(()=>{var V;return[k(w,{label:p(s)("common.codeName"),prop:"name"},{default:$(()=>[k(_,{modelValue:e.model.name,"onUpdate:modelValue":m[0]||(m[0]=x=>e.model.name=x),class:"min-w-300px",disabled:e.editMode,title:e.model.name,"data-cy":"code-name",onChange:n,onInput:m[1]||(m[1]=x=>d.value=!0)},null,8,["modelValue","disabled","title"])]),_:1},8,["label"]),((V=e.model.codeType)==null?void 0:V.toLocaleLowerCase())==="api"?(f(),U(w,{key:0,label:"URL",prop:"url"},{default:$(()=>[k(_,{modelValue:e.model.url,"onUpdate:modelValue":m[2]||(m[2]=x=>e.model.url=x),class:"min-w-300px","data-cy":"url"},null,8,["modelValue"])]),_:1})):j("",!0),r.value?(f(),U(w,{key:1},{default:$(()=>[k(h,{modelValue:e.model.eventType,"onUpdate:modelValue":m[3]||(m[3]=x=>e.model.eventType=x),class:"min-w-300px w-full",disabled:e.editMode,"default-first-option":""},{default:$(()=>[(f(!0),M(q,null,W(r.value,x=>(f(),U(S,{key:x.category,label:x.category},{default:$(()=>[(f(!0),M(q,null,W(x.events,y=>(f(),U(v,{key:y.name,label:y.name,value:y.name},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):j("",!0),!(e.model.codeType=="PageScript"&&e.model.isEmbedded)&&e.model.codeType!="CodeBlock"?(f(),U(w,{key:2,label:p(s)("common.scriptType")},{default:$(()=>[k(b,{modelValue:e.model.scriptType,"onUpdate:modelValue":m[4]||(m[4]=x=>e.model.scriptType=x),class:"el-radio-group--rounded"},{default:$(()=>[(f(!0),M(q,null,W(p(t).scriptTypes,x=>(f(),U(i,{key:x.key,label:x.key,"data-cy":x.key},{default:$(()=>[Ae(J(x.value),1)]),_:2},1032,["label","data-cy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):j("",!0)]}),_:1},8,["model","rules"])):j("",!0)}}}),Me=G({props:{actions:null},setup(e,{expose:l}){const o=C(),t=C(!1),s=C(0),u=C(0),a=C();return l({openMenu:(r,d)=>{var c=t.value;t.value=!0,u.value=r.clientY,s.value=r.clientX,o.value=d,setTimeout(()=>{a.value.click(),c&&setTimeout(()=>{t.value=!0,setTimeout(()=>{a.value.click()})},0)},0)},payload:o}),(r,d)=>{const c=Vt,m=Ot,_=Tt;return t.value?(f(),M("div",{key:0,style:$t({top:u.value-2+"px",left:s.value-32+"px"}),class:"fixed"},[k(_,{trigger:"click",onCommand:d[1]||(d[1]=w=>w.invoke(o.value)),onVisibleChange:d[2]||(d[2]=w=>t.value=w)},{dropdown:$(()=>[k(m,null,{default:$(()=>[(f(!0),M(q,null,W(e.actions,w=>(f(),U(c,{key:w.name,command:w},{default:$(()=>[Ae(J(w.name),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:$(()=>[R("div",{ref_key:"trigger",ref:a,class:"w-64 h-8",onContextmenu:d[0]||(d[0]=H(()=>{},["stop","prevent"]))},null,544)]),_:1})],4)):j("",!0)}}}),Ma=G({setup(e){const l=C(!0);return(o,t)=>(f(),M("div",null,[R("div",{onClick:t[0]||(t[0]=H(s=>l.value=!l.value,["stop"]))},[Ke(o.$slots,"name",{flag:l.value})]),ie(R("div",null,[Ke(o.$slots,"default")],512),[[Qe,l.value]])]))}}),Ia=["title"],Ra={class:"hidden"},Ne=G({props:{data:null,showEdit:{type:Boolean},showSetting:{type:Boolean},permission:null,hiddenRemove:null},emits:["click-handle","remove","click-contextMenu","edit","setting"],setup(e,{emit:l}){const o=De(),t=He("keyword"),s=u=>!(u!=null&&u.children)||(u==null?void 0:u.children.length)===0?u.name.toLowerCase():s(u==null?void 0:u.children[0]);return(u,a)=>{const n=be,r=be,d=Dt("ReSubMenu",!0),c=at("hasPermission");return f(),M("div",null,[k(Ma,null,{name:$(({flag:m})=>{var _;return[p(t)&&s(e.data).includes((_=p(t))==null?void 0:_.toLowerCase())||!p(t)?(f(),M("div",{key:0,class:"h-26px border-b-1 border-gray dark:border-b-1 dark:border-999 flex items-center space-x-12 cursor-pointer pr-12 text-12px dark:text-fff/60",style:$t({paddingLeft:12+e.data.floor*6+"px"})},[k(n,{class:de(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",m?"rotate-180 ":"rotate-0"])},null,8,["class"]),R("span",{class:"ellipsis leading-26px",title:e.data.name},J(e.data.name),9,Ia),R("span",Ra,J(m),1)],4)):j("",!0)]}),default:$(()=>[(f(!0),M(q,null,W(e.data.children,m=>(f(),M(q,null,[m.children?(f(),U(d,{key:m.folderName,data:m,permission:e.permission,"hidden-remove":e.hiddenRemove,"show-edit":e.showEdit,"show-setting":e.showSetting,onRemove:a[0]||(a[0]=_=>l("remove",_)),onClickHandle:a[1]||(a[1]=_=>l("click-handle",_)),onEdit:a[2]||(a[2]=_=>l("edit",_)),onClickContextMenu:a[3]||(a[3]=_=>l("click-contextMenu",_))},null,8,["data","permission","hidden-remove","show-edit","show-setting"])):(f(),U(ae,{id:m.id,key:m.id,title:m.tabName,name:m.name,remove:!e.hiddenRemove,permission:e.permission,"has-expand-row":!0,padding:12+m.floor*6,onClick:_=>l("click-handle",m),onRemove:_=>l("remove",m.id),onContextmenu:H(_=>l("click-contextMenu",{event:_,item:m}),["prevent","stop"])},{default:$(()=>[e.showEdit?ie((f(),U(r,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:_=>l("edit",m)},null,8,["onClick"])),[[c,{feature:p(o).query.activity,action:"edit",effect:"hiddenIcon"}]]):j("",!0),e.showSetting?(f(),U(n,{key:1,class:"iconfont icon-a-setup hover:text-blue",onClick:_=>l("setting",m.id)},null,8,["onClick"])):j("",!0)]),_:2},1032,["id","title","name","remove","permission","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1})])}}}),La=["onKeydown"],Ze=oe.global.t,Ua={name:"code",icon:"icon-code",display:Ze("common.code"),route:"code",order:25,permission:"code",actions:[{name:"refresh",display:Ze("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ze("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"code"}))}}]},ut=e=>{const l=[{name:"save",display:Ze("common.save"),visible:!1,icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",display:Ze("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})}];e.codeType==="Api"&&l.push({name:"open",display:Ze("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=qe();let t=o.codes.find(s=>s.id===e.id);if(t||(yield o.loadCodes(),t=o.codes.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.previewUrl)}})}),F().addTab({id:e.id,name:e.name,panel:Va,icon:"icon-code",actions:l})},Ea=G({setup(e,{expose:l}){const{t:o}=Y(),t=De(),s=qe(),u=C(!1),a=C(),n=C(),r=C(),d=C(),c=()=>g(this,null,function*(){yield s.loadCodes()}),m=i=>g(this,null,function*(){a.value=i,n.value=yield s.getCode(void 0,i.key),u.value=!0}),_=()=>g(this,null,function*(){yield r.value.validate();const i=yield s.updateCode(n.value);ut(i),s.loadCodes(),h(i),u.value=!1}),w=i=>g(this,null,function*(){yield xe(),yield s.deleteCodes([i])}),v=(i,b)=>g(this,null,function*(){a.value=b,n.value=yield s.getCode(i,b.key),u.value=!0}),S=X(()=>{var b,I;var i=[{name:o("common.copyTitle"),invoke:V=>g(this,null,function*(){Ve(V.name)})}];return((I=(b=d.value)==null?void 0:b.payload)==null?void 0:I.codeType)=="Api"&&i.push({name:o("common.preview"),invoke:V=>g(this,null,function*(){const{onPreview:x}=we();x(V.previewUrl)})}),i});l({load:c});const h=He("updateTabModel");return(i,b)=>{var y,T,L;const I=be,V=ye,x=at("hasPermission");return f(),M("div",null,[(f(!0),M(q,null,W(p(s).types,(O,D)=>(f(),U(re,{key:D,permission:"code",title:O,add:"","expand-default":!0,onOnAdd:P=>m({key:D,value:O})},{default:$(()=>[D==="pageScript"?(f(!0),M(q,{key:0},W(p(s).codes.filter(P=>P.codeType==="PageScript"),P=>(f(),U(ae,{id:P.id,key:P.id,title:P.name,name:P.name,remove:"",permission:"code",onClick:B=>ut(P),onRemove:B=>w(P.id),onContextmenu:H(B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B,P)},["prevent","stop"])},{default:$(()=>[P.isEmbedded?j("",!0):ie((f(),U(I,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:B=>v(P.id,{key:D,value:O})},null,8,["onClick"])),[[x,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","onClick","onRemove","onContextmenu"]))),128)):(f(!0),M(q,{key:1},W(p(s).codesByType[D],P=>(f(),M(q,null,[P.children?(f(),U(Ne,{key:P.folderName+P.floor,data:P,"show-edit":D!=="codeBlock",permission:"code",onClickHandle:b[0]||(b[0]=B=>ut(B)),onEdit:B=>v(B.id,{key:B.key,value:B.value}),onRemove:b[1]||(b[1]=B=>w(B)),onClickContextMenu:B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B.event,B.item)}},null,8,["data","show-edit","onEdit","onClickContextMenu"])):(f(),U(ae,{id:P.id,key:P.id,title:P.name,name:P.name,remove:"",permission:"code",padding:12+P.floor*6,onClick:B=>ut(P),onRemove:B=>w(P.id),onContextmenu:H(B=>{var A;return(A=d.value)==null?void 0:A.openMenu(B,P)},["prevent","stop"])},{default:$(()=>[P.codeType!="CodeBlock"?ie((f(),U(I,{key:0,class:"iconfont icon-a-writein hover:text-blue",onClick:B=>v(P.id,{key:D,value:O})},null,8,["onClick"])),[[x,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]]):j("",!0)]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:2},1032,["title","onOnAdd"]))),128)),R("div",{onClick:b[4]||(b[4]=H(()=>{},["stop"]))},[k(V,{modelValue:u.value,"onUpdate:modelValue":b[3]||(b[3]=O=>u.value=O),width:"600px","close-on-click-modal":!1,title:((y=n.value)==null?void 0:y.id)==p(Z)?p(o)("code.newCode",{name:(T=a.value)==null?void 0:T.value}):p(o)("code.editCode",{name:(L=a.value)==null?void 0:L.value}),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:b[2]||(b[2]=O=>u.value=!1)})]),default:$(()=>{var O;return[R("div",{onKeydown:ue(_,["enter"])},[n.value?(f(),U(Ta,{key:0,ref_key:"form",ref:r,"label-position":"top",model:n.value,"edit-mode":((O=n.value)==null?void 0:O.id)!==p(Z)},null,8,["model","edit-mode"])):j("",!0)],40,La)]}),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:d,actions:p(S)},null,8,["actions"])])}}});var Na=Object.freeze(Object.defineProperty({__proto__:null,define:Ua,open:ut,default:Ea},Symbol.toStringTag,{value:"Module"}));const Aa={class:"transition-all px-8 py-4 flex items-center space-x-4 cursor-pointer rounded-normal dark:text-fff/86 !hover:text-blue"},Da={class:"text-s"},Je=G({props:{icon:null,display:null,shortcut:null},setup(e){return(l,o)=>{const t=be;return f(),M("div",Aa,[k(t,{class:de(["iconfont",e.icon])},null,8,["class"]),R("span",null,J(e.display),1),R("span",Da,J(`(${e.shortcut})`),1)])}}}),ja={class:"py-4 px-8 flex items-center border-b border-solid border-line text-m dark:bg-[#252526]"},Pa=G({props:{debugSession:null},setup(e){const l=e,o=F(),{t}=Y(),s=Ee(()=>{var a;return(a=o.activeTab)==null?void 0:a.id.startsWith(Ye)});Fe("StartDebug",()=>{s.value&&Xt()}),Fe("DebugContinue",()=>{s.value&&Ie("None")}),Fe("DebugInto",()=>{s.value&&Ie("Into")}),Fe("DebugOver",()=>{s.value&&Ie("Over")}),Fe("DebugOut",()=>{s.value&&Ie("Out")}),Fe("DebugStop",()=>{s.value&&Ie("Stop")});const u=Ee(()=>{var a;return!l.debugSession||((a=l.debugSession)==null?void 0:a.end)});return(a,n)=>(f(),M("div",ja,[p(u)?(f(),U(Je,{key:0,icon:"icon-play1",display:p(t)("common.start"),shortcut:"F8",onClick:n[0]||(n[0]=r=>p(Xt)())},null,8,["display"])):(f(),M(q,{key:1},[k(Je,{icon:"icon-play2",display:p(t)("common.continue"),shortcut:"F5",onClick:n[1]||(n[1]=r=>p(Ie)("None"))},null,8,["display"]),k(Je,{icon:"icon-debug-step-into",display:p(t)("common.stepInto"),shortcut:"F11",onClick:n[2]||(n[2]=r=>p(Ie)("Into"))},null,8,["display"]),k(Je,{icon:"icon-a-debug-step-over",display:p(t)("common.stepOver"),shortcut:"F10",onClick:n[3]||(n[3]=r=>p(Ie)("Over"))},null,8,["display"]),k(Je,{icon:"icon-a-debug-step-out",display:p(t)("common.stepOut"),shortcut:"Shift + F11",onClick:n[4]||(n[4]=r=>p(Ie)("Out"))},null,8,["display"]),k(Je,{icon:"icon-delete4",display:p(t)("common.stop"),shortcut:"Shift + F5",onClick:n[5]||(n[5]=r=>p(Ie)("stop"))},null,8,["display"])],64))]))}});const Oa={key:0,class:"json-tree-row"},Fa={key:0,class:"json-tree-key"},Ba={key:1,class:"json-tree-colon"},qa=["title"],Ga={key:2,class:"json-tree-comma"},Ka=R("span",{class:"json-tree-indent"},"\xA0",-1),Ha={key:1,class:"json-tree-deep"},za=R("span",{class:"json-tree-indent"},"\xA0",-1),Ja={class:"json-tree-sign"},Wa={key:0,class:"json-tree-key"},Qa={key:1,class:"json-tree-colon"},Xa={class:"json-tree-open"},Ya={class:"json-tree-comma"},Za=R("span",{class:"json-tree-indent"},"\xA0",-1),el={class:"json-tree-deeper"},tl={class:"json-tree-row"},ol={class:"json-tree-close"},nl={key:0,class:"json-tree-comma"},al=R("span",{class:"json-tree-indent"},"\xA0",-1),Nt=G({props:{level:null,kv:null,raw:null,data:null},setup(e){const l=e,o=(n,r=0,d=!0,c=void 0)=>{let m={depth:r,last:d,primitive:!0,key:JSON.stringify(c)};if(typeof n!="object")return Object.assign(m,{type:typeof n,value:JSON.stringify(n)});if(n===null)return Object.assign(m,{type:"null",value:"null"});if(Array.isArray(n)){let _=n.map((w,v)=>o(w,r+1,v===n.length-1));return Object.assign(m,{primitive:!1,type:"array",value:_})}else{let _=Object.keys(n),w=_.map((v,S)=>o(n[v],r+1,S===_.length-1,v));return Object.assign(m,{primitive:!1,type:"object",value:w})}},t=C(!0),s=C(!1),u=X(()=>{if(l.kv)return l.kv;let n;try{l.raw?n=JSON.parse(l.raw):typeof l.data!="undefined"?n=l.data:(n="[Vue JSON Tree] No data passed.",console.warn(n))}catch(r){n="[Vue JSON Tree] Invalid raw JSON.",console.warn(n)}return o(n)}),a=n=>n>1?`${n} items`:n?"1 item":"no items";return(n,r)=>{const d=Dt("JsonTree",!0);return f(),M("span",{class:de(["json-tree",{"json-tree-root":p(u).depth===0}])},[p(u).primitive?(f(),M("span",Oa,[(f(!0),M(q,null,W(p(u).depth*2+3,c=>(f(),M("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),p(u).key?(f(),M("span",Fa,J(p(u).key),1)):j("",!0),p(u).key?(f(),M("span",Ba,":\xA0")):j("",!0),R("span",{class:de(["json-tree-value","json-tree-value-"+p(u).type]),title:`${p(u).value}`},J(`${p(u).value}`),11,qa),p(u).last?j("",!0):(f(),M("span",Ga,",")),Ka])):j("",!0),p(u).primitive?j("",!0):(f(),M("span",Ha,[R("span",{class:"json-tree-row json-tree-expando",onClick:r[0]||(r[0]=c=>t.value=!t.value),onMouseover:r[1]||(r[1]=c=>s.value=!0),onMouseout:r[2]||(r[2]=c=>s.value=!1)},[za,R("span",Ja,J(t.value?"-":"+"),1),(f(!0),M(q,null,W(p(u).depth*2+1,c=>(f(),M("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),p(u).key?(f(),M("span",Wa,J(p(u).key),1)):j("",!0),p(u).key?(f(),M("span",Qa,":\xA0")):j("",!0),R("span",Xa,J(p(u).type==="array"?"[":"{"),1),ie(R("span",{class:"json-tree-collapsed"},"\xA0/*\xA0"+J(a(p(u).value.length))+"\xA0*/\xA0",513),[[Qe,!t.value]]),ie(R("span",{class:"json-tree-close"},J(p(u).type==="array"?"]":"}"),513),[[Qe,!t.value]]),ie(R("span",Ya,",",512),[[Qe,!t.value&&!p(u).last]]),Za],32),ie(R("span",el,[(f(!0),M(q,null,W(p(u).value,(c,m)=>(f(),U(d,{key:m,kv:c,level:e.level},null,8,["kv","level"]))),128))],512),[[Qe,t.value]]),ie(R("span",tl,[R("span",{class:de(["json-tree-ending",{"json-tree-paired":s.value}])},[(f(!0),M(q,null,W(p(u).depth*2+3,c=>(f(),M("span",{key:c,class:"json-tree-indent"},"\xA0"))),128)),R("span",ol,J(p(u).type==="array"?"]":"}"),1),p(u).last?j("",!0):(f(),M("span",nl,",")),al],2)],512),[[Qe,t.value]])]))],2)}}}),ll={class:"space-x-8 flex items-center dark:bg-[#202428]"},sl=["disabled","placeholder","onKeydown"],il=G({props:{debugSession:null},setup(e){const l=e,{t:o}=Y(),t=C(""),s=C([]),u=X(()=>{var r;return!l.debugSession||((r=l.debugSession)==null?void 0:r.end)}),a=()=>g(this,null,function*(){if(!t.value)return;const r=yield Yn(t.value);t.value="",s.value.unshift(r)}),n=r=>{try{return JSON.parse(r)}catch(d){return r}};return(r,d)=>{var _;const c=be,m=mo;return f(),M(q,null,[R("div",ll,[k(c,{class:de(["iconfont icon-a-nextstep2 dark:text-fff/86",p(u)?"":" animate-pulse animate-duration-1000"])},null,8,["class"]),ie(R("input",{"onUpdate:modelValue":d[0]||(d[0]=w=>t.value=w),disabled:!e.debugSession||((_=e.debugSession)==null?void 0:_.end),class:de(["outline-none w-full bg-transparent dark:text-fff/86",p(u)?"cursor-not-allowed":""]),placeholder:p(o)("common.inputCodeToExecuteTips"),onKeydown:ue(a,["enter"])},null,42,sl),[[so,t.value]])]),k(m,{class:"dark:bg-[#202428]"},{default:$(()=>[(f(!0),M(q,null,W(s.value,(w,v)=>(f(),M("div",{key:v},[k(Nt,{data:n(w)},null,8,["data"])]))),128))]),_:1})],64)}}});function rl(e,l,o){const t=[];for(const s of e)t.push({range:new te.Range(s,1,s,1),options:{glyphMarginClassName:"kooboo-debug-breakpoint"}});return l!==void 0&&t.push({range:new te.Range(l,1,l,1),options:{isWholeLine:!0,className:"kooboo-debug-executing"}}),o!==void 0&&t.push({range:new te.Range(o,1,o,1),options:{glyphMarginClassName:"kooboo-debug-hover"}}),t}const ul=G({props:{modelValue:null,options:null,breakpoints:null,executing:null},emits:["update:modelValue","click"],setup(e,{emit:l}){const o=e,t=C(),s=jt();let u,a,n,r=C();ee(()=>o.modelValue,()=>{var c;u&&u.getValue()!==o.modelValue&&u.setValue((c=o.modelValue)!=null?c:"")});const d=()=>{if(!a)return;const c=u.getLineCount(),m=o.breakpoints.filter(_=>_<=c);n=a.deltaDecorations(n||[],rl(m,o.executing,r.value))};return ee([()=>o.breakpoints.toString(),()=>o.modelValue,r,()=>o.executing],d),nt(()=>g(this,null,function*(){u=te.editor.createModel(o.modelValue,"typescript",te.Uri.file(s)),a=te.editor.create(t.value,Oe(ge(ge({},vo),o.options),{model:u,glyphMargin:!0,readOnly:!0,minimap:{enabled:!1}})),a.onMouseDown(c=>{var w,v,S,h;if(((v=(w=c==null?void 0:c.target)==null?void 0:w.detail)==null?void 0:v.glyphMarginLeft)===void 0||(h=(S=c==null?void 0:c.target)==null?void 0:S.detail)!=null&&h.isAfterLines)return;const m=c.target.position.lineNumber,_=a.getModel().getLineFirstNonWhitespaceColumn(m);l("click",{line:m,column:_})}),a.onMouseMove(c=>{var m,_;r.value=(_=(m=c==null?void 0:c.target)==null?void 0:m.position)==null?void 0:_.lineNumber}),d()})),At(()=>{u==null||u.dispose()}),ee(fo,c=>te.editor.setTheme(c?"vs-dark":"vs"),{immediate:!0}),(c,m)=>(f(),M("div",{ref_key:"container",ref:t,class:"w-full h-full min-h-300px min-w-400px monaco-editor bg-fff"},null,512))}}),dl={key:0,class:"h-full flex bg-fff"},cl={class:"flex-1 flex flex-col"},ml={class:"flex-1 text-m font-mono relative"},pl={class:"absolute inset-0"},vl={class:"h-238px border-t border-solid border-line dark:bg-[#202428] p-4 text-s font-mono"},fl={key:0,class:"w-300px border-l border-solid border-line relative"},yl=G({props:{id:null},emits:["setAction"],setup(e,{expose:l,emit:o}){const t=e,s=qe(),u=F(),a=C(),n=C();let r=!0;const d=C(t.id.replace(Ye,"")),c=()=>g(this,null,function*(){if(!!r){try{n.value=yield Qn(),n.value.currentCode&&!n.value.end&&(yield m(n.value.currentCode))}catch(b){console.log(b)}setTimeout(()=>g(this,null,function*(){yield c()}),500)}}),m=b=>g(this,null,function*(){b!==d.value&&(b&&(d.value=b),u.debugTab&&(a.value=yield s.getCode(d.value),u.debugTab.name=a.value.name,o("setAction","open",{visible:!!a.value.url})))}),_=()=>g(this,null,function*(){a.value=yield s.getCode(d.value)}),w=X(()=>n.value?n.value.breakpoints.filter(b=>b.source===d.value).map(b=>b.line):[]),v=X(()=>{var b,I,V;if(!((b=n.value)!=null&&b.end))return(V=(I=n.value)==null?void 0:I.debugInfo)==null?void 0:V.currentLine}),S=b=>g(this,null,function*(){!n.value||(n.value.breakpoints=yield Xn({source:d.value,line:b.line,column:b.column}))});io(()=>{r=!1}),m(),c(),l({load:m,reload:_,currentCode:d});const h=C(),i=C();return ee(()=>n.value,()=>{var b,I,V;h.value=(b=n.value)==null?void 0:b.exception,i.value=(V=(I=n.value)==null?void 0:I.debugInfo)==null?void 0:V.variables},{deep:!0}),(b,I)=>{const V=mo;return a.value?(f(),M("div",dl,[R("div",cl,[k(Pa,{class:"border-b border-solid border-line","debug-session":n.value},null,8,["debug-session"]),R("div",ml,[R("div",pl,[k(ul,{modelValue:a.value.body,"onUpdate:modelValue":I[0]||(I[0]=x=>a.value.body=x),breakpoints:p(w),executing:p(v),onClick:S},null,8,["modelValue","breakpoints","executing"])])]),R("div",vl,[k(il,{"debug-session":n.value},null,8,["debug-session"])])]),h.value||i.value?(f(),M("div",fl,[k(V,null,{default:$(()=>[h.value?(f(),U(Nt,{key:0,data:h.value},null,8,["data"])):i.value?(f(),U(Nt,{key:1,data:i.value},null,8,["data"])):j("",!0)]),_:1})])):j("",!0)])):j("",!0)}}}),no=oe.global.t,gl={name:"debug",icon:"icon-debugging",display:no("common.debug"),order:90,permission:"debug",actions:[{name:"refresh",display:no("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}}]},bl=G({setup(e,{expose:l}){const{t:o}=Y(),t=qe(),s=F(),u=C(),a=C(),n=m=>t.codes.filter(_=>{var w;return((w=_.codeType)==null?void 0:w.toLowerCase())===(m==null?void 0:m.toLowerCase())}),r=m=>{s.addTab({id:Ye+m.id,name:m.name,panel:yl,icon:"icon-debugging",actions:[{name:"refresh",display:o("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(this,null,function*(){var w,v;const _=yield(v=(w=F().activeTab)==null?void 0:w.panelInstance)==null?void 0:v.promise;!_||_.reload()})},{name:"open",visible:!1,display:o("common.preview"),icon:"icon-eyes",invoke:()=>g(this,null,function*(){var v,S;const _=yield(S=(v=F().activeTab)==null?void 0:v.panelInstance)==null?void 0:S.promise;if(!_)return;const w=t.codes.find(h=>h.id===_.currentCode);if(w){const{onPreview:h}=we();h(w.previewUrl)}})}]})},d=()=>{t.loadCodes()};ee(()=>s.debugTab,m=>g(this,null,function*(){u.value=yield m==null?void 0:m.panelInstance.promise}));const c=X(()=>{var _,w;var m=[{name:o("common.copyTitle"),invoke:v=>g(this,null,function*(){Ve(v.name)})}];return((w=(_=a.value)==null?void 0:_.payload)==null?void 0:w.codeType)=="Api"&&m.push({name:o("common.preview"),invoke:v=>g(this,null,function*(){const{onPreview:S}=we();S(v.previewUrl)})}),m});return l({load:d}),(m,_)=>(f(),M("div",null,[(f(!0),M(q,null,W(p(t).types,(w,v)=>(f(),M(q,{key:v},[n(v).length?(f(),U(re,{key:0,title:w,"expand-default":!0,permission:"debug"},{default:$(()=>[v==="pageScript"?(f(!0),M(q,{key:0},W(p(t).codes.filter(S=>S.codeType==="PageScript"),S=>{var h;return f(),U(ae,{id:S.id,key:S.id,class:de(((h=u.value)==null?void 0:h.currentCode)===S.id?"bg-blue/20 dark:text-fff/86":""),title:S.name,name:S.name,permission:"debug",onClick:i=>r(S),onContextmenu:H(i=>{var b;return(b=a.value)==null?void 0:b.openMenu(i,S)},["prevent","stop"])},null,8,["id","class","title","name","onClick","onContextmenu"])}),128)):(f(!0),M(q,{key:1},W(p(t).codesByType[v],S=>{var h;return f(),M(q,null,[S.children?(f(),U(Ne,{key:S.folderName+S.floor,data:S,permission:"debug","hidden-remove":"true",onClickHandle:_[0]||(_[0]=i=>r(i)),onClickContextMenu:i=>{var b;return(b=a.value)==null?void 0:b.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:S.id,key:S.id,class:de(((h=u.value)==null?void 0:h.currentCode)===S.id?"bg-blue/20 dark:text-fff/86":""),title:S.name,name:S.name,permission:"debug",padding:12+S.floor*6,onContextmenu:H(i=>{var b;return(b=a.value)==null?void 0:b.openMenu(i,S)},["prevent","stop"]),onClick:i=>r(S)},null,8,["id","class","title","name","padding","onContextmenu","onClick"]))],64)}),256))]),_:2},1032,["title"])):j("",!0)],64))),128)),k(Me,{ref_key:"contextMenu",ref:a,actions:p(c)},null,8,["actions"])]))}});var wl=Object.freeze(Object.defineProperty({__proto__:null,define:gl,default:bl},Symbol.toStringTag,{value:"Module"}));const Mo=oe.global.t,_l=()=>N.get(E("Form/External",!0)),kl=()=>N.get(E("Form/Embedded",!0)),hl=e=>N.post(E("Form/Deletes"),{ids:e},void 0,{successMessage:Mo("common.deleteSuccess")}),xl=e=>N.get(E("Form/GetEdit"),{id:e}),Cl=e=>N.post(E("Form/post"),e),$l=e=>N.post(E("Form/UpdateSetting"),e),Sl=e=>N.get(E("Form/GetSetting"),{id:e}),Vl=e=>N.get(E("Form/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Tl=(e,l)=>N.get(E("Form/FormValues"),{id:e,pageNr:l,pageSize:30}),Ml=e=>N.post(E("Form/DeleteFormValues"),{ids:e},void 0,{successMessage:Mo("common.deleteSuccess")}),Io=Re("formStore",()=>{const e=ce(),l=F(),o=C([]),t=C([]),s=()=>g(void 0,null,function*(){o.value=yield _l()}),u=()=>g(void 0,null,function*(){t.value=yield kl()}),a=X(()=>l.getSplitNameData(o.value)),n=()=>Promise.all([s(),u()]),r=w=>g(void 0,null,function*(){yield hl(w),l.deleteTabs(w),n()}),d=w=>g(void 0,null,function*(){w=w||Z;const v=yield xl(w);return v.body||(v.body=""),v.id=w,v}),c=(w,v)=>g(void 0,null,function*(){w.body||(w.body=" ");const S=yield Cl(w);return e.site.recordSiteLogVideo&&v&&(yield Be(S,v,w.isEmbedded)),S}),m=(w,v)=>g(void 0,null,function*(){w=w||Z;const S=yield Tl(w,v);return S.id=w,S}),_=w=>g(void 0,null,function*(){yield Ml(w)});return ee(()=>{var w;return(w=e.site)==null?void 0:w.id},()=>{t.value=[],o.value=[]}),{external:o,embedded:t,getExternalFormList:a,loadAll:n,deleteForms:r,getForm:d,updateForm:c,getFormValues:m,deleteFormValues:_}}),Il={key:0,class:"h-full"},Rl=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Io(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getForm(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateForm(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))});ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0});const _=(w,v)=>g(this,null,function*(){yield d.promise,v?r.value.search(v,w):r.value.goToLine(w)});return c(),l({save:m,load:c,goToLine:_}),(w,v)=>a.value?(f(),M("div",Il,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:v[1]||(v[1]=S=>p(u).addTabRecord(t.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Ll={key:0,class:"h-40px leading-10 dark:text-[#fffa]"},Ul=G({props:{model:null},setup(e,{expose:l}){const o=e,t=De(),{t:s}=Y(),u=C(),a=X(()=>{var r;return o.model.id&&o.model.id===Z&&!((r=o.model)!=null&&r.isEmbedded)}),n=X(()=>({name:a.value?[le(s("common.fieldRequiredTips")),_e(1,50),Te(),Ce(Vl,s("common.valueHasBeenTakenTips"))]:[]}));return l({validate:()=>{var r;return(r=u.value)==null?void 0:r.validate()}}),(r,d)=>{const c=me,m=pe,_=ve;return p(t).query.type==="embedded"?(f(),M("span",Ll,J(p(s)("common.embeddedForm")),1)):(f(),U(_,{key:1,ref_key:"form",ref:u,model:e.model,rules:p(n),onSubmit:d[1]||(d[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(m,{label:p(s)("common.formName"),prop:"name"},{default:$(()=>[k(c,{modelValue:e.model.name,"onUpdate:modelValue":d[0]||(d[0]=w=>e.model.name=w),class:"min-w-300px",disabled:!p(a),title:e.model.name,"data-cy":"form-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"]))}}}),vt=oe.global.t,El=()=>N.get(E("Page/all",!0)),Nl=e=>N.post(E("Page/Deletes"),{ids:e},void 0,{successMessage:vt("common.deleteSuccess")}),ad=()=>N.get(E("Page/DefaultRoute")),ld=e=>N.post(E("Page/DefaultRouteUpdate"),e,void 0,{successMessage:vt("common.saveSuccess")}),sd=e=>N.post(E("Page/ConvertFile"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},hiddenError:!0,successMessage:vt("common.importSuccess"),errorMessage:vt("common.importFailed"),keepShowErrorMessage:!0}),Ro=e=>N.get(E("Page/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Lo=(e,l)=>ha(e,l),id=e=>N.post(E("Page/Copy"),e,void 0,{successMessage:vt("common.copySuccess")}),Al=e=>N.post(E("Page/post"),e),Dl=e=>N.post(E("Page/PostRichText"),e),jl=(e,l)=>N.get(E("Page/GetEdit"),ge({id:e},l)),rd=e=>N.get(E("Page/PageStructure"),{id:e}),ud=()=>N.get(E("Page/GetDesignTemplate"),{env:"production"}),dd=e=>N.get(E("GroupEdit/Tree"),{includeScript:e}),cd=(e,l)=>N.post(E("GroupEdit/Search"),{SearchParams:l,includeScript:e}),md=()=>N.get(E("GroupEdit/GetSiteRunningTask")),pd=()=>N.get(E("GroupEdit/ViewNames")),vd=()=>N.get(E("GroupEdit/PageNames")),fd=()=>N.get(E("GroupEdit/BlockNames")),yd=e=>N.post(E("GroupEdit/GetOuterHtml"),{pages:e}),gd=e=>N.post(E("GroupEdit/GetInnerHtml"),{pages:e}),bd=e=>N.get(E(`GroupEdit/GetViewBody?name=${e}`)),wd=e=>N.get(E(`GroupEdit/GetHtmlBlockBody?name=${e}`)),_d=(e,l)=>N.post(E("GroupEdit/EditOuterHtml"),{pages:e,NewBody:l}),kd=(e,l)=>N.post(E("GroupEdit/EditInnerHtml"),{pages:e,NewBody:l}),hd=e=>N.post(E("GroupEdit/DeleteDom"),{pages:e}),xd=(e,l,o,t)=>N.post(E("GroupEdit/ToHtmlBlock"),{pages:e,name:l,body:o,UseExisting:t}),Cd=(e,l,o,t)=>N.post(E("GroupEdit/ToView"),{pages:e,viewName:l,body:o,UseExisting:t}),$d=e=>N.get(E(`GroupEdit/GetTaskStatus?TaskId=${e}`)),ft=Re("pageStore",()=>{const e=C([]),l=ce(),o=F(),t=X(()=>o.getSplitNameData(e.value.filter(m=>["Normal","Designer"].includes(m.type)&&m.layoutId===Z))),s=X(()=>o.getSplitNameData(e.value.filter(m=>m.layoutId!==Z))),u=X(()=>o.getSplitNameData(e.value.filter(m=>m.type==="RichText"))),a=()=>g(void 0,null,function*(){const m=yield El();return e.value=m,m}),n=m=>g(void 0,null,function*(){yield Nl(m),o.deleteTabs(m),a()}),r=(m,_)=>g(void 0,null,function*(){m.body||(m.body=" ");const w=yield Dl(m);return l.site.recordSiteLogVideo&&_&&(yield Be(w,_)),w}),d=(m,_)=>g(void 0,null,function*(){const w=yield jl(m||Z,_);return w.body||(w.body=""),w}),c=(m,_)=>g(void 0,null,function*(){m.enableDiffChecker=!0;const w=yield Al(m);return l.site.recordSiteLogVideo&&_&&(yield Be(w,_)),Object.assign(m,yield d(w))});return ee(()=>{var m;return(m=l.site)==null?void 0:m.id},()=>{e.value=[]}),{list:e,deletePages:n,load:a,updateRichPage:r,getPage:d,updatePage:c,getNormalPage:t,getLayoutPage:s,getRichPage:u}}),Pl=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const o=e,{t}=Y(),s=C(!0),u=ft(),a=C(),n=C({id:"",formId:"",method:"get",redirectUrl:"RefreshSelf()",setting:{},formSubmitter:"",enable:!1});Sl(o.id).then(m=>{a.value=m,n.value.id=a.value.id,n.value.formId=a.value.formId,n.value.redirectUrl=a.value.redirectUrl,n.value.formSubmitter=a.value.formSubmitter,n.value.enable=a.value.enable,n.value.method=a.value.method||"get",n.value.setting=a.value.setting});const r=X(()=>{const m=[];m.push({key:"RefreshSelf()",value:t("common.refreshSelf")});for(const _ of u.list)m.push({key:_.path,value:_.name});return m}),d=()=>g(this,null,function*(){yield $l(n.value),s.value=!1}),c=X(()=>{if(!a.value)return[];const m=a.value.availableSubmitters.find(_=>_.name===n.value.formSubmitter);return(m==null?void 0:m.settings)||[]});return u.load(),(m,_)=>{const w=Ft,v=pe,S=wo,h=_o,i=Bt,b=qt,I=me,V=ve,x=ye;return f(),M("div",{onClick:_[8]||(_[8]=H(()=>{},["stop"]))},[k(x,{"model-value":s.value,width:"600px","close-on-click-modal":!1,title:p(t)("common.formSetting"),onClosed:_[7]||(_[7]=y=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"form",action:"edit"},onConfirm:d,onCancel:_[6]||(_[6]=y=>s.value=!1)})]),default:$(()=>[a.value?(f(),U(V,{key:0,ref:"form","label-position":"top",model:n.value,onKeydown:ue(d,["enter"])},{default:$(()=>[k(v,{label:p(t)("common.enable")},{default:$(()=>[k(w,{modelValue:n.value.enable,"onUpdate:modelValue":_[0]||(_[0]=y=>n.value.enable=y),"data-cy":"enable"},null,8,["modelValue"])]),_:1},8,["label"]),n.value.enable?(f(),M(q,{key:0},[k(v,{label:p(t)("common.method")},{default:$(()=>[k(h,{modelValue:n.value.method,"onUpdate:modelValue":_[1]||(_[1]=y=>n.value.method=y),class:"el-radio-group--rounded"},{default:$(()=>[(f(),M(q,null,W(["get","post"],y=>k(S,{key:y,label:y,"data-cy":`method-${y}`},{default:$(()=>[Ae(J(y),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),k(v,{label:p(t)("common.redirectTo")},{default:$(()=>[k(b,{modelValue:n.value.redirectUrl,"onUpdate:modelValue":_[2]||(_[2]=y=>n.value.redirectUrl=y),class:"w-full",filterable:"","allow-create":"","default-first-option":"","data-cy":"redirect-dropdown"},{default:$(()=>[(f(!0),M(q,null,W(p(r),y=>(f(),U(i,{key:y.key,value:y.key,label:y.value,"data-cy":"redirect-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),k(v,{label:p(t)("common.submitter")},{default:$(()=>[k(b,{modelValue:n.value.formSubmitter,"onUpdate:modelValue":_[3]||(_[3]=y=>n.value.formSubmitter=y),class:"w-full","data-cy":"submitter-dropdown",onChange:_[4]||(_[4]=y=>n.value.setting={})},{default:$(()=>[(f(!0),M(q,null,W(a.value.availableSubmitters,y=>(f(),U(i,{key:y.name,value:y.name,label:y.name,"data-cy":"submitter-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),n.value.formSubmitter=="SubmitToExternal"?(f(),U(v,{key:0},{default:$(()=>[k(I,{modelValue:n.value.setting.url,"onUpdate:modelValue":_[5]||(_[5]=y=>n.value.setting.url=y),placeholder:"http://www.domain.com/receive","data-cy":"url"},null,8,["modelValue"])]),_:1})):(f(!0),M(q,{key:1},W(p(c),y=>(f(),U(v,{key:y.name,label:y.name},{default:$(()=>[k(b,{modelValue:n.value.setting[y.name.replace(y.name[0],y.name[0].toLocaleLowerCase())],"onUpdate:modelValue":T=>n.value.setting[y.name.replace(y.name[0],y.name[0].toLocaleLowerCase())]=T,class:"w-full",filterable:"","allow-create":"","default-first-option":"","data-cy":"submitter-object-dropdown"},{default:$(()=>[(f(!0),M(q,null,W(y.selectionValues,(T,L)=>(f(),U(i,{key:L,value:L,label:T,"data-cy":"submitter-object-opt"},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))],64)):j("",!0)]),_:1},8,["model","onKeydown"])):j("",!0)]),_:1},8,["model-value","title"])])}}}),Ol=["onKeydown"],ct=oe.global.t,Fl={name:"forms",icon:"icon-page",display:ct("common.form"),route:"forms",order:70,permission:"form",actions:[{name:"refresh",display:ct("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:ct("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"forms"}))}}]},dt=e=>{F().addTab({id:e.id,name:e.name,panel:Rl,icon:"icon-page",actions:[{name:"save",display:ct("common.save"),visible:!1,icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.save()})},{name:"refresh",display:ct("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.load()})}]})},Bl=G({setup(e,{expose:l}){const{t:o}=Y(),t=Io(),s=C(!1),u=C(!1),a=C(""),n=C(),r=C(),d=C(),c=()=>{t.loadAll()},m=()=>g(this,null,function*(){r.value=yield t.getForm(),s.value=!0}),_=()=>g(this,null,function*(){yield n.value.validate();const h=yield t.updateForm(r.value);yield t.loadAll();const i=t.external.find(b=>b.id==h);i&&dt(i),s.value=!1}),w=h=>g(this,null,function*(){yield xe(),yield t.deleteForms([h])}),v=h=>{a.value=h,u.value=!0},S=[{name:o("common.copyTitle"),invoke:h=>g(this,null,function*(){Ve(h.name)})}];return l({load:c}),(h,i)=>{const b=be,I=ye;return f(),M("div",null,[k(re,{title:p(o)("common.external"),add:"","expand-default":!0,permission:"form",onOnAdd:m},{default:$(()=>[(f(!0),M(q,null,W(p(t).getExternalFormList,V=>(f(),M(q,null,[V.children?(f(),U(Ne,{key:V.folderName+V.floor,data:V,permission:"form","show-setting":!0,onClickHandle:i[0]||(i[0]=x=>dt(x)),onRemove:i[1]||(i[1]=x=>w(x)),onSetting:i[2]||(i[2]=x=>v(x)),onClickContextMenu:x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x.event,x.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:V.id,key:V.id,title:V.name,name:V.name,permission:"form",padding:12+V.floor*6,remove:"",onClick:x=>dt(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},{default:$(()=>[k(b,{class:"iconfont icon-a-setup hover:text-blue",onClick:x=>v(V.id)},null,8,["onClick"])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(o)("common.embedded"),"expand-default":!0,permission:"form"},{default:$(()=>[(f(!0),M(q,null,W(p(t).embedded,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,permission:"form",remove:"",onClick:x=>dt(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=d.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},{default:$(()=>[k(b,{class:"iconfont icon-a-setup hover:text-blue",onClick:x=>v(V.id)},null,8,["onClick"])]),_:2},1032,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:i[5]||(i[5]=H(()=>{},["stop"]))},[k(I,{modelValue:s.value,"onUpdate:modelValue":i[4]||(i[4]=V=>s.value=V),width:"600px","close-on-click-modal":!1,title:p(o)("common.newForm"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:i[3]||(i[3]=V=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(_,["enter"])},[r.value?(f(),U(Ul,{key:0,ref_key:"form",ref:n,"label-position":"top",model:r.value},null,8,["model"])):j("",!0)],40,Ol)]),_:1},8,["modelValue","title"])]),u.value?(f(),U(Pl,{key:0,id:a.value,modelValue:u.value,"onUpdate:modelValue":i[6]||(i[6]=V=>u.value=V)},null,8,["id","modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:d,actions:S},null,512)])}}});var ql=Object.freeze(Object.defineProperty({__proto__:null,define:Fl,open:dt,default:Bl},Symbol.toStringTag,{value:"Module"}));const Uo=oe.global.t,Eo=(e,l)=>N.get(E("Layout/get"),ge({id:e},l)),Gl=()=>N.get(E("Layout/list",!0)),Sd=(e,l)=>N.post(E("Layout/Copy"),{id:e,name:l},void 0,{successMessage:Uo("common.copySuccess")}),Kl=e=>N.post(E("Layout/post"),e),Hl=e=>N.post(E("Layout/Deletes"),{ids:e},void 0,{successMessage:Uo("common.deleteSuccess")}),No=e=>N.get(E("Layout/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),ao=oe.global.t,Gt=Re("layoutStore",()=>{const e=ce(),l=F(),o=C([]),t=X(()=>l.getSplitNameData(o.value)),s=()=>g(void 0,null,function*(){o.value=yield Gl()}),u=d=>({name:d?[]:[Te(),_e(1,50),le(ao("common.nameRequiredTips")),Ce(No,ao("common.layoutNameExistsTips"))]}),a=d=>g(void 0,null,function*(){yield Hl(d),l.deleteTabs(d),s()}),n=d=>g(void 0,null,function*(){const c=yield Eo(d||Z);return c.body||(c.body=""),c}),r=(d,c)=>g(void 0,null,function*(){d.enableDiffChecker=!0;const m=yield Kl(d);return e.site.recordSiteLogVideo&&c&&(yield Be(m,c)),Object.assign(d,yield n(m))});return ee(()=>{var d;return(d=e.site)==null?void 0:d.id},()=>{o.value=[]}),{load:s,list:o,deleteLayouts:a,getLayout:n,updateLayout:r,getRules:u,getLayoutList:t}}),zl={key:0,class:"h-full"},Jl=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Gt(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getLayout(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateLayout(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),_=(w,v)=>g(this,null,function*(){yield d.promise,v?r.value.search(v,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,v)=>a.value?(f(),M("div",zl,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:v[1]||(v[1]=S=>p(u).addTabRecord(t.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Wl=G({props:{model:null,editMode:{type:Boolean}},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),u=Ee(()=>({name:o.editMode?[]:[_e(1,50),le(t("common.nameRequiredTips")),Te(),Ce(No,t("common.layoutNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return e.model?(f(),U(c,{key:0,ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.layoutName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.editMode,title:e.model.name,"data-cy":"layout-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])):j("",!0)}}}),Ql=["onKeydown"],mt=oe.global.t,Xl={name:"layouts",icon:"icon-layout",display:mt("common.layout"),route:"layouts",order:20,permission:"layout",actions:[{name:"refresh",display:mt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:mt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"layouts"}))}}]},_t=e=>{F().addTab({id:e.id,name:e.name,panel:Jl,icon:"icon-layout",actions:[{name:"save",visible:!1,display:mt("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.save()})},{name:"refresh",display:mt("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.load()})}]})},Yl=G({setup(e,{expose:l}){const{t:o}=Y(),t=Gt(),s=C(!1),u=C(),a=C(),n=C(),r=()=>g(this,null,function*(){a.value=yield t.getLayout(),s.value=!0}),d=()=>g(this,null,function*(){yield u.value.validate();const w=yield t.updateLayout(a.value);_t(w),t.load(),s.value=!1}),c=w=>g(this,null,function*(){yield xe(),yield t.deleteLayouts([w])}),m=()=>{t.load()},_=[{name:o("common.copyTitle"),invoke:w=>g(this,null,function*(){Ve(w.name)})}];return l({load:m}),(w,v)=>{const S=ye;return f(),M("div",null,[k(re,{title:p(o)("common.list"),add:"","expand-default":!0,permission:"layout",onOnAdd:r},{default:$(()=>[(f(!0),M(q,null,W(p(t).getLayoutList,h=>(f(),M(q,null,[h.children?(f(),U(Ne,{key:h.folderName+h.floor,data:h,permission:"layout",onClickHandle:v[0]||(v[0]=i=>_t(i)),onRemove:v[1]||(v[1]=i=>c(i)),onClickContextMenu:i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:h.id,key:h.id,permission:"layout",title:h.name,name:h.name,padding:12+h.floor*6,remove:"",onClick:i=>_t(h),onRemove:i=>c(h.id),onContextmenu:H(i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i,h)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:v[4]||(v[4]=H(()=>{},["stop"]))},[k(S,{modelValue:s.value,"onUpdate:modelValue":v[3]||(v[3]=h=>s.value=h),width:"600px","close-on-click-modal":!1,title:p(o)("common.newLayout"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:d,onCancel:v[2]||(v[2]=h=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(d,["enter"])},[a.value?(f(),U(Wl,{key:0,ref_key:"form",ref:u,"label-position":"top",model:a.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Ql)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:n,actions:_},null,512)])}}});var Zl=Object.freeze(Object.defineProperty({__proto__:null,define:Xl,open:_t,default:Yl},Symbol.toStringTag,{value:"Module"}));const ze=oe.global.t,es=()=>N.get(E("Menu/list",!0)),Ao=(e,l)=>N.get(E("Menu/getMenu"),{id:e,name:l}),ts=e=>N.post(E("Menu/Deletes"),{ids:e},void 0,{successMessage:ze("common.deleteSuccess")}),os=(e,l)=>N.post(E("Menu/Delete"),{rootId:e,id:l},void 0,{successMessage:ze("common.deleteSuccess")}),ns=e=>N.post(E("Menu/Create"),{name:e},void 0,{successMessage:ze("common.addSuccess")}),as=e=>N.get(E("Menu/isUniqueName"),{name:e},{hiddenError:!0,hiddenLoading:!0}),ls=e=>N.post(E("Menu/CreateSub"),e,void 0,{successMessage:ze("common.saveSuccess")}),ss=e=>N.post(E("Menu/updateInfo"),e,void 0,{successMessage:ze("common.saveSuccess")}),is=e=>N.post(E("Menu/UpdateTemplate"),e,void 0,{successMessage:ze("common.saveSuccess")}),Do=(e,l,o)=>N.post(E("Menu/Swap"),{rootId:e,ida:l,idb:o},void 0,{successMessage:ze("common.saveSuccess")}),jo=Re("menuStore",()=>{const e=ce(),l=F(),o=C([]),t=X(()=>l.getSplitNameData(o.value)),s=()=>g(void 0,null,function*(){o.value=yield es()}),u=r=>g(void 0,null,function*(){yield ts(r),l.deleteTabs(r),s()}),a=r=>g(void 0,null,function*(){const d=yield ns(r);return s(),d}),n=r=>g(void 0,null,function*(){return yield Ao(r)});return ee(()=>{var r;return(r=e.site)==null?void 0:r.id},()=>{o.value=[]}),{load:s,list:o,deleteMenus:u,getMenu:n,createMenu:a,getMenuList:t}}),rs={class:"text-666 dark:text-fff/86 pr-8 pl-16 w-full border-line dark:border-444 rounded-normal border border-solid ellipsis bg-fff dark:bg-444","data-cy":"menu-item"},us={class:"flex items-center text-m"},ds={class:"space-x-8 flex"},cs=["title"],ms=["title"],ps=R("div",{class:"flex-1"},null,-1),vs={class:"p-8 cursor-move menu_move_handler","data-cy":"move"},fs={key:0,class:"pl-32 pr-24 mt-8 mb-16"},ys=G({props:{menu:null,id:null},emits:["reload","add","edit","template","delete"],setup(e,{emit:l}){const o=e,{t}=Y(),s=(u,a)=>g(this,null,function*(){const n=u.children[a.newIndex],r=u.children.splice(a.oldIndex,1)[0];u.children.splice(a.newIndex,0,r),yield Do(o.id,r.id,n.id),l("reload")});return(u,a)=>{var c,m,_;const n=be,r=Dt("MenuItem",!0),d=lt;return f(),M("div",rs,[R("div",us,[R("div",ds,[R("p",{"data-cy":"menu-item-name",class:"max-w-300px ellipsis",title:e.menu.name},J(e.menu.name),9,cs),R("p",{class:"text-blue max-w-500px ellipsis","data-cy":"menu-item-url",title:e.menu.url},J(e.menu.url),9,ms)]),ps,(c=e.menu.children)!=null&&c.length?(f(),U(Xe,{key:0,icon:"icon-code",tip:p(t)("common.editTemplate"),"data-cy":"edit-item-template",onClick:a[0]||(a[0]=w=>u.$emit("template",e.menu))},null,8,["tip"])):j("",!0),(m=e.menu.children)!=null&&m.length?j("",!0):(f(),U(Xe,{key:1,permission:{feature:"menu",action:"edit"},icon:"icon-a-addto",tip:p(t)("common.add"),"data-cy":"add-sub-item",onClick:a[1]||(a[1]=w=>u.$emit("add",e.menu.id))},null,8,["tip"])),k(Xe,{permission:{feature:"menu",action:"edit"},icon:"icon-a-writein",tip:p(t)("common.edit"),"data-cy":"edit-item",onClick:a[2]||(a[2]=w=>u.$emit("edit",e.menu))},null,8,["tip"]),k(Xe,{permission:{feature:"menu",action:"edit"},class:"text-orange hover:text-orange",icon:"icon-delete",tip:p(t)("common.delete"),"data-cy":"delete-item",onClick:a[3]||(a[3]=w=>u.$emit("delete",e.menu.id))},null,8,["tip"]),R("div",vs,[k(n,{class:"iconfont icon-move text-16px"})])]),(_=e.menu.children)!=null&&_.length?(f(),M("div",fs,[k(p(ko),{"model-value":e.menu.children,group:e.menu.id,"item-key":e.id,class:"space-y-8 mb-8",handle:".menu_move_handler","data-cy":"sub-menu-item-wrapper",onSort:a[9]||(a[9]=w=>s(e.menu,w))},{item:$(({element:w})=>[k(r,{id:e.id,menu:w,onReload:a[4]||(a[4]=v=>u.$emit("reload")),onAdd:a[5]||(a[5]=v=>u.$emit("add",v)),onEdit:a[6]||(a[6]=v=>u.$emit("edit",v)),onTemplate:a[7]||(a[7]=v=>u.$emit("template",v)),onDelete:a[8]||(a[8]=v=>u.$emit("delete",v))},null,8,["id","menu"])]),_:1},8,["model-value","group","item-key"]),k(d,{circle:"",onClick:a[10]||(a[10]=w=>u.$emit("add",e.menu.id))},{default:$(()=>[k(n,{class:"text-blue iconfont icon-a-addto"})]),_:1})])):j("",!0)])}}}),gs={class:"flex justify-end"},bs=G({props:{modelValue:{type:Boolean},menu:null},emits:["update:modelValue","reload"],setup(e,{emit:l}){const o=e,{t}=Y(),s=C([]),u={name:[le(t("common.nameRequiredTips")),_e(1,50)],url:[]};ka("Page").then(v=>s.value=v);const a=pn(),n=C(!0),r=C(),d=C(o.menu.values);rn(()=>{a.default in d.value||(d.value[a.default]=o.menu.name)});const c=C({rootId:o.menu.rootId,parentId:o.menu.parentId,name:o.menu.name,url:o.menu.url,id:o.menu.id}),m=Ee(()=>{if(!!c.value)return ge(ge({},c.value),d.value)}),_=()=>g(this,null,function*(){yield r.value.validate();var v=Oe(ge({},c.value),{Values:JSON.stringify(d.value)});v.url||(v.url="#"),v.name=d.value[a.default],c.value.id?yield ss(v):yield ls(v),n.value=!1,l("reload")}),w=v=>v===a.default?a.selected.length>1?t("common.name")+" - "+v+" ("+t("common.default")+")":t("common.name"):t("common.name")+" - "+v;return(v,S)=>{const h=me,i=pe,b=Bt,I=qt,V=ve,x=ye;return f(),U(x,{"model-value":n.value,width:"600px","close-on-click-modal":!1,title:p(t)("common.menuItem"),onClosed:S[2]||(S[2]=y=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:S[1]||(S[1]=y=>n.value=!1)})]),default:$(()=>[R("div",gs,[k(Rn)]),k(V,{ref_key:"form",ref:r,"label-position":"top",model:p(m),rules:p(u),onKeydown:ue(_,["enter"])},{default:$(()=>[(f(!0),M(q,null,W(p(a).selected,y=>(f(),U(i,{key:y,label:w(y),rules:p(u).name,prop:y},{default:$(()=>[k(h,{modelValue:d.value[y],"onUpdate:modelValue":T=>d.value[y]=T,"data-cy":"name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","rules","prop"]))),128)),k(i,{label:"URL",prop:"url"},{default:$(()=>[k(I,{modelValue:c.value.url,"onUpdate:modelValue":S[0]||(S[0]=y=>c.value.url=y),filterable:"","allow-create":"","default-first-option":"",class:"w-full","data-cy":"url-dropdown"},{default:$(()=>[(f(!0),M(q,null,W(s.value,y=>(f(),U(b,{key:y.id,value:y.name,label:y.name,"data-cy":"url-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["model-value","title"])}}}),ws={class:"flex space-x-8"},_s={class:"space-y-8 flex-1"},ks={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden","data-cy":"editor-wrapper"},hs={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden ml-32","data-cy":"editor-wrapper"},xs={class:"flex space-x-4 p-8"},Cs={class:"shadow-s-10 border border-solid border-line dark:border-444 rounded-normal overflow-hidden","data-cy":"editor-wrapper"},$s={class:"w-400px bg-card dark:bg-444 rounded-normal flex flex-col"},Ss={class:"p-8 font-bold"},Vs={class:"h-full p-8"},Ts={class:"overflow-auto h-374px","data-cy":"preview"},Ms=G({props:{modelValue:{type:Boolean},menu:null},emits:["update:modelValue","reload"],setup(e,{emit:l}){const o=e,{t}=Y(),s=C(),u={lineNumbersMinChars:2,minimap:{enabled:!1},renderLineHighlight:"none"},a={AnchorText:"{anchortext}",Href:"{href}",SubItems:"{items}",ActiveClass:"{activeclass:className}",ParentId:"{parentid}",CurrentId:"{currentid}"},n=C(!0),r=C({containerTop:o.menu.subItemContainer.split("{items}")[0],template:o.menu.subItemTemplate,containerBottom:o.menu.subItemContainer.split("{items}")[1]}),d=(w,v,S,h)=>{var b,I;let i=v;for(const V of w.children){let x=S;if(x.indexOf(a.Href)&&(x=x.split(a.Href).join(V.url?V.url:"#")),x.indexOf(a.AnchorText)&&(x=x.split(a.AnchorText).join(V.name)),x.indexOf(a.CurrentId)&&(x=x.split(a.CurrentId).join(V.id)),x.indexOf(a.ParentId)&&(x=x.split(a.ParentId).join(V.parentId)),x.indexOf("activeclass:")){const y=(b=(x.match(/{[\w\W]*?:([\w\W]*?)}/)||[])[1])==null?void 0:b.toString();y&&(x=x.split(`{activeclass:${y}}`).join(w.children[0]===V?`class="${y}"`:""))}if(x.indexOf(a.SubItems)&&((I=V.children)==null?void 0:I.length)){let y=d(V,V.subItemContainer.split("{items}")[0],V.subItemTemplate,V.subItemContainer.split("{items}")[1]);x=x.split(a.SubItems).join(y)}i+=x}return i+=h,i},c=X(()=>d(o.menu,r.value.containerTop,r.value.template,r.value.containerBottom)),m=w=>{var v;(v=s.value)==null||v.replace(w)},_=()=>g(this,null,function*(){yield is({Id:o.menu.id,RootId:o.menu.rootId===Z?o.menu.id:o.menu.rootId,SubItemContainer:r.value.containerTop+"{items}"+r.value.containerBottom,SubItemTemplate:r.value.template}),n.value=!1,l("reload")});return(w,v)=>{const S=In,h=ye;return f(),U(h,{"model-value":n.value,"custom-class":"el-dialog",width:"1100px","close-on-click-modal":!1,title:p(t)("common.editTemplate"),onClosed:v[4]||(v[4]=i=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"menu",action:"edit"},onConfirm:_,onCancel:v[3]||(v[3]=i=>n.value=!1)})]),default:$(()=>[R("div",ws,[R("div",_s,[R("div",ks,[k(he,{modelValue:r.value.containerTop,"onUpdate:modelValue":v[0]||(v[0]=i=>r.value.containerTop=i),class:"min-h-96px h-96px",language:"html",options:u},null,8,["modelValue"])]),R("div",hs,[k(he,{ref_key:"editor",ref:s,modelValue:r.value.template,"onUpdate:modelValue":v[1]||(v[1]=i=>r.value.template=i),class:"min-h-96px h-173px",language:"html",options:u},null,8,["modelValue"]),R("div",xs,[(f(),M(q,null,W(a,(i,b)=>k(S,{key:b,size:"small",class:"rounded-full cursor-pointer",onClick:I=>m(i)},{default:$(()=>[Ae(J(b),1)]),_:2},1032,["onClick"])),64))])]),R("div",Cs,[k(he,{modelValue:r.value.containerBottom,"onUpdate:modelValue":v[2]||(v[2]=i=>r.value.containerBottom=i),language:"html",class:"min-h-96px h-96px",options:u},null,8,["modelValue"])])]),R("div",$s,[R("div",Ss,J(p(t)("common.preview")),1),R("div",Vs,[R("pre",Ts,J(p(c)),1)])])])]),_:1},8,["model-value","title"])}}}),Is={key:0},Rs=G({props:{id:null},emits:["update:model"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),u=ce(),a=C(),n=C(!1),r=C(!1),d=C(),c=()=>g(this,null,function*(){a.value=yield Ao(t.id,t.id),o("update:model",a.value)}),m=(h,i)=>g(this,null,function*(){const b=h.children[i.newIndex],I=h.children.splice(i.oldIndex,1)[0];h.children.splice(i.newIndex,0,I),yield Do(a.value.id,I.id,b.id),c()}),_=h=>{!u.hasAccess("menu","edit")||(d.value={parentId:h,rootId:a.value.id,name:"",url:"",values:{},urls:{}},n.value=!0)},w=h=>{!u.hasAccess("menu","edit")||(d.value=h,n.value=!0)},v=h=>g(this,null,function*(){!u.hasAccess("menu","edit")||(yield xe(),yield os(a.value.id,h),c())}),S=h=>{d.value=h,r.value=!0};return l({onTemplateEdit:S}),c(),(h,i)=>{const b=be,I=lt,V=Xe;return a.value?(f(),M("div",Is,[k(p(ko),{"model-value":a.value.children,group:a.value.id,"item-key":a.value.id,class:"space-y-8 mb-8",handle:".menu_move_handler","data-cy":"menu-item-wrapper",onSort:i[0]||(i[0]=x=>m(a.value,x))},{item:$(({element:x})=>[k(ys,{id:a.value.id,menu:x,onReload:c,onAdd:_,onDelete:v,onEdit:w,onTemplate:S},null,8,["id","menu"])]),_:1},8,["model-value","group","item-key"]),R("div",null,[a.value.children.length?(f(),U(V,{key:1,permission:{feature:"menu",action:"edit"},circle:"",icon:"icon-a-addto",tip:p(s)("common.addMenuItem"),"data-cy":"add-item",onClick:i[2]||(i[2]=x=>_(a.value.id))},null,8,["tip"])):(f(),U(Ln,{key:0},{button:$(()=>[k(I,{round:"",type:"primary",onClick:i[1]||(i[1]=x=>_(a.value.id))},{default:$(()=>[k(b,{class:"iconfont icon-a-addto"}),Ae(J(p(s)("common.createItemNow")),1)]),_:1})]),default:$(()=>[Ae(J(p(s)("common.createItemNowToCreateAItem"))+" ",1)]),_:1}))]),(f(),U(ro,{to:"body"},[n.value?(f(),U(bs,{key:0,modelValue:n.value,"onUpdate:modelValue":i[3]||(i[3]=x=>n.value=x),menu:d.value,onReload:c},null,8,["modelValue","menu"])):j("",!0),r.value?(f(),U(Ms,{key:1,modelValue:r.value,"onUpdate:modelValue":i[4]||(i[4]=x=>r.value=x),menu:d.value,onReload:c},null,8,["modelValue","menu"])):j("",!0)]))])):j("",!0)}}}),Ls={class:"h-full p-24"},Us={class:"flex"},Es=R("div",{class:"flex-1"},null,-1),Ns={class:"pb-8"},As=G({props:{id:null},setup(e){const{t:l}=Y(),o=C(),t=C();return(s,u)=>(f(),M("div",Ls,[R("div",Us,[Es,R("div",Ns,[k(Xe,{icon:"icon-code",class:"dark:text-fff/86",tip:p(l)("common.editTemplate"),"data-cy":"edit-template",onClick:u[0]||(u[0]=a=>o.value.onTemplateEdit(t.value))},null,8,["tip"])])]),k(Rs,{id:e.id,ref_key:"inner",ref:o,"onUpdate:model":u[1]||(u[1]=a=>t.value=a)},null,8,["id"])]))}}),Ds=["onKeydown"],js=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue","created"],setup(e,{emit:l}){const{t:o}=Y(),t={name:[le(o("common.nameRequiredTips")),Te(),_e(1,50),Ce(as,o("common.menuNameExistsTips"))]},s=C(!0),u=C(),a=jo(),n=C({name:""}),r=()=>g(this,null,function*(){yield u.value.validate();const d=yield a.createMenu(n.value.name);l("created",d),s.value=!1});return(d,c)=>{const m=me,_=pe,w=ve,v=ye;return f(),M("div",{onClick:c[4]||(c[4]=H(()=>{},["stop"]))},[k(v,{"model-value":s.value,width:"600px","close-on-click-modal":!1,title:p(o)("common.addMenu"),onClosed:c[3]||(c[3]=S=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:r,onCancel:c[2]||(c[2]=S=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(r,["enter"])},[k(w,{ref_key:"form",ref:u,"label-position":"top",model:n.value,rules:p(t),onSubmit:c[1]||(c[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(_,{label:p(o)("common.name"),prop:"name"},{default:$(()=>[k(m,{modelValue:n.value.name,"onUpdate:modelValue":c[0]||(c[0]=S=>n.value.name=S),"data-cy":"menu-name"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])],40,Ds)]),_:1},8,["model-value","title"])])}}}),Ut=oe.global.t,Ps={name:"menus",icon:"icon-menu",display:Ut("common.menu"),order:60,permission:"menu",actions:[{name:"refresh",display:Ut("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ut("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"menus"}))}}]},kt=e=>{F().addTab({id:e.id,name:e.name,panel:As,icon:"icon-menu"})},Os=G({setup(e,{expose:l}){const{t:o}=Y(),t=jo(),s=C(!1),u=C(),a=()=>{t.load()},n=d=>g(this,null,function*(){yield xe(),yield t.deleteMenus([d])}),r=[{name:o("common.copyTitle"),invoke:d=>g(this,null,function*(){Ve(d.name)})}];return l({load:a}),(d,c)=>(f(),M("div",null,[k(re,{title:p(o)("common.list"),add:"","expand-default":!0,permission:"menu",onOnAdd:c[2]||(c[2]=m=>s.value=!0)},{default:$(()=>[(f(!0),M(q,null,W(p(t).getMenuList,m=>(f(),M(q,null,[m.children?(f(),U(Ne,{key:m.folderName+m.floor,data:m,permission:"menu",onClickHandle:c[0]||(c[0]=_=>kt(_)),onRemove:c[1]||(c[1]=_=>n(_)),onClickContextMenu:_=>{var w;return(w=u.value)==null?void 0:w.openMenu(_.event,_.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:m.id,key:m.id,permission:"menu",title:m.name,name:m.name,padding:12+m.floor*6,remove:"",onClick:_=>kt(m),onRemove:_=>n(m.id),onContextmenu:H(_=>{var w;return(w=u.value)==null?void 0:w.openMenu(_,m)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),s.value?(f(),U(js,{key:0,modelValue:s.value,"onUpdate:modelValue":c[3]||(c[3]=m=>s.value=m),onCreated:c[4]||(c[4]=m=>kt(m))},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:u,actions:r},null,512)]))}});var Fs=Object.freeze(Object.defineProperty({__proto__:null,define:Ps,open:kt,default:Os},Symbol.toStringTag,{value:"Module"}));const Bs=G({props:{model:null},emits:["save"],setup(e,{expose:l,emit:o}){const{t}=Y(),s=C(),u={name:[_e(1,50),le(t("common.nameRequiredTips")),bo()]};return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,"label-position":"top",model:e.model,rules:p(u),onSubmit:n[2]||(n[2]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.name"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),"data-cy":"name",onKeydown:n[1]||(n[1]=ue(m=>o("save"),["enter"]))},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}});const qs={key:0,class:"el-upload__tip ml-8"},Gs={key:1,class:"mt-12 w-full"},Ks=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const{t:o}=Y(),t={name:[_e(1,50),le(o("common.nameRequiredTips")),bo()],file:le(o("common.selectFileTips"))},s=C(!0),u=C(),a=C({name:"",file:null}),n=Se(),r=c=>{a.value.file=c},d=()=>g(this,null,function*(){yield u.value.validate();var c=new FormData;c.append("file",a.value.file.raw),c.append("name",a.value.name),yield oa(c),Pt(),s.value=!1,n.load()});return n.load(),ee(()=>a.value.file,()=>{a.value.file&&u.value.clearValidate("file")}),(c,m)=>{const _=me,w=pe,v=lt,S=En,h=Un,i=ve,b=ye;return f(),U(b,{modelValue:s.value,"onUpdate:modelValue":m[4]||(m[4]=I=>s.value=I),width:"600px","close-on-click-modal":!1,title:p(o)("common.import"),onClosed:m[5]||(m[5]=I=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{"confirm-label":p(o)("common.start"),onConfirm:d,onCancel:m[3]||(m[3]=I=>s.value=!1)},null,8,["confirm-label"])]),default:$(()=>[k(i,{ref_key:"form",ref:u,"label-position":"top",model:a.value,rules:t,onSubmit:m[2]||(m[2]=H(()=>{},["prevent"])),onKeydown:ue(d,["enter"])},{default:$(()=>[k(w,{label:p(o)("common.name"),prop:"name"},{default:$(()=>[k(_,{modelValue:a.value.name,"onUpdate:modelValue":m[0]||(m[0]=I=>a.value.name=I),"data-cy":"module-name"},null,8,["modelValue"])]),_:1},8,["label"]),k(w,{label:p(o)("common.file"),prop:"file"},{default:$(()=>[k(S,{"show-file-list":!1,action:"",accept:"application/zip","auto-upload":!1,"on-change":r,"data-cy":"upload"},{default:$(()=>[k(v,{type:"primary",round:"",plain:""},{default:$(()=>[Ae(J(p(o)("common.selectFile")),1)]),_:1})]),_:1}),a.value.file?j("",!0):(f(),M("div",qs,J(p(o)("common.compressedPackageFileFormat")),1)),a.value.file?(f(),M("div",Gs,[k(h,{title:a.value.file.name,type:"info",onClose:m[1]||(m[1]=I=>a.value.file=null)},null,8,["title"])])):j("",!0)]),_:1},8,["label"])]),_:1},8,["model","onKeydown"])]),_:1},8,["modelValue","title"])}}});var Hs=ho(Ks,[["__scopeId","data-v-38caff42"]]);const zs=["onKeydown"],Js=["src"],Ws=G({setup(e){const{t:l}=Y(),o=un(),t=Se(),s=C(!1),u=C(!1),a=C(),n=C(),r=C(),d=C(!1);let c=C();const m=()=>g(this,null,function*(){n.value={name:""},s.value=!0}),_=()=>g(this,null,function*(){yield a.value.validate(),yield t.createModule(n.value.name),s.value=!1}),w=h=>g(this,null,function*(){yield xe(),yield t.deleteModules([h])}),v=h=>{t.editModule(h),o.push(ke({name:"dev-mode",query:{activity:"modules",moduleId:h}}))},S=X(()=>{var i,b;var h=[{name:l("common.copyTitle"),invoke:I=>g(this,null,function*(){Ve(I.name)})}];return(b=(i=r.value)==null?void 0:i.payload)!=null&&b.backendViewUrl&&h.push({name:l("common.backend"),invoke:I=>g(this,null,function*(){c.value=I.backendViewUrl,d.value=!0})}),h});return(h,i)=>{const b=be,I=ye,V=at("hasPermission");return f(),M(q,null,[k(re,{title:p(l)("common.list"),add:"","expand-default":!0,permission:"module",onOnAdd:m},{bar:$(()=>[ie(k(b,{class:"iconfont icon-a-Cloudupload hover:text-blue",onClick:i[0]||(i[0]=x=>u.value=!0)},null,512),[[V,{feature:"module",action:"edit",effect:"hiddenIcon"}]])]),default:$(()=>[(f(!0),M(q,null,W(p(t).list,x=>(f(),U(ae,{id:x.id,key:x.id,title:x.name,remove:"",permission:"module",onRemove:y=>w(x.id),onClick:y=>v(x.id),onContextmenu:H(y=>{var T;return(T=r.value)==null?void 0:T.openMenu(y,x)},["prevent","stop"])},null,8,["id","title","onRemove","onClick","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:i[3]||(i[3]=H(()=>{},["stop"]))},[k(I,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=x=>s.value=x),width:"600px","close-on-click-modal":!1,title:p(l)("common.newModule"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:i[1]||(i[1]=x=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(_,["enter"])},[n.value?(f(),U(Bs,{key:0,ref_key:"form",ref:a,model:n.value},null,8,["model"])):j("",!0)],40,zs)]),_:1},8,["modelValue","title"])]),u.value?(f(),U(Hs,{key:0,modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=x=>u.value=x)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:r,actions:p(S)},null,8,["actions"]),k(I,{modelValue:d.value,"onUpdate:modelValue":i[5]||(i[5]=x=>d.value=x),width:"1000px","close-on-click-modal":!1,"custom-class":"el-dialog--zero-padding",title:p(l)("common.manage"),onClosed:i[6]||(i[6]=x=>d.value=!1)},{default:$(()=>[R("iframe",{src:p(c),class:"w-full h-500px"},null,8,Js)]),_:1},8,["modelValue","title"])],64)}}}),Qs={class:"h-full"},Xs=G({props:{id:null,params:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=C(""),u=Pe(),a=Se(),n=()=>g(this,null,function*(){s.value=yield la(t.params.file.objectType,t.params.moduleId,t.params.file.name),u.init(s.value)}),r=()=>g(this,null,function*(){!s.value||(yield So(t.params.file.objectType,t.params.moduleId,t.params.file.name,s.value),u.init(s.value),o("changed",!1),o("setAction","save",{visible:!1}))}),d=Ee(()=>t.params.file.name==="Module.config"),c=Ee(()=>{var _;if(t.params.file.objectType=="code"){const w=(_=a.list.find(S=>S.id==t.params.moduleId))==null?void 0:_.name;let v=t.params.file.name;return`file:///node_modules/@types/module:${w}/${v}.ts`}return d.value?`memory:///module:${t.params.moduleId}/${t.params.file.name}`:`memory:///${jt()}`}),m=Ee(()=>t.params.file.objectType==="css"?"css":t.params.file.objectType==="js"?"javascript":t.params.file.objectType==="view"||t.params.file.objectType==="backend"?"html":t.params.file.objectType==="api"||t.params.file.objectType==="code"?"typescript":t.params.file.name==="Module.config"?"json":t.params.file.name==="Dashboard.js"||t.params.file.name==="Event.js"?"typescript":"");return ee(()=>s.value,()=>{o("changed",u.changed(s.value)),o("setAction","save",{visible:u.changed(s.value)})},{deep:!0}),n(),l({save:r,load:n}),(_,w)=>(f(),M("div",Qs,[k(he,{modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=v=>s.value=v),uri:p(c),language:p(m),"k-script":""},null,8,["modelValue","uri","language"])]))}}),Ys={class:"h-full"},Zs={class:"ellipsis w-120px h-24 leading-6"},ei=G({props:{id:null,name:null,params:null},setup(e){const l=e,{t:o}=Y(),t=()=>{St(l.params.url+"?__content_type=application/octet-stream")};return(s,u)=>{const a=lt,n=xo;return f(),M("div",Ys,[k(n,{icon:"info",title:p(o)("common.canNotOpenFile")},{"sub-title":$(()=>[R("p",null,J(p(o)("common.canNotOpenFileTip")),1)]),extra:$(()=>{var r;return[(r=e.params)!=null&&r.url?(f(),U(a,{key:0,round:"",plain:"",type:"primary",onClick:t},{default:$(()=>[R("span",Zs,J(p(o)("common.downloadThisFile")),1)]),_:1})):j("",!0)]}),_:1},8,["title"])])}}}),ti=G({props:{id:null,name:null,params:null},emits:["changed"],setup(e,{expose:l,emit:o}){const t=e,s=C(),u=C();nt(()=>{const n=ge(ge({},t),t.params);u.value=n});const a=()=>g(this,null,function*(){yield Vo(t.params.type,t.params.moduleId,t.name,s.value.split("base64,")[1]),o("changed",!1)});return ee(()=>s.value,()=>{o("changed",!0)}),l({save:a}),(n,r)=>u.value?(f(),U(p(An),{key:0,base64:s.value,"onUpdate:base64":r[0]||(r[0]=d=>s.value=d),name:u.value.name,url:u.value.url},null,8,["base64","name","url"])):j("",!0)}});const oi={class:"relative group flex items-center"},ni=["accept","onChange"],ai=["onKeydown"],li={class:"w-full flex space-x-4"},si=G({setup(e){const{t:l}=Y(),o=Se(),t=ce(),s=F(),u=C(!1),a=C(),n=C(),{onPreview:r}=we(),d={name:[le(l("common.nameRequiredTips")),_e(1,50),Te()]},c=C({name:"",extension:""}),m=C(),_=x=>g(this,null,function*(){m.value=x,c.value.extension=x.defaultExtension,u.value=!0}),w=()=>g(this,null,function*(){yield a.value.validate();let x=c.value.name;yield o.createModuleFile(x,m.value);const y=o.files.find(T=>{var L;return T.name==c.value.name+T.extension&&T.objectType==((L=m.value)==null?void 0:L.name)});y&&i(y),u.value=!1}),v=(x,y,T)=>g(this,null,function*(){yield xe(),yield o.deleteModuleFile(x,y),s.deleteTab(T)}),S=x=>{x.isBinary?h(x):i(x)},h=x=>{s.addTab({id:x.id,name:x.name,panel:x.objectType==="img"?ti:ei,icon:"icon-classification",params:{url:x.previewUrl,type:x.objectType,moduleId:o.editingModule}})},i=x=>{const y=o.types.find(L=>L.name==x.objectType),T={id:x.id,name:x.name,panel:Xs,icon:"icon-classification",params:{type:y,file:x,moduleId:o.editingModule},actions:[{name:"save",visible:!1,icon:"icon-preservation",display:l("common.save"),invoke:()=>g(this,null,function*(){var O,D;const L=yield(D=(O=F().activeTab)==null?void 0:O.panelInstance)==null?void 0:D.promise;!L||L.save()})},{name:"refresh",display:l("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(this,null,function*(){var O,D;const L=yield(D=(O=F().activeTab)==null?void 0:O.panelInstance)==null?void 0:D.promise;!L||L.load()})}]};x.objectType!=="root"&&x.objectType!=="code"&&T.actions.push({name:"open",display:l("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(this,null,function*(){r(x.previewUrl)})}),s.addTab(T)};function b(x,y){var T=x.target.files[0];if(!!T){var L=new FileReader;L.readAsDataURL(T),L.onload=function(O){var D=O.target.result;o.uploadModuleFile(T.name,D.split("base64,")[1],y)}}}function I(){c.value={name:"",extension:""}}const V=X(()=>{var y,T,L,O;var x=[{name:l("common.copyTitle"),invoke:D=>g(this,null,function*(){Ve(D.name)})}];return((T=(y=n.value)==null?void 0:y.payload)==null?void 0:T.previewUrl)&&((O=(L=n.value)==null?void 0:L.payload)==null?void 0:O.objectType)!="root"&&x.push({name:l("common.preview"),invoke:D=>g(this,null,function*(){r(D.previewUrl)})}),x});return(x,y)=>{var A;const T=be,L=Nn,O=me,D=pe,P=ve,B=ye;return f(),M("div",null,[(f(!0),M(q,null,W(p(o).types,K=>(f(),U(re,{key:K.name,title:K.displayName,add:K.isText&&K.name!=="root","expand-default":!0,permission:"module",onOnAdd:ne=>_(K)},{bar:$(()=>[R("div",oi,[K.isBinary&&p(t).hasAccess("module","edit")?(f(),U(T,{key:0,class:"iconfont icon-a-Cloudupload group-hover:text-blue","data-cy":"import"})):j("",!0),R("input",{class:"!cursor-pointer absolute inset-0 !opacity-0 bg-green overflow-hidden",type:"file",title:" ",accept:K.name=="img"?"image/*":"","data-cy":"upload",onChange:ne=>b(ne,K)},null,40,ni)])]),default:$(()=>[(f(!0),M(q,null,W(p(o).files.filter(ne=>ne.objectType===K.name),ne=>(f(),U(ae,{id:ne.id,key:ne.name,title:ne.name,remove:ne.objectType!=="root",permission:"module",onRemove:Le=>v(ne.name,ne.objectType,ne.id),onClick:Le=>S(ne),onContextmenu:H(Le=>{var yt;return(yt=n.value)==null?void 0:yt.openMenu(Le,ne)},["prevent","stop"])},null,8,["id","title","remove","onRemove","onClick","onContextmenu"]))),128))]),_:2},1032,["title","add","onOnAdd"]))),128)),(f(),U(ro,{to:"body"},[R("div",{onClick:y[4]||(y[4]=H(()=>{},["stop"]))},[k(B,{modelValue:u.value,"onUpdate:modelValue":y[3]||(y[3]=K=>u.value=K),width:"600px","close-on-click-modal":!1,title:p(l)("common.newModuleType",{type:(A=m.value)==null?void 0:A.displayName}),"destroy-on-close":"",onClose:I},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:y[2]||(y[2]=K=>u.value=!1)})]),default:$(()=>{var K,ne;return[((K=m.value)==null?void 0:K.displayName)==="View"||((ne=m.value)==null?void 0:ne.displayName)==="Backend"?(f(),U(L,{key:0,class:"-mx-32 -mt-24 mb-12",title:p(l)("common.moduleViewEntrance"),content:p(l)("common.moduleViewEntranceTips")},null,8,["title","content"])):j("",!0),R("div",{onKeydown:ue(w,["enter"])},[c.value?(f(),U(P,{key:0,ref_key:"form",ref:a,"label-position":"top",model:c.value,rules:d,onSubmit:y[1]||(y[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(D,{label:p(l)("common.name"),prop:"name"},{default:$(()=>[R("div",li,[k(O,{modelValue:c.value.name,"onUpdate:modelValue":y[0]||(y[0]=Le=>c.value.name=Le),class:"flex-1","data-cy":"module-file-name"},null,8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model"])):j("",!0)],40,ai)]}),_:1},8,["modelValue","title"]),k(Me,{ref_key:"contextMenu",ref:n,actions:p(V)},null,8,["actions"])])]))])}}});var ii=ho(si,[["__scopeId","data-v-645d2160"]]);const wt=oe.global.t,ri={name:"modules",icon:"icon-classification",display:wt("common.modules"),order:100,permission:"module",actions:[{name:"back",display:wt("common.back"),icon:"icon-go-back",visible:!1,invoke(){se.push(ke({name:"dev-mode",query:{activity:"modules"}})),Se().exitEditModule()}},{name:"refresh",display:wt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:wt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"modules"}))}}]},ui=G({setup(e,{expose:l}){const o=Se(),t=F(),s=ce(),u=De(),a=C([]),n=()=>{o.load(),r()},r=()=>g(this,null,function*(){var d;!s.hasAccess("module","view")||(a.value=yield Co(),u.query.moduleId&&u.query.activity==="modules"&&(o.editModule(u.query.moduleId),t.activeActivity&&(t.activeActivity.panelDisplay=(d=a.value.find(c=>c.id===u.query.moduleId))==null?void 0:d.name)))});return ee(()=>u.query.moduleId,()=>{u.query.moduleId&&r()},{immediate:!0}),l({load:n}),(d,c)=>(f(),M("div",null,[p(o).editingModule&&p(o).types.length?(f(),U(ii,{key:0})):j("",!0),p(o).editingModule?j("",!0):(f(),U(Ws,{key:1}))]))}});var di=Object.freeze(Object.defineProperty({__proto__:null,define:ri,default:ui},Symbol.toStringTag,{value:"Module"}));function Po(e){return{id:e.id,name:e.name,body:e.body,url:e.urlPath,title:e.title,cacheByVersion:e.cacheByVersion,cacheMinutes:e.cacheMinutes,cacheQueryKeys:e.cacheQueryKeys,enableCache:e.enableCache,published:e.published}}var ci=(e=>(e.TagName="TagName",e.Id="Id",e.Class="Class",e))(ci||{}),mi=(e=>(e.Equal="Equal",e.StartWith="StartWith",e.Contains="Contains",e))(mi||{});const pi={key:0,class:"h-full"},We=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=ft(),u=F(),a=C(),n=Pe((v,S)=>{if(!(v==="urlPath"&&S))return S}),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getPage(t.id),d.resolve(null),n.init(a.value)}),m=v=>g(this,null,function*(){!a.value||(a.value.urlPath=v.urlPath)}),_=()=>g(this,null,function*(){!a.value||(yield s.updatePage(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),w=(v,S)=>g(this,null,function*(){yield d.promise,S?r.value.search(S,v):r.value.goToLine(v)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:_,load:c,goToLine:w,updateModel:m}),(v,S)=>a.value?(f(),M("div",pi,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":S[0]||(S[0]=h=>a.value.body=h),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:S[1]||(S[1]=h=>p(u).addTabRecord(t.id,h,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),vi={key:0,class:"h-full"},st=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=ft(),u=F(),a=C(),n=Pe((v,S)=>{if(!["url","published","title"].includes(v))return S}),r=C(),d=new $e,c=()=>g(this,null,function*(){const v=yield s.getPage(t.id);d.resolve(null),a.value=Po(v),n.init(a.value)}),m=v=>g(this,null,function*(){!a.value||(a.value.url=v.path,a.value.title=v.title,a.value.published=v.online)}),_=()=>g(this,null,function*(){!a.value||(yield s.updateRichPage(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),w=(v,S)=>g(this,null,function*(){yield d.promise,S?r.value.search(S,v):r.value.goToLine(v)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:_,load:c,goToLine:w,updateModel:m}),(v,S)=>a.value?(f(),M("div",vi,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":S[0]||(S[0]=h=>a.value.body=h),language:"html",uri:p(je).file(a.value.id),onMonacoLoadComplete:S[1]||(S[1]=h=>p(u).addTabRecord(t.id,h,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),fi=G({props:{model:null,oldUrlPath:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),u=n=>{!o.model||o.model.urlPath||(o.model.urlPath=`/${n}`)},a=X(()=>({name:[o.model.id===Z?[_e(1,50),le(t("common.nameRequiredTips")),Ce(Ro,t("common.thePageNameAlreadyExists"))]:[]],urlPath:[le(t("common.urlRequiredTips")),o.oldUrlPath===o.model.urlPath?"":Ce(n=>Lo(n,o.oldUrlPath),t("common.urlOccupied"))]}));return l({validate:()=>{var n;return(n=s.value)==null?void 0:n.validate()}}),(n,r)=>{const d=me,c=pe,m=ve;return f(),U(m,{ref_key:"form",ref:s,model:e.model,rules:p(a),onSubmit:r[4]||(r[4]=H(()=>{},["prevent"]))},{default:$(()=>[k(c,{label:p(t)("common.pageName"),prop:"name"},{default:$(()=>[k(d,{modelValue:e.model.name,"onUpdate:modelValue":r[0]||(r[0]=_=>e.model.name=_),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"page-name",onInput:r[1]||(r[1]=_=>e.model.name=e.model.name.replace(/\s+/g,"")),onChange:u},null,8,["modelValue","disabled","title"])]),_:1},8,["label"]),k(c,{label:"URL",prop:"urlPath"},{default:$(()=>[k(d,{modelValue:e.model.urlPath,"onUpdate:modelValue":r[2]||(r[2]=_=>e.model.urlPath=_),class:"min-w-300px","data-cy":"url",onInput:r[3]||(r[3]=_=>e.model.urlPath=e.model.urlPath.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])}}}),yi=G({props:{model:null,oldUrl:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),u=n=>{!o.model||o.model.url||(o.model.url=`/${n}`)},a=X(()=>({name:o.model.id!==Z?[]:[_e(1,50),le(t("common.nameRequiredTips")),Ce(Ro,t("common.thePageNameAlreadyExists"))],url:[le(t("common.urlRequiredTips")),o.oldUrl===o.model.url?"":Ce(n=>Lo(n,o.oldUrl),t("common.urlOccupied"))],title:[le(t("common.titleRequiredTips"))]}));return l({validate:()=>{var n;return(n=s.value)==null?void 0:n.validate()}}),(n,r)=>{const d=me,c=pe,m=Ft,_=ve;return f(),U(_,{ref_key:"form",ref:s,"label-position":"top",model:e.model,rules:p(a),onSubmit:r[6]||(r[6]=H(()=>{},["prevent"]))},{default:$(()=>[k(c,{label:p(t)("common.pageName"),prop:"name"},{default:$(()=>[k(d,{modelValue:e.model.name,"onUpdate:modelValue":r[0]||(r[0]=w=>e.model.name=w),class:"min-w-325px",title:e.model.name,disabled:e.model.id!==p(Z),"data-cy":"page-name",onInput:r[1]||(r[1]=w=>e.model.name=e.model.name.replace(/\s+/g,"")),onChange:u},null,8,["modelValue","title","disabled"])]),_:1},8,["label"]),k(c,{label:"URL",prop:"url"},{default:$(()=>[k(d,{modelValue:e.model.url,"onUpdate:modelValue":r[2]||(r[2]=w=>e.model.url=w),class:"min-w-325px","data-cy":"url",onInput:r[3]||(r[3]=w=>e.model.url=e.model.url.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1}),k(c,{label:p(t)("common.title"),prop:"title"},{default:$(()=>[k(d,{modelValue:e.model.title,"onUpdate:modelValue":r[4]||(r[4]=w=>e.model.title=w),class:"min-w-325px","data-cy":"title"},null,8,["modelValue"])]),_:1},8,["label"]),Ke(n.$slots,"default"),k(c,{label:p(t)("page.online")},{default:$(()=>[k(m,{modelValue:e.model.published,"onUpdate:modelValue":r[5]||(r[5]=w=>e.model.published=w)},null,8,["modelValue"])]),_:1},8,["label"])]),_:3},8,["model","rules"])}}}),gi=["onKeydown"],et=oe.global.t,bi={name:"pages",icon:"icon-copy",display:et("common.page"),route:"pages",order:0,permission:"pages",actions:[{name:"refresh",display:et("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:et("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"pages"}))}}]},Ue=(e,l)=>{if(e.type==="Designer"){const o=yo(e.id,e.layoutId);St(se.resolve(o).href);return}F().addTab({id:e.id,name:e.name,panel:l,icon:"icon-copy",actions:[{name:"save",visible:!1,display:et("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",visible:!0,display:et("common.refresh"),icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})},{name:"open",visible:!0,display:et("common.preview"),icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=ft();let t=o.list.find(s=>s.id===e.id);if(t||(yield o.load(),t=o.list.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.previewUrl)}})}]})},wi=G({setup(e,{expose:l}){const{t:o}=Y(),t=De(),s=ft(),u=Gt(),a=C(!1),n=C(),r=C(),d=C(),c=C(!1);let m=C("normal");const _=C(),w=C(),v=new on,S=ce(),h=()=>g(this,null,function*(){d.value=yield s.getPage(),d.value.published=!0,m.value="normal",a.value=!0}),i=B=>g(this,null,function*(){d.value=yield s.getPage(),d.value.published=!0;const A=yield Eo(B),K=_n(A.name,A.body);d.value.body=kn(K),m.value="layout",a.value=!0}),b=()=>g(this,null,function*(){m.value="rich",d.value={id:Z,body:"",title:"",name:"",url:"",cacheByVersion:!1,cacheMinutes:3,enableCache:!1,cacheQueryKeys:" ",published:!0},a.value=!0}),I=(B,A)=>g(this,null,function*(){m.value=A,d.value=yield s.getPage(B),_.value=d.value.urlPath,A==="rich"&&(d.value=Po(d.value)),a.value=!0}),V=()=>g(this,null,function*(){if(m.value==="rich"){yield r.value.validate();const B=yield s.updateRichPage(d.value);yield s.load();const A=s.list.find(K=>K.id==B);A&&Ue(A,st),P(A)}else{yield n.value.validate();const B=yield s.updatePage(d.value);B.type!=="Designer"&&Ue(B,We),s.load(),P(B)}a.value=!1}),x=B=>g(this,null,function*(){yield xe(),yield s.deletePages([B])}),y=()=>{s.load(),u.load()},T=B=>{let A=se.resolve(ke({name:"inline-design",query:{path:B.path,access_token:v.get("jwt_token"),inline_design_lang:nn(),scheme:localStorage.getItem("vueuse-color-scheme")}})).href;return A=dn(S.site.baseUrl,A),A},L=C(!1),O=X(()=>{const B=[{show:!0,name:o("common.copyTitle"),invoke:A=>g(this,null,function*(){Ve(A.name)})},{show:!0,name:o("common.preview"),invoke:A=>g(this,null,function*(){const{onPreview:K}=we();K(A.previewUrl)})}];return L.value||B.push({show:!0,name:o("common.settings"),invoke:A=>g(this,null,function*(){St(se.resolve(ke({name:A.type==="RichText"?"rich-page-edit":A.layoutId===Z?"page-setting":"layout-page-setting",query:{id:A.id,layoutId:A.layoutId===Z?void 0:A.layoutId}})).href)})}),B.push({show:S.hasAccess("pages","edit"),name:o("common.inlineEditor"),invoke:A=>g(this,null,function*(){const{onPreview:K}=we();K(T(A))})}),B});function D(B,A){var K;L.value=A.type==="Designer",(K=w.value)==null||K.openMenu(B,A)}l({load:y});const P=He("updateTabModel");return(B,A)=>{var Ht;const K=be,ne=Vt,Le=Tt,yt=ye,gt=at("hasPermission");return f(),M(q,null,[k(re,{ref:"collapse",permission:"pages",title:p(o)("common.normalPage"),add:"","expand-default":!0,onOnAdd:h},{default:$(()=>[(f(!0),M(q,null,W(p(s).getNormalPage,z=>(f(),M(q,null,[z.children?(f(),U(Ne,{ref_for:!0,ref:"reSubMenu",key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[0]||(A[0]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[1]||(A[1]=Q=>x(Q)),onEdit:A[2]||(A[2]=Q=>I(Q.id,"normal")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,We),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"normal")},null,8,["onClick"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(o)("common.layoutPage"),"expand-default":!0,permission:"pages"},{bar:$(()=>[p(u).list.length?(f(),U(Le,{key:0,trigger:"click",onCommand:i,onVisibleChange:A[3]||(A[3]=z=>c.value=z)},{dropdown:$(()=>[(f(!0),M(q,null,W(p(u).list,z=>(f(),U(ne,{key:z.id,command:z.id},{default:$(()=>[Ae(J(z.name),1)]),_:2},1032,["command"]))),128))]),default:$(()=>[ie(k(K,{class:de(["iconfont icon-a-addto opacity-0 group-hover:opacity-100 hover:text-blue",c.value?"opacity-100":""])},null,8,["class"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:1})):j("",!0)]),default:$(()=>[(f(!0),M(q,null,W(p(s).getLayoutPage,z=>(f(),M(q,null,[z.children?(f(),U(Ne,{key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[4]||(A[4]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[5]||(A[5]=Q=>x(Q)),onEdit:A[6]||(A[6]=Q=>I(Q.id,"layout")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,We),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"layout")},null,8,["onClick"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),k(re,{title:p(o)("common.richTextPage"),add:"","expand-default":!0,permission:"pages",onOnAdd:b},{default:$(()=>[(f(!0),M(q,null,W(p(s).getRichPage,z=>(f(),M(q,null,[z.children?(f(),U(Ne,{key:z.folderName+z.floor,data:z,permission:"pages","show-edit":!0,onClickHandle:A[7]||(A[7]=Q=>Ue(Q,Q.type==="RichText"?st:We)),onRemove:A[8]||(A[8]=Q=>x(Q)),onEdit:A[9]||(A[9]=Q=>I(Q.id,"rich")),onClickContextMenu:Q=>D(Q.event,Q.item)},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:z.id,key:z.id,title:z.name,name:z.name,remove:"",permission:"pages",padding:12+z.floor*6,onClick:Q=>Ue(z,st),onRemove:Q=>x(z.id),onContextmenu:H(Q=>D(Q,z),["prevent","stop"])},{default:$(()=>[ie(k(K,{class:"iconfont icon-a-writein hover:text-blue",onClick:Q=>I(z.id,"rich")},null,8,["onClick"]),[[gt,{feature:p(t).query.activity,action:"edit",effect:"hiddenIcon"}]])]),_:2},1032,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:A[12]||(A[12]=H(()=>{},["stop"]))},[k(yt,{modelValue:a.value,"onUpdate:modelValue":A[11]||(A[11]=z=>a.value=z),width:"600px","close-on-click-modal":!1,title:((Ht=d.value)==null?void 0:Ht.id)==p(Z)?p(o)("common.newPage"):p(o)("common.editPage"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:V,onCancel:A[10]||(A[10]=z=>a.value=!1)})]),default:$(()=>[d.value?(f(),M("div",{key:0,onKeydown:ue(V,["enter"])},[p(m)==="rich"?(f(),U(yi,{key:0,ref_key:"richForm",ref:r,"old-url":_.value,"label-position":"top",model:d.value},null,8,["old-url","model"])):(f(),U(fi,{key:1,ref_key:"form",ref:n,"old-url-path":_.value,"label-position":"top",model:d.value},null,8,["old-url-path","model"]))],40,gi)):j("",!0)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:w,actions:p(O).filter(z=>z.show===!0)},null,8,["actions"])],64)}}});var _i=Object.freeze(Object.defineProperty({__proto__:null,define:bi,open:Ue,default:wi},Symbol.toStringTag,{value:"Module"}));const Oo=oe.global.t,ki=()=>N.get(E("Script/External",!0)),hi=()=>N.get(E("Script/Embedded",!0)),xi=e=>N.get(E("Script/Get"),{id:e}),Ci=e=>N.post(E("Script/Update"),e),$i=e=>N.post(E("Script/Deletes"),{ids:e},void 0,{successMessage:Oo("common.deleteSuccess")}),Si=e=>N.post(E("Upload/Script"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},successMessage:Oo("common.uploadSuccess")}),Vi=e=>N.get(E("Script/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Fo=oe.global.t,Bo=e=>N.get(E(`ResourceGroup/${e}`,!0)),qo=e=>N.post(E("ResourceGroup/Update"),e,void 0,{successMessage:Fo("common.saveSuccess")}),Go=e=>N.post(E("ResourceGroup/Deletes"),{ids:e},void 0,{successMessage:Fo("common.deleteSuccess")}),Ko=(e,l)=>N.get(E("ResourceGroup/isUniqueName"),{name:e,type:l},{hiddenLoading:!0,hiddenError:!0}),Ho=e=>N.get(E("ResourceGroup/Get"),{id:e}),Mt=Re("scriptStore",()=>{const e=ce(),l=F(),o=C([]),t=C([]),s=C([]),u=X(()=>{const i=[];return i.push(...o.value.map(b=>({id:b.id,name:b.name,href:b.routeName,fullPath:b.fullUrl}))),i.push(...t.value.map(b=>({id:b.id,name:b.name,href:b.relativeUrl,fullPath:b.previewUrl}))),i}),a=()=>g(void 0,null,function*(){o.value=yield ki()}),n=()=>g(void 0,null,function*(){t.value=yield Bo("Script")}),r=()=>g(void 0,null,function*(){s.value=yield hi()}),d=()=>{a(),n(),r()},c=i=>Ho(i),m=i=>g(void 0,null,function*(){yield qo(i),n()}),_=i=>g(void 0,null,function*(){yield Go(i),l.deleteTabs(i),n()}),w=i=>g(void 0,null,function*(){const b=new FormData;b.append("file",i),yield Si(b),a()}),v=i=>g(void 0,null,function*(){const b=yield xi(i);return b.body||(b.body=""),b}),S=(i,b)=>g(void 0,null,function*(){i.enableDiffChecker=!0;const I=yield Ci(i);return e.site.recordSiteLogVideo&&b&&(yield Be(I,b,i.isEmbedded)),Object.assign(i,yield v(I))}),h=i=>g(void 0,null,function*(){yield $i(i),l.deleteTabs(i),d()});return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},()=>{o.value=[],s.value=[],t.value=[]}),{external:o,embedded:s,group:t,all:u,getGroup:c,updateGroup:m,deleteGroups:_,uploadScript:w,deleteScripts:h,getScript:v,updateScript:S,loadAll:d,loadEmbedded:r,loadExternal:a,loadGroups:n}}),Ti={key:0,class:"h-full"},Mi=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Mt(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getScript(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateScript(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),_=(w,v)=>g(this,null,function*(){yield d.promise,v?r.value.search(v,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,v)=>a.value?(f(),M("div",Ti,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"javascript",uri:p(je).from({scheme:"memory",path:a.value.id}),onMonacoLoadComplete:v[1]||(v[1]=S=>p(u).addTabRecord(t.id,S,"javascript"))},null,8,["modelValue","uri"])])):j("",!0)}}),Ii={class:"p-24"},Ri={class:"flex items-center"},Li={key:0,class:"w-100px !h-40px flex items-center justify-center"},Ui=R("div",null,null,-1),zo=G({props:{id:null,hiddenName:{type:Boolean}},emits:["save"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),u=Mt(),a=C(),n=C({id:t.id||Z,name:"",typeName:"Script",children:[]}),r=X(()=>n.value.id!==Z),d=()=>g(this,null,function*(){n.value=yield u.getGroup(n.value.id)}),c=X(()=>{const h=[];for(const i of u.external)n.value.children.some(b=>b.routeId===i.routeId)||h.push({name:i.name,routeId:i.routeId});return h}),m=X(()=>{const h={name:[_e(1,50),le(s("common.nameRequiredTips")),Te(),{asyncValidator(b,I,V){return g(this,null,function*(){try{yield Ko(I,"script")}catch(x){V(Error(s("common.nameExist")))}})},trigger:"blur"}]};return r.value&&delete h.name,h}),_=()=>g(this,null,function*(){var h;yield(h=a.value)==null?void 0:h.validate(),yield u.updateGroup(n.value)}),w=h=>{const i=c.value.find(b=>b.routeId===h);i&&n.value.children.push(i)},v=h=>{const i=n.value.children.splice(h.oldIndex,1)[0];n.value.children.splice(h.newIndex,0,i)},S=h=>{const i=n.value.children.findIndex(b=>b.routeId===h);n.value.children.splice(i,1)};return n.value.id!==Z&&d(),l({save:_}),(h,i)=>{const b=me,I=pe,V=ve,x=be,y=lt,T=Vt,L=Ot,O=Tt;return f(),M("div",Ii,[e.hiddenName?j("",!0):(f(),U(V,{key:0,ref_key:"form",ref:a,"label-position":"top",model:n.value,rules:p(m),onSubmit:i[1]||(i[1]=H(()=>{},["prevent"])),onKeydown:i[2]||(i[2]=ue(D=>o("save"),["enter"]))},{default:$(()=>[k(I,{label:p(s)("common.name"),prop:"name"},{default:$(()=>[k(b,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value.name=D),disabled:p(r),"data-cy":"group-name"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),k(O,{trigger:"click",onCommand:w},{dropdown:$(()=>[Object.keys(p(c)).length==0?(f(),M("div",Li,[R("span",null,J(p(s)("common.noData")),1)])):(f(),U(L,{key:1},{default:$(()=>[(f(!0),M(q,null,W(p(c),D=>(f(),U(T,{key:D.routeId,command:D.routeId,"data-cy":"script-opt"},{default:$(()=>[R("span",null,J(D.name),1)]),_:2},1032,["command"]))),128))]),_:1}))]),default:$(()=>[k(y,{round:"",class:"shadow-s-10 border-none","data-cy":"add-script"},{default:$(()=>[R("div",Ri,[R("span",null,J(p(s)("common.addScript")),1),k(x,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})])]),_:1})]),_:1}),k(go,{class:"!px-0",list:n.value.children,"display-prop":"name","id-prop":"routeId",onSort:v,onDelete:S},{bottom:$(()=>[Ui]),_:1},8,["list"])])}}}),Ei={class:"h-full"},Ni=G({props:{id:null},setup(e,{expose:l}){const o=C();return l({save:()=>g(this,null,function*(){o.value.save()})}),(s,u)=>(f(),M("div",Ei,[k(zo,{id:e.id,ref_key:"inner",ref:o,"hidden-name":""},null,8,["id"])]))}}),Ai=G({props:{model:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),u=X(()=>({name:o.model.id!==Z?"":[_e(1,64),le(t("common.nameRequiredTips")),Te(),Ce(Vi,t("common.scriptNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.scriptName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"script-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),Di=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const{t:o}=Y(),t=C(!0),s=C(),u=()=>g(this,null,function*(){yield s.value.save(),t.value=!1});return(a,n)=>{const r=ye;return f(),M("div",{onClick:n[2]||(n[2]=H(()=>{},["stop"]))},[k(r,{"model-value":t.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:p(o)("common.scriptGroup"),onClosed:n[1]||(n[1]=d=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"script",action:"edit"},onConfirm:u,onCancel:n[0]||(n[0]=d=>t.value=!1)})]),default:$(()=>[k(zo,{id:e.id,ref_key:"inner",ref:s,class:"p-32",onSave:u},null,8,["id"])]),_:1},8,["model-value","title"])])}}}),ji=["onKeydown"],tt=oe.global.t,Pi={name:"scripts",icon:"icon-js",display:tt("common.script"),order:40,permission:"script",actions:[{name:"refresh",display:tt("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:tt("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"scripts"}))}}]},ht=e=>{const l=[{name:"save",visible:!1,display:tt("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",display:tt("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})}];e.ownerObjectId===Z&&l.push({name:"open",display:tt("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=Mt();let t=o.all.find(s=>s.id===e.id);if(t||(yield Promise.all([o.loadExternal(),o.loadGroups()]),t=o.all.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.fullPath)}})}),F().addTab({id:e.id,name:e.name,panel:Mi,icon:"icon-js",actions:l})},Oi=G({setup(e,{expose:l}){const{t:o}=Y(),t=Mt(),s=F(),u=C(!1),a=C(!1),n=C(),r=C(),d=C(),c=i=>{const b=[{name:"save",visible:!1,display:o("common.save"),icon:"icon-preservation",invoke:()=>g(this,null,function*(){var V,x;const I=yield(x=(V=F().activeTab)==null?void 0:V.panelInstance)==null?void 0:x.promise;!I||I.save()})}];i.previewUrl&&b.push({name:"open",display:o("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>{const{onPreview:I}=we();I(i.previewUrl)}}),s.addTab({id:i.id,name:i.name,panel:Ni,icon:"icon-js",actions:b})},m=()=>g(this,null,function*(){d.value={id:Z,name:"",body:"",extension:"js",isEmbedded:!1,ownerObjectId:void 0},u.value=!0}),_=()=>g(this,null,function*(){yield n.value.validate();const i=yield t.updateScript(d.value);ht(i),t.loadExternal(),u.value=!1}),w=i=>g(this,null,function*(){yield xe(),yield t.deleteScripts([i])}),v=i=>g(this,null,function*(){yield xe(),t.deleteGroups([i])}),S=()=>{t.loadAll()},h=X(()=>{var I,V,x,y,T,L;var i=[{name:o("common.copyTitle"),invoke:O=>g(this,null,function*(){Ve(O.name)})}],b=((V=(I=r.value)==null?void 0:I.payload)==null?void 0:V.fullUrl)||((y=(x=r.value)==null?void 0:x.payload)==null?void 0:y.previewUrl);return b&&!((L=(T=r.value)==null?void 0:T.payload)!=null&&L.isEmbedded)&&i.push({name:o("common.preview"),invoke:O=>g(this,null,function*(){const{onPreview:D}=we();D(b)})}),i});return l({load:S}),(i,b)=>{const I=ye;return f(),M("div",null,[k(re,{title:p(o)("common.external"),add:"","expand-default":!0,permission:"script",onOnAdd:m},{default:$(()=>[(f(!0),M(q,null,W(p(t).external,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>ht(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=r.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.embedded"),"expand-default":!0,permission:"script"},{default:$(()=>[(f(!0),M(q,null,W(p(t).embedded,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>ht(V),onRemove:x=>w(V.id),onContextmenu:H(x=>{var y;return(y=r.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.group"),add:"","expand-default":!0,permission:"script",onOnAdd:b[0]||(b[0]=V=>a.value=!0)},{default:$(()=>[(f(!0),M(q,null,W(p(t).group,V=>(f(),U(ae,{id:V.id,key:V.id,title:V.name,remove:"",permission:"script",onClick:x=>c(V),onRemove:x=>v(V.id),onContextmenu:H(x=>{var y;return(y=r.value)==null?void 0:y.openMenu(x,V)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:b[3]||(b[3]=H(()=>{},["stop"]))},[k(I,{modelValue:u.value,"onUpdate:modelValue":b[2]||(b[2]=V=>u.value=V),width:"600px","close-on-click-modal":!1,title:p(o)("common.newScript"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:_,onCancel:b[1]||(b[1]=V=>u.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(_,["enter"])},[d.value?(f(),U(Ai,{key:0,ref_key:"form",ref:n,"label-position":"top",model:d.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,ji)]),_:1},8,["modelValue","title"])]),a.value?(f(),U(Di,{key:0,modelValue:a.value,"onUpdate:modelValue":b[4]||(b[4]=V=>a.value=V)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:r,actions:p(h)},null,8,["actions"])])}}});var Fi=Object.freeze(Object.defineProperty({__proto__:null,define:Pi,open:ht,default:Oi},Symbol.toStringTag,{value:"Module"}));const Bi={class:"highlight"},qi={key:0,class:"active"},Gi=G({props:{light:{default:()=>({background:"#f0c1a3",color:"#616161"})},dark:{default:()=>({background:"#595961",color:"#f8f8f2"})},keyword:null,text:null,maxLength:{default:16},pattern:{default:"all"},start:null,end:null},setup(e){const l=e;an(n=>({"65c4ab22":l.dark.background,d61c1e22:l.dark.color,"5008cfec":l.light.background,"4ff6d9f2":l.light.color}));const o=C([]),t=C([]);function s(n,r){var d=new RegExp(r,"i"),c=n.search(d),m=[];return c!==-1?(m.push(n.substring(0,c)),m.push(n.substring(c+r.length))):m.push(n),m}function u(n,r){var d=new RegExp(r,"i"),c=n.match(d);return c?[c[0]]:[]}ee(()=>l,a,{immediate:!0,deep:!0});function a(){if(!!(l.text&&l.keyword)){if(l.start!==void 0){o.value=s(l.text,l.keyword),t.value=u(l.text,l.keyword);return}if(l.pattern==="first"){const n=l.text.match(new RegExp(l.keyword,"i"));if(n===null){o.value=[l.text];return}t.value=[n[0]];const r=l.text.slice(0,n.index),d=l.text.slice(n.index+l.keyword.length);if(n.index===0){o.value=["",d];return}let c=l.maxLength-l.keyword.length;if(c<0){o.value=["...",d];return}n.index<=c?o.value=[r,d]:o.value=["..."+r.slice(-c).slice(3),d]}else l.pattern==="all"&&(o.value=l.text.split(new RegExp(l.keyword,"i")),t.value=l.text.match(new RegExp(l.keyword,"ig")))}}return(n,r)=>(f(),M("span",Bi,[(f(!0),M(q,null,W(o.value,(d,c)=>{var m;return f(),M(q,{key:c},[R("span",null,J(d),1),c+1!==((m=o.value)==null?void 0:m.length)?(f(),M("span",qi,J(t.value[c]),1)):j("",!0)],64)}),128))]))}}),Ki=(e,l,o)=>N.get(E("CodeSearch/Search"),{keyword:e,isRegex:l,ignoreCase:o}),Hi={class:"text-s px-8 py-4 flex items-center bg-gray/30 dark:bg-[#333] space-x-4 dark:text-fff/86"},zi=["placeholder"],Ji=["title"],Wi=["title"],Qi=["onClick"],Xi=["title"],Yi={key:1,class:"text-s text-999 break-all p-4","data-cy":"no-search-result"},lo=oe.global.t,Zi={name:"code search",icon:"icon-search",display:lo("common.search"),route:"layouts",order:85,permission:"code",actions:[{name:"refresh",display:lo("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).onSearch()})}}]},er=G({setup(e,{expose:l}){const o=He(po),{t}=Y(),s=F(),u=qe(),a=De(),n=C(),r=C(""),d=C(""),c=()=>g(this,null,function*(){if(r.value=d.value.trim(),!r.value){w();return}if(u.isRegex)try{RegExp(r.value)}catch(h){return}n.value=yield Ki(r.value,u.isRegex,u.ignoreCase)}),m=cn(c,1e3);ee(()=>[d.value,u.ignoreCase,u.isRegex],()=>{m()});const _=(h,i)=>g(this,null,function*(){var V,x,y,T;const b={id:h.id,name:h.name,params:h.params,type:h.type};if(b.type==="Page"&&((V=b.params)==null?void 0:V.type)===3){const L=yo(b.id,(x=b.params)==null?void 0:x.layout);St(se.resolve(L).href);return}o(b);const I=yield(T=(y=s.activeTab)==null?void 0:y.panelInstance)==null?void 0:T.promise;!(I!=null&&I.goToLine)||(i!==void 0?(I.goToLine(i,r.value),s.setActiveSearch(h.id+"-"+String(i))):(I.goToLine(1,r.value),s.setActiveSearch(h.id)))}),w=()=>{var h;r.value="",d.value="",n.value=void 0,(h=v.value)==null||h.focus()},v=C(),S=()=>{uo(()=>{var h,i;d.value?(h=v.value)==null||h.select():(i=v.value)==null||i.focus()})};return nt(S),ee(()=>a.query.activity,h=>{h==="code search"&&S()}),l({onSearch:c}),Fe("matchCase",()=>u.ignoreCase=!u.ignoreCase),Fe("useRegularExpression",()=>{u.isRegex=!u.isRegex}),(h,i)=>{var V,x;const b=be,I=Gi;return f(),M("div",null,[R("div",Hi,[k(b,{class:"iconfont icon-search text-666 dark:text-fff/86"}),ie(R("input",{ref_key:"inputKeywordEl",ref:v,"onUpdate:modelValue":i[0]||(i[0]=y=>d.value=y),class:"outline-none w-full bg-transparent",placeholder:p(t)("common.inputKeyword"),"data-cy":"search",onClick:i[1]||(i[1]=H(()=>{},["stop"]))},null,8,zi),[[so,d.value]]),R("span",{class:de(["cursor-pointer",{"text-blue":!p(u).ignoreCase}]),title:p(t)("common.matchCase"),onClick:i[2]||(i[2]=y=>p(u).ignoreCase=!p(u).ignoreCase)},"Aa",10,Ji),R("span",{class:de(["cursor-pointer",{"text-blue":p(u).isRegex}]),title:p(t)("common.useRegularExpression"),onClick:i[3]||(i[3]=y=>p(u).isRegex=!p(u).isRegex)},".*",10,Wi),d.value?(f(),U(b,{key:0,class:"iconfont icon-delete5 text-666/50 dark:text-fff/50 cursor-pointer",onClick:w})):j("",!0)]),(V=n.value)!=null&&V.length?(f(!0),M(q,{key:0},W(n.value,y=>(f(),U(ae,{key:y.id,id:y.id,title:y.name,"ignore-search":"",permission:"search",onClick:T=>_(y)},{collapse:$(()=>[(f(!0),M(q,null,W(y.matched,T=>(f(),M("div",{key:T.lineNumber+T.summary,class:de(["cursor-pointer hover:bg-blue/30 px-8",p(s).activeSearch===y.id+"-"+String(T.lineNumber+1)?"bg-blue/30":""]),onClick:H(L=>_(y,T.lineNumber+1),["stop"])},[R("p",{class:"text-s text-666 ellipsis cursor-default select-none pointer-events-none",title:T.summary,"data-cy":"line-summary"},[Ae(J(T.lineNumber+1)+": ",1),k(I,{keyword:r.value,text:T.summary,pattern:"all",start:T.start,end:T.end},null,8,["keyword","text","start","end"])],8,Xi)],10,Qi))),128))]),_:2},1032,["id","title","onClick"]))),128)):((x=n.value)==null?void 0:x.length)===0?(f(),M("p",Yi,J(p(t)("common.searchResultEmpty",{keyword:r.value})),1)):j("",!0)])}}});var tr=Object.freeze(Object.defineProperty({__proto__:null,define:Zi,default:er},Symbol.toStringTag,{value:"Module"}));const Jo=oe.global.t,or=()=>N.get(E("Style/External",!0)),nr=()=>N.get(E("Style/Embedded",!0)),ar=e=>N.get(E("Style/Get"),{id:e}),lr=e=>N.post(E("Style/Update"),e),sr=e=>N.post(E("Style/Deletes"),{ids:e},void 0,{successMessage:Jo("common.deleteSuccess")}),ir=e=>N.post(E("Upload/Style"),e,void 0,{headers:{"Content-Type":"multipart/form-data"},successMessage:Jo("common.uploadSuccess")}),rr=e=>N.get(E("Style/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),ur=oe.global.t,It=Re("styleStore",()=>{const e=ce(),l=F(),o=C([]),t=C([]),s=C([]),u=X(()=>{const i=[];return i.push(...o.value.map(b=>({id:b.id,name:b.name,href:b.routeName,fullPath:b.fullUrl}))),i.push(...t.value.map(b=>({id:b.id,name:b.name,href:b.relativeUrl,fullPath:b.previewUrl}))),i}),a=()=>g(void 0,null,function*(){o.value=yield or()}),n=()=>g(void 0,null,function*(){t.value=yield Bo("Style")}),r=()=>g(void 0,null,function*(){s.value=yield nr()}),d=()=>{a(),n(),r()},c=i=>Ho(i),m=i=>g(void 0,null,function*(){yield qo(i),n()}),_=i=>g(void 0,null,function*(){yield Go(i),l.deleteTabs(i),n()}),w=i=>g(void 0,null,function*(){const b=i.name,I=new FormData;b.indexOf(".")>-1&&b.split(".").reverse()[0]==="css"?(I.append("file",i),yield ir(I),a()):co.error(ur("common.fileFormatIsIncorrect"))}),v=i=>g(void 0,null,function*(){const b=yield ar(i);return b.body||(b.body=""),b}),S=(i,b)=>g(void 0,null,function*(){i.enableDiffChecker=!0;const I=yield lr(i);return e.site.recordSiteLogVideo&&b&&(yield Be(I,b,i.isEmbedded)),Object.assign(i,yield v(I))}),h=i=>g(void 0,null,function*(){yield sr(i),l.deleteTabs(i),d()});return ee(()=>{var i;return(i=e.site)==null?void 0:i.id},()=>{o.value=[],s.value=[],t.value=[]}),{external:o,group:t,embedded:s,all:u,getGroup:c,updateGroup:m,deleteGroups:_,uploadStyle:w,deleteStyles:h,getStyle:v,updateStyle:S,loadAll:d,loadEmbedded:r,loadExternal:a,loadGroups:n}}),dr={key:0,class:"h-full"},cr=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=It(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getStyle(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateStyle(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),_=(w,v)=>g(this,null,function*(){yield d.promise,v?r.value.search(v,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,v)=>a.value?(f(),M("div",dr,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"css",uri:p(je).from({scheme:"memory",path:a.value.id}),onMonacoLoadComplete:v[1]||(v[1]=S=>p(u).addTabRecord(t.id,S,"css"))},null,8,["modelValue","uri"])])):j("",!0)}});const mr={class:"p-24"},pr={class:"flex items-center"},vr={key:0,class:"w-100px !h-40px flex items-center justify-center dark:text-fff/86"},fr=R("div",null,null,-1),Wo=G({props:{id:null,hiddenName:{type:Boolean}},emits:["save"],setup(e,{expose:l,emit:o}){const t=e,{t:s}=Y(),u=It(),a=C(),n=C({id:t.id||Z,name:"",typeName:"Style",children:[]}),r=X(()=>n.value.id!==Z),d=()=>g(this,null,function*(){n.value=yield u.getGroup(n.value.id)}),c=X(()=>{const h=[];for(const i of u.external)n.value.children.some(b=>b.routeId===i.routeId)||h.push({name:i.name,routeId:i.routeId});return h}),m=X(()=>{const h={name:[_e(1,50),Te(),le(s("common.nameRequiredTips")),{asyncValidator(b,I,V){return g(this,null,function*(){try{yield Ko(I,"style")}catch(x){V(Error(s("common.nameExist")))}})},trigger:"blur"}]};return r.value&&delete h.name,h}),_=()=>g(this,null,function*(){var h;yield(h=a.value)==null?void 0:h.validate(),yield u.updateGroup(n.value)}),w=h=>{const i=c.value.find(b=>b.routeId===h);i&&n.value.children.push(i)},v=h=>{const i=n.value.children.splice(h.oldIndex,1)[0];n.value.children.splice(h.newIndex,0,i)},S=h=>{const i=n.value.children.findIndex(b=>b.routeId===h);n.value.children.splice(i,1)};return n.value.id!==Z&&d(),l({save:_}),(h,i)=>{const b=me,I=pe,V=ve,x=be,y=lt,T=Vt,L=Ot,O=Tt;return f(),M("div",mr,[e.hiddenName?j("",!0):(f(),U(V,{key:0,ref_key:"form",ref:a,"label-position":"top",model:n.value,rules:p(m),onSubmit:i[1]||(i[1]=H(()=>{},["prevent"])),onKeydown:i[2]||(i[2]=ue(D=>o("save"),["enter"]))},{default:$(()=>[k(I,{label:p(s)("common.name"),prop:"name"},{default:$(()=>[k(b,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=D=>n.value.name=D),disabled:p(r),"data-cy":"group-name"},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])),k(O,{trigger:"click",onCommand:w},{dropdown:$(()=>[Object.keys(p(c)).length==0?(f(),M("div",vr,[R("span",null,J(p(s)("common.noData")),1)])):(f(),U(L,{key:1,class:"styleDropdownMenu"},{default:$(()=>[(f(!0),M(q,null,W(p(c),D=>(f(),U(T,{key:D.routeId,command:D.routeId,"data-cy":"style-opt"},{default:$(()=>[R("span",null,J(D.name),1)]),_:2},1032,["command"]))),128))]),_:1}))]),default:$(()=>[k(y,{round:"",class:"shadow-s-10 border-none","data-cy":"add-style"},{default:$(()=>[R("div",pr,[R("span",null,J(p(s)("common.addStyle")),1),k(x,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})])]),_:1})]),_:1}),k(go,{class:"!px-0",list:n.value.children,"display-prop":"name","id-prop":"routeId",onSort:v,onDelete:S},{bottom:$(()=>[fr]),_:1},8,["list"])])}}}),yr={class:"h-full bg-fff dark:bg-[#141414]"},gr=G({props:{id:null},setup(e,{expose:l}){const o=C();return l({save:()=>g(this,null,function*(){o.value.save()})}),(s,u)=>(f(),M("div",yr,[k(Wo,{id:e.id,ref_key:"inner",ref:o,"hidden-name":""},null,8,["id"])]))}}),br=G({props:{model:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),u=X(()=>({name:o.model.id!==Z?"":[_e(1,64),le(t("common.nameRequiredTips")),Te(),Ce(rr,t("common.styleNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.styleName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"style-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),wr=G({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(e,{emit:l}){const{t:o}=Y(),t=C(!0),s=C(),u=()=>g(this,null,function*(){yield s.value.save(),t.value=!1});return(a,n)=>{const r=ye;return f(),M("div",{onClick:n[2]||(n[2]=H(()=>{},["stop"]))},[k(r,{"model-value":t.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:p(o)("common.styleGroup"),onClosed:n[1]||(n[1]=d=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{permission:{feature:"style",action:"edit"},onConfirm:u,onCancel:n[0]||(n[0]=d=>t.value=!1)})]),default:$(()=>[k(Wo,{id:e.id,ref_key:"inner",ref:s,onSave:u},null,8,["id"])]),_:1},8,["model-value","title"])])}}}),_r={class:"font-bold dark:text-fff/86"},kr=R("div",{class:"flex-1"},null,-1),hr={class:"font-bold dark:text-fff/86"},xr=R("div",{class:"flex-1"},null,-1),Cr={class:"flex items-center w-full"},$r={class:"font-bold text-666 flex-1"},Sr={key:0,class:"border-l-2 border-blue/50 pl-8"},Vr={class:"flex items-center w-full"},Tr={class:"text-666 flex-1"},Mr={class:"flex items-center w-full"},Ir={class:"text-666 flex-1"},Rr={class:"flex items-center w-full"},Lr={class:"font-bold text-666 flex-1"},Ur={key:1,class:"border-l-2 border-blue/50 pl-8"},Er={class:"text-666"},Nr={class:"text-s"},Ar={class:"text-666"},Dr={class:"text-s"},jr=G({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:l}){const o=ce(),t=C(JSON.parse(JSON.stringify(o.site))),{t:s}=Y(),u=C(!0),a=C(),n=()=>g(this,null,function*(){if(t.value.unocssSettings.enable)try{JSON.parse(t.value.unocssSettings.config),r()}catch(d){co.error(s("common.codeFormatIsIncorrect"));return}else r()}),r=()=>g(this,null,function*(){yield vn(t.value),o.loadSite(),o.loadSites(),u.value=!1});return(d,c)=>{const m=Ft,_=pe,w=he,v=me,S=ve,h=ye;return f(),U(h,{"model-value":u.value,width:"800px","close-on-click-modal":!1,title:p(s)("common.style"),onClosed:c[11]||(c[11]=i=>l("update:modelValue",!1))},{footer:$(()=>[k(fe,{onConfirm:n,onCancel:c[10]||(c[10]=i=>u.value=!1)})]),default:$(()=>[k(S,{ref_key:"form",ref:a,"label-position":"top",onKeydown:ue(n,["enter"])},{default:$(()=>[k(_,null,{default:$(()=>[R("span",_r,J(p(s)("common.JsCssCompression")),1),kr,k(m,{modelValue:t.value.enableJsCssCompress,"onUpdate:modelValue":c[0]||(c[0]=i=>t.value.enableJsCssCompress=i),"data-cy":"js-css-compress"},null,8,["modelValue"])]),_:1}),k(_,null,{default:$(()=>[R("span",hr,J(p(s)("common.JsCssBrowserCache")),1),xr,k(m,{modelValue:t.value.enableJsCssBrowerCache,"onUpdate:modelValue":c[1]||(c[1]=i=>t.value.enableJsCssBrowerCache=i),"data-cy":"js-css-cache"},null,8,["modelValue"])]),_:1}),k(_,null,{default:$(()=>[R("div",Cr,[R("span",$r,J(p(s)("settings.atomicCss")),1),k(m,{modelValue:t.value.unocssSettings.enable,"onUpdate:modelValue":c[2]||(c[2]=i=>t.value.unocssSettings.enable=i)},null,8,["modelValue"])])]),_:1}),t.value.unocssSettings.enable?(f(),M("div",Sr,[k(_,null,{default:$(()=>[R("div",Vr,[R("span",Tr,J(p(s)("settings.disableSsr")),1),k(m,{modelValue:t.value.unocssSettings.disableSsr,"onUpdate:modelValue":c[3]||(c[3]=i=>t.value.unocssSettings.disableSsr=i)},null,8,["modelValue"])])]),_:1}),k(_,null,{default:$(()=>[R("div",Mr,[R("span",Ir,J(p(s)("settings.resetDefaultStyle")),1),k(m,{modelValue:t.value.unocssSettings.resetStyle,"onUpdate:modelValue":c[4]||(c[4]=i=>t.value.unocssSettings.resetStyle=i)},null,8,["modelValue"])])]),_:1}),k(_,null,{default:$(()=>[R("div",{class:"h-300px w-full",onKeydown:c[6]||(c[6]=H(()=>{},["stop"]))},[k(w,{modelValue:t.value.unocssSettings.config,"onUpdate:modelValue":c[5]||(c[5]=i=>t.value.unocssSettings.config=i),language:"json"},null,8,["modelValue"])],32)]),_:1})])):j("",!0),k(_,null,{default:$(()=>[R("div",Rr,[R("span",Lr,J(p(s)("common.enableCssSplitByMedia")),1),k(m,{modelValue:t.value.enableCssSplitByMedia,"onUpdate:modelValue":c[7]||(c[7]=i=>t.value.enableCssSplitByMedia=i)},null,8,["modelValue"])])]),_:1}),t.value.enableCssSplitByMedia?(f(),M("div",Ur,[k(_,{class:"w-800px"},{default:$(()=>[R("div",null,[R("p",Er,J(p(s)("common.maxWidthForMobileBrowser")),1),R("p",Nr," ("+J(p(s)("common.maxWidthForMobileBrowserDetail"))+") ",1)]),k(v,{modelValue:t.value.mobileMaxWidth,"onUpdate:modelValue":c[8]||(c[8]=i=>t.value.mobileMaxWidth=i),class:"w-500px","data-cy":"max-width"},null,8,["modelValue"])]),_:1}),k(_,{class:"w-900px"},{default:$(()=>[R("div",null,[R("p",Ar,J(p(s)("common.minWidthForDesktopBrowser")),1),R("p",Dr," ("+J(p(s)("common.minWidthForDesktopBrowserDetail"))+") ",1)]),k(v,{modelValue:t.value.desktopMinWidth,"onUpdate:modelValue":c[9]||(c[9]=i=>t.value.desktopMinWidth=i),class:"w-500px","data-cy":"min-width"},null,8,["modelValue"])]),_:1})])):j("",!0)]),_:1},8,["onKeydown"])]),_:1},8,["model-value","title"])}}}),Pr=["onKeydown"],Ge=oe.global.t,Or={name:"styles",icon:"icon-css",display:Ge("common.style"),order:30,permission:"style",actions:[{name:"settings",display:Ge("common.settings"),icon:"icon-a-setup",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).showSettings()})}},{name:"refresh",display:Ge("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:Ge("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"styles"}))}}]},xt=e=>{const l=[{name:"save",visible:!1,display:Ge("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.save()})},{name:"refresh",display:Ge("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var t,s;const o=yield(s=(t=F().activeTab)==null?void 0:t.panelInstance)==null?void 0:s.promise;!o||o.load()})}];e.ownerObjectId===Z&&l.push({name:"open",display:Ge("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const o=It();let t=o.all.find(s=>s.id===e.id);if(t||(yield Promise.all([o.loadExternal(),o.loadGroups()]),t=o.all.find(s=>s.id===e.id)),t){const{onPreview:s}=we();s(t.fullPath)}})}),F().addTab({id:e.id,name:e.name,panel:cr,icon:"icon-css",actions:l})},Fr=G({setup(e,{expose:l}){const{t:o}=Y(),t=It(),s=F(),u=C(!1),a=C(!1),n=C(!1),r=C(),d=C(),c=C(),m=I=>{const V=[{name:"save",visible:!1,display:o("common.save"),icon:"icon-preservation",invoke:()=>g(this,null,function*(){var y,T;const x=yield(T=(y=F().activeTab)==null?void 0:y.panelInstance)==null?void 0:T.promise;!x||x.save()})}];I.previewUrl&&V.push({name:"open",display:o("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>{const{onPreview:x}=we();x(I.previewUrl)}}),s.addTab({id:I.id,name:I.name,panel:gr,icon:"icon-css",actions:V})},_=()=>g(this,null,function*(){c.value={id:Z,name:"",body:"",extension:"css",isEmbedded:!1,ownerObjectId:void 0},u.value=!0}),w=()=>g(this,null,function*(){yield r.value.validate();const I=yield t.updateStyle(c.value);xt(I),t.loadExternal(),u.value=!1}),v=I=>g(this,null,function*(){yield xe(),yield t.deleteStyles([I])}),S=I=>g(this,null,function*(){yield xe(),t.deleteGroups([I])}),h=()=>{t.loadAll()},i=X(()=>{var x,y,T,L,O,D;var I=[{name:o("common.copyTitle"),invoke:P=>g(this,null,function*(){Ve(P.name)})}],V=((y=(x=d.value)==null?void 0:x.payload)==null?void 0:y.fullUrl)||((L=(T=d.value)==null?void 0:T.payload)==null?void 0:L.previewUrl);return V&&!((D=(O=d.value)==null?void 0:O.payload)!=null&&D.isEmbedded)&&I.push({name:o("common.preview"),invoke:P=>g(this,null,function*(){const{onPreview:B}=we();B(V)})}),I});function b(){n.value=!0}return l({load:h,showSettings:b}),(I,V)=>{const x=ye;return f(),M("div",null,[k(re,{title:p(o)("common.external"),add:"","expand-default":!0,permission:"style",onOnAdd:_},{default:$(()=>[(f(!0),M(q,null,W(p(t).external,y=>(f(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:T=>xt(y),onRemove:T=>v(y.id),onContextmenu:H(T=>{var L;return(L=d.value)==null?void 0:L.openMenu(T,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.embedded"),"expand-default":!0,permission:"style"},{default:$(()=>[(f(!0),M(q,null,W(p(t).embedded,y=>(f(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:T=>xt(y),onRemove:T=>v(y.id),onContextmenu:H(T=>{var L;return(L=d.value)==null?void 0:L.openMenu(T,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),k(re,{title:p(o)("common.group"),add:"","expand-default":!0,permission:"style",onOnAdd:V[0]||(V[0]=y=>a.value=!0)},{default:$(()=>[(f(!0),M(q,null,W(p(t).group,y=>(f(),U(ae,{id:y.id,key:y.id,title:y.name,remove:"",permission:"style",onClick:T=>m(y),onRemove:T=>S(y.id),onContextmenu:H(T=>{var L;return(L=d.value)==null?void 0:L.openMenu(T,y)},["prevent","stop"])},null,8,["id","title","onClick","onRemove","onContextmenu"]))),128))]),_:1},8,["title"]),R("div",{onClick:V[3]||(V[3]=H(()=>{},["stop"]))},[k(x,{modelValue:u.value,"onUpdate:modelValue":V[2]||(V[2]=y=>u.value=y),width:"600px","close-on-click-modal":!1,title:p(o)("common.newStyle"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:w,onCancel:V[1]||(V[1]=y=>u.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(w,["enter"])},[c.value?(f(),U(br,{key:0,ref_key:"form",ref:r,"label-position":"top",model:c.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Pr)]),_:1},8,["modelValue","title"])]),a.value?(f(),U(wr,{key:0,modelValue:a.value,"onUpdate:modelValue":V[4]||(V[4]=y=>a.value=y)},null,8,["modelValue"])):j("",!0),k(Me,{ref_key:"contextMenu",ref:d,actions:p(i)},null,8,["actions"]),n.value?(f(),U(jr,{key:1,modelValue:n.value,"onUpdate:modelValue":V[5]||(V[5]=y=>n.value=y)},null,8,["modelValue"])):j("",!0)])}}});var Br=Object.freeze(Object.defineProperty({__proto__:null,define:Or,open:xt,default:Fr},Symbol.toStringTag,{value:"Module"}));const Qo=oe.global.t,qr=()=>N.get(E("View/list",!0)),Gr=e=>N.post(E("View/Deletes"),{ids:e},void 0,{successMessage:Qo("common.deleteSuccess")}),Vd=(e,l)=>N.post(E("View/Copy"),{id:e,name:l},void 0,{successMessage:Qo("common.copySuccess")}),Kr=e=>N.get(E("View/isUniqueName"),{name:e},{hiddenLoading:!0,hiddenError:!0}),Hr=e=>N.post(E("View/post"),e),zr=e=>N.get(E("View/get"),{id:e}),Kt=Re("viewStore",()=>{const e=ce(),l=F(),o=C([]),t=X(()=>l.getSplitNameData(o.value)),s=()=>g(void 0,null,function*(){o.value=yield qr()}),u=r=>g(void 0,null,function*(){yield Gr(r),l.deleteTabs(r),s()}),a=r=>g(void 0,null,function*(){r=r||Z;const d=yield zr(r);return d.body||(d.body=""),d.id=r,d}),n=(r,d)=>g(void 0,null,function*(){r.enableDiffChecker=!0;const c=yield Hr(r);return e.site.recordSiteLogVideo&&d&&(yield Be(c,d)),Object.assign(r,yield a(c))});return ee(()=>{var r;return(r=e.site)==null?void 0:r.id},()=>{o.value=[]}),{load:s,list:o,deleteViews:u,getView:a,updateView:n,getViews:t}}),Jr={key:0,class:"h-full"},Wr=G({props:{id:null},emits:["changed","setAction"],setup(e,{expose:l,emit:o}){const t=e,s=Kt(),u=F(),a=C(),n=Pe(),r=C(),d=new $e,c=()=>g(this,null,function*(){a.value=yield s.getView(t.id),d.resolve(null),n.init(a.value)}),m=()=>g(this,null,function*(){!a.value||(yield s.updateView(a.value,u.saveTabRecord(t.id)),n.init(a.value),o("changed",!1),o("setAction","save",{visible:!1}))}),_=(w,v)=>g(this,null,function*(){yield d.promise,v?r.value.search(v,w):r.value.goToLine(w)});return ee(()=>a.value,()=>{o("changed",n.changed(a.value)),o("setAction","save",{visible:n.changed(a.value)})},{deep:!0}),c(),l({save:m,load:c,goToLine:_}),(w,v)=>a.value?(f(),M("div",Jr,[k(he,{ref_key:"editor",ref:r,modelValue:a.value.body,"onUpdate:modelValue":v[0]||(v[0]=S=>a.value.body=S),language:"html","k-script":"",uri:p(je).file(a.value.id),onMonacoLoadComplete:v[1]||(v[1]=S=>p(u).addTabRecord(t.id,S,"html"))},null,8,["modelValue","uri"])])):j("",!0)}}),Qr=G({props:{model:null},setup(e,{expose:l}){const o=e,{t}=Y(),s=C(),u=Ee(()=>({name:o.model.id!==Z?[]:[Te(),_e(1,50),le(t("common.nameRequiredTips")),Ce(Kr,t("common.viewNameExistsTips"))]}));return l({validate:()=>{var a;return(a=s.value)==null?void 0:a.validate()}}),(a,n)=>{const r=me,d=pe,c=ve;return f(),U(c,{ref_key:"form",ref:s,model:e.model,rules:p(u),onSubmit:n[1]||(n[1]=H(()=>{},["prevent"]))},{default:$(()=>[k(d,{label:p(t)("common.viewName"),prop:"name"},{default:$(()=>[k(r,{modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=m=>e.model.name=m),class:"min-w-300px",disabled:e.model.id!==p(Z),title:e.model.name,"data-cy":"view-name"},null,8,["modelValue","disabled","title"])]),_:1},8,["label"])]),_:1},8,["model","rules"])}}}),Xr=["onKeydown"],ot=oe.global.t,Yr={name:"views",icon:"icon-view",display:ot("common.view"),route:"views",order:10,permission:"view",actions:[{name:"refresh",display:ot("common.refresh"),icon:"icon-Refresh",visible:!0,invoke(){return g(this,null,function*(){const e=F().activeActivity;if(!e)return;(yield e.panelInstance.promise).load()})}},{name:"more",display:ot("common.more"),icon:"icon-more",visible:!0,invoke(){se.push(ke({name:"views"}))}}]},Ct=e=>{F().addTab({id:e.id,name:e.name,panel:Wr,icon:"icon-view",actions:[{name:"save",visible:!1,display:ot("common.save"),icon:"icon-preservation",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.save()})},{name:"refresh",visible:!0,display:ot("common.refresh"),icon:"icon-Refresh",invoke:()=>g(void 0,null,function*(){var o,t;const l=yield(t=(o=F().activeTab)==null?void 0:o.panelInstance)==null?void 0:t.promise;!l||l.load()})},{name:"open",display:ot("common.preview"),visible:!0,icon:"icon-eyes",invoke:()=>g(void 0,null,function*(){const l=Kt();let o=l.list.find(t=>t.id===e.id);if(o||(yield l.load(),o=l.list.find(t=>t.id===e.id)),o){const{onPreview:t}=we();t(o.preview)}})}]})},Zr=G({setup(e,{expose:l}){const{t:o}=Y(),t=Kt(),s=C(!1),u=C(),a=C(),n=C(),r=()=>g(this,null,function*(){a.value=yield t.getView(),s.value=!0}),d=()=>g(this,null,function*(){yield u.value.validate();const w=yield t.updateView(a.value);Ct(w),t.load(),s.value=!1}),c=w=>g(this,null,function*(){yield xe(),yield t.deleteViews([w])}),m=()=>{t.load()},_=[{name:o("common.copyTitle"),invoke:w=>g(this,null,function*(){Ve(w.name)})},{name:o("common.preview"),invoke:w=>g(this,null,function*(){const{onPreview:v}=we();v(w.preview)})}];return l({load:m}),(w,v)=>{const S=ye;return f(),M("div",null,[k(re,{title:p(o)("common.list"),add:"","expand-default":!0,permission:"view",onOnAdd:r},{default:$(()=>[(f(!0),M(q,null,W(p(t).getViews,h=>(f(),M(q,null,[h.children?(f(),U(Ne,{key:h.folderName+h.floor,data:h,permission:"view",onClickHandle:v[0]||(v[0]=i=>Ct(i)),onRemove:v[1]||(v[1]=i=>c(i)),onClickContextMenu:i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i.event,i.item)}},null,8,["data","onClickContextMenu"])):(f(),U(ae,{id:h.id,key:h.id,permission:"view",title:h.name,name:h.name,padding:12+h.floor*6,remove:"",onClick:i=>Ct(h),onRemove:i=>c(h.id),onContextmenu:H(i=>{var b;return(b=n.value)==null?void 0:b.openMenu(i,h)},["prevent","stop"])},null,8,["id","title","name","padding","onClick","onRemove","onContextmenu"]))],64))),256))]),_:1},8,["title"]),R("div",{onClick:v[4]||(v[4]=H(()=>{},["stop"]))},[k(S,{modelValue:s.value,"onUpdate:modelValue":v[3]||(v[3]=h=>s.value=h),width:"600px","close-on-click-modal":!1,title:p(o)("common.newView"),"destroy-on-close":""},{footer:$(()=>[k(fe,{onConfirm:d,onCancel:v[2]||(v[2]=h=>s.value=!1)})]),default:$(()=>[R("div",{onKeydown:ue(d,["enter"])},[a.value?(f(),U(Qr,{key:0,ref_key:"form",ref:u,"label-position":"top",model:a.value,"edit-mode":!1},null,8,["model"])):j("",!0)],40,Xr)]),_:1},8,["modelValue","title"])]),k(Me,{ref_key:"contextMenu",ref:n,actions:_},null,512)])}}});var eu=Object.freeze(Object.defineProperty({__proto__:null,define:Yr,open:Ct,default:Zr},Symbol.toStringTag,{value:"Module"}));function tu(e,l,o){let t=0,s=[],u=null;const a=ce();e===""&&(e=Date.now().toString());function n(m,_){l=m,o=_,r()}function r(){!a.site.recordSiteLogVideo||!l||!o||(t=0,s=[],u=new Dn(e,l,o),u.bindStoreCallback(m=>{m.order=t++,s.push(m)}),u.open(),u.on())}function d(){return u==null||u.dispose(),u=null,s}function c(){var _;const m=s;if(t=0,s=[],u==null||u.open(),m.length){const w=(_=m.find(v=>v.type==="Open"))==null?void 0:_.text;return typeof w!="string"||w===(l==null?void 0:l.getValue())?"":JSON.stringify(m)}else return""}return{bindMonaco:n,on:r,off:d,save:c}}const Et={"../views/dev-mode/side-panels/code-panel.vue":Na,"../views/dev-mode/side-panels/debug-panel.vue":wl,"../views/dev-mode/side-panels/form-panel.vue":ql,"../views/dev-mode/side-panels/layout-panel.vue":Zl,"../views/dev-mode/side-panels/menu-panel.vue":Fs,"../views/dev-mode/side-panels/module-panel.vue":di,"../views/dev-mode/side-panels/page-panel.vue":_i,"../views/dev-mode/side-panels/script-panel.vue":Fi,"../views/dev-mode/side-panels/search-panel.vue":tr,"../views/dev-mode/side-panels/style-panel.vue":Br,"../views/dev-mode/side-panels/view-panel.vue":eu},F=Re("devModeStore",()=>{const e=C([]),l=C(),o=ce(),t=C([]),s=C(),u=C(""),a={},n=(y,T,L)=>{var O,D;if(y){for(let P=0;P<y.length;P++)if(((O=y[P].name)==null?void 0:O.toLocaleLowerCase())===(T==null?void 0:T.toLocaleLowerCase())&&((D=y[P].folderName)==null?void 0:D.toLocaleLowerCase())===(T==null?void 0:T.toLocaleLowerCase()))return y[P].children;return y.push({name:T,folderName:T,children:[],floor:L+1}),y[y.length-1].children}},r=y=>{var T;return(T=y.reduce((L,O)=>{const D=O.name.split(".").filter(B=>B!=="");if(D.length>1&&["html","css","js","ts"].includes(D[D.length-1].toLowerCase())){const B=D.pop();D[D.length-1]=D[D.length-1]+"."+B}let P=L;for(let B=0;B<D.length-1;B++)P=n(P,D[B],B);return P&&P.push(Oe(ge({},O),{tabName:D[D.length-1],floor:D.length?D.length:1})),L},[]))==null?void 0:T.sort((L,O)=>L.id&&!O.id?1:!L.id&&O.id?-1:0)},d=X(()=>e.value.find(y=>y.id.startsWith(Ye))),c=y=>{y.panelInstance=new $e,y.id.startsWith(Ye)?_(y):m(y)},m=y=>{const T=e.value.find(L=>L.id===y.id);T?l.value=T:(y.panel=Rt(y.panel),e.value.push(y),l.value=y)},_=y=>g(void 0,null,function*(){d.value?(l.value=d.value,(yield l.value.panelInstance.promise).load(y.id.replace(Ye,""))):(y.panel=Rt(y.panel),e.value.push(y),l.value=y)}),w=y=>{const T=e.value.find(O=>O.id===y);if(!T)return;const L=e.value.findIndex(O=>O.id===T.id);T===l.value&&(l.value=e.value[L===0?1:L-1]),e.value.splice(L,1),x(y)},v=y=>{for(const T of y)w(T)},S=()=>g(void 0,null,function*(){e.value=[],t.value=[];const y=[];s.value=void 0,l.value=void 0,yield uo();for(const T in Et){const L=Et[T].define;L&&(L.permission==="debug"?o.hasAccess("code","debug"):o.hasAccess(L.permission))&&y.push(Oe(ge({},JSON.parse(JSON.stringify(L))),{actions:L.actions,panel:Rt(Et[T].default),panelInstance:new $e}))}t.value=y.sort((T,L)=>T.order-L.order),s.value=t.value[0]}),h=()=>g(void 0,null,function*(){if(!s.value)return;const y=yield s.value.panelInstance.promise;y.load&&y.load()}),i=(y,T)=>g(void 0,null,function*(){const L=t.value.find(O=>O.name===y);!L||(s.value=L,s.value.init||(s.value.init=!0,yield h()),y==="modules"&&se.currentRoute.value.query.activity==="modules"&&T?(se.push(ke({name:"dev-mode",query:{activity:"modules"}})),Se().exitEditModule()):se.replace({name:se.currentRoute.value.name,query:Oe(ge({},se.currentRoute.value.query),{activity:y})}))}),b=y=>{u.value=y},I=(y,T,L)=>{e.value.find(D=>D.id===y)&&(a[y]=tu(y,T,L),a[y].on())},V=y=>{var T;return((T=a[y])==null?void 0:T.save())||""},x=y=>{var T;(T=a[y])==null||T.off(),delete a[y]};return ee(()=>{var y;return(y=o.site)==null?void 0:y.id},S,{immediate:!0}),{tabs:e,activeTab:l,addTab:c,deleteTab:w,deleteTabs:v,debugTab:d,activities:t,activeActivity:s,selectActivity:i,activeSearch:u,setActiveSearch:b,getSplitNameData:r,loadActivePanel:h,addTabRecord:I,saveTabRecord:V,removeTabRecord:x}});export{Rs as $,md as A,Se as B,Bs as C,la as D,nd as E,td as F,od as G,tu as H,Hs as I,fi as J,It as K,Mt as L,ud as M,Eo as N,mi as O,Po as P,yi as Q,Nt as R,ci as S,Sd as T,Kt as U,Vd as V,Io as W,Pl as X,jo as Y,js as Z,he as _,ft as a,Di as a0,wr as a1,jr as a2,qe as a3,Ki as a4,Wl as a5,Qr as a6,Ul as a7,Ai as a8,br as a9,Ta as aa,Me as ab,ti as ac,ei as ad,ut as ae,dt as af,Ct as ag,_t as ah,kt as ai,xt as aj,ht as ak,Ue as al,st as am,We as an,Gt as b,sd as c,ld as d,yd as e,pd as f,ad as g,bd as h,Kr as i,fd as j,wd as k,xd as l,gd as m,kd as n,_d as o,Lo as p,hd as q,vd as r,Ro as s,Cd as t,F as u,rd as v,id as w,$d as x,cd as y,dd as z};
