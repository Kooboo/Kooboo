var he=Object.defineProperty,_e=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var G=(e,n,t)=>n in e?he(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Q=(e,n)=>{for(var t in n||(n={}))ye.call(n,t)&&G(e,t,n[t]);if(Z)for(var t of Z(n))ge.call(n,t)&&G(e,t,n[t]);return e},X=(e,n)=>_e(e,ve(n));var j=(e,n,t)=>new Promise((r,u)=>{var _=c=>{try{m(t.next(c))}catch(i){u(i)}},p=c=>{try{m(t.throw(c))}catch(i){u(i)}},m=c=>c.done?r(c.value):Promise.resolve(c.value).then(_,p);m((t=t.apply(e,n)).next())});import{bv as be,cm as ke,d as B,g as O,E as xe,c as q,i as le,o as d,j as F,w as k,b as x,u as o,G as se,cd as we,B as Ce,cl as $e,bz as Se,x as Fe,c0 as N,a as y,f as l,t as b,k as S,F as M,b6 as K,n as T,b3 as Ee,b1 as Ue,cg as A,aH as Ve}from"./url.8f5ec20c.js";import{b as Ie}from"./toNumber.6efebd6a.js";import{b as Re}from"./last.e7aa49db.js";import{b as Y}from"./_baseIndexOf.4d7985be.js";import{b as Te}from"./style.67f0cdc4.js";import{f as D,h as ae,i as Me,j as ze}from"./_baseIsEqual.f1f57955.js";import{g as L,o as Pe,w as H}from"./i18n.0d8cb6d1.js";import{u as je}from"./use-operation-dialog.1c7cf152.js";import{h as Ae,d as Ne}from"./media-list.vue_vue_type_style_index_0_scoped_true_lang.92552fc5.js";import{c as Oe,d as Be}from"./file.f8555a01.js";import{a as Le,r as De,s as qe,f as Ke}from"./validate.b9ea657d.js";import{_ as He}from"./index.d1d474c4.js";import{E as Je}from"./index.97ced36a.js";import{E as We,a as Ye}from"./index.6756a6f3.js";import{E as Ze}from"./index.6ac167de.js";import{_ as Ge}from"./folder.8308bb9d.js";import{u as ie,k as Qe}from"./main.d919dab0.js";import{u as ee}from"./use-date.3be35318.js";import{u as Xe,a as te}from"./replace-all.e310d26c.js";import{_ as et}from"./relations-tag.c8ada5d9.js";import{c as oe}from"./use-copy-text.7801df9a.js";import{_ as tt}from"./plugin-vue_export-helper.21dcd24c.js";import{E as ot}from"./index.43142d25.js";import{E as nt}from"./index.ec3d8ab1.js";import{E as lt}from"./index.38840738.js";import{E as st}from"./index.c7806af3.js";import{E as at}from"./index.17321c3b.js";import{S as it}from"./search-input.fe88eea7.js";import{E as rt,a as ct}from"./index.9a7a049b.js";function dt(){}function ut(e,n){var t=e==null?0:e.length;return!!t&&Y(e,n,0)>-1}function ft(e,n,t){var r=e.length;return t=t===void 0?r:t,!n&&t>=r?e:Re(e,n,t)}var mt="\\ud800-\\udfff",pt="\\u0300-\\u036f",ht="\\ufe20-\\ufe2f",_t="\\u20d0-\\u20ff",vt=pt+ht+_t,yt="\\ufe0e\\ufe0f",gt="\\u200d",bt=RegExp("["+gt+mt+vt+yt+"]");function kt(e){return bt.test(e)}function xt(e){return e.split("")}var re="\\ud800-\\udfff",wt="\\u0300-\\u036f",Ct="\\ufe20-\\ufe2f",$t="\\u20d0-\\u20ff",St=wt+Ct+$t,Ft="\\ufe0e\\ufe0f",Et="["+re+"]",J="["+St+"]",W="\\ud83c[\\udffb-\\udfff]",Ut="(?:"+J+"|"+W+")",ce="[^"+re+"]",de="(?:\\ud83c[\\udde6-\\uddff]){2}",ue="[\\ud800-\\udbff][\\udc00-\\udfff]",Vt="\\u200d",fe=Ut+"?",me="["+Ft+"]?",It="(?:"+Vt+"(?:"+[ce,de,ue].join("|")+")"+me+fe+")*",Rt=me+fe+It,Tt="(?:"+[ce+J+"?",J,de,ue,Et].join("|")+")",Mt=RegExp(W+"(?="+W+")|"+Tt+Rt,"g");function zt(e){return e.match(Mt)||[]}function ne(e){return kt(e)?zt(e):xt(e)}function Pt(e,n,t){for(var r=-1,u=e==null?0:e.length;++r<u;)if(t(n,e[r]))return!0;return!1}function jt(e,n){for(var t=e.length;t--&&Y(n,e[t],0)>-1;);return t}function At(e,n){for(var t=-1,r=e.length;++t<r&&Y(n,e[t],0)>-1;);return t}function En(e,n,t){if(e=be(e),e&&(t||n===void 0))return Ie(e);if(!e||!(n=ke(n)))return e;var r=ne(e),u=ne(n),_=At(r,u),p=jt(r,u)+1;return ft(r,_,p).join("")}var Nt=1/0,Ot=D&&1/ae(new D([,-0]))[1]==Nt?function(e){return new D(e)}:dt,Bt=Ot,Lt=200;function Dt(e,n,t){var r=-1,u=ut,_=e.length,p=!0,m=[],c=m;if(t)p=!1,u=Pt;else if(_>=Lt){var i=n?null:Bt(e);if(i)return ae(i);p=!1,u=ze,c=new Me}else c=n?[]:m;e:for(;++r<_;){var a=e[r],f=n?n(a):a;if(a=t||a!==0?a:0,p&&f===f){for(var v=c.length;v--;)if(c[v]===f)continue e;n&&c.push(f),m.push(a)}else u(c,f,t)||(c!==m&&c.push(f),m.push(a))}return m}function Un(e,n){return e&&e.length?Dt(e,Te(n)):[]}const Vn=B({props:{modelValue:{type:Boolean},path:null,folders:null,folderType:null,provider:null},emits:["create-success"],setup(e,{emit:n}){const t=e,{t:r}=L(),{visible:u,handleClose:_}=je(t,n),p=O();let m=xe({name:""});const c=q(()=>t.folders.map(({name:f})=>({key:f}))),i={name:[Le(r("common.inputFolderNameTips")),De(1,50),qe(),Ke(c)]};le(()=>u.value,f=>{var v;return f&&((v=p.value)==null?void 0:v.resetFields())});function a(){var f;(f=p.value)==null||f.validate(v=>j(this,null,function*(){var h;if(v){const I={name:m.name,path:t.path,provider:(h=t.provider)!=null?h:"default"};t.folderType==="File"?yield Oe(I):yield Ae(I),_(),n("create-success")}}))}return(f,v)=>{const h=Je,I=We,z=Ye,P=Ze;return d(),F(P,{modelValue:o(u),"onUpdate:modelValue":v[2]||(v[2]=R=>se(u)?u.value=R:null),width:"600px","close-on-click-modal":!1,title:o(r)("common.newFolder"),onClose:o(_)},{footer:k(()=>[x(He,{"confirm-label":o(r)("common.create"),onConfirm:a,onCancel:o(_)},null,8,["confirm-label","onCancel"])]),default:k(()=>[x(z,{ref_key:"form",ref:p,class:"el-form--label-normal",model:o(m),rules:o(i),"label-position":"top",onSubmit:v[1]||(v[1]=H(()=>{},["prevent"]))},{default:k(()=>[x(I,{prop:"name",label:o(r)("common.nameYourFolder")},{default:k(()=>[x(h,{modelValue:o(m).name,"onUpdate:modelValue":v[0]||(v[0]=R=>o(m).name=R),"data-cy":"folder-name-input",onKeydown:Pe(a,["enter"])},null,8,["modelValue","onKeydown"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])}}});function qt(e){const n=we(),t=Ce("dialogInfo"),r=ie();function u(i){return i?Object.values(i).reduce((f,v)=>f+v,0):0}function _(i){e("clickFolder",i)}function p(i,a){if(t!=null&&t.value){e("editImage",i,a);return}n.push(Xe({name:"editImage",query:X(Q({},n.currentRoute.value.query),{id:i.key,provider:a})}))}function m(i,a){(t==null?void 0:t.value.multiple)===!1&&a.forEach(f=>{f.selected&&f!==i&&(f.selected=!1)})}function c(i){return i&&($e(i)?i:(i=Se(i,{siteId:Fe("siteId")}),N(r.site.prUrl,i)))}return{getReferencesCount:u,handleClickFolder:_,handleEditImage:p,dialogInfo:t,handleCheckFile:m,getPreviewUrl:c}}const V=e=>(Ee("data-v-743220c4"),e=e(),Ue(),e),Kt={class:"table-fixed w-full text-center text-[#666] dark:text-fff/50"},Ht={class:"bg-[#fafafa] dark:bg-444 shadow-s-10 relative"},Jt={key:0},Wt=V(()=>l("th",{width:"50"},null,-1)),Yt={class:"text-left"},Zt=V(()=>l("th",{class:"text-left"},"URL",-1)),Gt={width:"250",class:"text-left"},Qt={width:"100"},Xt={width:"150"},eo=["width"],to={key:1},oo=V(()=>l("th",{width:"50"},null,-1)),no={class:"text-left"},lo={key:0,class:"text-left"},so=V(()=>l("th",{width:"10"},null,-1)),ao={width:"90"},io={width:"160"},ro=["width"],co={class:"bg-[#fff] dark:bg-[#333] text-m"},uo=["onClick"],fo=["onClick"],mo=V(()=>l("img",{src:Ge,class:"w-28px mr-8px"},null,-1)),po=["title"],ho=V(()=>l("td",{class:"text-left"},null,-1)),_o=V(()=>l("td",null,"-",-1)),vo={class:"text-m"},yo={class:"flex items-center justify-end cursor-pointer px-16"},go=["onClick"],bo={class:"cursor-pointer"},ko={class:"text-left flex items-center min-h-48px"},xo=["src"],wo=["title"],Co={key:0},$o={class:"text-left flex items-center"},So=["title"],Fo={key:1},Eo={"data-cy":"size"},Uo={class:"text-m","data-cy":"last-modified-in-list"},Vo={key:2},Io={class:"inline-flex items-center cursor-pointer space-x-16"},Ro=["onClick"],To=["onClick"],Mo=["onClick"],zo=["onClick"],Po=["onClick"],jo={key:3},Ao={class:"flex items-center cursor-pointer space-x-16 justify-end px-16"},No=["onClick"],Oo=["onClick"],Bo=["onClick"],Lo=["onClick"],Do={key:0,class:"isEmpty"},qo=["colspan"],Ko={class:"el-table__empty-block w-full"},Ho={class:"el-table__empty-text"},Jo=B({props:{folders:null,files:null,hasCheckbox:{type:Boolean},hideOpenFolder:{type:Boolean},folderType:null,provider:null},emits:["clickFolder","editImage"],setup(e,{emit:n}){const t=e,r=O(!1),u=O([]),_=ie();let p=t.folderType?"file":"media";const m=g=>{var w;((w=g.mimeType)==null?void 0:w.split("/")[0])!=="image"?A(g.previewUrl):(u.value=[g.previewUrl],r.value=!0)},c=g=>j(this,null,function*(){if(g.downloadUrl)A(g.downloadUrl);else{const w=te(`Download/Single?id=${g.key}&type=${p}&provider=${t.provider}`);A(`/_api/v2/${w}`)}}),i=g=>j(this,null,function*(){const w={folder:g,folders:[g],files:[]},E=t.folderType?yield Be(w,t.provider):yield Ne(w,t.provider);if(!E)return;const C=te(`Download/Package?file=${E}&type=${p}`);A(`/_api/v2/${C}`)}),{t:a}=L(),{handleClickFolder:f,handleEditImage:v,dialogInfo:h,handleCheckFile:I}=qt(n),z=g=>{if(!g.folder){const E=g.url;g.folder=E.substring(0,E.lastIndexOf("/"))||""}const w={fullPath:`${g.folder||"/"}`,name:"",lastModified:new Date,count:1};f(w)},P=q(()=>!(h!=null&&h.value)&&t.folderType!=="File"),R=q(()=>t.folders.length===0&&t.files.length===0);return(g,w)=>{const E=nt,C=lt,pe=ot;return d(),y(M,null,[l("table",Kt,[l("thead",Ht,[o(P)?(d(),y("tr",Jt,[Wt,l("th",Yt,b(o(a)("common.fileName")),1),Zt,l("th",Gt,b(o(a)("common.usedBy")),1),l("th",Qt,b(o(a)("common.size")),1),l("th",Xt,b(o(a)("common.lastModified")),1),l("th",{width:e.hideOpenFolder?140:160},null,8,eo)])):(d(),y("tr",to,[oo,l("th",no,b(o(a)("common.fileName")),1),o(h)?S("",!0):(d(),y("th",lo,"URL")),so,l("th",ao,b(o(a)("common.size")),1),l("th",io,b(o(a)("common.lastModified")),1),l("th",{width:e.hideOpenFolder?110:130},null,8,ro)]))]),l("tbody",co,[(d(!0),y(M,null,K(e.folders,s=>(d(),y("tr",{key:s.fullPath,class:T({"!bg-blue/30":s.selected&&e.hasCheckbox&&!o(h)})},[l("td",{class:T(o(h)?"":"cursor-pointer"),onClick:U=>s.selected=!s.selected},[e.hasCheckbox&&!o(h)?(d(),F(E,{key:0,modelValue:s.selected,"onUpdate:modelValue":U=>s.selected=U,class:"pointer-events-none","data-cy":"folder-checkbox"},null,8,["modelValue","onUpdate:modelValue"])):S("",!0)],10,uo),l("td",null,[l("div",{class:"text-left flex items-center cursor-pointer min-h-48px",onClick:U=>o(f)(s)},[mo,l("div",{class:"ellipsis text-black dark:text-fff/50 pr-12",title:s.name,"data-cy":"folder-name"},b(s.name),9,po)],8,fo)]),l("td",{class:T(o(h)?"hidden":"")},null,2),ho,_o,l("td",vo,b(o(ee)(s.lastModified)),1),l("td",null,[l("div",yo,[x(C,{placement:"top","show-after":300,content:o(a)("common.download")},{default:k(()=>[l("span",{class:"iconfont icon-xiazai-wenjianxiazai-05 hover:text-blue font-bold",onClick:U=>i(s.fullPath)},null,8,go)]),_:2},1032,["content"])])])],2))),128)),(d(!0),y(M,null,K(e.files,s=>{var U;return d(),y("tr",{key:s.id,class:T({"!bg-blue/30":s.selected})},[l("td",bo,[e.hasCheckbox?(d(),F(E,{key:0,modelValue:s.selected,"onUpdate:modelValue":$=>s.selected=$,"data-cy":"file-checkbox",onChange:$=>o(I)(s,e.files)},null,8,["modelValue","onUpdate:modelValue","onChange"])):S("",!0)]),l("td",null,[l("div",ko,[s.thumbnail?(d(),y("img",{key:0,src:s.thumbnail,class:"w-30px h-26px mr-8px object-contain","data-cy":"thumbnail"},null,8,xo)):S("",!0),l("div",{class:"ellipsis text-black dark:text-fff/50 pr-12","data-cy":"file-name",title:s.name},b(s.name),9,wo)])]),o(h)?(d(),y("td",Fo)):(d(),y("td",Co,[l("div",$o,[l("div",{class:"ellipsis text-black dark:text-fff/50 pr-12","data-cy":"file-previewUrl",title:s.previewUrl},b(o(N)(o(_).site.baseUrl,s.url)),9,So)])])),l("td",{class:T(["py-8",o(h)?"hidden":""])},[x(et,{id:s.id,relations:(U=s.references)!=null?U:s.relations,type:s.references?"Image":"CmsFile"},null,8,["id","relations","type"])],2),l("td",Eo,b(o(Qe)(s.size)),1),l("td",Uo,b(o(ee)(s.lastModified)),1),o(P)?(d(),y("td",Vo,[l("div",Io,[e.hideOpenFolder?S("",!0):(d(),F(C,{key:0,placement:"top","show-after":300,content:o(a)("common.openFileLocation",s)},{default:k(()=>[l("span",{class:"iconfont icon-folder cursor-pointer hover:text-blue","data-cy":"open-folder",onClick:H($=>z(s),["stop"])},null,8,Ro)]),_:2},1032,["content"])),x(C,{placement:"top","show-after":300,content:o(a)("common.copyUrl")},{default:k(()=>[l("span",{class:"iconfont icon-copy cursor-pointer hover:text-blue","data-cy":"copy-in-grid",onClick:$=>o(oe)(o(N)(o(_).site.baseUrl,s.url))},null,8,To)]),_:2},1032,["content"]),x(C,{placement:"top","show-after":300,content:o(a)("common.preview")},{default:k(()=>[l("span",{class:"hover:text-blue iconfont icon-eyes","data-cy":"preview-in-list",onClick:$=>m(s)},null,8,Mo)]),_:2},1032,["content"]),o(_).hasAccess("mediaLibrary","edit")?(d(),F(C,{key:1,placement:"top","show-after":300,content:o(a)("common.edit")},{default:k(()=>[l("span",{class:"hover:text-blue iconfont icon-a-writein","data-cy":"edit-in-list",onClick:$=>o(v)(s,e.provider)},null,8,zo)]),_:2},1032,["content"])):S("",!0),x(C,{placement:"top","show-after":300,content:o(a)("common.download")},{default:k(()=>[l("span",{class:"hover:text-blue iconfont icon-xiazai-wenjianxiazai-05 font-bold","data-cy":"download-in-list",onClick:$=>c(s)},null,8,Po)]),_:2},1032,["content"])])])):(d(),y("td",jo,[l("div",Ao,[e.hideOpenFolder?S("",!0):(d(),F(C,{key:0,placement:"top","show-after":300,content:o(a)("common.openFileLocation",s)},{default:k(()=>[l("span",{class:"iconfont icon-folder cursor-pointer hover:text-blue","data-cy":"open-folder",onClick:H($=>z(s),["stop"])},null,8,No)]),_:2},1032,["content"])),x(C,{placement:"top","show-after":300,content:o(a)("common.copyUrl")},{default:k(()=>[l("span",{class:"iconfont icon-copy hover:text-blue",onClick:$=>o(oe)(o(N)(o(_).site.baseUrl,s.url))},null,8,Oo)]),_:2},1032,["content"]),x(C,{placement:"top","show-after":300,content:o(a)("common.preview")},{default:k(()=>[l("span",{class:"iconfont icon-eyes hover:text-blue",onClick:$=>m(s)},null,8,Bo)]),_:2},1032,["content"]),x(C,{placement:"top","show-after":300,content:o(a)("common.download")},{default:k(()=>[l("span",{class:"iconfont icon-xiazai-wenjianxiazai-05 hover:text-blue font-bold",onClick:$=>c(s)},null,8,Lo)]),_:2},1032,["content"])])]))],2)}),128)),o(R)?(d(),y("tr",Do,[l("td",{colspan:o(h)?6:7},[l("div",Ko,[l("span",Ho,b(o(a)("common.noData")),1)])],8,qo)])):S("",!0)])]),r.value?(d(),F(pe,{key:0,"url-list":u.value,"hide-on-click-modal":"",onClose:w[0]||(w[0]=s=>r.value=!1)},null,8,["url-list"])):S("",!0)],64)}}});var In=tt(Jo,[["__scopeId","data-v-743220c4"]]);const Wo={key:0,class:"flex justify-center"},Yo={key:1},Zo={key:1},Rn=B({props:{pagination:null,infinite:{type:Boolean}},emits:["current-change"],setup(e,{emit:n}){const t=e,{t:r}=L();function u(){var p;_(((p=t.pagination.currentPage)!=null?p:0)+1)}function _(p){n("current-change",p)}return(p,m)=>{var a,f;const c=st,i=at;return e.infinite?(d(),y("div",Wo,[((a=e.pagination.totalCount)!=null?a:0)>((f=e.pagination.pageSize)!=null?f:0)?(d(),F(c,{key:0,onClick:u},{default:k(()=>[Ve(b(o(r)("common.loadMore")),1)]),_:1})):(d(),y("div",Yo,b(o(r)("common.noMoreData")),1))])):e.pagination.totalCount?(d(),y("div",Zo,[x(i,{currentPage:e.pagination.currentPage,"onUpdate:currentPage":m[0]||(m[0]=v=>e.pagination.currentPage=v),"page-size":e.pagination.pageSize,layout:"prev, pager, next",total:e.pagination.totalCount,"hide-on-single-page":"",onCurrentChange:_},null,8,["currentPage","page-size","total"])])):S("",!0)}}}),Tn=B({props:{providers:null,provider:null,searchKey:null},emits:["update:provider","update:search-key"],setup(e,{emit:n}){var m;const t=e,{t:r}=L(),u=O((m=t.searchKey)!=null?m:"");function _(){var c;n("update:search-key",(c=u.value)!=null?c:"")}function p(c){n("update:provider",c)}return le(()=>t.searchKey,c=>{u.value=c}),(c,i)=>{const a=rt,f=ct,v=it;return d(),y(M,null,[e.providers.length>1?(d(),F(f,{key:0,modelValue:e.provider,"onUpdate:modelValue":i[0]||(i[0]=h=>se(provider)?provider.value=h:null),class:"right-24 w-130px","default-first-option":"",onChange:p},{default:k(()=>[(d(!0),y(M,null,K(e.providers,h=>(d(),F(a,{key:h,value:h,label:o(r)(`storage.${h}`)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):S("",!0),x(v,{modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=h=>u.value=h),placeholder:o(r)("common.enterKeywords"),class:"w-238px","data-cy":"search",onSearch:_},null,8,["modelValue","placeholder"])],64)}}});export{In as M,Tn as _,Rn as a,Vn as b,Un as c,ft as d,Dt as e,kt as h,ne as s,En as t,qt as u};
