var b=(e,p,a)=>new Promise((h,d)=>{var l=o=>{try{t(a.next(o))}catch(m){d(m)}},c=o=>{try{t(a.throw(o))}catch(m){d(m)}},t=o=>o.done?h(o.value):Promise.resolve(o.value).then(l,c);t((a=a.apply(e,p)).next())});import{_ as z}from"./layout.7d98e9c1.js";import{g as B}from"./i18n.48bd28ac.js";import{d as k,E as A}from"./main.ea42d807.js";import{a as x}from"./replace-all.7cf5f327.js";import{d as H,o as n,a as f,f as u,t as _,u as v,F as E,b6 as C,j as w,w as y,aH as F,k as P,c as Q,g as $,b7 as G,b as T,e as J,x as K}from"./url.2e6a77c4.js";import{M as W}from"./userWorker.b3a6730b.js";import{i as V}from"./style.19d0c187.js";import{c as X}from"./index.0d2684bf.js";import{E as Y}from"./index.8ef89ff6.js";import{E as Z}from"./index.2bc50276.js";function ee(e){return{onlineSearch:l=>k.get(x(`online-${e}/SearchOnline`),l),getSearchProviders:()=>k.get(x(`online-${e}/Providers`)),download:(l,c)=>k.post(x(`online-${e}/Download`),{file:c},{path:l},{hiddenLoading:!0,hiddenError:!0}),tops:()=>k.get(x(`online-${e}/TopPackages`))}}const te={class:"py-16 px-24"},oe={key:0},se={class:"text-999 py-8"},ne={class:"flex gap-4 flex-wrap"},ae={key:1},le={class:"text-999 py-8 mt-8"},ie={class:"flex gap-4 flex-wrap"},re=H({props:{top:null},emits:["selected"],setup(e){const{t:p}=B();return(a,h)=>{var l,c;const d=X;return n(),f("div",te,[(l=e.top)!=null&&l.topRecommends?(n(),f("div",oe,[u("div",se,_(v(p)("common.recommends")),1),u("div",ne,[(n(!0),f(E,null,C(e.top.topRecommends,t=>(n(),w(d,{key:t.id,title:t.description,class:"cursor-pointer",round:"",onClick:o=>a.$emit("selected",t.title)},{default:y(()=>[F(_(t.title),1)]),_:2},1032,["title","onClick"]))),128))])])):P("",!0),(c=e.top)!=null&&c.topDownloads?(n(),f("div",ae,[u("div",le,_(v(p)("common.mostDownloads")),1),u("div",ie,[(n(!0),f(E,null,C(e.top.topDownloads,t=>(n(),w(d,{key:t.id,title:t.description,class:"cursor-pointer",round:"",onClick:o=>a.$emit("selected",t.title)},{default:y(()=>[F(_(t.title),1)]),_:2},1032,["title","onClick"]))),128))])])):P("",!0)])}}}),de=["title"],ce={class:"flex-1 text-l font-bold ellipsis"},ue=["data-cy","innerHTML"],pe=["data-cy","innerHTML"],Se=H({props:{module:null},emits:["reload"],setup(e,{expose:p,emit:a}){const h=e,{getSearchProviders:d,onlineSearch:l,download:c,tops:t}=Q(()=>ee(h.module)).value,o=$(!1),{t:m}=B(),D=$(),S=$(),L=$([]),N=()=>b(this,null,function*(){L.value=yield d()});function R(s){return b(this,null,function*(){return yield l(s)})}function I(s){var i;s.loading=!0,c((i=K("folder"))!=null?i:"/",s).then(()=>{s.installed=!0,a("reload")}).catch(()=>{s.installed=!1,A.error(m("common.installationFailed"))}).finally(()=>{W(),s.loading=!1})}N();function O(){var s;o.value=!0,S.value=null,(s=D.value)==null||s.reset(),h.module=="module"&&t().then(i=>{S.value=i})}return p({show:O}),(s,i)=>{const U=Z,j=Y,q=G("hasPermission");return n(),w(z,{ref_key:"searchDialogRef",ref:D,modelValue:o.value,"onUpdate:modelValue":i[1]||(i[1]=g=>o.value=g),"fetch-data":R,providers:L.value},{placeholder:y(()=>[T(re,{top:S.value,onSelected:i[0]||(i[0]=g=>D.value.search(g))},null,8,["top"])]),default:y(({list:g,keyword:M})=>[(n(!0),f(E,null,C(g,r=>(n(),f("div",{key:r.id,class:"hover:bg-[#EFF6FF] dark:hover:bg-666 px-32"},[u("div",{class:"flex items-center pt-12 pb-4",title:r.name+`
`+r.description},[u("div",ce,[u("p",{class:"ellipsis h-auto","data-cy":`${e.module}-name`,innerHTML:v(V)(r.name,M)},null,8,ue),u("p",{class:"font-light text-m text-999 p-4 ellipsis","data-cy":`${e.module}-description`,innerHTML:v(V)(r.description,M)},null,8,pe)]),J((n(),w(U,{type:"primary",size:"small",round:"","data-cy":"install",loading:r.loading,disabled:r.loading||r.installed,onClick:me=>I(r)},{default:y(()=>[F(_(r.installed?v(m)("common.hasInstall"):v(m)("common.install")),1)]),_:2},1032,["loading","disabled","onClick"])),[[q,{feature:e.module,action:"edit"}]])],8,de),T(j,{class:"m-0"})]))),128))]),_:1},8,["modelValue","providers"])}}});export{Se as _};
