var he=Object.defineProperty,xe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var te=(p,s,e)=>s in p?he(p,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[s]=e,ae=(p,s)=>{for(var e in s||(s={}))ke.call(s,e)&&te(p,e,s[e]);if(oe)for(var e of oe(s))we.call(s,e)&&te(p,e,s[e]);return p},ne=(p,s)=>xe(p,ge(s));var y=(p,s,e)=>new Promise((o,l)=>{var i=d=>{try{r(e.next(d))}catch(t){l(t)}},c=d=>{try{r(e.throw(d))}catch(t){l(t)}},r=d=>d.done?o(d.value):Promise.resolve(d.value).then(i,c);r((e=e.apply(p,s)).next())});import{_ as Te,a as $e}from"./kmail-button.6d1c1156.js";import{f as Me,l as Ce,b as Se}from"./main.9fdfea92.js";import{C as Ee}from"./replace-all.56d2c1f7.js";import{k as Ie,l as ie,r as je,m as Be,n as Ae,g as Fe}from"./mail-module.731ae262.js";import{d as Ve,w as L,g as z,o as Le,v as re}from"./i18n.a87944a4.js";import{g as w,E as De,d as R,N as Re,a4 as Ue,h as ce,aX as Ne,i as X,b8 as We,o as f,a as M,f as v,t as K,r as Y,e as J,j as F,k as V,b as g,n as U,m as Z,c as de,u as _,ce as Q,x as pe,cg as se,w as j,F as N,b7 as O,aI as Oe,L as le,l as qe,ay as ze,cj as Ke}from"./url.4cb47a7a.js";import{_ as He}from"./alert.d2815716.js";import{b as Pe,s as G}from"./confirm.b60b5d2f.js";import{a as Xe,r as Ye,s as Ge}from"./validate.bb56f9e3.js";import{E as q}from"./windi.6360286d.js";import{_ as Qe}from"./index.f0d5f031.js";import{_ as Je,ab as Ze,ac as eo,ad as oo}from"./dev-mode.acf56c3e.js";import{u as to}from"./use-save-tip.e3dc783a.js";import{n as ao}from"./guid.c1a40312.js";import{U as no}from"./editor.main.d2800f63.js";import{c as so}from"./use-copy-text.ec245a13.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import{E as me}from"./index.fd96ea36.js";import{E as lo}from"./index.178b9e08.js";import{E as io,a as ro}from"./index.9fd79879.js";import{E as co}from"./index.c003dfa1.js";import{u as po}from"./use-shortcuts.ff4b1f52.js";import{S as uo}from"./sortable.esm.a99254e8.js";import{_ as mo}from"./icon-button.74ccc970.js";import{E as fo,a as vo,b as _o}from"./index.c86a187b.js";import{_ as bo}from"./site-button.47eb531f.js";import{E as yo}from"./index.1f664aab.js";import"./light-switch.51a4a594.js";import"./dark.9459c47b.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.1fd72ea8.js";import"./avatar.f8531598.js";import"./logo-transparent.1566007e.js";import"./index.d24a40b9.js";import"./email.3c5ebb02.js";import"./index.d2657986.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseIsEqual.dc9e64c4.js";import"./index.f2c1b903.js";import"./index.361e2245.js";import"./index.7b8c5aef.js";import"./index.c10802d9.js";import"./error.7e8331f1.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./validator.b5df2420.js";import"./index.4d568055.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.abe211fa.js";import"./userWorker.b3a6730b.js";import"./config.1e73f9c3.js";import"./page.881ec888.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./index.6918f0a5.js";import"./event.776e7e11.js";import"./index.f15f695e.js";import"./index.7c862087.js";import"./index.d96452a6.js";import"./isEqual.4cab74e3.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./vuedraggable.umd.af323a53.js";import"./index.f154d010.js";import"./index.42922617.js";import"./index.b9a74c44.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./index.0e5d639d.js";import"./cloneDeep.c5011aa2.js";import"./_baseClone.b8903935.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";import"./refs.3132cbdb.js";import"./index.4f90a917.js";import"./dropdown.86d3a7fb.js";const ho=Ve.global.t,D=Me("mailModuleEditorStore",()=>{const p=w([]),s=w([]),e=w([]),o=w();let l;Ie().then(n=>p.value=n);const i=n=>{n.panelInstance=new Ee;const a=e.value.find(x=>x.id===n.id);a?o.value=a:(n.panel=De(n.panel),e.value.push(n),o.value=n)},c=n=>{const a=e.value.find(h=>h.id===n);if(!a)return;const x=e.value.findIndex(h=>h.id===a.id);a===o.value&&(o.value=e.value[x===0?1:x-1]),e.value.splice(x,1)},r=n=>{for(const a of n)c(a)};function d(){return y(this,null,function*(){const n=yield Ae(l);s.value=n.map(a=>ne(ae({},a),{id:`${l}_${a.objectType}_${a.fullName}`}))})}const t=n=>y(void 0,null,function*(){l=n,s.value=[],e.value=[],o.value=void 0,yield d()});function b(n,a){return y(this,null,function*(){yield ie(a.name,l,n," ",ho("common.createSuccess")),yield d()})}return{tabs:e,activeTab:o,addTab:i,deleteTab:c,deleteTabs:r,types:p,files:s,initialize:t,createModuleFile:b,deleteModuleFile:(n,a)=>y(void 0,null,function*(){yield je(a,l,n),d()}),updateMailModuleModule:(n,a,x)=>y(void 0,null,function*(){yield Be(a,l,n,x),d(),Ce()})}});const xo={class:"group-collapse"},go={class:"flex-1","data-cy":"folder"},ko={class:"transition-all opacity-0 flex items-center space-x-8"},wo=R({props:{title:null,add:{type:Boolean},expandDefault:{type:Boolean},permission:null},emits:["onAdd"],setup(p){const s=p,e=Re(),o=w(s.expandDefault||!1),l=w(),i=w();let c;const r=()=>y(this,null,function*(){var t;const d=i.value?`${(t=i.value)==null?void 0:t.scrollHeight}px`:void 0;d!==l.value&&(l.value=d,o.value=!0)});return Ue(r),ce(()=>{c=new MutationObserver(r),c.observe(i.value,{childList:!0,subtree:!0})}),Ne(()=>{c==null||c.disconnect()}),X(()=>e.query.activity,()=>{r()}),(d,t)=>{const b=q,T=We("hasPermission");return f(),M("div",xo,[v("div",{class:"h-26px flex items-center px-12 text-s bg-gray/60 dark:bg-[#333] dark:text-fff/86 space-x-8 not-last:border-b not-last:border-solid not-last:border-gray/50 not-last:dark:border-opacity-20 cursor-pointer",onClick:t[3]||(t[3]=L(m=>o.value=!o.value,["stop"]))},[v("span",go,K(p.title),1),v("div",{class:"flex items-center space-x-8 collapse-bar",onClick:t[2]||(t[2]=L(()=>{},["stop"]))},[v("div",ko,[Y(d.$slots,"bar"),p.add?J((f(),F(b,{key:0,class:"iconfont icon-a-addto hover:text-blue","data-cy":"add",onClick:t[0]||(t[0]=m=>d.$emit("onAdd"))},null,512)),[[T,{feature:p.permission,action:"edit",effect:"hiddenIcon"}]]):V("",!0)]),g(b,{class:U(["iconfont icon-pull-down origin-center transform transition duration-200 origin-center",o.value?"rotate-180 ":"rotate-0"]),"data-cy":"expand",onClick:t[1]||(t[1]=m=>o.value=!o.value)},null,8,["class"])])]),v("div",{style:Z({height:o.value?l.value:"0px"}),class:"overflow-hidden transition-all duration-200"},[v("div",{ref_key:"body",ref:i},[Y(d.$slots,"default")],512)],4)])}}}),To=["title"],$o={class:"ml-8px ellipsis flex-1","data-cy":"file-name"},Mo={class:"pl-12 pr-4"},Co=R({props:{id:null,icon:null,title:null,remove:{type:Boolean},permission:null},emits:["remove"],setup(p){const s=p,e=D(),o=de(()=>{var l;return((l=e.activeTab)==null?void 0:l.id)===s.id});return(l,i)=>{const c=q;return f(),M("div",null,[v("div",{class:U(["group px-12 cursor-pointer h-26px flex items-center text-s space-x-4 group hover:bg-blue/30",_(o)?"bg-blue/20 dark:text-fff/86":"dark:text-fff/60"]),title:p.title},[g(c,{class:U(["iconfont",p.icon||"icon-code3"])},null,8,["class"]),v("div",$o,K(p.title),1),v("div",{class:U(["transition-all ease-in-out opacity-0 group-hover:opacity-100 space-x-8",_(o)?"opacity-100":""]),onClick:i[1]||(i[1]=L(()=>{},["stop"]))},[Y(l.$slots,"default"),p.remove?(f(),F(c,{key:0,class:"iconfont icon-delete hover:text-orange","data-cy":"delete",onClick:i[0]||(i[0]=r=>l.$emit("remove"))})):V("",!0)],2)],10,To),v("div",Mo,[Y(l.$slots,"collapse")])])}}}),So={class:"h-full"},Eo=R({props:{id:null,params:null},emits:["changed","setAction"],setup(p,{expose:s,emit:e}){const o=p,{t:l}=z(),i=w(""),c=to(),r=()=>y(this,null,function*(){i.value=yield Fe(o.params.file.objectType,o.params.moduleId,o.params.file.name),c.init(i.value)}),d=()=>y(this,null,function*(){yield ie(o.params.file.objectType,o.params.moduleId,o.params.file.name,i.value?i.value:" ",l("common.saveSuccess")),c.init(i.value),e("changed",!1),e("setAction","save",{visible:!1})}),t=Q(()=>o.params.file.name==="Module.config"),b=Q(()=>t.value?`memory:///mail_module:${o.params.moduleId}/${o.params.file.name}`:ao()),T=Q(()=>o.params.file.objectType==="css"?"css":o.params.file.objectType==="js"?"typescript":o.params.file.objectType==="view"||o.params.file.objectType==="read"||o.params.file.objectType==="compose"||o.params.file.objectType==="backend"?"html":o.params.file.objectType==="api"?"typescript":o.params.file.name==="Module.config"?"json":o.params.file.name==="Dashboard.js"||o.params.file.name==="Event.js"?"typescript":"");return X(()=>i.value,()=>{e("changed",c.changed(i.value)),e("setAction","save",{visible:c.changed(i.value)})},{deep:!0}),r(),s({save:d,load:r}),(m,n)=>(f(),M("div",So,[g(Je,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=a=>i.value=a),"model-uri":_(no).from({scheme:"memory",path:_(b)}),language:_(T),kmail:_(T)=="html"||_(T)=="typescript","k-script":""},null,8,["modelValue","model-uri","language","kmail"])]))}});const Io={class:"h-full bg-fff dark:bg-[#252526] dark:border-none flex border-r border-solid border-line dark:border-[#f00]"},jo={class:"w-200px h-full relative"},Bo={class:"ellipsis h-36px text-black flex items-center pr-12 space-x-12 dark:text-fff/60"},Ao={class:"w-36px h-full flex justify-center items-center hover:text-blue"},Fo={class:"flex-1 truncate h-full leading-9","data-cy":"tab-title"},Vo={key:0,class:"relative group flex items-center"},Lo=["accept","onChange"],Do=["onKeydown"],Ro={class:"w-full flex space-x-4"},Uo=R({setup(p){const{t:s}=z(),e=D(),o=w(!1),l=pe("id"),i=w(!1),c=w(),r=w(),d={name:[Xe(s("common.nameRequiredTips")),Ye(1,50),Ge()]},t=w({name:"",extension:""}),b=w(),T=u=>y(this,null,function*(){b.value=u,t.value.extension=u.defaultExtension,i.value=!0}),m=()=>y(this,null,function*(){yield c.value.validate();let u=t.value.name;yield e.createModuleFile(u,b.value);const k=e.files.find(C=>{var $;return C.name==t.value.name+C.extension&&C.objectType==(($=b.value)==null?void 0:$.name)});k&&h(k),i.value=!1}),n=(u,k,C)=>y(this,null,function*(){yield Pe(),yield e.deleteModuleFile(u,k),e.deleteTab(C)}),a=u=>{u.isBinary?x(u):h(u)},x=u=>{e.addTab({id:u.id,name:u.name,panel:u.objectType==="img"?eo:oo,icon:"icon-classification",params:{url:u.previewUrl,type:u.objectType,moduleId:l}})},h=u=>{const k=e.types.find($=>$.name==u.objectType),C={id:u.id,name:u.name,panel:Eo,icon:"icon-classification",params:{type:k,file:u,moduleId:l},actions:[{name:"save",visible:!1,icon:"icon-preservation",display:s("common.save"),invoke:()=>y(this,null,function*(){var A,B;const $=yield(B=(A=D().activeTab)==null?void 0:A.panelInstance)==null?void 0:B.promise;!$||$.save()})},{name:"refresh",display:s("common.refresh"),visible:!0,icon:"icon-Refresh",invoke:()=>y(this,null,function*(){var A,B;const $=yield(B=(A=D().activeTab)==null?void 0:A.panelInstance)==null?void 0:B.promise;!$||$.load()})}]};u.objectType!=="root"&&C.actions.push({name:"open",display:s("common.preview"),visible:!0,icon:"icon-share",invoke:()=>y(this,null,function*(){se(u.previewUrl)})}),e.addTab(C)};function E(u,k){var C=u.target.files[0];if(!!C){var $=new FileReader;$.readAsDataURL(C),$.onload=function(A){var B=A.target.result;e.updateMailModuleModule(C.name,k.name,B.split("base64,")[1])}}}function H(){t.value={name:"",extension:""}}const fe=de(()=>{var k,C,$,A;var u=[{name:s("common.copyTitle"),invoke:B=>y(this,null,function*(){so(B.name)})}];return((C=(k=r.value)==null?void 0:k.payload)==null?void 0:C.previewUrl)&&((A=($=r.value)==null?void 0:$.payload)==null?void 0:A.objectType)!="root"&&u.push({name:s("common.preview"),invoke:B=>y(this,null,function*(){se(B.previewUrl)})}),u});return(u,k)=>{var ee;const C=q,$=q,A=me,B=He,ve=lo,_e=io,be=ro,ye=co;return f(),M("div",Io,[v("div",jo,[v("div",Bo,[v("div",Ao,[g(C,{class:"iconfont icon-fanhui1 cursor-pointer",onClick:k[0]||(k[0]=I=>u.$router.goBackOrTo({name:"mail-extensions"}))})]),v("div",Fo,K(_(s)("common.mailModule")),1)]),g(A,{class:"flex-1",style:Z({outline:o.value?"1px solid rgba(34, 150, 243,.5)":""})},{default:j(()=>[v("div",null,[(f(!0),M(N,null,O(_(e).types,I=>(f(),F(wo,{key:I.name,title:I.displayName,add:I.isText&&I.name!=="root","expand-default":!0,onOnAdd:S=>T(I)},{bar:j(()=>[I.isBinary?(f(),M("div",Vo,[g($,{class:"iconfont icon-a-Cloudupload group-hover:text-blue","data-cy":"import"}),v("input",{class:"cursor-pointer absolute inset-0 !opacity-0",type:"file",accept:I.name=="img"?"image/*":"","data-cy":"upload",onChange:S=>E(S,I)},null,40,Lo)])):V("",!0)]),default:j(()=>[(f(!0),M(N,null,O(_(e).files.filter(S=>S.objectType===I.name),S=>(f(),F(Co,{id:S.id,key:S.name,title:S.name,remove:S.objectType!=="root",onRemove:W=>n(S.name,S.objectType,S.id),onClick:W=>a(S),onContextmenu:L(W=>{var P;return(P=r.value)==null?void 0:P.openMenu(W,S)},["prevent","stop"])},null,8,["id","title","remove","onRemove","onClick","onContextmenu"]))),128))]),_:2},1032,["title","add","onOnAdd"]))),128))])]),_:1},8,["style"])]),g(ye,{modelValue:i.value,"onUpdate:modelValue":k[4]||(k[4]=I=>i.value=I),width:"600px","close-on-click-modal":!1,title:_(s)("common.newModuleType",{type:(ee=b.value)==null?void 0:ee.displayName}),"destroy-on-close":"",onClose:H},{footer:j(()=>[g(Qe,{onConfirm:m,onCancel:k[3]||(k[3]=I=>i.value=!1)})]),default:j(()=>{var I,S,W;return[((I=b.value)==null?void 0:I.name)==="read"||((S=b.value)==null?void 0:S.name)==="compose"||((W=b.value)==null?void 0:W.name)==="backend"?(f(),F(B,{key:0,class:"-mx-32 -mt-24 mb-12",title:_(s)("common.moduleViewEntrance"),content:_(s)("common.moduleViewEntranceTips")},null,8,["title","content"])):V("",!0),v("div",{onKeydown:Le(m,["enter"])},[t.value?(f(),F(be,{key:0,ref_key:"form",ref:c,"label-position":"top",model:t.value,rules:d,onSubmit:k[2]||(k[2]=L(()=>{},["prevent"]))},{default:j(()=>[g(_e,{label:_(s)("common.name"),prop:"name"},{default:j(()=>[v("div",Ro,[g(ve,{modelValue:t.value.name,"onUpdate:modelValue":k[1]||(k[1]=P=>t.value.name=P),class:"flex-1","data-cy":"module-file-name"},null,8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model"])):V("",!0)],40,Do)]}),_:1},8,["modelValue","title"]),g(Ze,{ref_key:"contextMenu",ref:r,actions:_(fe)},null,8,["actions"])])}}});var No=ue(Uo,[["__scopeId","data-v-407ee50a"]]);const Wo=R({setup(p,{expose:s}){const{t:e}=z(),o=D(),l=(m,n)=>y(this,null,function*(){m.some(x=>x.changed)&&(yield G(e("common.unsavedChangesLeaveTips"))),o.deleteTabs(n)}),i=w(),c=w(!1),r=w(0),d=w(0),t=w(),b=(m,n)=>{c.value=!0,d.value=m.clientY,r.value=m.clientX,i.value=n,setTimeout(()=>{t.value.click()},0)},T=[{name:e("common.close"),invoke:m=>y(this,null,function*(){m.changed&&(yield G(e("common.unsavedChangesLeaveTips"))),o.deleteTab(m.id)})},{name:e("common.closeToRight"),invoke:m=>y(this,null,function*(){const n=o.tabs.findIndex(h=>h.id===m.id),a=o.tabs.filter((h,E)=>E>n),x=a.map(h=>h.id);l(a,x)})},{name:e("common.closeOthers"),invoke:m=>y(this,null,function*(){const n=o.tabs.map(h=>h.id),a=o.tabs.filter(h=>h.id!=m.id),x=n.filter(h=>h!=m.id);l(a,x)})},{name:e("common.closeSaved"),invoke:()=>y(this,null,function*(){const n=o.tabs.filter(a=>!a.changed).map(a=>a.id);o.deleteTabs(n)})},{name:e("common.closeAll"),invoke:()=>y(this,null,function*(){const m=o.tabs.map(n=>n.id);l(o.tabs,m)})}];return s({openMenu:b}),(m,n)=>{const a=fo,x=vo,h=_o;return c.value?(f(),M("div",{key:0,style:Z({top:d.value-2+"px",left:r.value-32+"px"}),class:"fixed"},[g(h,{trigger:"click",onCommand:n[1]||(n[1]=E=>E.invoke(i.value)),onVisibleChange:n[2]||(n[2]=E=>c.value=E)},{dropdown:j(()=>[g(x,null,{default:j(()=>[(f(),M(N,null,O(T,E=>g(a,{key:E.name,command:E},{default:j(()=>[Oe(K(E.name),1)]),_:2},1032,["command"])),64))]),_:1})]),default:j(()=>[v("div",{ref_key:"trigger",ref:t,class:"w-64 h-8",onContextmenu:n[0]||(n[0]=L(()=>{},["stop","prevent"]))},null,544)]),_:1})],4)):V("",!0)}}});const Oo={class:"h-26px bg-gray/60 dark:bg-[#252526] text-s flex"},qo=["onWheel"],zo=["title","onClick","onContextmenu"],Ko={class:"w-4 h-4 rounded-full bg-444 dark:bg-[#fffa] absolute left-4"},Ho={class:"select-none ellipsis","data-cy":"file-name"},Po={key:0,class:"flex items-center p-8 -space-x-4"},Xo=R({setup(p){const{t:s}=z(),e=D(),o=w(),l=w(),i=w();ce(()=>{l.value&&uo.create(l.value,{forceFallback:!0,filter:".icon-close",dragClass:"sortable-drag",delay:100,onChoose:function(){r()},onEnd:function(){r()}})}),X(()=>e.tabs,()=>{le(()=>{o.value&&o.value.update()})},{deep:!0}),X(()=>e.activeTab,()=>{r()});function c(t){var T;const b=(T=o.value)==null?void 0:T.$refs.wrap$;b&&(b.scrollLeft=b.scrollLeft+(t.deltaX+t.deltaY))}function r(){le(()=>{var b,T;const t=(b=l.value)==null?void 0:b.querySelector(".activeTab");if(t&&o.value){const m=o.value.$el.offsetWidth,n=t.offsetLeft,a=t.offsetLeft+t.offsetWidth,x=(T=o.value)==null?void 0:T.$refs.wrap$,h=x.scrollLeft;n>=h&&a<=m+h+1||(x.scrollLeft=a-m+50)}})}const d=t=>y(this,null,function*(){t.changed&&(yield G(s("common.unsavedChangesLeaveTips"))),e.deleteTab(t.id)});return(t,b)=>{var n;const T=q,m=me;return f(),M("div",Oo,[v("div",{class:"whitespace-nowrap flex-1 overflow-hidden",onWheel:L(c,["prevent"])},[g(m,{ref_key:"scrollbar",ref:o},{default:j(()=>[v("div",{ref_key:"sortableWrap",ref:l,class:"h-26px"},[(f(!0),M(N,null,O(_(e).tabs,a=>{var x,h;return f(),M("div",{key:a.id,title:a.name,class:U(["group inline-flex h-full cursor-default items-center border-r border-solid border-line dark:border-transparent px-8 space-x-4 min-w-64 overflow-hidden max-w-280px relative",((x=_(e).activeTab)==null?void 0:x.id)===a.id?"bg-fff activeTab dark:bg-[#1e1e1e] dark:text-fff/86":"dark:bg-[#2d2d2d] dark:text-fff/60 hover:bg-black/10"]),"data-cy":"opened-file",onClick:E=>_(e).activeTab=a,onContextmenu:L(E=>{var H;return(H=i.value)==null?void 0:H.openMenu(E,a)},["prevent","stop"])},[J(v("div",Ko,null,512),[[re,a.changed]]),g(T,{class:U(["iconfont",a.icon||"icon-code"])},null,8,["class"]),v("span",Ho,K(a.name),1),g(T,{class:U(["iconfont icon-close cursor-pointer hover:text-blue group-hover:opacity-100",((h=_(e).activeTab)==null?void 0:h.id)===a.id?"opacity-100":"opacity-0"]),"data-cy":"close",onClick:L(E=>d(a),["stop"])},null,8,["class","onClick"])],42,zo)}),128))],512)]),_:1},512)],40,qo),(n=_(e).activeTab)!=null&&n.actions?(f(),M("div",Po,[(f(!0),M(N,null,O(_(e).activeTab.actions,a=>(f(),M(N,{key:a.name},[a.visible?(f(),F(mo,{key:0,tip:a.display,icon:a.icon,class:"!p-0 !text-m dark:text-fff/60",onClick:x=>a.invoke()},null,8,["tip","icon","onClick"])):V("",!0)],64))),128))])):V("",!0),g(Wo,{ref_key:"tabContext",ref:i},null,512)])}}});var Yo=ue(Xo,[["__scopeId","data-v-0769e2d1"]]);const Go={class:"h-full flex-1 relative overflow-hidden"},Qo={key:0,class:"absolute inset-0 flex items-center justify-center text-200px text-black/5 dark:bg-[#1e1e1e] dark:text-[#424242]"},Jo={class:"h-full w-full dark:bg-[#1e1e1e]"},Zo=R({setup(p){const s=D(),e=()=>y(this,null,function*(){var i;const l=yield(i=s.activeTab)==null?void 0:i.panelInstance.promise;l&&l.save&&l.save()}),o=(l,i,c)=>{var d;const r=(d=l.actions)==null?void 0:d.find(t=>t.name===i);if(r)for(const t in c)r[t]=c[t]};return po("save",e),(l,i)=>{const c=q;return f(),M("div",Go,[_(s).tabs.length?V("",!0):(f(),M("div",Qo,[g(c,{class:"iconfont icon-code3"})])),_(s).tabs.length?(f(),F(Yo,{key:1})):V("",!0),v("div",Jo,[(f(!0),M(N,null,O(_(s).tabs,r=>{var d;return f(),F(ze,{key:r.id},[J((f(),F(qe(r.panel),{id:r.id,ref_for:!0,ref:t=>r.panelInstance.resolve(t),name:r.name,params:r.params,onChanged:t=>r.changed=t,onSetAction:(t,b)=>o(r,t,b)},null,8,["id","name","params","onChanged","onSetAction"])),[[re,((d=_(s).activeTab)==null?void 0:d.id)===r.id]])],1024)}),128))])])}}}),et={class:"h-full flex flex-col"},ot={class:"flex-1 overflow-hidden relative"},tt={class:"h-full flex min-h-600px"},Ya=R({setup(p){const s=Se(),{t:e}=z(),o=D();return o.initialize(pe("id")),Ke((l,i,c)=>y(this,null,function*(){l.name==="login"?c():o.tabs.find(r=>r.changed)?yield G(e("common.unsavedChangesLeaveTips")).then(()=>{c()}).catch(()=>{c(!1)}):c()})),(l,i)=>{const c=yo;return f(),F(c,{locale:_(s).locale},{default:j(()=>[v("div",et,[g(_($e),{class:"pl-40px"},{left:j(()=>[g(bo),g(Te)]),right:j(()=>[]),_:1}),v("div",ot,[v("div",tt,[g(No),g(Zo)])])])]),_:1},8,["locale"])}}});export{Ya as default};
