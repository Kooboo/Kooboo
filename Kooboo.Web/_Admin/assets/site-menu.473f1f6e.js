var G=(i,s,e)=>new Promise((o,u)=>{var _=m=>{try{a(e.next(m))}catch(v){u(v)}},n=m=>{try{a(e.throw(m))}catch(v){u(v)}},a=m=>m.done?o(m.value):Promise.resolve(m.value).then(_,n);a((e=e.apply(i,s)).next())});import{_ as Z}from"./preload-helper.13a99eb0.js";import{_ as ee,a as te}from"./kmail-button.eb4d8791.js";import{g as z,w as H}from"./i18n.0d8cb6d1.js";import{d as D,M as R,c as N,N as V,u as r,o as l,j as b,w as f,b as p,n as I,f as x,t as C,a as k,b6 as q,F as L,aH as Q,k as $,cd as ie,g as O,h as oe,J as ne,i as se}from"./url.8f5ec20c.js";import{u as B,s as re,a as ae,b as me,c as le,E as ue,r as ce}from"./main.d919dab0.js";import{E as J}from"./windi.dcba9a95.js";import{E as de,a as pe,b as fe}from"./index.de5f3c8c.js";import{u as ve}from"./replace-all.e310d26c.js";import{n as _e}from"./guid.c1a40312.js";import{c as U}from"./cloneDeep.007117a9.js";import{_ as xe}from"./plugin-vue_export-helper.21dcd24c.js";import{E as K}from"./index.3d638063.js";import{E as be}from"./index.ec3d8ab1.js";import{E as he,a as ye}from"./index.77fd2161.js";import{_ as Me,a as ke,D as ge}from"./code-conflict.48de9f7d.js";import{E as Se}from"./index.0e7c2180.js";import"./light-switch.143f802c.js";import"./dark.4719ae81.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.6943850d.js";import"./index.bc6ab153.js";import"./index.c7806af3.js";import"./index.6e9a6658.js";import"./index.38840738.js";import"./focus-trap.0c15535f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./dropdown.61c74520.js";import"./index.1d64e54f.js";import"./refs.d2253dd4.js";import"./avatar.3578cce6.js";import"./logo-transparent.1566007e.js";import"./index.3e5d2d38.js";import"./email.52d16969.js";import"./index.3688e838.js";import"./index.50c16ae5.js";import"./aria.75ec5909.js";import"./index.a2cc40a6.js";import"./error.7e8331f1.js";import"./_baseClone.24478792.js";import"./_baseIsEqual.f1f57955.js";import"./event.776e7e11.js";import"./index.6756a6f3.js";import"./isEqual.8058d1d5.js";import"./dev-mode.7f653a4a.js";import"./index.8cff0d70.js";import"./classCompletion.a22e38a6.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./vuedraggable.umd.e0421fdf.js";import"./config.69138790.js";import"./page.be880a87.js";import"./validate.b9ea657d.js";import"./index.f2618a8f.js";import"./index.ddf78e53.js";import"./index.4ccd5d27.js";import"./style.67f0cdc4.js";import"./toNumber.6efebd6a.js";import"./index.ab7ae43a.js";import"./index.97ced36a.js";import"./index.1e651ffe.js";import"./scroll.9a94de30.js";import"./validator.11bc55c7.js";import"./use-copy-text.7801df9a.js";import"./index.66bd0e61.js";import"./toggleComment.5b29ca87.js";import"./use-save-tip.a46b00fb.js";import"./confirm.f89fa710.js";import"./index.d1d474c4.js";import"./index.d29acda2.js";import"./index.230671a2.js";import"./index.9a7a049b.js";import"./debounce.730e1961.js";import"./index.6d134d76.js";import"./index.6ac167de.js";import"./icon-button.a2edb33f.js";import"./index.36905e5d.js";import"./index.bdc63b78.js";import"./index.3be79fd5.js";import"./index.f7975397.js";import"./index.337c36f2.js";import"./index.e68a3b8d.js";import"./alert.8fe5500a.js";import"./index.3b3f2bf9.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.92552fc5.js";/* empty css                                                          */import"./file.f8555a01.js";import"./use-date.3be35318.js";import"./dayjs.min.8b8ca7e9.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.e88ed30a.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.8fc1c564.js";import"./image-editor.37a79505.js";import"./main.esm.ae650d02.js";import"./index.8d99b8f6.js";import"./index.9b4bce31.js";import"./diff.4edc03df.js";const we=["src"],Ae=D({props:{item:null},setup(i){const s=R(),e=B(),o=N(()=>n=>{if(n.advanced===void 0)return!0;let a=JSON.parse(JSON.stringify(e.site.visibleAdvancedMenus));return a===null?!0:!!a.includes(n.name)}),u=N(()=>n=>!e.site.visibleAdvancedMenus||n.items.some(a=>!a.advanced)?!0:n.items.some(a=>e.site.visibleAdvancedMenus.includes(a.name)));function _(n){return typeof n.queryBuilder=="function"?n.queryBuilder(n,s):{SiteId:s.query.SiteId}}return(n,a)=>{const m=J,v=V("SubMenu",!0),S=de,w=pe,g=V("router-link");return i.item.items.length&&r(u)(i.item)?(l(),b(S,{key:0,index:i.item.id},{title:f(()=>[p(m,{class:I(["iconfont",i.item.icon])},null,8,["class"]),x("span",null,C(i.item.display),1)]),default:f(()=>[(l(!0),k(L,null,q(i.item.items,t=>(l(),b(v,{key:t.id,item:t},null,8,["item"]))),128))]),_:1},8,["index"])):i.item.name?(l(),b(g,{key:1,to:{name:i.item.name.toLowerCase(),query:_(i.item),params:i.item.params}},{default:f(()=>[r(o)(i.item)?(l(),b(w,{key:0,index:i.item.routeMenuName?i.item.name.toLowerCase()+i.item.routeMenuName:i.item.name.toLowerCase()},{default:f(()=>[i.item.routeMenuName&&i.item.icon?(l(),k("img",{key:0,class:"w-18px h-18px mr-8",src:i.item.icon},null,8,we)):(l(),b(m,{key:1,class:I(["iconfont",[i.item.icon,{"!w-18px":!i.item.icon}]])},null,8,["class"])),Q(" "+C(i.item.display),1)]),_:1},8,["index"])):$("",!0)]),_:1},8,["to"])):$("",!0)}}}),Ee={class:"transform scale-75 origin-left"},Ce=["title"],$e={class:"text-999 dark:text-fff/60 text-s transform"},Ne=D({setup(i){const{t:s}=z(),e=ie(),o=R();var u=B();return(_,n)=>{const a=J;return l(),k("div",{class:"flex items-center px-5 pt-16 pb-12 border-b border-solid border-line dark:border-444 cursor-pointer space-x-12","data-cy":"dashboard",onClick:n[0]||(n[0]=m=>r(e).push(r(ve)({name:"dashboard"})))},[p(a,{class:I(["iconfont text-size-28px text-blue",r(o).name==="dashboard"?"icon-home2":"icon-home"])},null,8,["class"]),x("div",Ee,[x("p",{class:"text-2l ellipsis max-w-150px dark:text-fff/86",title:r(u).site.displayName},C(r(u).site.displayName),9,Ce),x("p",$e,C(r(s)("common.currentSite")),1)])])}}}),Ie=B();function j(i){var e,o,u,_,n,a,m,v,S,w,g;const s=[];for(const t of i)if((e=t.meta)!=null&&e.menu){const c={name:(o=t.name)==null?void 0:o.toString(),items:[],display:t.meta.menu.display,id:_e(),permission:(_=(u=t.meta)==null?void 0:u.menu)==null?void 0:_.permission,advanced:(n=t.meta)!=null&&n.advanced?(a=t.meta)==null?void 0:a.advanced:void 0,icon:(v=(m=t.meta)==null?void 0:m.menu)==null?void 0:v.icon,queryBuilder:(w=(S=t.meta)==null?void 0:S.menu)==null?void 0:w.queryBuilder,routeMenuName:(g=t.meta)==null?void 0:g.menu.name};t.children&&c.items.push(...j(t.children)),s.push(c)}else t.children&&s.push(...j(t.children));return s}function W(i){const s=[];for(const e of i){const o=U(e);(!o.permission||Ie.hasAccess(o.permission.feature,o.permission.action))&&(s.push(o),o.items=W(o.items))}return s}const Be={class:"w-202px h-full relative bg-fff z-10 dark:bg-[#252526]"},qe={class:"text-[#303133] dark:text-999"},Le={class:"p-26px pb-16"},De={class:"flex justify-between items-center mb-8 dark:text-999"},Re={class:"text-12px text-666 dark:text-999"},Ve=["data-cy"],Oe=D({setup(i){const s=R(),e=B(),{t:o}=z(),u=O(!1),_=O(),n=N(()=>{var c;const t=j(re);for(const d of e.moduleMenus){let h=t;d.parent&&(h=(c=t.find(A=>A.routeMenuName==d.parent))==null?void 0:c.items),h&&h.push({id:d.id,display:d.name,name:"module menu",routeMenuName:d.id,items:[],icon:d.icon,queryBuilder(){return{url:d.url,SiteId:s.query.SiteId}},params:{module:d.id}})}return t}),a=N(()=>e.isAdmin?n.value:e.permissions?W(n.value):[]),m=N(()=>e.firstActiveMenu?e.firstActiveMenu:s.meta.activeMenu?s.meta.activeMenu:s.name=="module menu"?s.name+s.params.module:s.name),v=t=>{var c,d;if(e.site.visibleAdvancedMenus===null||(c=e.site.visibleAdvancedMenus)!=null&&c.includes(t.name))return!0;if(((d=e.site.visibleAdvancedMenus)==null?void 0:d.length)===0)return!1;if(!t.advanced)return!0},S=t=>{var c,d;if(e.site.visibleAdvancedMenus===null){let h=a.value.filter(y=>y.advanced===!0),A=[];h.forEach(y=>{A=A.concat(y.items)}),e.site.visibleAdvancedMenus=A.filter(y=>y.name!==t&&y.advanced===!0).map(y=>y.name)}else(c=e.site.visibleAdvancedMenus)!=null&&c.includes(t)?e.site.visibleAdvancedMenus=e.site.visibleAdvancedMenus.filter(h=>h!==t):(d=e.site.visibleAdvancedMenus)==null||d.push(t);w()},w=()=>G(this,null,function*(){yield ae(e.site.visibleAdvancedMenus)}),g=t=>{!_.value.contains(t.target)&&u.value&&(u.value=!1)};return oe(()=>{window.addEventListener("click",g)}),ne(()=>{window.removeEventListener("click",g)}),(t,c)=>{const d=fe,h=K,A=J,y=be,X=he,Y=ye;return l(),k("aside",Be,[p(h,{class:"pb-14"},{default:f(()=>[p(Ne),p(d,{"default-active":r(m)},{default:f(()=>[(l(!0),k(L,null,q(r(a),M=>(l(),b(Ae,{key:M.id,item:M},null,8,["item"]))),128))]),_:1},8,["default-active"])]),_:1}),x("div",{class:I(["absolute bottom-0 left-0 right-0 h-[56px] flex items-center px-5 hover:bg-[#d3eafd] dark:hover:bg-[#18222c] cursor-pointer text-444 dark:text-999",u.value?"bg-[#d3eafd]  dark:bg-[#18222c]":""]),"data-cy":"edit-menu",onClick:c[0]||(c[0]=H(M=>u.value=!u.value,["stop"]))},[p(A,{class:"iconfont icon-a-writein3 text-18px text-999 text-opacity-60 mr-8"}),x("span",qe,C(r(o)("common.editMenu")),1)],2),x("div",{ref_key:"editMenuBox",ref:_,class:I(["absolute inset-0 left-210px w-250px h-full bg-fff shadow-s-10",u.value?"block":"hidden"])},[p(h,{class:"dark:bg-[#252526]"},{default:f(()=>[x("div",Le,[x("div",De,[x("h1",null,C(r(o)("common.editMenu")),1),p(A,{class:"iconfont icon-close cursor-pointer hover:text-blue text-14px",title:r(o)("common.close"),onClick:c[1]||(c[1]=H(M=>u.value=!u.value,["stop"]))},null,8,["title"])]),x("span",Re,C(r(o)("common.editMenuTips")),1)]),p(Y,{class:"editMenu pt-8"},{default:f(()=>[(l(!0),k(L,null,q(r(a).filter(M=>M.advanced===!0),M=>(l(),b(X,{key:M.id,title:M.display},{default:f(()=>[(l(!0),k(L,null,q(r(U)(M.items).sort((E,P)=>{var T,F;return Number((T=E.advanced)!=null?T:!1)-Number((F=P.advanced)!=null?F:!1)}),E=>(l(),k("div",{key:E.id,class:"py-8 px-44px flex items-center justify-between dark:text-999","data-cy":E.name},[p(y,{"model-value":v(E),disabled:!E.advanced,onChange:P=>S(E.name)},{default:f(()=>[Q(C(E.display),1)]),_:2},1032,["model-value","disabled","onChange"])],8,Ve))),128))]),_:2},1032,["title"]))),128))]),_:1})]),_:1})],2)])}}});var je=xe(Oe,[["__scopeId","data-v-4859e556"]]);const ze={key:1,class:"h-full flex flex-col bg-[#f3f5f5] dark:bg-[#1e1e1e]"},Je={key:0,class:"flex-1 overflow-hidden relative"},Pe={class:"absolute inset-0 left-202px"},Ri=D({setup(i){const{t:s}=z(),e=R(),o=me(),u=B(),_=le(),n=O(!1),a=m=>{n.value=m};return se(()=>e.query.SiteId,m=>{m&&n.value&&(ue({message:s("common.siteChangingSuccess"),type:"success"}),n.value=!1),ce.addRoute({name:"test",path:"/sites/test",component:()=>Z(()=>import("./module-index.b1dd8db8.js"),["assets/module-index.b1dd8db8.js","assets/url.8f5ec20c.js","assets/windi.dcba9a95.js","assets/windi.5a66692c.css","assets/i18n.0d8cb6d1.js"]),meta:{menu:{display:"aaa",icon:"icon-media1"}}})}),(m,v)=>{const S=V("router-view"),w=K,g=Se;return l(),b(g,{locale:r(o).locale},{default:f(()=>[r(_).show?(l(),b(Me,{key:0})):$("",!0),r(u).site?(l(),k("div",ze,[p(r(te),{class:"pl-40px"},{left:f(()=>[r(o).limitSite?$("",!0):(l(),b(ke,{key:0,onChange:v[0]||(v[0]=t=>a(t))})),p(ge),r(o).limitSite?$("",!0):(l(),b(ee,{key:1}))]),right:f(()=>[]),_:1}),r(o).header?(l(),k("div",Je,[p(je,{class:"absolute inset-0 right-auto"}),x("div",Pe,[p(w,{id:"main-scrollbar",class:"w-full"},{default:f(()=>[(l(),b(S,{key:m.$route.name}))]),_:1})])])):$("",!0)])):$("",!0)]),_:1},8,["locale"])}}});export{Ri as default};
