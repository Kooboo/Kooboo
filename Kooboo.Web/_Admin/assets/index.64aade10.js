var g=(k,i,v)=>new Promise((_,e)=>{var b=u=>{try{f(v.next(u))}catch(n){e(n)}},x=u=>{try{f(v.throw(u))}catch(n){e(n)}},f=u=>u.done?_(u.value):Promise.resolve(u.value).then(b,x);f((v=v.apply(k,i)).next())});import{_ as G}from"./k-table.c13bd7f5.js";import{_ as W}from"./icon-button.0e134c9b.js";import{g as F,w as ee,o as oe}from"./i18n.25caaace.js";import{X as te,Y as ae,Z as B,_ as le,$ as ne,a0 as se}from"./index.878e2bbf.js";import{r as T,a as I,e as re,Q as ie,b as me,c as ue}from"./validate.f3c0b03b.js";import{_ as pe}from"./index.50326354.js";import{u as j}from"./email.c84e7645.js";import{E as ce,a as de}from"./index.960b9732.js";import{E as fe,a as ve}from"./index.94998415.js";import{E as _e}from"./index.f571dfc9.js";import{E as K}from"./windi.a815125a.js";import{E as be}from"./index.158cdd11.js";import{E as ge}from"./index.537a2de2.js";import{E as Se}from"./index.db6dfc3c.js";import{E as D}from"./index.c6488b3c.js";import{E as xe}from"./index.a5d96e5a.js";import{d as z,g as E,c as Ee,o as V,j as w,w as r,b as t,u as a,a as O,b6 as Ve,F as P,f as S,t as C,k as U,h as he,cj as ye,aH as q,n as $}from"./url.8f5ec20c.js";import{b as Ce}from"./confirm.629bcef4.js";import{E as we}from"./index.e9f8834a.js";import{E as ke}from"./index.5388dbc8.js";import{E as Je}from"./index.92411976.js";import"./sortable.esm.a99254e8.js";import"./main.1c3b59e3.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./replace-all.b35629e7.js";import"./index.a9a077b4.js";import"./index.f9c89813.js";import"./isEqual.2e410d13.js";import"./_baseIsEqual.0a4e01e5.js";import"./error.7e8331f1.js";import"./index.2e51d36e.js";import"./index.1e7e06b8.js";import"./event.776e7e11.js";import"./index.5b499f72.js";import"./index.0c2ced08.js";import"./index.adb17f32.js";import"./index.b065185c.js";import"./index.ab12ea9e.js";import"./index.b1b64a44.js";import"./style.1b77b3a2.js";import"./toNumber.6efebd6a.js";import"./index.7247b296.js";import"./scroll.0cf77af8.js";import"./debounce.730e1961.js";import"./index.c93fe8e7.js";import"./validator.9b0d789f.js";import"./_baseClone.885c975f.js";import"./isNil.98bb3b88.js";import"./focus-trap.81e4fb05.js";import"./event.53b2ad83.js";import"./index.e3f90979.js";import"./index.1d16d007.js";import"./refs.d2253dd4.js";import"./logo-transparent.1566007e.js";import"./index.60799c00.js";import"./aria.75ec5909.js";import"./dropdown.fed924b2.js";const Le={class:"mr-8"},Te=z({props:{modelValue:{type:Boolean},currentJob:null},emits:["update:modelValue","reload"],setup(k,{emit:i}){const v=k,{addressList:_}=j(),e=E({id:"",addressId:void 0,name:"",emailAddress:"",host:"",forceSSL:!0,port:993,password:""}),b=E(!1);function x(){b.value=!0}function f(p){e.value.port=p?993:143}function u(p){if(p&&p.includes("@")&&!b.value){const o=p.split("@")[1];o&&(e.value.host=`imap.${o}`)}}const{t:n}=F(),h=E(!0),J=E(),m=Ee(()=>{var p;return{name:[T(1,64),I(n("common.nameRequiredTips"))],addressId:[{required:!0,message:n("common.valueRequiredTips"),trigger:"change"}],emailAddress:[I(n("common.pleaseEnterAddress")),re,ie(64)],password:(p=e.value)!=null&&p.id?[T(1,64)]:[T(1,64),I(n("common.inputPasswordTips"))],host:[T(1,64),I(n("common.valueRequiredTips"))],port:[me(),ue()]}}),d=()=>g(this,null,function*(){yield J.value.validate(),e.value.id?yield te(e.value.id,e.value):yield ae(e.value),i("reload"),h.value=!1});function A(){return g(this,null,function*(){e.value=JSON.parse(JSON.stringify(v.currentJob))})}return A(),(p,o)=>{var N;const M=ce,R=de,c=fe,y=_e,s=K,L=be,H=ge,Q=Se,X=ve,Y=D,Z=xe;return V(),w(Z,{modelValue:h.value,"onUpdate:modelValue":o[9]||(o[9]=l=>h.value=l),width:"500px",title:(N=e.value)!=null&&N.id?a(n)("common.editMigrationJob"):a(n)("common.addMigrationJob"),"close-on-click-modal":!1,onClosed:o[10]||(o[10]=l=>i("update:modelValue",!1))},{footer:r(()=>{var l;return[t(pe,{"confirm-label":(l=e.value)!=null&&l.id?a(n)("common.save"):a(n)("common.add"),onConfirm:d,onCancel:o[8]||(o[8]=Me=>h.value=!1)},null,8,["confirm-label"])]}),default:r(()=>[t(Y,{class:"pr-12 h-50vh"},{default:r(()=>[t(X,{ref_key:"form",ref:J,class:"el-form--label-normal",model:e.value,rules:a(m),"label-position":"top",onSubmit:o[7]||(o[7]=ee(()=>{},["prevent"])),onKeydown:oe(d,["enter"])},{default:r(()=>[t(c,{prop:"addressId",label:a(n)("common.koobooAddress")},{default:r(()=>[t(R,{modelValue:e.value.addressId,"onUpdate:modelValue":o[0]||(o[0]=l=>e.value.addressId=l),class:"w-full",placeholder:a(n)("common.selectAKoobooAddressToStoreMigratedMails")},{default:r(()=>[(V(!0),O(P,null,Ve(a(_),l=>(V(),w(M,{key:l.id,label:l.address,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(c,{prop:"name",label:a(n)("common.jobName")},{default:r(()=>[t(y,{modelValue:e.value.name,"onUpdate:modelValue":o[1]||(o[1]=l=>e.value.name=l)},null,8,["modelValue"])]),_:1},8,["label"]),t(c,{prop:"emailAddress",label:a(n)("common.account")},{default:r(()=>[t(y,{modelValue:e.value.emailAddress,"onUpdate:modelValue":o[2]||(o[2]=l=>e.value.emailAddress=l),onChange:u},null,8,["modelValue"])]),_:1},8,["label"]),t(c,{prop:"password"},{label:r(()=>{var l;return[S("span",Le,C(a(n)("common.password")),1),(l=e.value)!=null&&l.id?(V(),w(L,{key:0,class:"box-item",content:a(n)("common.migrationPasswordTips"),placement:"top"},{default:r(()=>[t(s,{class:"iconfont icon-problem mr-4"})]),_:1},8,["content"])):U("",!0)]}),default:r(()=>[t(y,{modelValue:e.value.password,"onUpdate:modelValue":o[3]||(o[3]=l=>e.value.password=l),type:"password"},null,8,["modelValue"])]),_:1}),t(c,{prop:"host",label:a(n)("common.imapServer")},{default:r(()=>[t(y,{modelValue:e.value.host,"onUpdate:modelValue":o[4]||(o[4]=l=>e.value.host=l),onChange:x},null,8,["modelValue"])]),_:1},8,["label"]),t(c,{prop:"forceSSL",label:"SSL"},{default:r(()=>[t(H,{modelValue:e.value.forceSSL,"onUpdate:modelValue":o[5]||(o[5]=l=>e.value.forceSSL=l),onChange:f},null,8,["modelValue"])]),_:1}),t(c,{prop:"port",label:a(n)("common.port")},{default:r(()=>[t(Q,{modelValue:e.value.port,"onUpdate:modelValue":o[6]||(o[6]=l=>e.value.port=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules","onKeydown"])]),_:1})]),_:1},8,["modelValue","title"])}}}),Ie={class:"p-24"},$e={class:"text-s mb-12 text-666 space-x-4"},Ae={class:"flex justify-between items-center"},jo=z({setup(k){const{t:i}=F(),{loadAddress:v}=j(),_=E(!1),e=E([]);let b;he(()=>g(this,null,function*(){yield v("addresses")})),ye(()=>{clearTimeout(b)});function x(){return g(this,null,function*(){e.value=yield B(),f()})}function f(){clearTimeout(b),b=setTimeout(()=>g(this,null,function*(){e.value=yield B(!0),e.value.some(m=>m.active)&&f()}),1e3)}const u=E(),n=(m,d=!0)=>{d?u.value=m:u.value={id:"",addressId:void 0,name:"",emailAddress:"",host:"",forceSSL:!0,port:993,password:""},!(m!=null&&m.active)&&(_.value=!0)},h=m=>g(this,null,function*(){yield(m.active?le:ne)(m.id),m.active=!m.active,f()}),J=m=>g(this,null,function*(){m.active||(yield Ce(),yield se(m.id),x())});return x(),(m,d)=>{const A=we,p=K,o=ke,M=D,R=Je,c=W,y=G;return V(),O(P,null,[S("div",Ie,[t(A,{round:"",class:"mb-24",onClick:d[0]||(d[0]=s=>n(void 0,!1))},{default:r(()=>[q(C(a(i)("common.addMigrationJob")),1)]),_:1}),S("div",$e,[t(p,{class:"iconfont icon-Tips"}),S("span",null,C(a(i)("common.emailMigrationTips")),1)]),t(y,{data:e.value},{default:r(()=>[t(o,{label:a(i)("common.name"),prop:"name"},null,8,["label"]),t(o,{label:a(i)("common.account"),prop:"emailAddress"},null,8,["label"]),t(o,{label:a(i)("common.imapServer"),prop:"host"},null,8,["label"]),t(o,{label:"SSL",prop:"forceSSL",align:"center"},{default:r(({row:s})=>[S("span",{class:$(s.forceSSL?"text-green":"text-orange")},C(s.forceSSL?a(i)("common.yes"):a(i)("common.no")),3)]),_:1}),t(o,{label:a(i)("common.port"),prop:"port",width:"60",align:"center"},null,8,["label"]),t(o,{label:a(i)("common.latestExecutionStatus"),prop:"forceSSL",align:"center"},{default:r(({row:s})=>[S("span",{class:$({"text-green":s.status==="Success","text-orange":s.status==="Failure","text-gray":s.status==="Running "})},[s.errorMessage?(V(),w(R,{key:0,trigger:"hover","popper-class":"!w-auto max-w-300px !p-0",placement:"left"},{reference:r(()=>[t(p,{class:"iconfont icon-fasongshibai text-14px"})]),default:r(()=>[t(M,{"max-height":"50vh",class:"p-12 text-left !break-normal"},{default:r(()=>[S("div",null,C(s.errorMessage),1)]),_:2},1024)]),_:2},1024)):U("",!0),q(" "+C(s.status==="Success"?a(i)("common.success"):s.status==="Failure"?a(i)("common.failed"):a(i)("common.executing")),1)],2)]),_:1},8,["label"]),t(o,{width:"120",align:"right"},{default:r(({row:s})=>[S("div",Ae,[t(c,{class:"!text-20px",icon:s.active?"icon-quxiaozhihang":"icon-putongzhihang",tip:s.active?a(i)("common.stop"):a(i)("common.execute"),"data-cy":"execute",onClick:L=>h(s)},null,8,["icon","tip","onClick"]),t(c,{icon:"icon-a-writein",tip:a(i)("common.edit"),class:$(s.active?"cursor-not-allowed !hover:text-[#989b9c] !hover:text-opacity-40  !text-opacity-40":""),"data-cy":"edit",onClick:L=>n(s)},null,8,["tip","class","onClick"]),t(c,{icon:"icon-delete ",class:$(["text-orange hover:text-orange",s.active?"cursor-not-allowed !hover:text-orange !hover:text-opacity-40  !text-opacity-40 ":""]),tip:a(i)("common.delete"),"data-cy":"remove",onClick:L=>J(s)},null,8,["class","tip","onClick"])])]),_:1})]),_:1},8,["data"])]),_.value?(V(),w(Te,{key:0,modelValue:_.value,"onUpdate:modelValue":d[1]||(d[1]=s=>_.value=s),"current-job":u.value,onReload:x},null,8,["modelValue","current-job"])):U("",!0)],64)}}});export{jo as default};
