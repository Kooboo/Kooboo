var V=(S,o,d)=>new Promise((m,u)=>{var f=n=>{try{g(d.next(n))}catch(x){u(x)}},b=n=>{try{g(d.throw(n))}catch(x){u(x)}},g=n=>n.done?m(n.value):Promise.resolve(n.value).then(f,b);g((d=d.apply(S,o)).next())});import{d as h,u as q,k as Z}from"./main.9fdfea92.js";import{B as G}from"./breadcrumb.f4d80c95.js";import{_ as H}from"./chart-js.aa2b427a.js";import{a as v}from"./replace-all.56d2c1f7.js";import{d as J,g as K}from"./i18n.a87944a4.js";import{u as Q}from"./use-date.f1258183.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Y}from"./windi.6360286d.js";import{E as ee}from"./index.d96452a6.js";import{E as te}from"./index.6918f0a5.js";import{E as oe}from"./index.361e2245.js";import{E as ae}from"./index.4f90a917.js";import{E as se}from"./index.7df1cda1.js";import{E as le,a as ne}from"./index.b38edc72.js";import{E as ce,a as ie}from"./index.7c862087.js";import{E as re}from"./index.f2c1b903.js";import{d as de,g as p,i as me,b8 as ue,o as E,a as M,f as t,b as s,u as a,w as l,F as z,t as c,e as D,j as F,aI as A,b7 as pe}from"./url.4cb47a7a.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";/* empty css                                                               */import"./plugin-vue_export-helper.41ffa612.js";import"./index.fd96ea36.js";import"./error.7e8331f1.js";import"./dark.9459c47b.js";import"./cloneDeep.c5011aa2.js";import"./_baseClone.b8903935.js";import"./_baseIsEqual.dc9e64c4.js";import"./dayjs.min.ccc40d4f.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.7b8c5aef.js";import"./validator.b5df2420.js";import"./event.776e7e11.js";import"./index.4d568055.js";import"./debounce.4e0c106e.js";import"./toNumber.47eea968.js";import"./index.42922617.js";import"./index.66319a92.js";import"./index.178b9e08.js";import"./scroll.16983984.js";import"./isEqual.4cab74e3.js";import"./index.c10802d9.js";import"./aria.75ec5909.js";const _=J.global.t,_e=()=>h.get(v("Search/WeekNames")),he=()=>h.get(v("Search/IndexStat")),ve=()=>h.get(v("Search/Lastest")),fe=S=>h.get(v("Search/SearchStat"),S),be=S=>h.post(v("Search/Enable"),S,void 0,{successMessage:_("common.enableSuccess"),errorMessage:_("common.enableFailed")}),xe=()=>h.post(v("Search/Disable"),void 0,void 0,{successMessage:_("common.disableSuccess"),errorMessage:_("common.disableFailed")}),Se=()=>h.post(v("Search/Rebuild"),void 0,void 0,{successMessage:_("common.rebuildSuccess"),errorMessage:_("common.rebuildFailed")}),ge=()=>h.get(v("Search/Clean"),void 0,{successMessage:_("common.cleanSuccess"),errorMessage:_("common.cleanFailed")});const we={class:"p-24"},ye={class:"px-24 w-full"},Ee={class:"flex items-center"},ke={class:"flex items-center ml-12"},Ce={class:"flex items-center"},Te={class:"flex-1"},Fe={class:"text-666"},Ie={class:"text-444 text-s"},Be={class:"flex-1"},Ve={class:"text-666"},Me={class:"text-444 text-s"},ze={class:"flex-1"},De={class:"text-666"},Ae={class:"text-444 text-s"},Pe={class:"flex-1 whitespace-nowrap text-center"},Ne={class:"mb-32 p-24 w-full flex"},je={class:"w-6/12"},Le={class:"w-6/12 search-statistic"},Oe={class:"flex justify-between items-center"},Ue={class:"p-24"},We=de({setup(S){const{t:o}=K(),d=q(),m=p(!1),u=p(0),f=p(0),b=p(0),g=p([]),n=p(""),x=p([]),k=p({type:"bar",data:{labels:[],datasets:[{label:"PV",data:[]}]},options:{scales:{y:{beginAtZero:!0}}}});me(n,e=>{e&&fe({weekname:e}).then(i=>{k.value.data.labels=Object.keys(i),k.value.data.datasets[0].data=Object.values(i)})});function P(){Se().then(e=>{m.value=e.enableFullTextSearch,u.value=e.wordCount,f.value=e.docCount,b.value=e.diskSize})}function N(){ge().then(e=>{m.value=e.enableFullTextSearch,u.value=e.wordCount,f.value=e.docCount,b.value=e.diskSize})}function j(e){return V(this,null,function*(){if(!!d.hasAccess("search","edit"))if(e){const i=C=>{be({rebuild:C}).then(w=>{m.value=w.enableFullTextSearch,u.value=w.wordCount,f.value=w.docCount,b.value=w.diskSize})};re.confirm(o("common.rebuildSiteIndexTips"),o("common.warning"),{confirmButtonText:o("common.ok"),cancelButtonText:o("common.cancel"),type:"warning"}).then(()=>{i(!0)}).catch(()=>{i(!1)})}else yield xe()})}function L(){_e().then(e=>{e.length&&(x.value=e.reverse(),n.value=x.value[0])}),he().then(e=>{m.value=e.enableFullTextSearch,u.value=e.wordCount,f.value=e.docCount,b.value=e.diskSize}),ve().then(e=>{g.value=e})}return L(),(e,i)=>{const C=Y,w=ee,O=te,I=oe,U=ae,T=se,y=le,W=ne,R=ce,$=ie,B=ue("hasPermission");return E(),M(z,null,[t("div",we,[s(G,{name:a(o)("common.search")},null,8,["name"])]),t("div",ye,[s(T,{shadow:"never"},{header:l(()=>[t("div",Ee,[t("span",null,c(a(o)("common.indexData")),1),t("div",ke,[s(w,{class:"box-item",content:a(o)("common.addToIndexAutomaticallyWhenDocumentChanged"),placement:"left"},{default:l(()=>[s(C,{class:"iconfont icon-problem mr-4"})]),_:1},8,["content"]),s(O,{modelValue:m.value,"onUpdate:modelValue":i[0]||(i[0]=r=>m.value=r),size:"large",disabled:!a(d).hasAccess("search","edit"),title:a(d).hasAccess("search","edit")?"":a(o)("common.noPermission"),"data-cy":"auto-add-index",onChange:j},null,8,["modelValue","disabled","title"])])])]),default:l(()=>[t("div",Ce,[t("div",Te,[t("div",Fe,c(u.value),1),t("div",Ie,c(a(o)("common.keyword")),1)]),t("div",Be,[t("div",Ve,c(f.value),1),t("div",Me,c(a(o)("common.document")),1)]),t("div",ze,[t("div",De,c(a(Z)(b.value)),1),t("div",Ae,c(a(o)("common.diskSize")),1)]),t("div",Pe,[D((E(),F(I,{class:"bg-blue mr-4 rounded-full",type:"primary","data-cy":"rebuild",onClick:P},{default:l(()=>[A(c(a(o)("common.rebuild")),1)]),_:1})),[[B,{feature:"search",action:"edit"}]]),s(U,{title:a(o)("common.cleanSearchIndexTips"),onConfirm:N},{reference:l(()=>[D((E(),F(I,{class:"bg-orange rounded-full",type:"danger","data-cy":"clean"},{default:l(()=>[A(c(a(o)("common.clean")),1)]),_:1})),[[B,{feature:"search",action:"delete"}]])]),_:1},8,["title"])])])]),_:1})]),t("div",Ne,[t("div",je,[s(T,{shadow:"never",class:"mr-12","body-style":{padding:0}},{header:l(()=>[t("div",null,[t("span",null,c(a(o)("common.lastestSearch")),1)])]),default:l(()=>[s(W,{data:g.value,class:"w-full"},{default:l(()=>[s(y,{width:"10"}),s(y,{prop:"ip",label:"IP",width:"120"}),s(y,{prop:"keywords",label:a(o)("common.keyword")},null,8,["label"]),s(y,{prop:"docFound",label:a(o)("common.documentFound")},null,8,["label"]),s(y,{label:a(o)("common.date")},{default:l(({row:r})=>[t("span",null,c(a(Q)(r.time)),1)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})]),t("div",Le,[s(T,{shadow:"never",class:"ml-12","body-style":{padding:0}},{header:l(()=>[t("div",Oe,[t("span",null,c(a(o)("common.searchStatistic")),1),s($,{modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=r=>n.value=r),class:"w-120px",placeholder:a(o)("common.select")},{default:l(()=>[(E(!0),M(z,null,pe(x.value,r=>(E(),F(R,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])])]),default:l(()=>[t("div",Ue,[s(H,{height:"180",options:k.value},null,8,["options"])])]),_:1})])])],64)}}});var Dt=X(We,[["__scopeId","data-v-94c7d93e"]]);export{Dt as default};
