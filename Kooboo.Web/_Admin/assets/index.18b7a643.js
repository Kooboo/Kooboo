var y=(g,m,o)=>new Promise((r,l)=>{var p=e=>{try{s(o.next(e))}catch(c){l(c)}},u=e=>{try{s(o.throw(e))}catch(c){l(c)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(p,u);s((o=o.apply(g,m)).next())});import{a as F,g as T,b as q,c as S,d as P}from"./user.fea8bc66.js";import{a as C}from"./validate.bb56f9e3.js";import{_ as j}from"./index.f0d5f031.js";import{g as w}from"./i18n.a87944a4.js";import{E as z,a as A,c as L}from"./index.7c862087.js";import{E as O,a as G}from"./index.9fd79879.js";import{E as H}from"./index.c003dfa1.js";import{d as I,g as _,o as d,j as b,w as n,b as a,u as i,a as E,b7 as x,F as V,b8 as J,f as B,e as K,aI as h,t as D,k as M}from"./url.4cb47a7a.js";import{E as Q}from"./windi.6360286d.js";import{E as W}from"./index.361e2245.js";import{_ as X}from"./k-table.b1a54b80.js";import{B as Y}from"./breadcrumb.f4d80c95.js";import{b as Z}from"./confirm.b60b5d2f.js";import{E as ee}from"./index.b38edc72.js";import"./replace-all.56d2c1f7.js";import"./main.9fdfea92.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseIsEqual.dc9e64c4.js";import"./index.178b9e08.js";import"./event.776e7e11.js";import"./index.7b8c5aef.js";import"./error.7e8331f1.js";import"./isNil.98bb3b88.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./event.53b2ad83.js";import"./index.fd96ea36.js";import"./index.4d568055.js";import"./scroll.16983984.js";import"./isEqual.4cab74e3.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./validator.b5df2420.js";import"./_baseClone.b8903935.js";import"./index.c10802d9.js";import"./refs.3132cbdb.js";import"./sortable.esm.a99254e8.js";import"./icon-button.74ccc970.js";import"./index.4f90a917.js";import"./index.c6da2706.js";import"./index.42922617.js";import"./index.f15f695e.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.f2c1b903.js";import"./aria.75ec5909.js";const oe=I({props:{modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(g,{emit:m}){const{t:o}=w(),r=_([]),l=_([]);F().then(v=>{r.value=v,r.value.length&&(e.value.userId=r.value[0].userId)}),T().then(v=>{l.value=v,l.value.length&&(e.value.role=l.value[0])});const p={userId:C(o("common.userRequired")),role:C(o("common.roleRequiredTips"))},u=_(!0),s=_(),e=_({userId:"",role:""}),c=()=>y(this,null,function*(){yield s.value.validate(),yield q(e.value),u.value=!1,m("reload")});return(v,f)=>{const U=z,$=A,k=O,N=G,R=H;return d(),b(R,{"model-value":u.value,width:"600px","close-on-click-modal":!1,title:i(o)("common.addUser"),onClosed:f[3]||(f[3]=t=>m("update:modelValue",!1))},{footer:n(()=>[a(j,{"confirm-label":i(o)("common.add"),onConfirm:c,onCancel:f[2]||(f[2]=t=>u.value=!1)},null,8,["confirm-label"])]),default:n(()=>[a(N,{ref_key:"form",ref:s,"label-position":"top",model:e.value,rules:i(p)},{default:n(()=>[a(k,{label:i(o)("common.availableUser"),prop:"userId"},{default:n(()=>[a($,{modelValue:e.value.userId,"onUpdate:modelValue":f[0]||(f[0]=t=>e.value.userId=t),class:"w-full","data-cy":"users"},{default:n(()=>[(d(!0),E(V,null,x(r.value,t=>(d(),b(U,{key:t.userId,value:t.userId,label:`${t.userName}<${t.email}>`,"data-cy":"user-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(k,{label:i(o)("common.role"),prop:"role"},{default:n(()=>[a($,{modelValue:e.value.role,"onUpdate:modelValue":f[1]||(f[1]=t=>e.value.role=t),class:"w-full","data-cy":"roles"},{default:n(()=>[(d(!0),E(V,null,x(l.value,t=>(d(),b(U,{key:t,value:t,label:t,"data-cy":"role-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}}),le={class:"flex items-center py-24 space-x-16"},te={class:"flex items-center"},ae=I({emits:["reload"],setup(g){const{t:m}=w(),o=_(!1);return(r,l)=>{const p=Q,u=W,s=J("hasPermission");return d(),E(V,null,[B("div",le,[K((d(),b(u,{round:"","data-cy":"add-user",onClick:l[0]||(l[0]=e=>o.value=!0)},{default:n(()=>[B("div",te,[a(p,{class:"mr-16 iconfont icon-a-addto"}),h(" "+D(i(m)("common.addUser")),1)])]),_:1})),[[s,{feature:"siteUser",action:"edit"}]])]),o.value?(d(),b(oe,{key:0,modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value=e),onReload:l[2]||(l[2]=e=>r.$emit("reload"))},null,8,["modelValue"])):M("",!0)],64)}}}),re={class:"p-24"},io=I({setup(g){const{t:m}=w(),o=_(),r=()=>y(this,null,function*(){o.value=yield S()}),l=p=>y(this,null,function*(){yield Z(p.length),yield P(p.map(u=>u.userId)),r()});return r(),(p,u)=>{var c;const s=ee,e=L;return d(),E("div",re,[a(Y,{name:i(m)("common.siteUser")},null,8,["name"]),a(ae,{onReload:r}),a(i(X),{data:(c=o.value)!=null?c:[],"show-check":"",permission:{feature:"siteUser",action:"delete"},onDelete:l},{default:n(()=>[a(s,{label:i(m)("common.username"),prop:"userName"},null,8,["label"]),a(s,{label:i(m)("common.email"),prop:"email"},null,8,["label"]),a(s,{label:i(m)("common.role")},{default:n(({row:v})=>[a(e,{size:"small",class:"rounded-full cursor-pointer","data-cy":"role"},{default:n(()=>[h(D(v.role),1)]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])])}}});export{io as default};
