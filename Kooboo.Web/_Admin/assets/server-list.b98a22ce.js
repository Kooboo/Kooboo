var h=(k,m,c)=>new Promise((r,i)=>{var f=a=>{try{e(c.next(a))}catch(_){i(_)}},y=a=>{try{e(c.throw(a))}catch(_){i(_)}},e=a=>a.done?r(a.value):Promise.resolve(a.value).then(f,y);e((c=c.apply(k,m)).next())});import{_ as G}from"./k-table.b1a54b80.js";import{B as K}from"./breadcrumb.f4d80c95.js";import{g as F}from"./i18n.a87944a4.js";import{A as O,B as j,g as J,C as M}from"./index.48581690.js";import{w as Q}from"./main.9fdfea92.js";import{e as W}from"./guid.c1a40312.js";import{_ as X}from"./index.f0d5f031.js";import{a as T,s as Y,r as Z,u as ee}from"./validate.bb56f9e3.js";import{E as oe}from"./index.178b9e08.js";import{E as ae,a as le}from"./index.9fd79879.js";import{E as te,a as re}from"./index.7c862087.js";import{E as ne,a as se}from"./index.f15f695e.js";import{E as me}from"./index.c003dfa1.js";import{d as q,g as v,o as s,j as b,w as t,b as n,u as p,f as w,a as C,b7 as S,F as B,aI as D,t as I,k as z,b8 as ie,e as ue}from"./url.4cb47a7a.js";import{b as de}from"./confirm.b60b5d2f.js";import{E as pe}from"./windi.6360286d.js";import{E as ce}from"./index.361e2245.js";import{E as ve}from"./index.b38edc72.js";import"./sortable.esm.a99254e8.js";import"./icon-button.74ccc970.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.7b8c5aef.js";import"./index.4f90a917.js";import"./index.4d568055.js";import"./index.c6da2706.js";import"./isEqual.4cab74e3.js";import"./_baseIsEqual.dc9e64c4.js";import"./error.7e8331f1.js";import"./index.42922617.js";import"./event.776e7e11.js";import"./replace-all.56d2c1f7.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.fd96ea36.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseClone.b8903935.js";import"./scroll.16983984.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./validator.b5df2420.js";import"./index.c10802d9.js";import"./refs.3132cbdb.js";import"./logo-transparent.1566007e.js";import"./index.f2c1b903.js";import"./aria.75ec5909.js";const fe={class:"flex items-center space-x-8 w-full"},_e={class:"flex items-center space-x-8 w-full"},be=q({props:{modelValue:{type:Boolean},organizations:null},emits:["update:modelValue","reload"],setup(k,{emit:m}){var u;const c=k,{t:r}=F(),i=v(!0),f=v(),y=v([]),e=v({id:W,name:"",serverUrl:"",orgId:(u=c.organizations.find(d=>d.isAdmin))==null?void 0:u.id}),a={name:[T(r("common.nameRequiredTips")),Y,Z(1,50)],serverUrl:[ee(r("common.urlInvalid")),T(r("common.serverUrlRequiredTips"))]},_=v([{key:"kooboo",value:"Kooboo"+r("common.online")},{key:"custom",value:r("common.custom")}]),V=v(_.value[0].key),E=()=>h(this,null,function*(){yield f.value.validate(),yield O(e.value),m("reload"),i.value=!1}),x=()=>h(this,null,function*(){!e.value.orgId||(c.organizations.find(d=>d.id==e.value.orgId),y.value=(yield j(e.value.orgId)).map(d=>(d.host=`http://${d.orgFullDomain}`,d)))}),$=()=>{e.value.serverUrl=""};return x(),(d,l)=>{const U=oe,g=ae,R=te,N=re,A=ne,H=se,L=le,P=me;return s(),b(P,{"model-value":i.value,width:"600px","close-on-click-modal":!1,title:p(r)("common.addServer"),onClosed:l[6]||(l[6]=o=>m("update:modelValue",!1))},{footer:t(()=>[n(X,{disabled:!e.value.name||!e.value.serverUrl,onConfirm:E,onCancel:l[5]||(l[5]=o=>i.value=!1)},null,8,["disabled"])]),default:t(()=>[n(L,{ref_key:"form",ref:f,"label-position":"top",model:e.value,rules:p(a)},{default:t(()=>[n(g,{prop:"name",label:p(r)("common.name")},{default:t(()=>[n(U,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.name=o),placeholder:"kooboocn"},null,8,["modelValue"])]),_:1},8,["label"]),n(g,{label:p(r)("common.organization"),prop:"orgId",required:""},{default:t(()=>[w("div",fe,[n(N,{modelValue:e.value.orgId,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.orgId=o),class:"w-full",onChange:x},{default:t(()=>[(s(!0),C(B,null,S(k.organizations,o=>(s(),b(R,{key:o.id,label:o.displayName,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["label"]),n(g,{label:p(r)("common.from")},{default:t(()=>[n(H,{modelValue:V.value,"onUpdate:modelValue":l[2]||(l[2]=o=>V.value=o),class:"el-radio-group--rounded h-38px",onChange:$},{default:t(()=>[(s(!0),C(B,null,S(_.value,o=>(s(),b(A,{key:o.key,label:o.key},{default:t(()=>[D(I(o.value),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),V.value=="kooboo"?(s(),b(g,{key:0,prop:"serverUrl"},{default:t(()=>[w("div",_e,[n(N,{modelValue:e.value.serverUrl,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.serverUrl=o),class:"w-full"},{default:t(()=>[(s(!0),C(B,null,S(y.value,o=>(s(),b(R,{key:o.host,label:`${o.dataCenter} (${o.host})`,value:o.host},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})):z("",!0),V.value=="custom"?(s(),b(g,{key:1,prop:"serverUrl"},{default:t(()=>[n(U,{modelValue:e.value.serverUrl,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.serverUrl=o),placeholder:"https://www.kooboo.cn"},null,8,["modelValue"])]),_:1})):z("",!0)]),_:1},8,["model","rules"])]),_:1},8,["model-value","title"])}}}),ge={class:"p-24"},ye={class:"flex items-center py-24 space-x-16"},Ve={class:"flex items-center"},we={"data-cy":"remote-site"},ke={"data-cy":"server"},Co=q({setup(k){const{t:m}=F(),c=v([]),r=v(),i=v(!1),f=()=>h(this,null,function*(){const e=yield Promise.all([yield J(),yield Q()]);c.value=e[0].map(a=>(a.reserved&&(a.$DisabledSelect=!0),a)),r.value=e[1]});f();function y(e){return h(this,null,function*(){yield de();for(const a of e)yield M(a.id);f()})}return(e,a)=>{const _=pe,V=ce,E=ve,x=G,$=ie("hasPermission");return s(),C("div",ge,[n(K,{"crumb-path":[{name:p(m)("common.sync"),route:{name:"sync"}},{name:p(m)("common.server")}]},null,8,["crumb-path"]),w("div",ye,[ue((s(),b(V,{round:"",onClick:a[0]||(a[0]=u=>i.value=!0)},{default:t(()=>[w("div",Ve,[n(_,{class:"mr-16 iconfont icon-a-addto"}),D(" "+I(p(m)("common.addServer")),1)])]),_:1})),[[$,{feature:"sync",action:"edit"}]])]),n(x,{data:c.value,"show-check":"",permission:{feature:"sync",action:"delete"},onDelete:y},{default:t(()=>[n(E,{label:p(m)("common.name")},{default:t(({row:u})=>[w("span",we,I(u.name),1)]),_:1},8,["label"]),n(E,{label:p(m)("common.server")},{default:t(({row:u})=>[w("span",ke,I(u.serverUrl),1)]),_:1},8,["label"]),n(E,{label:p(m)("common.organization")},{default:t(({row:u})=>{var d,l,U;return[D(I((U=(l=(d=r.value)==null?void 0:d.find(g=>g.id==u.orgId))==null?void 0:l.displayName)!=null?U:"-"),1)]}),_:1},8,["label"])]),_:1},8,["data"]),i.value&&r.value?(s(),b(be,{key:0,modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=u=>i.value=u),organizations:r.value,onReload:f},null,8,["modelValue","organizations"])):z("",!0)])}}});export{Co as default};
