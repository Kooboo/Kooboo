var q=(T,l,u)=>new Promise((U,v)=>{var e=r=>{try{D(u.next(r))}catch(y){v(y)}},E=r=>{try{D(u.throw(r))}catch(y){v(y)}},D=r=>r.done?U(r.value):Promise.resolve(r.value).then(e,E);D((u=u.apply(T,l)).next())});import{g as W,w as X}from"./i18n.a87944a4.js";import{a as Y}from"./index.d2657986.js";import{x as Z,M as ee,N as oe,H as ae,O as z,E as te}from"./main.9fdfea92.js";import{a as k,r as P,b as le,d as se,s as ne,i as ie}from"./validate.bb56f9e3.js";import{d as re,g as c,cd as me,i as h,o as p,a as N,f,t as b,u as d,b as n,w as m,F as L,b7 as O,j as F,aI as j,k as C,x as ue}from"./url.4cb47a7a.js";import{n as pe}from"./guid.c1a40312.js";import{E as de}from"./index.d878e15f.js";import{j as ce,E as fe}from"./windi.6360286d.js";import{E as ve}from"./index.178b9e08.js";import{E as _e,a as be}from"./index.9fd79879.js";import{E as De,a as ye}from"./index.7c862087.js";import{E as ge,a as xe}from"./index.f15f695e.js";import{E as ke}from"./index.99e769ef.js";import{E as Ne}from"./index.361e2245.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./replace-all.56d2c1f7.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseIsEqual.dc9e64c4.js";import"./event.776e7e11.js";import"./index.7b8c5aef.js";import"./error.7e8331f1.js";import"./isNil.98bb3b88.js";import"./_baseClone.b8903935.js";import"./isEqual.4cab74e3.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./event.53b2ad83.js";import"./index.fd96ea36.js";import"./index.4d568055.js";import"./scroll.16983984.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./validator.b5df2420.js";const Ee={class:"text-444 dark:text-fff/86"},we={class:"text-3l mb-8"},Ve={class:"text-s"},he={class:"border-t border-b border-line dark:border-[#555] border-solid my-24 py-24"},Fe={class:"flex items-center space-x-8"},Ue={class:"flex items-center justify-center h-full flex-col"},Re={class:"text-m flex items-center relative"},Ie={key:0,class:"h-16 text-666 font-normal text-[12px] leading-relaxed"},Se={key:1,class:"text-s mt-8 text-666 pr-8 pl-8"},xo=re({setup(T){const{t:l}=W(),u=c(),U=me(),v=c(0),e=c({rootDomain:"",subDomain:"",siteName:"",url:"",file:null}),E=c(!1),D=c(!1),r=c(),y={subDomain:[k(l("common.subDomainRequiredTips")),P(1,63),le,se(e.value)],rootDomain:k(l("common.rootDomainRequiredTips")),file:k(l("common.selectSitePackageTips")),siteName:[P(1,50),k(l("common.nameRequiredTips")),ne(),ie(Z,l("common.siteNameExistsTips"))],url:k(l("common.urlRequiredTips"))},R=c();Y().then(s=>{u.value=s,u.value.length&&(e.value.rootDomain=u.value[0].domainName)});const B=[{key:"file",value:l("common.file")},{key:"URL",value:"URL"}],w=c(B[0].key),M=()=>q(this,null,function*(){yield R.value.validate();const s=ce.service({lock:!0,text:l("common.siteParsing"),background:"rgba(0, 0, 0, 0.7)"});try{if(w.value==="file"){var o=new FormData;o.append("siteName",e.value.siteName),o.append("subDomain",e.value.subDomain),o.append("rootDomain",e.value.rootDomain);const i=yield G();o.append("packageName",i),r.value=yield ee(o,g=>{})}else r.value=yield oe({rootDomain:e.value.rootDomain,subDomain:e.value.subDomain,siteName:e.value.siteName,url:e.value.url});const t=ue("currentFolder");t&&(yield ae({siteIds:[r.value],folderName:t})),s.close(),U.push({name:"home",query:{currentFolder:t}})}catch(t){s.close()}});var $=1024*1024;function G(){return q(this,null,function*(){const s=pe(),o=e.value.file;let t=0,i=0;for(;t<o.size;){i++;const V=t+$,I=o.raw.slice(t,V),_=new FormData;_.append("id",s),_.append("index",i.toString()),_.append("file",I),yield z(_,S=>{v.value=parseFloat(((S.loaded+t)/o.size*100).toFixed(2))}),t=V}const g=`${s}.zip`,x=new FormData;return x.append("id",s),x.append("name",g),yield z(x,()=>{}),g})}const A=s=>{var o=s.name;if(o.indexOf(".")>-1&&o.split(".").reverse()[0]==="zip"){if(e.value.file=s,!e.value.subDomain){var t=o.split(".");t.pop(),e.value.subDomain=t.join(".")}}else te.error(l("common.fileFormatIsIncorrect"))},H=()=>{e.value.file=null,e.value.subDomain=""};return h(()=>e.value.file,()=>{e.value.file&&R.value.clearValidate("file")}),h(()=>e.value.subDomain,()=>{E.value||(e.value.siteName=e.value.subDomain)}),h(()=>e.value.siteName,()=>{D.value||(e.value.subDomain=e.value.siteName)}),h(()=>e.value.rootDomain,()=>{var s,o,t;e.value.sudDomainUseDash=(t=(o=(s=u.value)==null?void 0:s.find(i=>i.domainName==e.value.rootDomain))==null?void 0:o.sudDomainUseDash)!=null?t:!1}),(s,o)=>{const t=ve,i=_e,g=De,x=ye,V=ge,I=xe,_=fe,S=ke,Q=de,J=be,K=Ne;return p(),N("div",Ee,[f("p",we,b(d(l)("common.importSite")),1),f("p",Ve,b(d(l)("common.importSiteTips")),1),f("div",he,[n(J,{ref_key:"form",ref:R,"label-position":"top",model:e.value,rules:d(y)},{default:m(()=>[n(i,{label:d(l)("common.siteName"),prop:"siteName"},{default:m(()=>[n(t,{modelValue:e.value.siteName,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.siteName=a),class:"w-304px","data-cy":"siteName",onInput:o[1]||(o[1]=a=>E.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),f("div",Fe,[n(i,{label:d(l)("common.domain"),prop:"subDomain"},{default:m(()=>[n(t,{modelValue:e.value.subDomain,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.subDomain=a),class:"w-304px","data-cy":"subdomain",onInput:o[3]||(o[3]=a=>D.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),n(i,{prop:"rootDomain",class:"mt-30px"},{default:m(()=>[n(x,{modelValue:e.value.rootDomain,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.rootDomain=a),"data-cy":"root-domain",class:"!w-300px"},{default:m(()=>[(p(!0),N(L,null,O(u.value,a=>(p(),F(g,{key:a.domainName,value:a.domainName,label:(a.sudDomainUseDash?"-":".")+a.domainName,"data-cy":"root-domain-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),n(I,{modelValue:w.value,"onUpdate:modelValue":o[5]||(o[5]=a=>w.value=a),class:"el-radio-group--rounded mb-12"},{default:m(()=>[(p(),N(L,null,O(B,a=>n(V,{key:a.key,label:a.key,"data-cy":a.key},{default:m(()=>[j(b(a.value),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"]),w.value==="file"?(p(),F(i,{key:0,label:d(l)("common.file"),prop:"file"},{default:m(()=>[n(S,{"show-file-list":!1,action:"",drag:"",accept:".zip","auto-upload":!1,"on-change":A,class:"w-full"},{default:m(()=>[f("div",Ue,[f("p",Re,[n(_,{class:"iconfont icon-a-Cloudupload mr-8 text-2l leading-none absolute left-[-24px]"}),f("span",null,b(d(l)("common.selectOrDrag")),1)]),e.value.file?C("",!0):(p(),N("span",Ie,b(d(l)("common.compressedPackageFileFormat")),1)),e.value.file?(p(),N("p",Se,[f("span",null,b(e.value.file.name),1),n(_,{class:"iconfont icon-delete text-orange ml-8",onClick:X(H,["stop"])},null,8,["onClick"])])):C("",!0)])]),_:1})]),_:1},8,["label"])):(p(),F(i,{key:1,prop:"url",label:"URL"},{default:m(()=>[n(t,{modelValue:e.value.url,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value.url=a),"data-cy":"url"},null,8,["modelValue"])]),_:1})),v.value>0?(p(),F(Q,{key:2,"text-inside":!0,"stroke-width":26,percentage:v.value>100?100:v.value},null,8,["percentage"])):C("",!0)]),_:1},8,["model","rules"])]),n(K,{round:"",type:"primary","data-cy":"start-import",onClick:M},{default:m(()=>[j(b(d(l)("common.startImport")),1)]),_:1})])}}});export{xo as default};
