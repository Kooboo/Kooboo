var x=(V,g,v)=>new Promise((h,e)=>{var m=c=>{try{f(v.next(c))}catch(a){e(a)}},t=c=>{try{f(v.throw(c))}catch(a){e(a)}},f=c=>c.done?h(c.value):Promise.resolve(c.value).then(m,t);f((v=v.apply(V,g)).next())});import{_ as ie}from"./icon-button.74ccc970.js";import{_ as se}from"./k-table.b1a54b80.js";import{B as Y,C as me,D as Z,I as re,E as ue,F as de,G as ce}from"./dev-mode.acf56c3e.js";import{B as pe}from"./breadcrumb.f4d80c95.js";import{g as A,d as fe,C as _e}from"./i18n.a87944a4.js";import{_ as ee}from"./index.f0d5f031.js";import{E as F}from"./index.c003dfa1.js";import{d as j,g as _,o as i,j as p,w as d,b as s,u as n,ce as ve,f as w,a as z,F as H,b7 as Q,aI as B,t as $,k as S,c as ge,O as ke,b8 as ye,e as R,cg as X}from"./url.4cb47a7a.js";import{m as Ve}from"./marked.esm.30e9f73c.js";import{_ as he}from"./index.ba677b9f.js";import{a as oe,u as we}from"./replace-all.56d2c1f7.js";import{d as te,u as be}from"./main.9fdfea92.js";import{E as xe}from"./index.6f16842c.js";import{E as le}from"./index.6918f0a5.js";import{E as Ce,a as Se}from"./index.7c862087.js";import{E as $e}from"./index.178b9e08.js";import{E as Ee,a as De}from"./index.9fd79879.js";import{b as Ue,s as Me}from"./confirm.b60b5d2f.js";import{_ as Ie}from"./package-search.392883e4.js";import{E as Be}from"./windi.6360286d.js";import{E as Ne}from"./index.361e2245.js";import{E as Oe}from"./index.b38edc72.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.7b8c5aef.js";import"./index.4f90a917.js";import"./index.4d568055.js";import"./sortable.esm.a99254e8.js";import"./index.c6da2706.js";import"./isEqual.4cab74e3.js";import"./_baseIsEqual.dc9e64c4.js";import"./error.7e8331f1.js";import"./index.42922617.js";import"./event.776e7e11.js";import"./index.f15f695e.js";import"./guid.c1a40312.js";import"./use-shortcuts.ff4b1f52.js";import"./index.fd96ea36.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./preload-helper.13a99eb0.js";import"./config.1e73f9c3.js";import"./dark.9459c47b.js";import"./page.881ec888.js";import"./validate.bb56f9e3.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./index.f2c1b903.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./validator.b5df2420.js";import"./index.c86a187b.js";import"./dropdown.86d3a7fb.js";import"./refs.3132cbdb.js";import"./use-copy-text.ec245a13.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./use-save-tip.e3dc783a.js";import"./vuedraggable.umd.af323a53.js";import"./index.f154d010.js";import"./index.b9a74c44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./alert.d2815716.js";import"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./index.0e5d639d.js";import"./cloneDeep.c5011aa2.js";import"./_baseClone.b8903935.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.50c16ae5.js";import"./index.e3f90979.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./logo-transparent.1566007e.js";import"./layout.b686c380.js";import"./search-input.2a27ef56.js";import"./index.765084fe.js";import"./position.7590de53.js";import"./throttle.1f6a079c.js";import"./index.a7b376b1.js";const Te=j({props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(V,{emit:g}){const{t:v}=A(),h=Y(),e=_(!0),m=_(),t=_({name:""}),f=()=>x(this,null,function*(){yield m.value.validate(),yield h.createModule(t.value.name),e.value=!1});return(c,a)=>{const k=F;return i(),p(k,{"model-value":e.value,width:"600px","close-on-click-modal":!1,title:n(v)("common.newModule"),onClosed:a[1]||(a[1]=b=>g("update:modelValue",!1))},{footer:d(()=>[s(ee,{onConfirm:f,onCancel:a[0]||(a[0]=b=>e.value=!1)})]),default:d(()=>[s(me,{ref_key:"form",ref:m,model:t.value,onSave:f},null,8,["model"])]),_:1},8,["model-value","title"])}}}),Re={class:"px-12"},ze=j({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(V,{emit:g}){const v=V,{t:h}=A(),e=_(!0),m=_("");Z("root",v.id,"Readme.md").then(f=>{m.value=Ve.parse(f)});const t=ve(()=>`<div style="padding:10px;">${m.value}<div>`);return(f,c)=>{const a=F;return i(),p(a,{"custom-class":"el-dialog--zero-padding","model-value":e.value,width:"1000px","close-on-click-modal":!1,title:n(h)("common.description"),onClosed:c[0]||(c[0]=k=>g("update:modelValue",!1))},{default:d(()=>[w("div",Re,[s(he,{class:"h-400px",content:n(t)},null,8,["content"])])]),_:1},8,["model-value","title"])}}}),Ae=fe.global.t,Fe=V=>te.get(oe("ModuleSetting/GetSetting"),{id:V}),je=(V,g)=>te.post(oe("ModuleSetting/UpdateSetting"),{id:V,json:g},void 0,{successMessage:Ae("common.saveSuccess")}),Pe={key:0},Je={class:"text-m font-bold ellipsis"},qe=["title"],Ge=j({props:{modelValue:{type:Boolean},id:null},emits:["update:modelValue"],setup(V,{emit:g}){const v=V,{t:h}=A(),e=_(!0),m=_(),t=_({});x(this,null,function*(){var c=yield Z("root",v.id,"module.config");m.value=JSON.parse(c);const a=yield Fe(v.id);if(a)t.value=JSON.parse(a);else if(m.value.settingDefines)for(const k of m.value.settingDefines)t.value[k.name]=k.defaultValue});const f=()=>x(this,null,function*(){m.value.setting=t.value,yield je(v.id,JSON.stringify(t.value,null,2)),e.value=!1});return(c,a)=>{const k=le,b=xe,E=Ce,M=Se,P=$e,J=Ee,q=De,G=F;return i(),p(G,{"model-value":e.value,width:"600px","close-on-click-modal":!1,title:n(h)("common.setting"),onClosed:a[1]||(a[1]=D=>g("update:modelValue",!1))},{footer:d(()=>[s(ee,{permission:{feature:"module",action:"edit"},onConfirm:f,onCancel:a[0]||(a[0]=D=>e.value=!1)})]),default:d(()=>[s(q,{"label-position":"top"},{default:d(()=>{var D;return[(D=m.value)!=null&&D.settingDefines?(i(),z("div",Pe,[(i(!0),z(H,null,Q(m.value.settingDefines,r=>(i(),p(J,{key:r.name},{label:d(()=>[w("p",Je,[B($(r.display||r.name),1),w("span",{class:"font-normal text-s px-4",title:r.description},$(r.description),9,qe)])]),default:d(()=>[r.type==="switch"?(i(),p(k,{key:0,modelValue:t.value[r.name],"onUpdate:modelValue":y=>t.value[r.name]=y},null,8,["modelValue","onUpdate:modelValue"])):r.type==="number"?(i(),p(b,{key:1,modelValue:t.value[r.name],"onUpdate:modelValue":y=>t.value[r.name]=y,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])):r.type==="select"?(i(),p(M,{key:2,modelValue:t.value[r.name],"onUpdate:modelValue":y=>t.value[r.name]=y,modelModifiers:{number:!0},class:"w-full"},{default:d(()=>[(i(!0),z(H,null,Q(r.options,(y,K)=>(i(),p(E,{key:K,label:y,value:y},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(i(),p(P,{key:3,modelValue:t.value[r.name],"onUpdate:modelValue":y=>t.value[r.name]=y,modelModifiers:{number:!0},type:r.type=="textarea"?"textarea":""},null,8,["modelValue","onUpdate:modelValue","type"]))]),_:2},1024))),128))])):S("",!0)]}),_:1})]),_:1},8,["model-value","title"])}}}),Ke={class:"p-24"},Le={class:"flex items-center py-24 space-x-16"},We={class:"flex items-center"},He={class:"flex items-center"},Qe={class:"flex items-center"},Xe={class:"text-blue cursor-pointer"},Ye=["src"],Zt=j({setup(V){const g=_();function v(){var l;(l=g.value)==null||l.show()}const h=new _e,{t:e}=A(),m=Y(),t=be(),f=_(!1),c=_(!1),a=_(!1),k=_(!1),b=_(!1),E=_(),M=_(),P=l=>x(this,null,function*(){yield Ue(l.length),yield m.deleteModules(l.map(u=>u.id))}),J=l=>x(this,null,function*(){!t.hasAccess("module","edit")||(yield Me(e("common.shareModuleConfirm")),yield ue(l))}),q=l=>{E.value=l,a.value=!0},G=l=>{E.value=l,k.value=!0},D=l=>x(this,null,function*(){!t.hasAccess("module","edit")||(yield de(l.id,!l.online),m.load())}),r=l=>{!t.hasAccess("module","edit")||ce(l)},y=ge(()=>{if(!M.value)return;const l=h.get("jwt_token")||localStorage.getItem("TOKEN");return M.value+"?access_token="+l}),K=l=>{const u=h.get("jwt_token")||localStorage.getItem("TOKEN"),C=new URL(l),U=t.site.siteType=="p",L=location.protocol=="https:"&&C.protocol=="http:";U?L?X(l):(M.value=l,b.value=!0):(l=`${C.origin}/_Admin/login?permission=${t.site.siteType}&returnurl=${C.pathname}&&access_token=${u}`,X(l))},W=()=>x(this,null,function*(){yield m.load()});return W(),(l,u)=>{const C=Be,U=Ne,L=ke("router-link"),N=Oe,ae=le,O=ie,ne=F,T=ye("hasPermission");return i(),z("div",Ke,[s(pe,{name:n(e)("common.modules")},null,8,["name"]),w("div",Le,[R((i(),p(U,{round:"","data-cy":"create-module",onClick:u[0]||(u[0]=o=>f.value=!0)},{default:d(()=>[w("div",We,[s(C,{class:"mr-16 iconfont icon-a-addto"}),B(" "+$(n(e)("common.create")),1)])]),_:1})),[[T,{feature:"module",action:"edit"}]]),R((i(),p(U,{round:"","data-cy":"import",onClick:u[1]||(u[1]=o=>c.value=!0)},{default:d(()=>[w("div",He,[s(C,{class:"mr-16 iconfont icon-a-Pullin"}),B(" "+$(n(e)("common.import")),1)])]),_:1})),[[T,{feature:"module",action:"edit"}]]),R((i(),p(U,{round:"","data-cy":"search",onClick:v},{default:d(()=>[w("div",Qe,[s(C,{class:"mr-16 iconfont icon-search"}),B(" "+$(n(e)("common.search")),1)])]),_:1})),[[T,{feature:"module",action:"edit"}]])]),n(m).list?(i(),p(n(se),{key:0,data:n(m).list,"show-check":"",sort:"creationDate",permission:{feature:"module",action:"delete"},onDelete:P},{default:d(()=>[s(N,{label:n(e)("common.name")},{default:d(({row:o})=>[s(L,{to:n(we)({name:"dev-mode",query:{activity:"modules",moduleId:o.id}}),"data-cy":"name"},{default:d(()=>[w("span",Xe,$(o.name),1)]),_:2},1032,["to"])]),_:1},8,["label"]),s(N,{label:n(e)("common.online"),width:"150"},{default:d(({row:o})=>[R(s(ae,{"model-value":o.online,"data-cy":"online",onClick:I=>D(o)},null,8,["model-value","onClick"]),[[T,{feature:"module",action:"edit"}]])]),_:1},8,["label"]),s(N,{width:"100",label:n(e)("common.backend")},{default:d(({row:o})=>[o.backendViewUrl?(i(),p(U,{key:0,size:"small",type:"primary",round:"","data-cy":"",class:"leading-6",onClick:I=>K(o.backendViewUrl)},{default:d(()=>[B($(n(e)("common.manage")),1)]),_:2},1032,["onClick"])):S("",!0)]),_:1},8,["label"]),s(N,{align:"right",width:"180px",prop:"creationDate"},{default:d(({row:o})=>[s(O,{icon:"icon-a-setup",tip:n(e)("common.settings"),"data-cy":"setting",onClick:I=>G(o.id)},null,8,["tip","onClick"]),s(O,{icon:"icon-page",tip:n(e)("common.description"),"data-cy":"description",onClick:I=>q(o.id)},null,8,["tip","onClick"]),s(O,{permission:{feature:"module",action:"edit"},icon:"icon-xiazai-wenjianxiazai-05",tip:n(e)("common.export"),"data-cy":"export",onClick:I=>r(o.name)},null,8,["tip","onClick"]),s(O,{permission:{feature:"module",action:"edit"},icon:"icon-link !bg-transparent",tip:n(e)("common.share"),"data-cy":"share",onClick:I=>J(o.id)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data"])):S("",!0),f.value?(i(),p(Te,{key:1,modelValue:f.value,"onUpdate:modelValue":u[2]||(u[2]=o=>f.value=o)},null,8,["modelValue"])):S("",!0),c.value?(i(),p(re,{key:2,modelValue:c.value,"onUpdate:modelValue":u[3]||(u[3]=o=>c.value=o)},null,8,["modelValue"])):S("",!0),a.value?(i(),p(ze,{key:3,id:E.value,modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=o=>a.value=o)},null,8,["id","modelValue"])):S("",!0),k.value?(i(),p(Ge,{key:4,id:E.value,modelValue:k.value,"onUpdate:modelValue":u[5]||(u[5]=o=>k.value=o)},null,8,["id","modelValue"])):S("",!0),s(ne,{modelValue:b.value,"onUpdate:modelValue":u[6]||(u[6]=o=>b.value=o),width:"1000px","close-on-click-modal":!1,"custom-class":"el-dialog--zero-padding",title:n(e)("common.manage"),onClosed:u[7]||(u[7]=o=>b.value=!1)},{default:d(()=>[w("iframe",{src:n(y),class:"w-full h-500px"},null,8,Ye)]),_:1},8,["modelValue","title"]),s(Ie,{ref_key:"searchDialog",ref:g,module:"module",onReload:W},null,512)])}}});export{Zt as default};
