import{M as A}from"./media-dialog.31d6c41c.js";import"./validate.238a9986.js";import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.53a9e945.js";import{g as M,w as I}from"./i18n.bcd18f8a.js";import{u as P}from"./index.b8a66e09.js";import{u as H,i as X}from"./main.582f9de6.js";import{d as F,c as $,o as r,a as g,r as E,f as y,k as b,aH as R,t as z,u as n,n as Y,c0 as L,b as U,w as C,j as x,I as Z,g as W,b7 as q,e as G,F as J,aT as ee}from"./url.8f5ec20c.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import{c as le}from"./use-copy-text.c117d066.js";import{E as oe}from"./index.ec6ad7db.js";import{V as K}from"./vuedraggable.umd.7929a3b6.js";import{E as O}from"./index.aec72f69.js";import{E as ne}from"./windi.19264205.js";import{c as ie}from"./cloneDeep.060340c1.js";const se={class:"hidden absolute top-8 right-8"},ae={class:"h-20px flex items-center space-x-8 dark:text-fff/50 text-14px text-666"},re={class:"w-full flex-1 rounded-4px overflow-hidden"},ue=["src","alt","title"],ce={class:"ellipsis text-s text-444 dark:text-fff/60 h-32 leading-32px text-center","data-cy":"file-name"},me=F({props:{src:null,name:null,selected:{type:Boolean},alt:null,title:null},setup(o){const c=o;function i(t){const d=t.split("/");return d[d.length-1]}const s=$(()=>c.name||i(c.src));return(t,d)=>(r(),g("div",{class:Y(["file-item relative rounded-4px w-full h-161px px-32 pt-32 mb-12 hover:bg-[#E9EAF0] dark:hover:bg-444 flex flex-col",{"bg-[#E9EAF0] dark:bg-444":o.selected}])},[E(t.$slots,"checkbox",{},void 0,!0),y("div",se,[y("div",ae,[E(t.$slots,"actions",{},void 0,!0)])]),y("div",re,[E(t.$slots,"thumbnail",{},()=>[o.src?(r(),g("img",{key:0,class:"select-none w-full h-full object-contain dark:text-fff/60",src:o.src,"data-cy":"thumbnail",alt:o.alt,title:o.title},null,8,ue)):b("",!0)],!0)]),y("div",ce,[E(t.$slots,"file-name",{},()=>[R(z(n(s)),1)],!0)])],2))}});var de=te(me,[["__scopeId","data-v-1c83c02c"]]);const pe={key:0,class:"rounded-4px w-161px h-161px mr-32 mb-24"},N=F({props:{url:null,advanced:{type:Boolean}},emits:["remove","edit"],setup(o,{emit:c}){const i=o,{t:s}=M(),t=H(),d=$(()=>L(t.site.prUrl,i.url+""));return(V,m)=>{const k=oe;return o.url?(r(),g("div",pe,[U(de,{src:n(d),advanced:o.advanced},{actions:C(()=>[U(k,{placement:"top","show-after":300,content:n(s)("common.copyUrl")},{default:C(()=>[y("span",{class:"iconfont icon-copy cursor-pointer hover:text-blue","data-cy":"copy-in-grid",onClick:m[0]||(m[0]=I(_=>n(le)(n(L)(n(t).site.baseUrl,o.url)),["stop"]))})]),_:1},8,["content"]),o.advanced?(r(),x(k,{key:0,placement:"top","show-after":300,content:n(s)("common.editCommonName",{name:n(s)("common.meta")})},{default:C(()=>[y("span",{class:"iconfont icon-a-writein cursor-pointer hover:text-blue","data-cy":"edit",onClick:m[1]||(m[1]=I(_=>c("edit"),["stop"]))})]),_:1},8,["content"])):b("",!0),U(k,{placement:"top","show-after":300,content:n(s)("common.delete")},{default:C(()=>[y("span",{class:"iconfont icon-delete cursor-pointer hover:text-orange","data-cy":"remove",onClick:m[2]||(m[2]=I(_=>c("remove"),["stop"]))})]),_:1},8,["content"])]),_:1},8,["src","advanced"])])):b("",!0)}}});function Q(o,c){return{onChange(i){if(typeof c!="function")return;const s=ie(Z(o.value));i.moved?(s.splice(i.moved.oldIndex,1),s.splice(i.moved.newIndex,0,i.moved.element)):i.added?s.splice(i.added.newIndex,0,i.added.element):i.removed&&s.splice(i.removed.oldIndex,1),c(s)}}}const fe={class:"select-media-file"},ve={key:0},ye={class:"flex items-center"},he={key:0,class:"ml-8px text-s text-666","data-cy":"tooltip-right"},je=F({props:{multiple:{type:Boolean},modelValue:null,placeholder:null,validations:null},emits:["update:modelValue"],setup(o,{emit:c}){const i=o,{t:s}=M(),t=P(i,"modelValue",c),d=$(()=>t.value.map(l=>({key:l,value:l}))),{onChange:V}=Q(d,l=>{t.value=l.map(e=>e.value)}),m=W(!1),k=$(()=>{var l,e;return(e=(l=i.validations)==null?void 0:l.find(a=>a.type==="fileSize"))!=null?e:void 0}),_=$(()=>{var h;const l=(h=k.value)!=null?h:{value:0,pattern:"kb"},{value:e,pattern:a}=l;return!e||!["kb","mb"].includes(a!=null?a:"")?0:a==="kb"?e*1024:a==="mb"?e*1024*1024:0}),f=$(()=>{var l,e;return(e=(l=i.validations)==null?void 0:l.find(a=>a.type==="fileTypes"))!=null?e:void 0}),p=$(()=>{var a;const{pattern:l}=(a=f.value)!=null?a:{pattern:""};return l?(Array.isArray(l)?l:l.split(",")).map(h=>{const u=h.trim().toLowerCase();return u.startsWith(".")?u:`.${u}`}):[]});function S(l,e){var a,h;if(p.value.length>0&&!p.value.some(u=>l.url.toLowerCase().endsWith(u.toLowerCase()))){if(!e.fileTypesTitle){const{msg:u}=(a=f.value)!=null?a:{msg:""};u?e.fileTypesTitle=u.replace("{types}",p.value.join(", ")):e.fileTypesTitle=s("common.fileTypesNotAllowed",{types:p.value.join(", ")})}return e.fileTypes||(e.fileTypes=[]),e.fileTypes.push(l.name),!1}if(_.value&&l.size>_.value){if(!e.fileSizeTitle){const{value:u,pattern:w,msg:v}=(h=k.value)!=null?h:{value:0,pattern:"kb"};v?e.fileSizeTitle=v.replace("{size}",`${u}${w}`.toUpperCase()):e.fileSizeTitle=s("common.fileSizeExceedLimitTips",{size:`${u}${w}`.toUpperCase()})}return e.fileSize||(e.fileSize=[]),e.fileSize.push(l.name),!1}return!0}function B(l){var h,u,w;const e={},a=[];if(i.multiple){const v=[];for(const D of l)S(D,e)&&v.push(D.url);t.value=((h=t.value)!=null?h:[]).concat(v)}else S(l[0],e)&&(t.value=l[0].url);if((u=e.fileTypes)!=null&&u.length&&(a.push(e.fileTypesTitle),a.push(`<ul class="max-w-504px">${e.fileTypes.map(v=>`<li><p class="ellipsis">${v}</p></li>`).join("")}</ul>`)),(w=e.fileSize)!=null&&w.length&&(a.push(e.fileSizeTitle),a.push(`<ul class="max-w-504px">${e.fileSize.map(v=>`<li><p class="ellipsis">${v}</p></li>`).join("")}</ul>`)),a.length>0){const v=a.join("<br/>");X(v,!0,{dangerouslyUseHTMLString:!0})}}function T(l){l===void 0?t.value="":t.value.splice(l,1)}return(l,e)=>{const a=O,h=q("hasPermission");return r(),g(J,null,[y("div",fe,[n(t)?(r(),g("div",ve,[o.multiple?(r(),x(n(K),{key:0,"model-value":n(d),"item-key":"key",disabled:n(d).length<2,class:"flex items-center flex-wrap",onChange:n(V)},{item:C(({element:u,index:w})=>[(r(),x(N,{key:w,tooltip:n(d).length<2?void 0:n(s)("common.dragToSort"),url:u.value,onRemove:v=>T(w)},null,8,["tooltip","url","onRemove"]))]),_:1},8,["model-value","disabled","onChange"])):(r(),x(N,{key:1,url:n(t),onRemove:e[0]||(e[0]=u=>T())},null,8,["url"]))])):b("",!0),y("div",ye,[G((r(),x(a,{type:"primary",round:"",onClick:e[1]||(e[1]=u=>m.value=!0)},{default:C(()=>[R(z(n(s)("common.selectFile")),1)]),_:1})),[[h,{feature:"content",action:"edit"}]]),o.placeholder?(r(),g("div",he,z(o.placeholder),1)):b("",!0)])]),m.value?(r(),x(n(A),{key:0,modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=u=>m.value=u),multiple:o.multiple,onChoose:B},null,8,["modelValue","multiple"])):b("",!0)],64)}}}),xe={class:"mb-8 mr-32"},ge=["title","href"],j=F({props:{url:null,tooltip:null},emits:["remove"],setup(o,{emit:c}){const i=o,s=H(),t=$(()=>L(s.site.baseUrl,i.url));return(d,V)=>{const m=ne;return r(),g("div",xe,[y("a",{title:o.tooltip,href:n(t),target:"_blank",class:"break-all inline-flex leading-normal","data-cy":"preview-url"},z(o.url),9,ge),y("a",{class:"cursor-pointer ml-8",onClick:V[0]||(V[0]=k=>c("remove"))},[U(m,{class:"text-orange iconfont icon-delete"})])])}}}),ke=F({props:{modelValue:{type:Boolean}},setup(o){const c=o;return(i,s)=>c.modelValue?(r(),x(n(A),ee({key:0,modelValue:c.modelValue,"onUpdate:modelValue":s[0]||(s[0]=t=>c.modelValue=t),"folder-type":"File"},i.$attrs),null,16,["modelValue"])):b("",!0)}}),$e={class:"select-media-file"},be={key:0},_e={class:"flex items-center"},Te={key:0,class:"ml-8px text-s text-666","data-cy":"tooltip-right"},Ae=F({props:{multiple:{type:Boolean},modelValue:null,placeholder:null},emits:["update:modelValue"],setup(o,{emit:c}){const i=o,{t:s}=M(),t=P(i,"modelValue",c),d=$(()=>t.value.map(f=>({key:f,value:f}))),{onChange:V}=Q(d,f=>{t.value=f.map(p=>p.value)}),m=W(!1);function k(f){var p;i.multiple?t.value=((p=t.value)!=null?p:[]).concat(f.map(S=>S.url)):t.value=f[0].url}function _(f){f===void 0?t.value="":t.value.splice(f,1)}return(f,p)=>{const S=O,B=q("hasPermission");return r(),g(J,null,[y("div",$e,[n(t)?(r(),g("div",be,[o.multiple?(r(),x(n(K),{key:0,"model-value":n(d),"item-key":"key",disabled:n(d).length<2,class:"flex items-center flex-wrap",onChange:n(V)},{item:C(({element:T,index:l})=>[(r(),x(j,{key:l,tooltip:n(d).length<2?void 0:n(s)("common.dragToSort"),url:T.value,onRemove:e=>_(l)},null,8,["tooltip","url","onRemove"]))]),_:1},8,["model-value","disabled","onChange"])):(r(),x(j,{key:1,url:n(t),onRemove:p[0]||(p[0]=T=>_())},null,8,["url"]))])):b("",!0),y("div",_e,[G((r(),x(S,{type:"primary",round:"",onClick:p[1]||(p[1]=T=>m.value=!0)},{default:C(()=>[R(z(n(s)("common.selectFile")),1)]),_:1})),[[B,{feature:"content",action:"edit"}]]),o.placeholder?(r(),g("div",Te,z(o.placeholder),1)):b("",!0)])]),U(ke,{modelValue:m.value,"onUpdate:modelValue":p[2]||(p[2]=T=>m.value=T),multiple:o.multiple,onChoose:k},null,8,["modelValue","multiple"])],64)}}});export{N as _,je as a,Ae as b,Q as u};
