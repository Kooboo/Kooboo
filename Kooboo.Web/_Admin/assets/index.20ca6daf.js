var z=(D,f,y)=>new Promise((d,w)=>{var c=V=>{try{k(y.next(V))}catch(I){w(I)}},T=V=>{try{k(y.throw(V))}catch(I){w(I)}},k=V=>V.done?d(V.value):Promise.resolve(V.value).then(c,T);k((y=y.apply(D,f)).next())});import{_ as se}from"./icon-button.3313e42d.js";import{_ as ie}from"./k-table.d4486972.js";import{i as re,p as ue,g as me,d as ce}from"./content-folder.151b44e9.js";import{u as W}from"./replace-all.7cf5f327.js";import{g as j,w as Y,o as pe}from"./i18n.48bd28ac.js";import{u as fe}from"./use-operation-dialog.f0f37a10.js";import{g as ve,a as _e}from"./content-type.a6f9cfbe.js";import{a as H,s as ye,r as be,l as ge,i as Ve}from"./validate.efc4a5c0.js";import{E as Z,a as ee,c as Ce}from"./index.0d2684bf.js";import{E as le,a as oe}from"./index.6855d037.js";import{E as te}from"./index.fc90f5ad.js";import{E as ke}from"./index.77edae39.js";import{E as ae}from"./windi.a5b0b048.js";import{E as ne}from"./index.2bc50276.js";import{d as G,g as F,c as J,i as M,o as r,j as g,w as o,b as e,a as N,b6 as B,F as q,u as l,aH as K,t as R,f as S,k as $,G as we,M as he,h as xe,N as Ee,b7 as Te,e as Fe}from"./url.2e6a77c4.js";import{_ as Ie}from"./index.a731e53b.js";import{E as de}from"./index.cbddf8eb.js";import{E as Ue,a as Ne}from"./index.6a6b77f3.js";import{E as Se,a as De}from"./index.be352e91.js";import{E as Re}from"./index.c4e9b529.js";import{_ as $e}from"./relations-tag.a09361ff.js";import{B as Ae}from"./breadcrumb.80c136b8.js";import{b as Be}from"./confirm.e2c924ff.js";import{u as qe}from"./main.ea42d807.js";import{E as Le,a as ze,b as Me}from"./index.f5a869bb.js";import{E as Pe}from"./index.b494e80e.js";import{E as He}from"./index.379e80ad.js";import{c as X}from"./cloneDeep.ff43c1f8.js";import"./index.8262f5ef.js";import"./index.fcc3ea42.js";import"./sortable.esm.a99254e8.js";import"./index.7034978e.js";import"./isEqual.f1ae9fb3.js";import"./_baseIsEqual.c0d7e77a.js";import"./error.7e8331f1.js";import"./index.695d0284.js";import"./event.776e7e11.js";import"./index.ff0264f3.js";import"./index.d75a71d9.js";import"./index.aba77680.js";import"./index.6d45a031.js";import"./index.31f26a0f.js";import"./index.60af85f4.js";import"./style.19d0c187.js";import"./toNumber.574be4f1.js";import"./index.a439b087.js";import"./scroll.f51de5d8.js";import"./debounce.61c67278.js";import"./index.064c7de9.js";import"./validator.e2869aba.js";import"./_baseClone.adbc92f5.js";import"./isNil.98bb3b88.js";import"./index.603c1365.js";import"./focus-trap.23f44899.js";import"./refs.4001ce17.js";import"./page.831d1a45.js";import"./index.99c4f65d.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./guid.c1a40312.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./dropdown.0507a1c7.js";const Ke={class:"flex-1 text-right"},Oe={class:"w-full"},je={class:"flex-1 text-right"},Ge={class:"w-full"},Je=G({props:{current:null,folders:null},setup(D,{expose:f}){const y=D,{t:d}=j(),w=F(),c=F({}),T=J(()=>y.folders.filter(n=>!c.value.category.some(v=>v.folderId===n.id)&&!c.value.embedded.some(v=>v.folderId===n.id)).map(n=>n.id)),k=[H(d("common.fieldRequiredTips")),ye(),{asyncValidator(C,n,v){c.value.category.concat(c.value.embedded).filter(s=>s.alias.toLowerCase()===n.toLowerCase()).length>=2?v(Error(d("common.valueHasBeenTakenTips"))):v()},trigger:"blur"}];M(()=>y.current,C=>{c.value=C,c.value.category.forEach(n=>n.oldMultiple=n.multiple)},{immediate:!0});function V(C){return y.folders.filter(n=>!n.isContent&&(n.id===C||T.value.includes(n.id)))}function I(C){c.value.category.splice(C,1)}function A(){c.value.category.push({folderId:T.value[0],alias:"",multiple:!1})}function t(C){c.value.embedded.splice(C,1)}function L(){c.value.embedded.push({folderId:T.value[0],alias:""})}return f({form:w}),(C,n)=>{const v=Z,h=ee,s=le,a=te,U=ke,b=ae,x=ne,_=oe;return r(),g(_,{ref_key:"form",ref:w,model:c.value,"label-position":"top",class:"el-form--label-normal",onSubmit:n[2]||(n[2]=Y(()=>{},["prevent"]))},{default:o(()=>[e(s,{label:l(d)("common.categoryFolders")},{default:o(()=>[(r(!0),N(q,null,B(c.value.category,(u,E)=>(r(),N("div",{key:E,class:"flex items-center space-x-4 mb-16"},[e(s,null,{default:o(()=>[e(h,{modelValue:u.folderId,"onUpdate:modelValue":m=>u.folderId=m,"data-cy":"category-folder-dropdown"},{default:o(()=>[(r(!0),N(q,null,B(V(u.folderId),m=>(r(),g(v,{key:m.id,label:m.displayName,value:m.id,"data-cy":"category-folder-opt"},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(s,{rules:k,prop:"category."+E+".alias"},{default:o(()=>[e(a,{modelValue:u.alias,"onUpdate:modelValue":m=>u.alias=m,placeholder:l(d)("common.alias"),class:"w-150px","data-cy":"category-folder-alias"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(s,{prop:"category."+E+".display"},{default:o(()=>[e(a,{modelValue:u.display,"onUpdate:modelValue":m=>u.display=m,placeholder:l(d)("common.displayName"),class:"w-150px"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(U,{modelValue:u.multiple,"onUpdate:modelValue":m=>u.multiple=m,disabled:u.oldMultiple,"data-cy":"multiple"},{default:o(()=>[K(R(l(d)("common.multiple")),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),S("div",Ke,[e(x,{circle:"","data-cy":"remove-category-folder",onClick:m=>I(E)},{default:o(()=>[e(b,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),S("div",Oe,[l(T).length?(r(),g(x,{key:0,circle:"","data-cy":"add-category-folder",onClick:n[0]||(n[0]=u=>A())},{default:o(()=>[e(b,{class:"iconfont icon-a-addto text-blue"})]),_:1})):$("",!0)])]),_:1},8,["label"]),e(s,{label:l(d)("common.embeddedFolders")},{default:o(()=>[(r(!0),N(q,null,B(c.value.embedded,(u,E)=>(r(),N("div",{key:E,class:"flex items-center space-x-4 mb-16"},[e(s,null,{default:o(()=>[e(h,{modelValue:u.folderId,"onUpdate:modelValue":m=>u.folderId=m,class:"w-full","data-cy":"embedded-folder-dropdown"},{default:o(()=>[(r(!0),N(q,null,B(V(u.folderId),m=>(r(),g(v,{key:m.id,label:m.displayName,value:m.id,"data-cy":"embedded-folder-opt"},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(s,{rules:k,prop:"embedded."+E+".alias"},{default:o(()=>[e(a,{modelValue:u.alias,"onUpdate:modelValue":m=>u.alias=m,placeholder:l(d)("common.alias"),"data-cy":"embedded-folder-alias"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),e(s,{prop:"embedded."+E+".display"},{default:o(()=>[e(a,{modelValue:u.display,"onUpdate:modelValue":m=>u.display=m,placeholder:l(d)("common.displayName")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["prop"]),S("div",je,[e(x,{circle:"","data-cy":"remove-embedded-folder",onClick:m=>t(E)},{default:o(()=>[e(b,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),S("div",Ge,[l(T).length?(r(),g(x,{key:0,circle:"","data-cy":"add-embedded-folder",onClick:n[1]||(n[1]=u=>L())},{default:o(()=>[e(b,{class:"iconfont icon-a-addto text-blue"})]),_:1})):$("",!0)])]),_:1},8,["label"])]),_:1},8,["model"])}}}),Qe=G({props:{modelValue:{type:Boolean},current:null,folders:null,isContent:{type:Boolean}},emits:["create-success"],setup(D,{emit:f}){const y=D,{t:d}=j(),{visible:w,handleClose:c}=fe(y,f),T=[{displayName:d("common.basicInfo"),value:"basic"},{displayName:d("common.relationFolders"),value:"relation"}],k=F("basic"),V=F(),I=F(),A=F(),t=F({}),L=J(()=>{const s={name:[H(d("common.fieldRequiredTips")),be(1,50),ge(),Ve(re,d("common.folderNameExistsTips"))],contentTypeId:[H(d("common.fieldRequiredTips"))]};return t.value.sortable&&(s.sortField=[H(d("common.fieldRequiredTips"))]),s}),C=F([]),n=F(!0);M(()=>w.value,s=>{var a,U,b;s&&(v(),(a=I.value)==null||a.resetFields(),(b=(U=A.value)==null?void 0:U.form)==null||b.resetFields(),k.value="basic",y.current?(t.value=y.current,n.value=!1):(n.value=!0,t.value={pageSize:30,category:[],embedded:[]}))}),M(()=>{var s;return(s=t.value)==null?void 0:s.contentTypeId},s=>z(this,null,function*(){if(!s){C.value=[];return}const{properties:a}=yield ve({id:s});C.value=a||[]})),M(()=>t.value.sortable,s=>{var a;s&&!t.value.sortField&&(t.value.sortField=(a=C.value[0])==null?void 0:a.name)}),M(()=>t.value.sortField,s=>{s==="dragAndDrop"&&(t.value.ascending=!1)});function v(){return z(this,null,function*(){var s;(s=V.value)!=null&&s.length||(V.value=yield _e())})}function h(){return z(this,null,function*(){var s,a,U,b,x;try{yield(s=I.value)==null?void 0:s.validate()}catch(_){throw k.value="basic",_}try{yield(U=(a=A.value)==null?void 0:a.form)==null?void 0:U.validate()}catch(_){throw k.value="relation",_}yield ue({id:t.value.id,displayName:t.value.displayName,name:t.value.name,contentTypeId:t.value.contentTypeId,category:(b=t.value.category)==null?void 0:b.map(_=>(_.display=_.display||_.alias,_)),embedded:(x=t.value.embedded)==null?void 0:x.map(_=>(_.display=_.display||_.alias,_)),hidden:t.value.hidden,sortable:t.value.sortable,sortField:t.value.sortable?t.value.sortField:"",ascending:t.value.ascending,pageSize:t.value.pageSize,isContent:y.isContent}),c(),f("create-success")})}return(s,a)=>{const U=te,b=le,x=Z,_=ee,u=de,E=Ue,m=Ne,O=oe,P=Se,p=De,Q=Re;return r(),g(Q,{modelValue:l(w),"onUpdate:modelValue":a[11]||(a[11]=i=>we(w)?w.value=i:null),width:"600px","close-on-click-modal":!1,title:l(d)("common.settings"),"custom-class":"el-dialog--zero-padding",onClose:l(c)},{footer:o(()=>[e(Ie,{permission:{feature:"contentType",action:"edit"},onConfirm:h,onCancel:l(c)},null,8,["onCancel"])]),default:o(()=>[e(p,{modelValue:k.value,"onUpdate:modelValue":a[10]||(a[10]=i=>k.value=i)},{default:o(()=>[e(P,{label:l(T)[0].displayName,name:l(T)[0].value},{default:o(()=>[e(O,{ref_key:"form",ref:I,model:t.value,rules:l(L),"label-position":"top","validate-on-rule-change":!1,onSubmit:a[9]||(a[9]=Y(()=>{},["prevent"])),onKeydown:pe(h,["enter"])},{default:o(()=>[n.value?(r(),g(b,{key:0,prop:"name",label:l(d)("common.name")},{default:o(()=>[e(U,{modelValue:t.value.name,"onUpdate:modelValue":a[0]||(a[0]=i=>t.value.name=i),"data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])):(r(),g(b,{key:1,label:l(d)("common.name")},{default:o(()=>[e(U,{modelValue:t.value.name,"onUpdate:modelValue":a[1]||(a[1]=i=>t.value.name=i),disabled:"","data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])),e(b,{prop:"displayName",label:l(d)("common.displayName")},{default:o(()=>[e(U,{modelValue:t.value.displayName,"onUpdate:modelValue":a[2]||(a[2]=i=>t.value.displayName=i),"data-cy":"display-name"},null,8,["modelValue"])]),_:1},8,["label"]),e(b,{prop:"contentTypeId",label:l(d)("common.contentType")},{default:o(()=>[e(_,{modelValue:t.value.contentTypeId,"onUpdate:modelValue":a[3]||(a[3]=i=>t.value.contentTypeId=i),class:"w-full",disabled:!n.value,"data-cy":"content-type-dropdown"},{default:o(()=>[(r(!0),N(q,null,B(V.value,i=>(r(),g(x,{key:i.id,label:i.name,value:i.id,"data-cy":"content-type-opt"},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),D.isContent?$("",!0):(r(),g(b,{key:2,label:l(d)("common.pageSize")},{default:o(()=>[e(_,{modelValue:t.value.pageSize,"onUpdate:modelValue":a[4]||(a[4]=i=>t.value.pageSize=i)},{default:o(()=>[(r(),N(q,null,B([10,30,50,100],i=>e(x,{key:i,label:i,value:i},null,8,["label","value"])),64)),e(x,{value:999999,label:l(d)("common.disablePaging")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])),D.isContent?$("",!0):(r(),g(b,{key:3,label:l(d)("common.sortable")},{default:o(()=>[e(u,{modelValue:t.value.sortable,"onUpdate:modelValue":a[5]||(a[5]=i=>t.value.sortable=i),disabled:!t.value.contentTypeId},null,8,["modelValue","disabled"])]),_:1},8,["label"])),t.value.sortable?(r(),g(b,{key:4,prop:"sortField",label:l(d)("common.sortField")},{default:o(()=>[e(m,{gutter:20,class:"w-full"},{default:o(()=>[e(E,{span:12},{default:o(()=>[e(_,{modelValue:t.value.sortField,"onUpdate:modelValue":a[6]||(a[6]=i=>t.value.sortField=i)},{default:o(()=>[(r(!0),N(q,null,B(C.value,i=>(r(),g(x,{key:i.name,label:i.displayName,value:i.name,"data-cy":"content-type-opt"},null,8,["label","value"]))),128)),e(x,{value:"dragAndDrop",label:l(d)("common.dragAndDrop")},null,8,["label"])]),_:1},8,["modelValue"])]),_:1}),e(E,{span:12},{default:o(()=>[e(u,{modelValue:t.value.ascending,"onUpdate:modelValue":a[7]||(a[7]=i=>t.value.ascending=i),disabled:t.value.sortField==="dragAndDrop","active-text":l(d)("common.ascending"),"inactive-text":l(d)("common.descending")},null,8,["modelValue","disabled","active-text","inactive-text"])]),_:1})]),_:1})]),_:1},8,["label"])):$("",!0),e(b,{label:l(d)("common.hidden")},{default:o(()=>[e(u,{modelValue:t.value.hidden,"onUpdate:modelValue":a[8]||(a[8]=i=>t.value.hidden=i)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules","onKeydown"])]),_:1},8,["label","name"]),e(P,{label:l(T)[1].displayName,name:l(T)[1].value},{default:o(()=>[e(Je,{ref_key:"relationFolder",ref:A,current:t.value,folders:D.folders},null,8,["current","folders"])]),_:1},8,["label","name"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title","onClose"])}}}),We={class:"p-24"},Xe={class:"flex items-center py-24 space-x-16"},Ye=S("div",{class:"flex-1"},null,-1),Ze={key:0,class:"flex items-center text-s space-x-4 text-999"},el={class:"flex items-center space-x-4"},_o=G({setup(D){const{t:f}=j(),y=qe(),d=F([]),w=F(!1),c=F(),T=he(),k=F(!1),V=F(!1);xe(()=>{I()});function I(){return z(this,null,function*(){const n=yield me();d.value=n.sort((v,h)=>v.displayName<h.displayName?-1:1)})}const A=J(()=>k.value?d.value:d.value.filter(n=>!n.hidden));function t(n){return z(this,null,function*(){yield Be(n.length);const v=n.map(h=>h.id);yield ce({ids:v}),I()})}function L(n){V.value=(n==null?void 0:n.isContent)||!1,y.hasAccess("contentType","edit")&&(w.value=!0,n?c.value=X(n):c.value=void 0)}function C(n){V.value=!0,y.hasAccess("contentType","edit")&&(w.value=!0,n?c.value=X(n):c.value=void 0)}return(n,v)=>{const h=ae,s=ne,a=Le,U=ze,b=Me,x=de,_=Ee("router-link"),u=Pe,E=Ce,m=se,O=He,P=Te("hasPermission");return r(),N("div",We,[e(Ae,{name:l(f)("common.contentFolders")},null,8,["name"]),S("div",Xe,[e(b,{trigger:"click",class:"ml-10px",onCommand:v[0]||(v[0]=p=>p=="multi-content"?L():C())},{dropdown:o(()=>[e(U,null,{default:o(()=>[e(a,{command:"multi-content",disabled:!l(y).hasAccess("contentType","edit"),title:l(y).hasAccess("contentType","edit")?"":l(f)("common.noPermission"),"data-cy":"multi-content"},{default:o(()=>[S("span",null,R(l(f)("common.folder")),1)]),_:1},8,["disabled","title"]),e(a,{command:"single-content",disabled:!l(y).hasAccess("contentType","edit"),title:l(y).hasAccess("contentType","edit")?"":l(f)("common.noPermission"),"data-cy":"single-content"},{default:o(()=>[S("span",null,R(l(f)("common.singleContent")),1)]),_:1},8,["disabled","title"])]),_:1})]),default:o(()=>[Fe((r(),g(s,{round:"","data-cy":"new-folder"},{default:o(()=>[e(h,{class:"iconfont icon-a-addto"}),S("span",null,R(l(f)("common.new")),1),e(h,{class:"iconfont icon-pull-down text-12px ml-8 !mr-0"})]),_:1})),[[P,{feature:"contentType",action:"edit"}]])]),_:1}),Ye,d.value.some(p=>p.hidden)?(r(),N("div",Ze,[S("div",null,R(l(f)("common.showAll")),1),e(x,{modelValue:k.value,"onUpdate:modelValue":v[1]||(v[1]=p=>k.value=p)},null,8,["modelValue"])])):$("",!0)]),e(l(ie),{data:l(A),"show-check":"",permission:{feature:"contentType",action:"edit"},onDelete:t},{default:o(()=>[e(u,{label:l(f)("common.name")},{default:o(({row:p})=>[S("div",el,[e(_,{class:"ellipsis text-blue cursor-pointer",to:l(W)({name:p.isContent?"content":"textcontentsbyfolder",query:{folder:p.id,id:p.defaultContentId,isContent:p.isContent}}),"data-cy":"name"},{default:o(()=>[K(R(p.displayName),1)]),_:2},1032,["to"]),p.hidden?(r(),g(h,{key:0,class:"text-20px iconfont icon-yincang-px- text-999/60"})):$("",!0)])]),_:1},8,["label"]),e(u,{label:l(f)("common.usedBy")},{default:o(({row:p})=>[e($e,{id:p.id,relations:p.relations,type:"ContentFolder"},null,8,["id","relations"])]),_:1},8,["label"]),e(u,{label:l(f)("common.type"),width:"140",align:"center"},{default:o(({row:p})=>[p.isContent?(r(),g(E,{key:0,type:"success",round:""},{default:o(()=>[K(R(l(f)("common.singleContent")),1)]),_:1})):(r(),g(E,{key:1,type:"warning",round:""},{default:o(()=>[K(R(l(f)("common.folder")),1)]),_:1}))]),_:1},8,["label"]),e(u,{width:"150",align:"right"},{default:o(({row:p})=>[p.type!=="RichText"?(r(),g(m,{key:0,permission:{feature:"contentType",action:"edit"},icon:"icon-a-setup",tip:l(f)("common.folderSetting"),"data-cy":"setting",onClick:Q=>L(p)},null,8,["tip","onClick"])):$("",!0),l(y).hasAccess("contentType","edit")?(r(),g(_,{key:1,to:l(W)({name:"contenttype",query:{id:p.contentTypeId,fromRouter:l(T).name}}),"data-cy":"edit-content-type",class:"mx-8"},{default:o(()=>[e(O,{placement:"top",content:l(f)("common.editContentType")},{default:o(()=>[e(h,{class:"iconfont icon-a-writein"})]),_:1},8,["content"])]),_:2},1032,["to"])):(r(),g(m,{key:2,permission:{feature:"contentType",action:"edit"},icon:"icon-a-writein",tip:l(f)("common.editContentType")},null,8,["tip"]))]),_:1})]),_:1},8,["data"]),e(Qe,{modelValue:w.value,"onUpdate:modelValue":v[2]||(v[2]=p=>w.value=p),current:c.value,folders:d.value,"is-content":V.value,onCreateSuccess:I},null,8,["modelValue","current","folders","is-content"])])}}});export{_o as default};
