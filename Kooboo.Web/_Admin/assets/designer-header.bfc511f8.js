var Pe=Object.defineProperty,Te=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var de=(e,t,n)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,me=(e,t)=>{for(var n in t||(t={}))He.call(t,n)&&de(e,n,t[n]);if(ue)for(var n of ue(t))Le.call(t,n)&&de(e,n,t[n]);return e},fe=(e,t)=>Te(e,Ne(t));var w=(e,t,n)=>new Promise((o,a)=>{var s=u=>{try{r(n.next(u))}catch(m){a(m)}},l=u=>{try{r(n.throw(u))}catch(m){a(m)}},r=u=>u.done?o(u.value):Promise.resolve(u.value).then(s,l);r((n=n.apply(e,t)).next())});import{_ as qe}from"./index.051a5017.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import{al as Fe,E as Ge}from"./windi.a5b0b048.js";import{bq as pe,g as p,c as M,I as Oe,d as $,h as F,i as te,o as d,a as _,e as Ae,m as we,u as c,j as g,k,K as be,f as v,n as Je,t as N,w as y,b,b6 as j,F as D,b3 as Ke,b1 as Qe,aW as Xe,aH as ke,G as Ye,r as X,b2 as ve,J as Ze,aF as et}from"./url.2e6a77c4.js";import{_ as tt}from"./index.66d5d547.js";import{V as $e}from"./vuedraggable.umd.5840ebc7.js";import{c as S}from"./cloneDeep.ff43c1f8.js";import{h as nt,p as L,b as ot,e as G,j as ne,a as at,i as st,k as ge,l as lt,m as ct}from"./index.4fa52eca.js";import{d as it,g as O}from"./i18n.48bd28ac.js";import{a as rt,_ as _e,r as ut}from"./renderer.cbda5f2c.js";import{d as dt}from"./debounce.61c67278.js";import{E as mt,a as ft}from"./index.aa73e4df.js";import{E as pt}from"./index.379e80ad.js";import{a as vt}from"./string.955a924b.js";import{E as gt,a as _t}from"./index.695d0284.js";import{E as xt}from"./index.a439b087.js";import{p as yt,q as ht,o as wt}from"./style.19d0c187.js";import{e as bt}from"./guid.c1a40312.js";import{i as xe}from"./isEmpty.dc565ae5.js";import{E as kt}from"./index.2bc50276.js";import{r as $t,a as Ct,i as It}from"./validate.efc4a5c0.js";import{s as Et}from"./dev-mode.c4133b5a.js";import{E as St}from"./index.fc90f5ad.js";import{E as Vt,a as Wt}from"./index.6855d037.js";function Mt(e,t,n,o){return e==null?[]:(pe(t)||(t=t==null?[]:[t]),n=o?void 0:n,pe(n)||(n=n==null?[]:[n]),yt(e,t,n))}function z(e,t){const n=document.querySelector(t!=null?t:"#ve-iframe");if(!n)throw"Iframe not found";n.contentWindow.postMessage(S(e),"*")}function Dt(e){var n;const t={type:"in-update-dom",group:(n=e.group)!=null?n:"",context:e};z(t)}function Ce(){z({type:"in-reset-drag",context:void 0})}function Ie(e){var o,a;const t=(a=(o=e.item)==null?void 0:o.__draggable_context)==null?void 0:a.element;z({type:"in-dragging-item",context:t})}const H={},ye="ve-";function oe(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(H[t]||(H[t]=new Set),H[t].add(e[t]))}function Rt(){ht(window,"message",Ee)}function Bt(){wt(window,"message",Ee)}const Ee=e=>{const n=e.data,o=n==null?void 0:n.type;if(!(o!=null&&o.startsWith(ye)))return;const a=o.substring(ye.length),s=H[a];!s||s.forEach(l=>{typeof l=="function"&&l(n,e)})};function Se(){return{children:[],htmlStr:"",id:bt,name:"page",props:{},propDefines:[],type:"page"}}const Y=p({baseUrl:"/",classic:!1}),ae=p(Se()),se=p(),le=p(),Ve=p(""),We=p(),Me=p();function De(e,t){return w(this,null,function*(){var o;if(xe(e))return e;const n=[];for(const a of e){if(xe(a.children)||(a.children=yield De(a.children,t)),!ot(a)){a.htmlStr=yield L(a,t),n.push(a);continue}const s=(o=se.value)==null?void 0:o.find(l=>l.meta.type===a.type&&l.meta.name===a.name);!s||(a.propDefines=s.meta.propDefines,a.htmlStr=yield L(a,t),n.push(a))}return n})}function zt(e,t){return w(this,null,function*(){var o;e=e!=null?e:Se(),Y.value=fe(me({},t.renderContext),{rootMeta:e});const n=Mt(S((o=t.customWidgets)!=null?o:[]),[a=>{var s,l;return(l=(s=a.meta)==null?void 0:s.type)==null?void 0:l.toLowerCase()},a=>a.name.toLowerCase()],["asc","asc"]);se.value=n,e.children=yield De(e.children,Y.value),Re(e)})}function Re(e){ae.value=S(e)}function Ut(e,t,n){le.value=e!=null?e:void 0,Ve.value=t!=null?t:"",Me.value=e==null?void 0:e.id,We.value=n}function jt(e){return w(this,null,function*(){const t=le.value;if(t){const[n]=nt(ae.value,o=>o.id===t.id);n&&(n.props=t.props,n.htmlStr=yield L(t,e))}})}function A(){return{renderContext:Y,rootMeta:ae,customWidgets:se,activeContext:We,activeWidget:le,activeGroup:Ve,activeId:Me,flushData:jt,init:zt,updateRootMeta:Re,selectWidget:Ut}}const{widgets:Pt}=ne(),{rootMeta:J,activeId:Tt,selectWidget:Be,updateRootMeta:ze}=A(),{t:W}=it.global,P=p([{name:"full",size:void 0,display:W("common.fullScreen")},{name:"pad",size:820,display:W("common.pad")},{name:"phone",size:390,display:W("inlineDesign.phone")}]),K=p();M(()=>{var e,t;return(t=(e=K.value)==null?void 0:e.element)==null?void 0:t.contentDocument});M(()=>{var e,t;return(t=(e=K.value)==null?void 0:e.element)==null?void 0:t.contentWindow});function B(){Be(null),z({type:"in-reset-holder",group:"",context:""})}const T=p(P.value[0]),Nt=e=>{var t;return(t=P.value.find(n=>n.name==e))!=null?t:P.value[0]},Ue=e=>{T.value=Nt(e),B()};function je(e,t,n,o,a){if(!at(t)){if(st(t)){const s=e.findIndex(l=>l.id===t.id);if(s>-1){const l=ge(t);o({index:s,clonedItem:l,list:e})}return}if(!n){console.warn(["activeContext undefined"]);return}if(!n.columnId){console.warn(["column undefined",n]);return}for(const s of e)if(s.id===n.rowId)for(const l of s.children){if(l.id!==n.columnId)continue;const r=l.children;if(!r){console.warn(["widgets is null",n]);return}const u=r.findIndex(m=>m.id===t.id);if(u>-1){const m=ge(t);a({index:u,clonedItem:m,list:r})}}}}function Ht(e,t,n){T.value=P.value[0];const o={"common.copy":W("common.copy"),"common.delete":W("common.delete"),column:W("ve.column"),row:W("ve.row"),"ve.dragItHere":W("ve.dragItHere")};Pt.value.forEach(a=>{o[a.id]=a.name}),K.value.element.contentWindow.loadDesign(e,t,n!=null?n:"",o)}const Lt=e=>{ze(e.item)},qt=e=>{var n;const t=G(J.value,(n=e.group)!=null?n:"");t.children=e.item},Ft=e=>{var n;const t=e.item;Be((n=t.meta)!=null?n:null,t.group,t.context)},Gt=e=>{const t=e.item;if(!t.meta)return;const n=t.group,a=G(J.value,n||"").children;je(a,t.meta,t.context,({index:s,clonedItem:l,list:r})=>{r.splice(s+1,0,l),q(a,n)},({index:s,clonedItem:l,list:r})=>{r.splice(s+1,0,l),q(a,n)})},Ot=e=>{const t=e.item;if(!t.meta)return;const n=t.meta,o=t.group,s=G(J.value,o||"").children;je(s,t.meta,t.context,({index:l,list:r})=>{r.splice(l,1),q(s,o)},({index:l,list:r})=>{r.splice(l,1),q(s,o)}),n.id===Tt.value&&B()};function q(e,t){const n=S(Oe(J.value)),o=G(n,t||"");o.children=e,ze(n);const a={type:"in-sync",group:t!=null?t:"",context:n};z(a)}function At(){oe({sync:Lt,init:qt,select:Ft,layout:B,copy:Gt,delete:Ot,["switch-tab"]:B})}const Jt={class:"w-full h-full my-0 ve-content-wrapper"},Kt=$({props:{content:null,loaded:{type:Boolean},size:null,pageStyles:null,renderContext:null},setup(e){const t=e,{rootMeta:n}=A(),o=p(!0);F(()=>{At(),t.size&&Ue(t.size)});function a(){o.value=!1,be(()=>{Ht(n.value,t.renderContext,t.pageStyles)})}const s=M(()=>{if(!!T.value.size)return`${T.value.size}px`});return te(()=>t.pageStyles,l=>{z({type:"in-page-style",context:{meta:n.value,cssText:l},group:""})}),(l,r)=>{const u=Fe;return d(),_("div",Jt,[Ae((d(),_("div",{class:"mx-auto h-full",style:we({width:c(s),marginBottom:"20px",backgroundColor:"#ffffff"})},[e.loaded&&e.content&&c(n)?(d(),g(qe,{key:0,id:"ve-iframe",ref:m=>K.value=m,"base-url":e.renderContext.baseUrl,content:e.content,height:"500px",onLoad:a},null,8,["base-url","content"])):k("",!0)],4)),[[u,o.value||!e.loaded]])])}}});var Qt=ee(Kt,[["__scopeId","data-v-545d8f2e"]]);const Xt=["title"],Yt={class:"w-10 h-10"},Zt={class:"w-full truncate text-center text-bold text-xs px-2 leading-[1.2em]"},en=$({props:{name:null,tooltip:null,icon:null},setup(e){return(t,n)=>{const o=Ge;return d(),_("div",{class:"h-[128px] mt-3 ml-12 dark:bg-444 bg-fff border border-999 py-5 flex flex-col justify-between items-center text-[#6b7280] text-[12px] font-bold hover:shadow-444 cursor-move",style:{width:"28%"},title:e.tooltip},[v("div",Yt,[e.icon?(d(),g(o,{key:0,class:Je(["iconfont w-full h-full text-44px text-[#505659]",e.icon])},null,8,["class"])):k("",!0)]),v("div",Zt,N(e.name),1)],8,Xt)}}}),he=$({props:{items:null},setup(e){function t(n,o){const a=S(o.__draggable_context.element);a.meta.id=void 0,n.setData("application/json",JSON.stringify(a.meta))}return(n,o)=>{var a;return(a=e.items)!=null&&a.length?(d(),g(c($e),{key:0,"item-key":"id",list:e.items,class:"ml-8 text-center w-full h-full flex flex-wrap justify-start overflow-y-auto overflow-x-hidden items-start",group:{name:"component",pull:"clone",put:!1},sort:!1,"set-data":t,onStart:c(Ie),onEnd:c(Ce)},{item:y(({element:{name:s,icon:l,tooltip:r,id:u}})=>[b(en,{"data-type":u,name:s,icon:l,tooltip:r},null,8,["data-type","name","icon","tooltip"])]),_:1},8,["list","onStart","onEnd"])):k("",!0)}}});const tn=["title"],nn={class:"w-full h-full flex justify-between my-8"},on={class:"w-full text-center text-bold text-xs mb-12"},an=$({setup(e){const{widgets:t}=lt();function n(o,a){const s=S(a.__draggable_context.element);s.meta.id=void 0,o.setData("application/json",JSON.stringify(s.meta))}return(o,a)=>(d(),g(c($e),{class:"mx-8 text-center w-full h-full flex flex-wrap justify-start overflow-y-auto overflow-x-hidden items-start",list:c(t),"item-key":"id",group:{name:"rows",pull:"clone",put:!1},sort:!1,"set-data":n,onStart:c(Ie),onEnd:c(Ce)},{item:y(({element:{meta:{name:s,children:l}}})=>[v("div",{class:"w-full mx-12 h-[80px] mt-3 dark:bg-444 bg-fff border border-999 flex flex-col justify-between items-center text-[#6b7280] text-[12px] font-bold hover:shadow-444 cursor-move",title:s},[v("div",nn,[(d(!0),_(D,null,j(l,(r,u)=>(d(),_("div",{key:u,class:"mx-8 ve-column h-full text-center",style:we({width:`${r.props.widthPercent}%`})}," \xA0 ",4))),128))]),v("div",on,N(s),1)],8,tn)]),_:1},8,["list","onStart","onEnd"]))}});var sn=ee(an,[["__scopeId","data-v-596f8621"]]);const ln=$({props:{meta:null,renderContext:null},emits:["changed"],setup(e,{expose:t,emit:n}){const o=e,{widgets:a}=ne(),s=p(),l=p(),r=p(),{t:u}=O(),m=ct(),{model:x,containerFields:h,fields:C,rules:V}=rt(o.meta,m);F(()=>{C.value.length?s.value="basic":h.value.length?s.value="container":s.value=void 0}),function(){const i=a.value.find(f=>f.id===o.meta.type);typeof(i==null?void 0:i.init)=="function"&&i.init(x)}(),te(()=>x.value,dt(function(i){return w(this,null,function*(){let f=S(i);o.meta.props=f,o.meta.htmlStr=yield L(o.meta,o.renderContext),n("changed",f)})},300),{deep:!0});function U(){return w(this,null,function*(){var i,f;yield(i=l.value)==null?void 0:i.validate(),yield(f=r.value)==null?void 0:f.validate(),o.meta.props=S(x.value)})}return t({validate:U}),(i,f)=>{const E=mt,R=ft;return d(),g(R,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=Q=>s.value=Q)},{default:y(()=>[c(C).length?(d(),g(E,{key:0,name:"basic",title:c(u)("common.basic")},{default:y(()=>[b(_e,{ref_key:"fieldsRef",ref:l,model:c(x),fields:c(C),rules:c(V)},null,8,["model","fields","rules"])]),_:1},8,["title"])):k("",!0),["spacer"].includes(e.meta.type)?k("",!0):(d(),g(E,{key:1,name:"container",title:c(u)("ve.containerStyles")},{default:y(()=>[b(_e,{ref_key:"containerRef",ref:r,model:c(x),fields:c(h),rules:c(V)},null,8,["model","fields","rules"])]),_:1},8,["title"]))]),_:1},8,["modelValue"])}}});const cn=e=>(Ke("data-v-7ce613d4"),e=e(),Qe(),e),rn={class:"prop-header !mt-0 dark:bg-gray"},un={class:"text-xs text-bold"},dn={class:"flex justify-evenly items-center"},mn=cn(()=>v("svg",{width:"20",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg","data-v-029747aa":""},[v("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.592 30.592 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.592 30.592 0 0 0-42.752 0z"})],-1)),fn=$({setup(e){const{t}=O();return(n,o)=>{const a=pt;return d(),_("div",rn,[v("div",un,N(c(t)("ve.contentProperties")),1),v("div",dn,[v("div",{class:"w-10 h-11 icon-color cursor-pointer flex justify-center items-center hover:bg-999 hover:text-fff",onClick:o[0]||(o[0]=(...s)=>c(B)&&c(B)(...s))},[b(a,{effect:"dark",content:c(t)("common.close"),placement:"bottom"},{default:y(()=>[mn]),_:1},8,["content"])])])])}}});var pn=ee(fn,[["__scopeId","data-v-7ce613d4"]]);const vn=$({props:{model:null,group:null,context:null,renderContext:null},setup(e,{expose:t}){const n=e,o=p();function a(){!n.model||Dt({meta:n.model,group:n.group,context:n.context})}function s(){return w(this,null,function*(){var l;yield(l=o.value)==null?void 0:l.validate()})}return t({validate:s}),(l,r)=>(d(),_(D,null,[b(pn),e.model?(d(),g(ln,{key:0,ref_key:"form",ref:o,meta:e.model,"render-context":e.renderContext,onChanged:a},null,8,["meta","render-context"])):k("",!0)],64))}}),Z=p("widgets");function gn(){oe({["switch-tab"](e){Z.value=e.item}})}function _n(){return Z.value="widgets",{currentTab:Z}}const xn={class:"pb-150px"},yn={class:"flex items-center px-24 py-12 leading-none"},hn=v("p",{class:"flex-1 text-m"},null,-1),wn=$({props:{customTabs:null,renderContext:null},setup(e,{expose:t}){const n=e,{activeWidget:o,activeGroup:a,activeContext:s,selectWidget:l,customWidgets:r}=A(),u=p(),{currentTab:m}=_n(),{t:x}=O(),{widgets:h}=ne(),C=M(()=>{var i,f;return(i=n.renderContext)!=null&&i.classic?(f=h.value)==null?void 0:f.filter(E=>!vt(["youtube"],E.name)):h.value}),V=M(()=>{var f;const i=[{key:"columns",value:x("ve.columns")},{key:"widgets",value:x("ve.widgets")}];return(f=r.value)!=null&&f.length&&i.push({key:"custom",value:x("common.custom")}),n.customTabs&&i.push(...n.customTabs),i});F(()=>{gn()}),Xe(()=>{l(null)});function U(){return w(this,null,function*(){var i;yield(i=u.value)==null?void 0:i.validate()})}return t({validate:U}),(i,f)=>{const E=gt,R=_t,Q=xt;return d(),g(Q,null,{default:y(()=>{var ce,ie,re;return[v("div",xn,[c(o)?(d(),g(vn,{ref_key:"propRef",ref:u,key:(ce=c(o).id)!=null?ce:"empty",model:c(o),group:c(a),context:c(s),"render-context":e.renderContext},null,8,["model","group","context","render-context"])):(d(),_(D,{key:1},[v("div",yn,[b(R,{modelValue:c(m),"onUpdate:modelValue":f[0]||(f[0]=I=>Ye(m)?m.value=I:null),class:"el-radio-group--rounded"},{default:y(()=>[(d(!0),_(D,null,j(c(V),I=>(d(),g(E,{key:I.key,label:I.key,"data-cy":I.key},{default:y(()=>[ke(N(I.value),1)]),_:2},1032,["label","data-cy"]))),128))]),_:1},8,["modelValue"]),hn,b(tt)]),(d(),_("div",{key:c(m)},[c(m)==="columns"?(d(),g(sn,{key:0})):k("",!0),c(m)==="widgets"&&c(C)?(d(),g(he,{key:1,items:(ie=c(C))!=null?ie:[]},null,8,["items"])):k("",!0),c(m)==="custom"&&c(r)?(d(),g(he,{key:2,items:(re=c(r))!=null?re:[]},null,8,["items"])):k("",!0),(d(!0),_(D,null,j(e.customTabs,I=>(d(),_(D,{key:I.key},[c(m)===I.key?X(i.$slots,I.key,{key:0}):k("",!0)],64))),128))]))],64))])]}),_:3})}}}),bn={class:"flex w-full h-full"},kn={class:"flex-1 pr-32 pl-80px flex flex-col min-h-400px min-w-600px"},$n={class:"flex-1 rounded-normal overflow-hidden shadow-s-10 mb-100px bg-fff dark:bg-[#333] min-h-400px"},Cn={class:"bg-card dark:bg-[#333] shadow-s-10 w-400px h-full"},Zn=$({props:{modelValue:null,html:null,baseUrl:null,customTabs:null,customWidgets:null,pageStyles:null,size:null,pages:null,classic:{type:Boolean}},emits:["update:modelValue","ready"],setup(e,{expose:t,emit:n}){const o=e,{init:a,rootMeta:s,flushData:l}=A(),r=p(),u=p(),m=p(!1),x=M(()=>{const i=new URL(o.baseUrl);return i.protocol=location.protocol,i.toString()}),h=M(()=>{var i;return{baseUrl:x.value,classic:(i=o.classic)!=null?i:!1,rootMeta:s.value}});function C(){var i;return(i=o.pages)!=null?i:[]}ve("ve-get-pages",C),ve("is-classic",o.classic);function V(){return w(this,null,function*(){yield a(o.modelValue,{customWidgets:o.customWidgets,renderContext:h.value}),m.value=!0})}te(()=>s.value,i=>{n("update:modelValue",i)},{deep:!0});function U(){return w(this,null,function*(){var i,f;yield l(h.value),yield(i=u.value)==null?void 0:i.validate(),yield(f=r.value)==null?void 0:f.validate(),n("update:modelValue",S(s.value))})}return oe({ready(i){s.value.children=i.item.children,n("ready",s.value)}}),F(()=>{Bt()}),Ze(()=>{Rt()}),t({validate:U,getHtml(){return new Promise(i=>{be(()=>w(this,null,function*(){const f=yield ut(s.value,o.classic);i(f)}))})},loadDesign:V}),(i,f)=>{var E;return d(),_("div",bn,[v("div",kn,[X(i.$slots,"header"),v("div",$n,[e.html?(d(),g(Qt,{key:0,content:e.html,loaded:m.value,size:e.size,"page-styles":e.pageStyles,"render-context":c(h)},null,8,["content","loaded","size","page-styles","render-context"])):k("",!0)])]),v("div",Cn,[b(wn,{ref_key:"sidebarRef",ref:u,"custom-tabs":(E=e.customTabs)!=null?E:[],"render-context":c(h)},et({_:2},[j(e.customTabs,R=>({name:R.key,fn:y(()=>[X(i.$slots,R.key)])}))]),1032,["custom-tabs","render-context"])])])}}}),In=$({setup(e){return(t,n)=>{const o=kt;return d(!0),_(D,null,j(c(P),a=>(d(),g(o,{key:a.name,type:a.name===c(T).name?"primary":"default",onClick:s=>c(Ue)(a.name)},{default:y(()=>[ke(N(a.display),1)]),_:2},1032,["type","onClick"]))),128)}}}),En={class:"pt-16 flex items-stretch justify-between"},eo=$({props:{modelValue:null,isEdit:{type:Boolean}},setup(e,{expose:t}){const n=e,{t:o}=O(),a=p(),s=M(()=>({name:n.isEdit?[]:[$t(1,50),Ct(o("common.nameRequiredTips")),It(Et,o("common.thePageNameAlreadyExists"))]})),l=u=>{const m=u.replace(/\s+/g,"");n.modelValue.urlPath||(n.modelValue.urlPath=`/${m}`),n.modelValue.name=m};function r(){return w(this,null,function*(){var u;yield(u=a.value)==null?void 0:u.validate()})}return t({validate:r}),(u,m)=>{const x=St,h=Vt,C=Wt;return d(),_("div",En,[b(C,{ref_key:"form",ref:a,model:e.modelValue,rules:c(s)},{default:y(()=>[b(h,{label:c(o)("common.pageName"),prop:"name"},{default:y(()=>[b(x,{modelValue:e.modelValue.name,"onUpdate:modelValue":m[0]||(m[0]=V=>e.modelValue.name=V),class:"w-300px",title:e.modelValue.name,disabled:e.isEdit,"data-cy":"page-name",onChange:l},null,8,["modelValue","title","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),v("div",null,[b(In)])])}}});export{Zn as _,eo as a};
