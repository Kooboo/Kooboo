var I=(T,t,u)=>new Promise((R,v)=>{var e=s=>{try{y(u.next(s))}catch(g){v(g)}},E=s=>{try{y(u.throw(s))}catch(g){v(g)}},y=s=>s.done?R(s.value):Promise.resolve(s.value).then(e,E);y((u=u.apply(T,t)).next())});import{g as W,w as X}from"./i18n.bcd18f8a.js";import{a as Y}from"./index.aef630be.js";import{x as Z,M as ee,N as oe,H as ae,O as z,E as te}from"./main.582f9de6.js";import{a as k,r as P,D as le,d as ne,s as ie,i as se}from"./validate.238a9986.js";import{d as re,g as c,cd as me,i as q,o as p,a as N,f,t as b,u as d,b as n,w as r,F as L,b6 as O,j as F,aH as j,k as C,x as ue}from"./url.8f5ec20c.js";import{n as pe}from"./guid.c1a40312.js";import{E as de}from"./index.57a23e6d.js";import{j as ce,E as fe}from"./windi.19264205.js";import{E as ve}from"./index.5cbbc5d7.js";import{E as _e,a as be}from"./index.6d63eb53.js";import{E as ye,a as ge}from"./index.6d22f937.js";import{E as De,a as xe}from"./index.59b1471f.js";import{E as ke}from"./index.ff00fbd6.js";import{E as Ne}from"./index.aec72f69.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./replace-all.d441bf14.js";import"./index.2341329b.js";import"./index.bda83f28.js";import"./index.bff48780.js";import"./index.649f6c77.js";import"./index.a32fb6e5.js";import"./style.9c8f6403.js";import"./toNumber.6efebd6a.js";import"./_baseIsEqual.547729d3.js";import"./event.776e7e11.js";import"./index.05e21f33.js";import"./error.7e8331f1.js";import"./isNil.98bb3b88.js";import"./_baseClone.eeff2792.js";import"./isEqual.11d86bcc.js";import"./index.ec6ad7db.js";import"./focus-trap.eafcfd1f.js";import"./event.53b2ad83.js";import"./index.79f78425.js";import"./index.c80f5028.js";import"./scroll.4888a9e9.js";import"./debounce.730e1961.js";import"./index.9a83ee01.js";import"./validator.b73911a9.js";const Ee={class:"text-444 dark:text-fff/86"},we={class:"text-3l mb-8"},Ve={class:"text-s"},Fe={class:"border-t border-b border-line dark:border-[#555] border-solid my-24 py-24"},Re={class:"flex items-center space-x-8"},he={class:"flex items-center justify-center h-full flex-col"},Se={class:"text-m flex items-center relative"},Ue={key:0,class:"h-16 text-666 font-normal text-[12px] leading-relaxed"},Ie={key:1,class:"text-s mt-8 text-666 pr-8 pl-8"},xo=re({setup(T){const{t}=W(),u=c(),R=me(),v=c(0),e=c({rootDomain:"",subDomain:"",siteName:"",url:"",file:null}),E=c(!1),y=c(!1),s=c(),g={subDomain:[k(t("common.subDomainRequiredTips")),P(1,63),le,ne(e.value)],rootDomain:k(t("common.rootDomainRequiredTips")),file:k(t("common.selectSitePackageTips")),siteName:[P(1,50),k(t("common.nameRequiredTips")),ie(),se(Z,t("common.siteNameExistsTips"))],url:k(t("common.urlRequiredTips"))},h=c();Y().then(i=>{u.value=i,u.value.length&&(e.value.rootDomain=u.value[0].domainName)});const B=[{key:"file",value:t("common.file")},{key:"URL",value:"URL"}],w=c(B[0].key),M=()=>I(this,null,function*(){yield h.value.validate();const i=ce.service({lock:!0,text:t("common.siteParsing"),background:"rgba(0, 0, 0, 0.7)"});try{if(w.value==="file"){var o=new FormData;o.append("siteName",e.value.siteName),o.append("subDomain",e.value.subDomain),o.append("rootDomain",e.value.rootDomain);const m=yield G();o.append("packageName",m),s.value=yield ee(o,D=>{})}else s.value=yield oe({rootDomain:e.value.rootDomain,subDomain:e.value.subDomain,siteName:e.value.siteName,url:e.value.url});const l=ue("currentFolder");l&&(yield ae({siteIds:[s.value],folderName:l})),i.close(),R.push({name:"home",query:{currentFolder:l}})}catch(l){i.close()}});var $=1024*1024;function G(){return I(this,null,function*(){const i=pe(),o=e.value.file;let l=0,m=0;for(;l<o.size;){m++;const V=l+$,S=o.raw.slice(l,V),_=new FormData;_.append("id",i),_.append("index",m.toString()),_.append("file",S),yield z(_,U=>{v.value=parseFloat(((U.loaded+l)/o.size*100).toFixed(2))}),l=V}const D=`${i}.zip`,x=new FormData;return x.append("id",i),x.append("name",D),yield z(x,()=>{}),D})}const H=i=>{var o=i.name;if(o.indexOf(".")>-1&&o.split(".").reverse()[0]==="zip"){if(e.value.file=i,!e.value.subDomain){var l=o.split(".");l.pop(),e.value.subDomain=l.join(".")}}else te.error(t("common.fileFormatIsIncorrect"))},A=()=>{e.value.file=null,e.value.subDomain=""};return q(()=>e.value.file,()=>{e.value.file&&h.value.clearValidate("file")}),q(()=>e.value.subDomain,()=>{E.value||(e.value.siteName=e.value.subDomain)}),q(()=>e.value.siteName,()=>{y.value||(e.value.subDomain=e.value.siteName)}),(i,o)=>{const l=ve,m=_e,D=ye,x=ge,V=De,S=xe,_=fe,U=ke,Q=de,J=be,K=Ne;return p(),N("div",Ee,[f("p",we,b(d(t)("common.importSite")),1),f("p",Ve,b(d(t)("common.importSiteTips")),1),f("div",Fe,[n(J,{ref_key:"form",ref:h,"label-position":"top",model:e.value,rules:d(g)},{default:r(()=>[n(m,{label:d(t)("common.siteName"),prop:"siteName"},{default:r(()=>[n(l,{modelValue:e.value.siteName,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.siteName=a),class:"w-394px","data-cy":"siteName",onInput:o[1]||(o[1]=a=>E.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),f("div",Re,[n(m,{label:d(t)("common.domain"),prop:"subDomain"},{default:r(()=>[n(l,{modelValue:e.value.subDomain,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.subDomain=a),class:"w-394px","data-cy":"subdomain",onInput:o[3]||(o[3]=a=>y.value=!0)},null,8,["modelValue"])]),_:1},8,["label"]),n(m,{prop:"rootDomain",class:"mt-30px"},{default:r(()=>[n(x,{modelValue:e.value.rootDomain,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.rootDomain=a),"data-cy":"root-domain"},{default:r(()=>[(p(!0),N(L,null,O(u.value,a=>(p(),F(D,{key:a.domainName,value:a.domainName,label:"."+a.domainName,"data-cy":"root-domain-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),n(S,{modelValue:w.value,"onUpdate:modelValue":o[5]||(o[5]=a=>w.value=a),class:"el-radio-group--rounded mb-12"},{default:r(()=>[(p(),N(L,null,O(B,a=>n(V,{key:a.key,label:a.key,"data-cy":a.key},{default:r(()=>[j(b(a.value),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["modelValue"]),w.value==="file"?(p(),F(m,{key:0,label:d(t)("common.file"),prop:"file"},{default:r(()=>[n(U,{"show-file-list":!1,action:"",drag:"",accept:".zip","auto-upload":!1,"on-change":H,class:"w-full"},{default:r(()=>[f("div",he,[f("p",Se,[n(_,{class:"iconfont icon-a-Cloudupload mr-8 text-2l leading-none absolute left-[-24px]"}),f("span",null,b(d(t)("common.selectOrDrag")),1)]),e.value.file?C("",!0):(p(),N("span",Ue,b(d(t)("common.compressedPackageFileFormat")),1)),e.value.file?(p(),N("p",Ie,[f("span",null,b(e.value.file.name),1),n(_,{class:"iconfont icon-delete text-orange ml-8",onClick:X(A,["stop"])},null,8,["onClick"])])):C("",!0)])]),_:1})]),_:1},8,["label"])):(p(),F(m,{key:1,prop:"url",label:"URL"},{default:r(()=>[n(l,{modelValue:e.value.url,"onUpdate:modelValue":o[6]||(o[6]=a=>e.value.url=a),"data-cy":"url"},null,8,["modelValue"])]),_:1})),v.value>0?(p(),F(Q,{key:2,"text-inside":!0,"stroke-width":26,percentage:v.value>100?100:v.value},null,8,["percentage"])):C("",!0)]),_:1},8,["model","rules"])]),n(K,{round:"",type:"primary","data-cy":"start-import",onClick:M},{default:r(()=>[j(b(d(t)("common.startImport")),1)]),_:1})])}}});export{xo as default};
