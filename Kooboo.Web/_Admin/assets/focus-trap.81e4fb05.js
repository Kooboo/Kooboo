var A=(e,s,n)=>new Promise((o,c)=>{var a=i=>{try{p(n.next(i))}catch(v){c(v)}},E=i=>{try{p(n.throw(i))}catch(v){c(v)}},p=i=>i.done?o(i.value):Promise.resolve(i.value).then(a,E);p((n=n.apply(e,s)).next())});import{c as H,_ as j}from"./windi.a815125a.js";import{h as $,aW as B,d as q,g as J,b2 as Y,i as h,u as F,K as I,p as z,r as G}from"./url.8f5ec20c.js";import{a as P}from"./i18n.25caaace.js";import{i as Q}from"./isNil.98bb3b88.js";let m=[];const X=e=>{const s=n=>{const o=n;o.key===H.esc&&m.forEach(c=>c(o))};$(()=>{m.length===0&&document.addEventListener("keydown",s),P&&m.push(e)}),B(()=>{m=m.filter(n=>n!==e),m.length===0&&P&&document.removeEventListener("keydown",s)})},V=e=>{const s=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>{const c=o.tagName==="INPUT"&&o.type==="hidden";return o.disabled||o.hidden||c?NodeFilter.FILTER_SKIP:o.tabIndex>=0||o===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)s.push(n.currentNode);return s},K=(e,s)=>{for(const n of e)if(!Z(n,s))return n},Z=(e,s)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(s&&e===s)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},ee=e=>{const s=V(e),n=K(s,e),o=K(s.reverse(),e);return[n,o]},te=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,s)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&te(e)&&s&&e.select()}};function w(e,s){const n=[...e],o=e.indexOf(s);return o!==-1&&n.splice(o,1),n}const ne=()=>{let e=[];return{push:o=>{const c=e[0];c&&o!==c&&c.pause(),e=w(e,o),e.unshift(o)},remove:o=>{var c,a;e=w(e,o),(a=(c=e[0])==null?void 0:c.resume)==null||a.call(c)}}},se=(e,s=!1)=>{const n=document.activeElement;for(const o of e)if(l(o,s),document.activeElement!==n)return},R=ne(),y="focus-trap.focus-after-trapped",g="focus-trap.focus-after-released",D={cancelable:!0,bubbles:!1},U="focusAfterTrapped",x="focusAfterReleased",oe=Symbol("elFocusTrap"),re=q({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[U,x,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:s}){const n=J();let o,c;X(t=>{e.trapped&&!a.paused&&s("release-requested",t)});const a={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},E=t=>{if(!e.loop&&!e.trapped||a.paused)return;const{key:r,altKey:u,ctrlKey:f,metaKey:d,currentTarget:M,shiftKey:N}=t,{loop:k}=e,W=r===H.tab&&!u&&!f&&!d,T=document.activeElement;if(W&&T){const _=M,[b,S]=ee(_);b&&S?!N&&T===S?(t.preventDefault(),k&&l(b,!0),s("focusout-prevented")):N&&[b,_].includes(T)&&(t.preventDefault(),k&&l(S,!0),s("focusout-prevented")):T===_&&(t.preventDefault(),s("focusout-prevented"))}};Y(oe,{focusTrapRef:n,onKeydown:E}),h(()=>e.focusTrapEl,t=>{t&&(n.value=t)},{immediate:!0}),h([n],([t],[r])=>{t&&(t.addEventListener("keydown",E),t.addEventListener("focusin",v),t.addEventListener("focusout",L)),r&&(r.removeEventListener("keydown",E),r.removeEventListener("focusin",v),r.removeEventListener("focusout",L))});const p=t=>{s(U,t)},i=t=>s(x,t),v=t=>{const r=F(n);if(!r)return;const u=t.target,f=u&&r.contains(u);f&&s("focusin",t),!a.paused&&e.trapped&&(f?c=u:l(c,!0))},L=t=>{const r=F(n);if(!(a.paused||!r))if(e.trapped){const u=t.relatedTarget;!Q(u)&&!r.contains(u)&&setTimeout(()=>{!a.paused&&e.trapped&&l(c,!0)},0)}else{const u=t.target;u&&r.contains(u)||s("focusout",t)}};function C(){return A(this,null,function*(){yield I();const t=F(n);if(t){R.push(a);const r=document.activeElement;if(o=r,!t.contains(r)){const f=new Event(y,D);t.addEventListener(y,p),t.dispatchEvent(f),f.defaultPrevented||I(()=>{let d=e.focusStartEl;z(d)||(l(d),document.activeElement!==d&&(d="first")),d==="first"&&se(V(t),!0),(document.activeElement===r||d==="container")&&l(t)})}}})}function O(){const t=F(n);if(t){t.removeEventListener(y,p);const r=new Event(g,D);t.addEventListener(g,i),t.dispatchEvent(r),r.defaultPrevented||l(o!=null?o:document.body,!0),t.removeEventListener(g,p),R.remove(a)}}return $(()=>{e.trapped&&C(),h(()=>e.trapped,t=>{t?C():O()})}),B(()=>{e.trapped&&O()}),{onKeydown:E}}});function ce(e,s,n,o,c,a){return G(e.$slots,"default",{handleKeydown:e.onKeydown})}var pe=j(re,[["render",ce],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{pe as E,oe as F};
