var h=(x,U,u)=>new Promise((y,d)=>{var b=m=>{try{k(u.next(m))}catch(V){d(V)}},r=m=>{try{k(u.throw(m))}catch(V){d(V)}},k=m=>m.done?y(m.value):Promise.resolve(m.value).then(b,r);k((u=u.apply(x,U)).next())});import{g as I,w as R}from"./i18n.bcd18f8a.js";import{j as J,k as O}from"./index.a32fb6e5.js";import{_ as Y}from"./index.20b12391.js";import{d as j,g as q,J as z,cj as H,i as G,o as a,j as t,w as v,a as _,b6 as g,F as f,aH as S,t as w,f as K,u as P,k as i}from"./url.8f5ec20c.js";import{u as $,E as Q}from"./main.582f9de6.js";import{u as W}from"./use-save-tip.8f44d6c0.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Z}from"./index.0a8d3d17.js";import{E as ee}from"./index.5cbbc5d7.js";import{E as le,a as oe}from"./index.6d22f937.js";import{E as ae,a as ne}from"./index.daafc4da.js";import{b as te,a as ue}from"./index.59b1471f.js";import{E as re}from"./index.373c837a.js";import{E as se}from"./index.d6799c63.js";import{E as pe,a as ce}from"./index.6d63eb53.js";const ie={key:0},me={class:"text-999 text-s"},de=j({props:{dbType:null,table:null,id:null},setup(x,{expose:U}){const u=x,y=$(),d=W(),{t:b}=I(),r=q([]);(()=>h(this,null,function*(){const s=yield J(u.dbType,{tableName:u.table,id:u.id});r.value=s.map(e=>{var n,c,T,E;if(((n=e.controlType)==null?void 0:n.toLowerCase())==="checkbox"){let p=null;if(Array.isArray(e.value))p=e.value;else try{e.value&&(p=JSON.parse(e.value))}catch(C){p=[]}e.value=p||[]}else((c=e.controlType)==null?void 0:c.toLowerCase())==="number"?e.value===null&&(e.value=void 0):((T=e.controlType)==null?void 0:T.toLowerCase())==="datetime"?e.value&&e.value.includes(".")&&(e.value=e.value.split(".")[0]):((E=e.controlType)==null?void 0:E.toLowerCase())==="boolean"&&e.value===null&&(e.value=!1);if(e.setting){const p=JSON.parse(e.setting);p&&p.options&&p.options.length&&(e.options=p.options)}return e}),d.init(r.value)}))(),z(()=>{y.firstActiveMenu=""}),H((s,e,n)=>h(this,null,function*(){var c;s.name==="login"?n():(y.firstActiveMenu=(c=s.meta.activeMenu)!=null?c:s.name,yield d.check(r.value).then(()=>{n()}).catch(()=>{y.firstActiveMenu=e.query.dbType?e.query.dbType.toLocaleLowerCase()+".table":"table",n(!1)}))}));function m(){const s=r.value.find(e=>e.isPrimaryKey&&!e.isSystem&&(e.value===null||e.value===""));return s?(Q.error(b("common.fieldRequiredTips2",{field:s.name})),!1):!0}function V(){return h(this,null,function*(){if(!m())return;const s=r.value.map(e=>{var c;let n=e.value;return Array.isArray(e.value)&&(n=JSON.stringify(e.value)),(c=e.value)!=null&&c.value&&(n=e.value.value),{name:e.name,value:n===void 0?null:n,rawValue:JSON.stringify(n!=null?n:null)}});yield O(u.dbType,{tableName:u.table,id:u.id,values:s}),d.init(r.value)})}return U({save:V}),G(()=>r.value,()=>{d.changed(r.value)},{deep:!0}),(s,e)=>{const n=ee,c=le,T=oe,E=ae,p=ne,C=te,N=ue,B=re,D=se,A=Z,L=pe,M=ce;return a(),t(M,{"label-position":"top",onSubmit:e[0]||(e[0]=R(()=>{},["prevent"]))},{default:v(()=>[(a(!0),_(f,null,g(r.value,(l,F)=>(a(),_(f,{key:F},[l.isSystem?i("",!0):(a(),t(L,{key:0,label:l.name},{default:v(()=>[l.isIncremental?(a(),_("p",ie,[S(w(l.value||"Empty")+" ",1),K("span",me,w("("+P(b)("common.unableChangeSelfIncrementalField")+")"),1)])):(a(),_(f,{key:1},[l.controlType==="TextBox"?(a(),t(n,{key:0,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="TextArea"?(a(),t(n,{key:1,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o,type:"textarea",autosize:{minRows:8,maxRows:15},style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="Tinymce"?(a(),t(Y,{key:2,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o},null,8,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="Selection"?(a(),t(T,{key:3,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o,clearable:""},{default:v(()=>[(a(!0),_(f,null,g(l.options,o=>(a(),t(c,{key:o.value,value:o.value,label:o.key},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="CheckBox"?(a(),t(p,{key:4,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o},{default:v(()=>[(a(!0),_(f,null,g(l.options,o=>(a(),t(E,{key:o.value,size:"large",label:o.value},{default:v(()=>[S(w(o.key),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="RadioBox"?(a(),t(N,{key:5,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o},{default:v(()=>[(a(!0),_(f,null,g(l.options,o=>(a(),t(C,{key:o.value,size:"large",label:o.value},{default:v(()=>[S(w(o.key),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="Boolean"?(a(),t(B,{key:6,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o},null,8,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="DateTime"?(a(),t(D,{key:7,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o,type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue","onUpdate:modelValue"])):i("",!0),l.controlType==="Number"?(a(),t(A,{key:8,modelValue:l.value,"onUpdate:modelValue":o=>l.value=o,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])):i("",!0)],64))]),_:2},1032,["label"]))],64))),128))]),_:1})}}});var Ne=X(de,[["__scopeId","data-v-609f0916"]]);export{Ne as E};
