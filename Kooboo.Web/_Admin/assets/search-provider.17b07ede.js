var me=Object.defineProperty,pe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var W=(e,l,t)=>l in e?me(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,Z=(e,l)=>{for(var t in l||(l={}))_e.call(l,t)&&W(e,t,l[t]);if(Q)for(var t of Q(l))ve.call(l,t)&&W(e,t,l[t]);return e},G=(e,l)=>pe(e,he(l));var j=(e,l,t)=>new Promise((c,f)=>{var h=d=>{try{_(t.next(d))}catch(a){f(a)}},p=d=>{try{_(t.throw(d))}catch(a){f(a)}},_=d=>d.done?c(d.value):Promise.resolve(d.value).then(h,p);_((t=t.apply(e,l)).next())});import{bv as ye,cm as be,d as D,g as N,E as ke,c as A,i as oe,o as r,j as S,w as g,b as x,u as o,G as ne,cd as ge,B as xe,cl as we,bz as Ce,x as $e,c0 as B,a as y,f as n,t as k,k as F,F as T,b6 as q,n as M,b3 as Fe,b1 as Se,cg as O,aH as Ue}from"./url.8f5ec20c.js";import{b as Ee}from"./toNumber.6efebd6a.js";import{b as Ve}from"./last.e7aa49db.js";import{b as le}from"./_baseIndexOf.4d7985be.js";import{b as Re}from"./style.9c8f6403.js";import{b as Ie}from"./_baseUniq.098d08d2.js";import{g as L,o as Me,w as K}from"./i18n.bcd18f8a.js";import{u as Te}from"./use-operation-dialog.175b540a.js";import{h as ze,d as Pe}from"./media-list.vue_vue_type_style_index_0_scoped_true_lang.c0b84b74.js";import{c as je,d as Oe}from"./file.734aeed6.js";import{a as Be,r as Ne,s as De,f as Le}from"./validate.238a9986.js";import{_ as Ae}from"./index.7a75fca3.js";import{E as qe}from"./index.5cbbc5d7.js";import{E as Ke,a as He}from"./index.6d63eb53.js";import{E as Je}from"./index.d4a6b2d5.js";import{_ as Qe}from"./folder.8308bb9d.js";import{u as se,k as We}from"./main.582f9de6.js";import{u as Y}from"./use-date.a1321c18.js";import{u as Ze,a as X}from"./replace-all.d441bf14.js";import{_ as Ge}from"./relations-tag.7a82bbd0.js";import{c as ee}from"./use-copy-text.c117d066.js";import{_ as Ye}from"./plugin-vue_export-helper.21dcd24c.js";import{E as Xe}from"./index.ea2df5df.js";import{E as et}from"./index.daafc4da.js";import{E as tt}from"./index.ec6ad7db.js";import{E as ot}from"./index.aec72f69.js";import{E as nt}from"./index.564bc658.js";import{S as lt}from"./search-input.5b2e8d23.js";import{E as st,a as at}from"./index.6d22f937.js";function it(e,l,t){var c=e.length;return t=t===void 0?c:t,!l&&t>=c?e:Ve(e,l,t)}var rt="\\ud800-\\udfff",ct="\\u0300-\\u036f",dt="\\ufe20-\\ufe2f",ut="\\u20d0-\\u20ff",ft=ct+dt+ut,mt="\\ufe0e\\ufe0f",pt="\\u200d",ht=RegExp("["+pt+rt+ft+mt+"]");function _t(e){return ht.test(e)}function vt(e){return e.split("")}var ae="\\ud800-\\udfff",yt="\\u0300-\\u036f",bt="\\ufe20-\\ufe2f",kt="\\u20d0-\\u20ff",gt=yt+bt+kt,xt="\\ufe0e\\ufe0f",wt="["+ae+"]",H="["+gt+"]",J="\\ud83c[\\udffb-\\udfff]",Ct="(?:"+H+"|"+J+")",ie="[^"+ae+"]",re="(?:\\ud83c[\\udde6-\\uddff]){2}",ce="[\\ud800-\\udbff][\\udc00-\\udfff]",$t="\\u200d",de=Ct+"?",ue="["+xt+"]?",Ft="(?:"+$t+"(?:"+[ie,re,ce].join("|")+")"+ue+de+")*",St=ue+de+Ft,Ut="(?:"+[ie+H+"?",H,re,ce,wt].join("|")+")",Et=RegExp(J+"(?="+J+")|"+Ut+St,"g");function Vt(e){return e.match(Et)||[]}function te(e){return _t(e)?Vt(e):vt(e)}function Rt(e,l){for(var t=e.length;t--&&le(l,e[t],0)>-1;);return t}function It(e,l){for(var t=-1,c=e.length;++t<c&&le(l,e[t],0)>-1;);return t}function vn(e,l,t){if(e=ye(e),e&&(t||l===void 0))return Ee(e);if(!e||!(l=be(l)))return e;var c=te(e),f=te(l),h=It(c,f),p=Rt(c,f)+1;return it(c,h,p).join("")}function yn(e,l){return e&&e.length?Ie(e,Re(l)):[]}const bn=D({props:{modelValue:{type:Boolean},path:null,folders:null,folderType:null,provider:null},emits:["create-success"],setup(e,{emit:l}){const t=e,{t:c}=L(),{visible:f,handleClose:h}=Te(t,l),p=N();let _=ke({name:""});const d=A(()=>t.folders.map(({name:m})=>({key:m}))),a={name:[Be(c("common.inputFolderNameTips")),Ne(1,50),De(),Le(d)]};oe(()=>f.value,m=>{var v;return m&&((v=p.value)==null?void 0:v.resetFields())});function i(){var m;(m=p.value)==null||m.validate(v=>j(this,null,function*(){var u;if(v){const R={name:_.name,path:t.path,provider:(u=t.provider)!=null?u:"default"};t.folderType==="File"?yield je(R):yield ze(R),h(),l("create-success")}}))}return(m,v)=>{const u=qe,R=Ke,z=He,P=Je;return r(),S(P,{modelValue:o(f),"onUpdate:modelValue":v[2]||(v[2]=I=>ne(f)?f.value=I:null),width:"600px","close-on-click-modal":!1,title:o(c)("common.newFolder"),onClose:o(h)},{footer:g(()=>[x(Ae,{"confirm-label":o(c)("common.create"),onConfirm:i,onCancel:o(h)},null,8,["confirm-label","onCancel"])]),default:g(()=>[x(z,{ref_key:"form",ref:p,class:"el-form--label-normal",model:o(_),rules:o(a),"label-position":"top",onSubmit:v[1]||(v[1]=K(()=>{},["prevent"]))},{default:g(()=>[x(R,{prop:"name",label:o(c)("common.nameYourFolder")},{default:g(()=>[x(u,{modelValue:o(_).name,"onUpdate:modelValue":v[0]||(v[0]=I=>o(_).name=I),"data-cy":"folder-name-input",onKeydown:Me(i,["enter"])},null,8,["modelValue","onKeydown"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","onClose"])}}});function Mt(e){const l=ge(),t=xe("dialogInfo"),c=se();function f(a){return a?Object.values(a).reduce((m,v)=>m+v,0):0}function h(a){e("clickFolder",a)}function p(a,i){if(t!=null&&t.value){e("editImage",a,i);return}l.push(Ze({name:"editImage",query:G(Z({},l.currentRoute.value.query),{id:a.key,provider:i})}))}function _(a,i){(t==null?void 0:t.value.multiple)===!1&&i.forEach(m=>{m.selected&&m!==a&&(m.selected=!1)})}function d(a){return a&&(we(a)?a:(a=Ce(a,{siteId:$e("siteId")}),B(c.site.prUrl,a)))}return{getReferencesCount:f,handleClickFolder:h,handleEditImage:p,dialogInfo:t,handleCheckFile:_,getPreviewUrl:d}}const V=e=>(Fe("data-v-743220c4"),e=e(),Se(),e),Tt={class:"table-fixed w-full text-center text-[#666] dark:text-fff/50"},zt={class:"bg-[#fafafa] dark:bg-444 shadow-s-10 relative"},Pt={key:0},jt=V(()=>n("th",{width:"50"},null,-1)),Ot={class:"text-left"},Bt=V(()=>n("th",{class:"text-left"},"URL",-1)),Nt={width:"250",class:"text-left"},Dt={width:"100"},Lt={width:"150"},At=["width"],qt={key:1},Kt=V(()=>n("th",{width:"50"},null,-1)),Ht={class:"text-left"},Jt={key:0,class:"text-left"},Qt=V(()=>n("th",{width:"10"},null,-1)),Wt={width:"90"},Zt={width:"160"},Gt=["width"],Yt={class:"bg-[#fff] dark:bg-[#333] text-m"},Xt=["onClick"],eo=["onClick"],to=V(()=>n("img",{src:Qe,class:"w-28px mr-8px"},null,-1)),oo=["title"],no=V(()=>n("td",{class:"text-left"},null,-1)),lo=V(()=>n("td",null,"-",-1)),so={class:"text-m"},ao={class:"flex items-center justify-end cursor-pointer px-16"},io=["onClick"],ro={class:"cursor-pointer"},co={class:"text-left flex items-center min-h-48px"},uo=["src"],fo=["title"],mo={key:0},po={class:"text-left flex items-center"},ho=["title"],_o={key:1},vo={"data-cy":"size"},yo={class:"text-m","data-cy":"last-modified-in-list"},bo={key:2},ko={class:"inline-flex items-center cursor-pointer space-x-16"},go=["onClick"],xo=["onClick"],wo=["onClick"],Co=["onClick"],$o=["onClick"],Fo={key:3},So={class:"flex items-center cursor-pointer space-x-16 justify-end px-16"},Uo=["onClick"],Eo=["onClick"],Vo=["onClick"],Ro=["onClick"],Io={key:0,class:"isEmpty"},Mo=["colspan"],To={class:"el-table__empty-block w-full"},zo={class:"el-table__empty-text"},Po=D({props:{folders:null,files:null,hasCheckbox:{type:Boolean},hideOpenFolder:{type:Boolean},folderType:null,provider:null},emits:["clickFolder","editImage"],setup(e,{emit:l}){const t=e,c=N(!1),f=N([]),h=se();let p=t.folderType?"file":"media";const _=b=>{var w;((w=b.mimeType)==null?void 0:w.split("/")[0])!=="image"?O(b.previewUrl):(f.value=[b.previewUrl],c.value=!0)},d=b=>j(this,null,function*(){if(b.downloadUrl)O(b.downloadUrl);else{const w=X(`Download/Single?id=${b.key}&type=${p}&provider=${t.provider}`);O(`/_api/v2/${w}`)}}),a=b=>j(this,null,function*(){const w={folder:b,folders:[b],files:[]},U=t.folderType?yield Oe(w,t.provider):yield Pe(w,t.provider);if(!U)return;const C=X(`Download/Package?file=${U}&type=${p}`);O(`/_api/v2/${C}`)}),{t:i}=L(),{handleClickFolder:m,handleEditImage:v,dialogInfo:u,handleCheckFile:R}=Mt(l),z=b=>{if(!b.folder){const U=b.url;b.folder=U.substring(0,U.lastIndexOf("/"))||""}const w={fullPath:`${b.folder||"/"}`,name:"",lastModified:new Date,count:1};m(w)},P=A(()=>!(u!=null&&u.value)&&t.folderType!=="File"),I=A(()=>t.folders.length===0&&t.files.length===0);return(b,w)=>{const U=et,C=tt,fe=Xe;return r(),y(T,null,[n("table",Tt,[n("thead",zt,[o(P)?(r(),y("tr",Pt,[jt,n("th",Ot,k(o(i)("common.fileName")),1),Bt,n("th",Nt,k(o(i)("common.usedBy")),1),n("th",Dt,k(o(i)("common.size")),1),n("th",Lt,k(o(i)("common.lastModified")),1),n("th",{width:e.hideOpenFolder?140:160},null,8,At)])):(r(),y("tr",qt,[Kt,n("th",Ht,k(o(i)("common.fileName")),1),o(u)?F("",!0):(r(),y("th",Jt,"URL")),Qt,n("th",Wt,k(o(i)("common.size")),1),n("th",Zt,k(o(i)("common.lastModified")),1),n("th",{width:e.hideOpenFolder?110:130},null,8,Gt)]))]),n("tbody",Yt,[(r(!0),y(T,null,q(e.folders,s=>(r(),y("tr",{key:s.fullPath,class:M({"!bg-blue/30":s.selected&&e.hasCheckbox&&!o(u)})},[n("td",{class:M(o(u)?"":"cursor-pointer"),onClick:E=>s.selected=!s.selected},[e.hasCheckbox&&!o(u)?(r(),S(U,{key:0,modelValue:s.selected,"onUpdate:modelValue":E=>s.selected=E,class:"pointer-events-none","data-cy":"folder-checkbox"},null,8,["modelValue","onUpdate:modelValue"])):F("",!0)],10,Xt),n("td",null,[n("div",{class:"text-left flex items-center cursor-pointer min-h-48px",onClick:E=>o(m)(s)},[to,n("div",{class:"ellipsis text-black dark:text-fff/50 pr-12",title:s.name,"data-cy":"folder-name"},k(s.name),9,oo)],8,eo)]),n("td",{class:M(o(u)?"hidden":"")},null,2),no,lo,n("td",so,k(o(Y)(s.lastModified)),1),n("td",null,[n("div",ao,[x(C,{placement:"top","show-after":300,content:o(i)("common.download")},{default:g(()=>[n("span",{class:"iconfont icon-xiazai-wenjianxiazai-05 hover:text-blue font-bold",onClick:E=>a(s.fullPath)},null,8,io)]),_:2},1032,["content"])])])],2))),128)),(r(!0),y(T,null,q(e.files,s=>{var E;return r(),y("tr",{key:s.id,class:M({"!bg-blue/30":s.selected})},[n("td",ro,[e.hasCheckbox?(r(),S(U,{key:0,modelValue:s.selected,"onUpdate:modelValue":$=>s.selected=$,"data-cy":"file-checkbox",onChange:$=>o(R)(s,e.files)},null,8,["modelValue","onUpdate:modelValue","onChange"])):F("",!0)]),n("td",null,[n("div",co,[s.thumbnail?(r(),y("img",{key:0,src:s.thumbnail,class:"w-30px h-26px mr-8px object-contain","data-cy":"thumbnail"},null,8,uo)):F("",!0),n("div",{class:"ellipsis text-black dark:text-fff/50 pr-12","data-cy":"file-name",title:s.name},k(s.name),9,fo)])]),o(u)?(r(),y("td",_o)):(r(),y("td",mo,[n("div",po,[n("div",{class:"ellipsis text-black dark:text-fff/50 pr-12","data-cy":"file-previewUrl",title:s.previewUrl},k(o(B)(o(h).site.baseUrl,s.url)),9,ho)])])),n("td",{class:M(["py-8",o(u)?"hidden":""])},[x(Ge,{id:s.id,relations:(E=s.references)!=null?E:s.relations,type:s.references?"Image":"CmsFile"},null,8,["id","relations","type"])],2),n("td",vo,k(o(We)(s.size)),1),n("td",yo,k(o(Y)(s.lastModified)),1),o(P)?(r(),y("td",bo,[n("div",ko,[e.hideOpenFolder?F("",!0):(r(),S(C,{key:0,placement:"top","show-after":300,content:o(i)("common.openFileLocation",s)},{default:g(()=>[n("span",{class:"iconfont icon-folder cursor-pointer hover:text-blue","data-cy":"open-folder",onClick:K($=>z(s),["stop"])},null,8,go)]),_:2},1032,["content"])),x(C,{placement:"top","show-after":300,content:o(i)("common.copyUrl")},{default:g(()=>[n("span",{class:"iconfont icon-copy cursor-pointer hover:text-blue","data-cy":"copy-in-grid",onClick:$=>o(ee)(o(B)(o(h).site.baseUrl,s.url))},null,8,xo)]),_:2},1032,["content"]),x(C,{placement:"top","show-after":300,content:o(i)("common.preview")},{default:g(()=>[n("span",{class:"hover:text-blue iconfont icon-eyes","data-cy":"preview-in-list",onClick:$=>_(s)},null,8,wo)]),_:2},1032,["content"]),o(h).hasAccess("mediaLibrary","edit")?(r(),S(C,{key:1,placement:"top","show-after":300,content:o(i)("common.edit")},{default:g(()=>[n("span",{class:"hover:text-blue iconfont icon-a-writein","data-cy":"edit-in-list",onClick:$=>o(v)(s,e.provider)},null,8,Co)]),_:2},1032,["content"])):F("",!0),x(C,{placement:"top","show-after":300,content:o(i)("common.download")},{default:g(()=>[n("span",{class:"hover:text-blue iconfont icon-xiazai-wenjianxiazai-05 font-bold","data-cy":"download-in-list",onClick:$=>d(s)},null,8,$o)]),_:2},1032,["content"])])])):(r(),y("td",Fo,[n("div",So,[e.hideOpenFolder?F("",!0):(r(),S(C,{key:0,placement:"top","show-after":300,content:o(i)("common.openFileLocation",s)},{default:g(()=>[n("span",{class:"iconfont icon-folder cursor-pointer hover:text-blue","data-cy":"open-folder",onClick:K($=>z(s),["stop"])},null,8,Uo)]),_:2},1032,["content"])),x(C,{placement:"top","show-after":300,content:o(i)("common.copyUrl")},{default:g(()=>[n("span",{class:"iconfont icon-copy hover:text-blue",onClick:$=>o(ee)(o(B)(o(h).site.baseUrl,s.url))},null,8,Eo)]),_:2},1032,["content"]),x(C,{placement:"top","show-after":300,content:o(i)("common.preview")},{default:g(()=>[n("span",{class:"iconfont icon-eyes hover:text-blue",onClick:$=>_(s)},null,8,Vo)]),_:2},1032,["content"]),x(C,{placement:"top","show-after":300,content:o(i)("common.download")},{default:g(()=>[n("span",{class:"iconfont icon-xiazai-wenjianxiazai-05 hover:text-blue font-bold",onClick:$=>d(s)},null,8,Ro)]),_:2},1032,["content"])])]))],2)}),128)),o(I)?(r(),y("tr",Io,[n("td",{colspan:o(u)?6:7},[n("div",To,[n("span",zo,k(o(i)("common.noData")),1)])],8,Mo)])):F("",!0)])]),c.value?(r(),S(fe,{key:0,"url-list":f.value,"hide-on-click-modal":"",onClose:w[0]||(w[0]=s=>c.value=!1)},null,8,["url-list"])):F("",!0)],64)}}});var kn=Ye(Po,[["__scopeId","data-v-743220c4"]]);const jo={key:0,class:"flex justify-center"},Oo={key:1},Bo={key:1},gn=D({props:{pagination:null,infinite:{type:Boolean}},emits:["current-change"],setup(e,{emit:l}){const t=e,{t:c}=L();function f(){var p;h(((p=t.pagination.currentPage)!=null?p:0)+1)}function h(p){l("current-change",p)}return(p,_)=>{var i,m;const d=ot,a=nt;return e.infinite?(r(),y("div",jo,[((i=e.pagination.totalCount)!=null?i:0)>((m=e.pagination.pageSize)!=null?m:0)?(r(),S(d,{key:0,onClick:f},{default:g(()=>[Ue(k(o(c)("common.loadMore")),1)]),_:1})):(r(),y("div",Oo,k(o(c)("common.noMoreData")),1))])):e.pagination.totalCount?(r(),y("div",Bo,[x(a,{currentPage:e.pagination.currentPage,"onUpdate:currentPage":_[0]||(_[0]=v=>e.pagination.currentPage=v),"page-size":e.pagination.pageSize,layout:"prev, pager, next",total:e.pagination.totalCount,"hide-on-single-page":"",onCurrentChange:h},null,8,["currentPage","page-size","total"])])):F("",!0)}}}),xn=D({props:{providers:null,provider:null,searchKey:null},emits:["update:provider","update:search-key"],setup(e,{emit:l}){var _;const t=e,{t:c}=L(),f=N((_=t.searchKey)!=null?_:"");function h(){var d;l("update:search-key",(d=f.value)!=null?d:"")}function p(d){l("update:provider",d)}return oe(()=>t.searchKey,d=>{f.value=d}),(d,a)=>{const i=st,m=at,v=lt;return r(),y(T,null,[e.providers.length>1?(r(),S(m,{key:0,modelValue:e.provider,"onUpdate:modelValue":a[0]||(a[0]=u=>ne(provider)?provider.value=u:null),class:"right-24 w-130px","default-first-option":"",onChange:p},{default:g(()=>[(r(!0),y(T,null,q(e.providers,u=>(r(),S(i,{key:u,value:u,label:o(c)(`storage.${u}`)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):F("",!0),x(v,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=u=>f.value=u),placeholder:o(c)("common.enterKeywords"),class:"w-238px","data-cy":"search",onSearch:h},null,8,["modelValue","placeholder"])],64)}}});export{kn as M,xn as _,gn as a,bn as b,yn as c,it as d,_t as h,te as s,vn as t,Mt as u};
