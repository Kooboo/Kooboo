var A=(_,d,s)=>new Promise((r,C)=>{var V=e=>{try{y(s.next(e))}catch(E){C(E)}},S=e=>{try{y(s.throw(e))}catch(E){C(E)}},y=e=>e.done?r(e.value):Promise.resolve(e.value).then(V,S);y((s=s.apply(_,d)).next())});import{_ as oe}from"./icon-button.3313e42d.js";import{_ as ae}from"./k-table.d4486972.js";import{a as B}from"./replace-all.7cf5f327.js";import{d as M}from"./main.ea42d807.js";import{d as le,g as z,w as O,o as P}from"./i18n.48bd28ac.js";import{u as ne}from"./use-date.01b82ce0.js";import{u as ie}from"./use-operation-dialog.f0f37a10.js";import{e as re}from"./guid.c1a40312.js";import{a as F,r as me,l as ue,H as se}from"./validate.efc4a5c0.js";import{_ as de}from"./dev-mode.c4133b5a.js";import{_ as ce}from"./index.a731e53b.js";import{U as pe}from"./editor.main.d2800f63.js";import{E as fe}from"./index.d4bbb472.js";import{E as ve}from"./index.fc90f5ad.js";import{E as _e,a as ye}from"./index.6855d037.js";import{E as he,a as be}from"./index.0d2684bf.js";import{E as J}from"./windi.a5b0b048.js";import{E as Q}from"./index.2bc50276.js";import{E as Ce}from"./index.c4e9b529.js";import{d as W,g as R,c as j,i as Ve,o as u,j as f,w as n,b as l,u as i,k as D,a as w,b6 as $,aH as x,t as v,F as N,f as U,G as ge,h as ke,b7 as we,e as Ee}from"./url.2e6a77c4.js";import{B as Ue}from"./breadcrumb.80c136b8.js";import{b as Ae}from"./confirm.e2c924ff.js";import{E as Ne}from"./index.b494e80e.js";import{c as $e}from"./cloneDeep.ff43c1f8.js";import"./index.379e80ad.js";import"./focus-trap.23f44899.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.ff0264f3.js";import"./index.8262f5ef.js";import"./index.fcc3ea42.js";import"./sortable.esm.a99254e8.js";import"./index.7034978e.js";import"./isEqual.f1ae9fb3.js";import"./_baseIsEqual.c0d7e77a.js";import"./error.7e8331f1.js";import"./index.77edae39.js";import"./event.776e7e11.js";import"./index.695d0284.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./dayjs.min.0a66969b.js";import"./index.d75a71d9.js";import"./index.aba77680.js";import"./index.6d45a031.js";import"./index.31f26a0f.js";import"./index.60af85f4.js";import"./style.19d0c187.js";import"./toNumber.574be4f1.js";import"./use-shortcuts.21ce2d8e.js";import"./index.a439b087.js";import"./userWorker.b3a6730b.js";import"./config.9fb52765.js";import"./dark.ddf8665a.js";import"./page.831d1a45.js";import"./index.99c4f65d.js";import"./index.603c1365.js";import"./scroll.f51de5d8.js";import"./aria.75ec5909.js";import"./validator.e2869aba.js";import"./index.f5a869bb.js";import"./dropdown.0507a1c7.js";import"./refs.4001ce17.js";import"./use-copy-text.a346ed23.js";import"./index.c6df1b45.js";import"./index.0f940e7f.js";import"./classCompletion.a22e38a6.js";import"./vuedraggable.umd.5840ebc7.js";import"./toggleComment.5b29ca87.js";import"./use-save-tip.04d9878f.js";import"./index.cbddf8eb.js";import"./index.66d5d547.js";import"./index.232e741a.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.af90dc36.js";import"./index.470f0e7e.js";import"./index.deca86b5.js";import"./alert.583ccfe6.js";import"./index.fafb14b3.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.118b18f5.js";/* empty css                                                          */import"./file.b0d4cc6e.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.82732353.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.f6d26366.js";import"./image-editor.846c8dc6.js";import"./main.esm.5190fb65.js";import"./index.f01d4ffd.js";import"./index.e3f90979.js";import"./_baseClone.adbc92f5.js";import"./debounce.61c67278.js";import"./index.064c7de9.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";const X=le.global.t,xe=()=>M.get(B("Authentication/list")),Re=_=>M.post(B("Authentication/Deletes"),_,void 0,{successMessage:X("common.deleteSuccess")}),Se=_=>M.post(B("Authentication/post"),_,void 0,{successMessage:X("common.saveSuccess")}),Te=()=>M.get(B("Authentication/GetTypes")),qe=_=>M.get(B("Authentication/isUniqueName"),{name:_},{hiddenLoading:!0,hiddenError:!0}),De={class:"w-full space-y-4"},Be=W({props:{modelValue:{type:Boolean},current:null},emits:["save-success"],setup(_,{emit:d}){const s=_,{t:r}=z(),{visible:C,handleClose:V}=ie(s,d),S=()=>({id:re,name:"",matcher:"None",action:"None",failedAction:"None",customCodeName:"",customCode:`// sample code.. 
// if (k.request.url.indexOf('/api') == 0) {
//     var token = k.request.headers.get('Authorization');
//     if (token != 'abc123') k.response.unauthorized()
// }`,httpCode:401,url:"/",conditions:[]}),y=R(),e=R({}),E={name:[F(r("common.nameRequiredTips")),me(1,50),ue(),{asyncValidator(o,a,k){return A(this,null,function*(){try{yield qe(a),k()}catch(b){k(Error(r("common.valueHasBeenTakenTips")))}})},trigger:"blur"}],httpCode:[F(r("common.httpCodeRequiredTips")),se],url:[F(r("common.urlRequiredTips"))],options:[{validator(o,a,k){e.value.conditions.length===0?k(new Error(r("common.fieldRequiredTips"))):k()},trigger:"blur"}]},m=j(()=>!s.current),c=j(()=>{var o,a;return(m.value?r("common.create"):r("common.edit"))+((o=s.current)!=null&&o.name?": "+((a=s.current)==null?void 0:a.name):"")}),h=R();Ve(()=>s.modelValue,o=>A(this,null,function*(){var a;o&&(h.value||(h.value=yield Te()),(a=y.value)==null||a.resetFields(),s.current?e.value=s.current:e.value=S())}));function H(o){e.value.conditions.splice(o,1)}function g(){var o;e.value.conditions.push({left:"url",operator:"=",right:""}),(o=y.value)==null||o.clearValidate("options")}function I(){return A(this,null,function*(){var o;yield(o=y.value)==null?void 0:o.validate(),yield Se(e.value),V(),d("save-success")})}return(o,a)=>{const k=ve,b=_e,T=he,q=be,G=J,L=Q,Z=fe,ee=ye,te=Ce;return u(),f(te,{modelValue:i(C),"onUpdate:modelValue":a[11]||(a[11]=t=>ge(C)?C.value=t:null),width:"650px","close-on-click-modal":!1,title:i(c),onClose:i(V)},{footer:n(()=>[l(ce,{permission:{feature:"authentication",action:"edit"},onConfirm:I,onCancel:i(V)},null,8,["onCancel"])]),default:n(()=>[h.value?(u(),f(ee,{key:0,ref_key:"form",ref:y,rules:E,model:e.value,"label-position":"top",onSubmit:a[10]||(a[10]=O(()=>{},["prevent"])),onKeydown:P(I,["enter"])},{default:n(()=>[i(m)?(u(),f(b,{key:0,prop:"name",label:i(r)("common.name")},{default:n(()=>[l(k,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.name=t),"data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0),l(b,{prop:"matcher",label:i(r)("common.matcher")},{default:n(()=>[l(q,{modelValue:e.value.matcher,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.matcher=t),class:"w-full","data-cy":"matcher"},{default:n(()=>[(u(!0),w(N,null,$(h.value.matcher,t=>(u(),f(T,{key:t.name,value:t.name,"data-cy":"matcher-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.matcher==="Condition"?(u(),f(b,{key:1,prop:"options"},{default:n(()=>[U("div",De,[(u(!0),w(N,null,$(e.value.conditions,(t,K)=>(u(),w("div",{key:K,class:"flex items-center space-x-4"},[l(q,{modelValue:t.left,"onUpdate:modelValue":p=>t.left=p,class:"w-120px","data-cy":"condition-left"},{default:n(()=>[(u(),w(N,null,$(["url","method"],p=>l(T,{key:p,value:p,"data-cy":"condition-left-opt"},{default:n(()=>[x(v(p),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(q,{modelValue:t.operator,"onUpdate:modelValue":p=>t.operator=p,class:"w-150px","data-cy":"condition-operater"},{default:n(()=>[(u(),w(N,null,$([{label:"=",value:"="},{label:"!=",value:"!="},{label:"Contains",value:"contains"},{label:"Not contains",value:"notcontains"},{label:"Starts with",value:"startwith"},{label:"Not starts with",value:"notstartwith"}],p=>l(T,{key:p.value,value:p.value,label:p.label,"data-cy":"condition-operater-opt"},null,8,["value","label"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(b,{prop:"conditions."+K+".right",rules:i(F)(i(r)("common.valueRequiredTips"))},{default:n(()=>[l(k,{modelValue:t.right,"onUpdate:modelValue":p=>t.right=p,"data-cy":"condition-right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),U("div",null,[l(L,{circle:"","data-cy":"remove-condition",onClick:p=>H(K)},{default:n(()=>[l(G,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),l(L,{circle:"",onClick:a[2]||(a[2]=t=>g())},{default:n(()=>[l(G,{class:"iconfont icon-a-addto text-blue","data-cy":"add-condition"})]),_:1})])]),_:1})):D("",!0),l(b,{prop:"action",label:i(r)("common.action")},{default:n(()=>[l(q,{modelValue:e.value.action,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.action=t),class:"w-full","data-cy":"action"},{default:n(()=>[(u(!0),w(N,null,$(h.value.action,t=>(u(),f(T,{key:t.name,value:t.name,"data-cy":"action-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.action==="CustomCode"?(u(),f(b,{key:2,prop:"customCodeName",label:i(r)("common.code")},{default:n(()=>[l(de,{modelValue:e.value.customCode,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.customCode=t),class:"h-200px",language:"typescript","k-script":"",uri:i(pe).file(e.value.id),onKeydown:a[5]||(a[5]=P(O(()=>{},["stop"]),["enter"]))},null,8,["modelValue","uri"])]),_:1},8,["label"])):(u(),w(N,{key:3},[l(b,{prop:"failedAction",label:i(r)("common.failedAction")},{default:n(()=>[l(q,{modelValue:e.value.failedAction,"onUpdate:modelValue":a[6]||(a[6]=t=>e.value.failedAction=t),class:"w-full","data-cy":"failed-action"},{default:n(()=>[(u(!0),w(N,null,$(h.value.failedAction,t=>(u(),f(T,{key:t.name,value:t.name,"data-cy":"failed-action-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.failedAction==="ResultCode"?(u(),f(b,{key:0,prop:"httpCode",label:i(r)("common.httpCode")},{default:n(()=>[l(Z,{modelValue:e.value.httpCode,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value.httpCode=t),placeholder:i(r)("common.httpCode"),"data-cy":"http-code"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):D("",!0),e.value.failedAction==="Redirect"?(u(),f(b,{key:1,prop:"url",label:i(r)("common.url")},{default:n(()=>[l(k,{modelValue:e.value.url,"onUpdate:modelValue":a[8]||(a[8]=t=>e.value.url=t),"data-cy":"redirect-url",onInput:a[9]||(a[9]=t=>e.value.url=e.value.url.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0)],64))]),_:1},8,["model","onKeydown"])):D("",!0)]),_:1},8,["modelValue","title","onClose"])}}}),Me={class:"p-24"},Ie={class:"flex items-center py-24 space-x-16"},Fe=["title"],He={"data-cy":"matcher"},Ke={"data-cy":"action"},Ge={"data-cy":"failed-action"},Le={class:"ellipsis","data-cy":"parameters"},Do=W({setup(_){const{t:d}=z(),s=R([]),r=R(!1),C=R();ke(()=>{V()});function V(){return A(this,null,function*(){s.value=(yield xe()).sort((m,c)=>m.lastModified>c.lastModified?-1:1)})}function S(m){return m.action==="CustomCode"?m.customCode+"":m.failedAction==="ResultCode"?m.httpCode+"":m.failedAction==="Redirect"?m.url:""}function y(m){return m.matcher!=="Condition"?m.matcher:m.conditions.map(c=>`${c.left} ${c.operator} '${c.right}'`).join(" && ")}function e(m){return A(this,null,function*(){yield Ae(m.length);const c=m.map(h=>h.id);yield Re({ids:c}),V()})}function E(m){return A(this,null,function*(){C.value=m?$e(m):void 0,r.value=!0})}return(m,c)=>{const h=J,H=Q,g=Ne,I=oe,Y=we("hasPermission");return u(),w("div",Me,[l(Ue,{name:i(d)("common.authentication")},null,8,["name"]),U("div",Ie,[Ee((u(),f(H,{round:"","data-cy":"create",onClick:c[0]||(c[0]=o=>E())},{default:n(()=>[l(h,{class:"iconfont icon-a-addto"}),x(" "+v(i(d)("common.create")),1)]),_:1})),[[Y,{feature:"authentication",action:"edit"}]])]),l(i(ae),{data:s.value,"show-check":"",permission:{feature:"authentication",action:"delete"},onDelete:e},{default:n(()=>[l(g,{label:i(d)("common.name"),width:"150"},{default:n(({row:o})=>[U("span",{class:"ellipsis",title:o.name,"data-cy":"name"},v(o.name),9,Fe)]),_:1},8,["label"]),l(g,{label:i(d)("common.matcher")},{default:n(({row:o})=>[U("span",He,v(y(o)),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.action"),width:"150"},{default:n(({row:o})=>[U("span",Ke,v(o.action),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.failedAction"),width:"150"},{default:n(({row:o})=>[U("span",Ge,v(o.action==="CustomCode"?"CustomCode":o.failedAction),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.parameters"),width:"180"},{default:n(({row:o})=>[U("div",Le,v(S(o)),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.lastModified"),width:"180"},{default:n(({row:o})=>[x(v(i(ne)(o.lastModified)),1)]),_:1},8,["label"]),l(g,{width:"70",align:"right"},{default:n(({row:o})=>[l(I,{icon:"icon-a-setup",tip:i(d)("common.setting"),"data-cy":"setting",onClick:a=>E(o)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data"]),l(Be,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=o=>r.value=o),current:C.value,onSaveSuccess:V},null,8,["modelValue","current"])])}}});export{Do as default};
