var L=(u,C,o)=>new Promise((E,c)=>{var r=d=>{try{m(o.next(d))}catch(w){c(w)}},s=d=>{try{m(o.throw(d))}catch(w){c(w)}},m=d=>d.done?E(d.value):Promise.resolve(d.value).then(r,s);m((o=o.apply(u,C)).next())});import{g as q,v as re,w as ce}from"./i18n.48bd28ac.js";import{g as de,d as pe,a as fe,l as me}from"./textContent.585a78c7.js";import{g as ve,u as ye}from"./main.ea42d807.js";import{u as _e,g as ge,_ as he}from"./index.453b96b0.js";import{G as xe}from"./index.232e741a.js";import{_ as Ce}from"./index.66d5d547.js";import{u as Y}from"./index.4db7adae.js";import{u as X}from"./use-operation-dialog.f0f37a10.js";import{_ as be}from"./k-table.d4486972.js";import{_ as Z}from"./index.a731e53b.js";import{E as Ve}from"./index.77edae39.js";import{E as we}from"./index.b494e80e.js";import{E as ee}from"./index.c4e9b529.js";import{bq as Se,cr as Ee,d as K,g as I,i as G,o as S,j as B,w as j,b as A,u as N,f as M,a as J,b6 as R,F as D,G as te,aH as oe,t as H,az as le,c as z,K as ne,h as ae,aW as ke,k as se,J as Oe,cj as Ie,e as Te,x as Ne}from"./url.2e6a77c4.js";import{_ as ie}from"./index.0f940e7f.js";import{E as ue,a as Fe}from"./index.6855d037.js";import{u as je}from"./use-save-tip.04d9878f.js";import{_ as Ae}from"./plugin-vue_export-helper.21dcd24c.js";import{v as $e,b as Le}from"./style.19d0c187.js";import{s as Be}from"./confirm.e2c924ff.js";import{E as Je}from"./windi.a5b0b048.js";function De(u,C,o,E){for(var c=-1,r=u==null?0:u.length;++c<r;){var s=u[c];C(E,s,o(s),u)}return E}function Me(u,C,o,E){return $e(u,function(c,r,s){C(E,c,o(c),s)}),E}function Ue(u,C){return function(o,E){var c=Se(o)?De:Me,r=C?C():{};return c(o,u,Le(E),r)}}var Pe=Object.prototype,Ke=Pe.hasOwnProperty,Re=Ue(function(u,C,o){Ke.call(u,o)?u[o].push(C):Ee(u,o,[C])}),ze=Re;const Ge={class:"flex items-center"},qe=K({props:{modelValue:{type:Boolean},current:null},setup(u,{emit:C}){const o=u,{t:E}=q(),{visible:c,handleClose:r}=X(o,C),s=I([]),m=I({}),d=I([]),w=I([]);G(()=>o.current,e=>{e.categoryFolder&&p()}),G(()=>o.modelValue,e=>{e&&(w.value=o.current.contents.map(t=>t.id))});function p(){return L(this,null,function*(){const e=yield de({folderId:o.current.categoryFolder.id,pageNr:1,pageSize:99999});k(e.list,e.columns)})}function k(e,t){var i,V;const b={};e.forEach(g=>{b[g.id]=g}),m.value=b;const a=Object.keys((V=(i=e[0])==null?void 0:i.textValues)!=null?V:{})[0];if(a){d.value=[a];const g=t.find($=>$.name==a);s.value=e.map($=>{let l=$.textValues[a];if(g!=null&&g.selectionOptions)try{const f=JSON.parse(g.selectionOptions);let v=[l];g.controlType=="CheckBox"&&(v=JSON.parse(l));const O=[];for(const T of v){const _=f.find(U=>U.value==T);_?O.push(_.key):O.push(T)}l=O.join(",")}catch(f){}return{id:$.id,[a]:l}})}}function y(){o.current.contents=w.value.map(e=>{const t=m.value[e];return t||null}).filter(e=>e).map((e,t)=>(e.order=t,e)),r()}function n(e){const t=w.value.indexOf(e);t>-1?w.value.splice(t,1):o.current.multipleChoice?w.value.push(e):w.value=[e]}return(e,t)=>{const b=Ve,a=we,i=ee;return S(),B(i,{modelValue:N(c),"onUpdate:modelValue":t[0]||(t[0]=V=>te(c)?c.value=V:null),width:"600px","close-on-click-modal":!1,title:N(E)("common.categories"),"custom-class":"el-dialog--fixed-footer",onClose:N(r)},{footer:j(()=>[A(Z,{onConfirm:y,onCancel:N(r)},null,8,["onCancel"])]),default:j(()=>[A(N(be),{data:s.value},{default:j(()=>[A(a,{width:"50"},{default:j(V=>[M("div",Ge,[A(b,{size:"large",class:"pl-14px","model-value":w.value.includes(V.row.id),onChange:g=>n(V.row.id)},null,8,["model-value","onChange"])])]),_:1}),(S(!0),J(D,null,R(d.value,V=>(S(),B(a,{key:V,prop:V,label:V},null,8,["prop","label"]))),128))]),_:1},8,["data"])]),_:1},8,["modelValue","title","onClose"])}}}),He=K({props:{modelValue:null},emits:["update:modelValue"],setup(u,{emit:C}){const E=Y(u,"modelValue",C),c=I(!1),r=I({});function s(p,k){var t,b;let y=(t=p.summaryField)!=null?t:Object.keys(p.textValues)[0];y=(b=Object.keys(p.textValues).find(a=>a.toLowerCase()==y.toLowerCase()))!=null?b:"";let n=p.textValues[y];const e=k.columns.find(a=>{var i;return((i=a.name)==null?void 0:i.toLowerCase())==(y==null?void 0:y.toLowerCase())});if(e!=null&&e.selectionOptions)try{const a=JSON.parse(e.selectionOptions);let i=[n];e.controlType=="CheckBox"&&(i=JSON.parse(n));const V=[];for(const g of i){const $=a.find(l=>l.value==g);$?V.push($.key):V.push(g)}n=V.join(",")}catch(a){}return n}function m(p,k,y){y.list.splice(y.index,1)}function d(p){r.value=p,c.value=!0}function w(p,k){const y=p.splice(k.oldIndex,1)[0];p.splice(k.newIndex,0,y),p.forEach((n,e)=>{n.order=e})}return(p,k)=>{const y=ue;return S(),J(D,null,[(S(!0),J(D,null,R(N(E),(n,e)=>(S(),B(y,{key:e,label:n.display||n.alias},{default:j(()=>[A(ie,{class:"!p-0 min-w-600px",list:n.contents,"id-prop":"id",onSort:t=>w(n.contents,t),onDelete:m,onAdd:t=>d(n)},{default:j(({item:t})=>[oe(H(s(t,n)),1)]),_:2},1032,["list","onSort","onAdd"])]),_:2},1032,["label"]))),128)),(S(),B(le,{to:"body"},[A(qe,{modelValue:c.value,"onUpdate:modelValue":k[0]||(k[0]=n=>c.value=n),current:r.value},null,8,["modelValue","current"])]))],64)}}});const Qe={class:"flex items-center gap-8 max-w-700px truncate"},We=["title"],Ye={key:0,class:"el-dialog__title"},Xe=K({props:{modelValue:{type:Boolean},current:null,currentContent:null,paths:null},emits:["save-success"],setup(u,{emit:C}){const o=u,E=nt,{t:c}=q(),{visible:r,handleClose:s}=X(o,C),m=z(()=>o.current.embeddedFolder.id),d=z(()=>{var e;return(e=o.currentContent)==null?void 0:e.id}),w=I();function p(){return L(this,null,function*(){var t;const e=yield(t=w.value)==null?void 0:t.save();e&&(C("save-success",{id:e.id,textValues:e.values[Object.keys(e.values)[0]]}),s())})}const k=z(()=>{let e=o.paths;return e||(e=[]),e.length&&!e[e.length-1]&&(e.pop(),e.push(c("common.createEmbedded"))),e.length||e.push(c("common.createEmbedded")),e}),y=I();G(()=>r.value,()=>{ne(()=>{var e;r.value?(y.value=(e=Array.from(document.querySelectorAll(".el-overlay")).at(-1))==null?void 0:e.style.zIndex,document.body.style.setProperty("--tox-tinymce-aux-index",y.value),document.body.classList.add("editEmbeddedDialog")):document.body.classList.remove("editEmbeddedDialog")})});function n(e){e.stopImmediatePropagation()}return ae(()=>{window.addEventListener("focusout",n,!0)}),ke(()=>{window.removeEventListener("focusout",n)}),(e,t)=>{const b=ee;return S(),B(b,{modelValue:N(r),"onUpdate:modelValue":t[0]||(t[0]=a=>te(r)?r.value=a:null),width:"800px","close-on-click-modal":!1,"custom-class":"el-dialog--fixed-footer editEmbeddedDialog","destroy-on-close":"",onClose:N(s)},{header:j(()=>[M("div",Qe,[(S(!0),J(D,null,R(N(k),(a,i)=>(S(),J(D,{key:i},[M("div",{class:"el-dialog__title truncate",title:a},H(a),9,We),i<N(k).length-1?(S(),J("div",Ye,">")):se("",!0)],64))),128))])]),footer:j(()=>[A(Z,{onConfirm:p,onCancel:N(s)},null,8,["onCancel"])]),default:j(()=>[A(N(E),{id:N(d),ref_key:"editContent",ref:w,"folder-id":N(m),paths:u.paths},null,8,["id","folder-id","paths"])]),_:1},8,["modelValue","onClose"])}}}),Ze=["onClick"],et=K({props:{modelValue:null,id:null,paths:null},emits:["update:modelValue"],setup(u,{emit:C}){const o=u,{t:E}=q(),c=Y(o,"modelValue",C),r=I(!1),s=I({}),m=I();function d(n,e){var i,V,g,$;if(!n)return"";let t=(g=(V=n.summaryField)!=null?V:(i=e.columns.find(l=>l.isSummaryField))==null?void 0:i.name)!=null?g:Object.keys(n.textValues)[0];t=($=Object.keys(n.textValues).find(l=>l.toLowerCase()==t.toLowerCase()))!=null?$:"";var b=n.textValues[t];const a=e.columns.find(l=>{var f;return((f=l.name)==null?void 0:f.toLowerCase())==(t==null?void 0:t.toLowerCase())});if(a!=null&&a.selectionOptions)try{const l=JSON.parse(a.selectionOptions);let f=[b];a.controlType=="CheckBox"&&(f=JSON.parse(b));const v=[];for(const O of f){const T=l.find(_=>_.value==O);T?v.push(T.key):v.push(O)}b=v.join(",")}catch(l){}return b}function w(n,e,t){return L(this,null,function*(){yield Be(E("common.deleteEmbeddedFolderTips"));const b=t.list.splice(t.index,1);pe({ids:b.map(a=>a.id),parentId:o.id})})}function p(n,e){s.value=n,m.value=e,r.value=!0}function k(n){m.value?m.value.textValues=n.textValues:s.value.contents.push(n)}function y(n,e){const t=n.splice(e.oldIndex,1)[0];n.splice(e.newIndex,0,t),n.forEach((b,a)=>{b.order=a})}return(n,e)=>{var a;const t=Je,b=ue;return S(),J(D,null,[(S(!0),J(D,null,R(N(c),(i,V)=>(S(),B(b,{key:V,label:i.display||i.alias},{default:j(()=>[A(ie,{class:"!p-0 min-w-600px",list:i.contents,"id-prop":"id",onSort:g=>y(i.contents,g),onDelete:w,onAdd:g=>p(i)},{default:j(({item:g})=>[oe(H(d(g,i)),1)]),right:j(({item:g})=>[M("a",{class:"cursor-pointer px-4 hover:text-blue","data-cy":"edit",onClick:$=>p(i,g)},[A(t,{class:"iconfont icon-a-writein"})],8,Ze)]),_:2},1032,["list","onSort","onAdd"])]),_:2},1032,["label"]))),128)),(S(),B(le,{to:"body"},[A(Xe,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=i=>r.value=i),current:s.value,"current-content":m.value,paths:[...(a=u.paths)!=null?a:[],d(m.value,s.value)],onSaveSuccess:k},null,8,["modelValue","current","current-content","paths"])]))],64)}}});const tt={class:"edit-data"},ot={class:"flex justify-end mb-8"},lt=K({props:{folderId:null,contentType:null,id:null,paths:null,associated:{type:Boolean}},setup(u,{expose:C}){const o=u,{t:E}=q(),c=I(),r=I([]),s=I([]),m=I([]),d=I({}),w=I({}),p=ve(),k=I(!1),y=je(),n=ye();ae(()=>L(this,null,function*(){yield t(),o.associated||y.init([d.value,s.value,m.value])}));const e=z(()=>p.visible&&Object.keys(p.cultures).length>1);Oe(()=>{n.firstActiveMenu=""});function t(){return L(this,null,function*(){k.value=!0;const l=yield fe({id:o.id,folderId:o.folderId,typeId:o.contentType});k.value=!1,a(l.properties),s.value=l.categories||[],m.value=l.embedded||[]})}Ie((l,f,v)=>L(this,null,function*(){var O;if(o.associated)return v();l.name==="login"?v():(n.firstActiveMenu=(O=l.meta.activeMenu)!=null?O:l.name,yield y.check([d.value,s.value,m.value]).then(()=>{v()}).catch(()=>{n.firstActiveMenu="contents",v(!1)}))}));const{getControlType:b}=_e();function a(l){if(!l||l.length===0)return;const f=p.default,v=[],O={},T={};l.forEach(_=>{Object.keys(_.values).sort((h,F)=>h===f?-1:F===f?1:0).map(h=>({lang:h,value:_.values[h]})).forEach(h=>{var W;const F={lang:h.lang,name:_.name,displayName:_.isMultilingual&&e.value?_.displayName+" ("+h.lang+")":_.displayName,prop:_.name+"_"+h.lang,toolTip:_.toolTip,selectionOptions:JSON.parse(_.selectionOptions||"[]")||[],validations:JSON.parse((W=_.validations)!=null?W:"[]")||[],multipleValue:_.multipleValue,isMultilingual:_.isMultilingual,controlType:_.controlType,settings:JSON.parse(_.settings||"{}")||{}};v.push(F);let x=h.value;if(F.multipleValue)x=JSON.parse(x||"[]");else{let P=b(_.controlType);P&&(P.value==="Switch"?x&&typeof x=="string"?x=JSON.parse(x.toLowerCase()):x=!!x:P.value==="CheckBox"?x=x?JSON.parse(x):[]:P.value==="KeyValues"?x=x?JSON.parse(x):[]:P.value==="Number"&&(x=x===null?void 0:x))}O[F.prop]=x,T[F.prop]=ge(F)})}),r.value=v,d.value=O,w.value=T}function i(){return L(this,arguments,function*(l={}){var _,U,Q;try{yield(_=c.value)==null?void 0:_.validate()}catch(h){throw yield g(h),h}const f=ze(r.value,h=>h.lang);for(const h in f)l[h]={},f[h].forEach(F=>{let x=d.value[F.prop];(F.multipleValue||Array.isArray(x))&&(x=JSON.stringify(x)),l[h][F.name]=x===void 0?null:x});const v={};(U=s.value)==null||U.forEach(h=>{v[h.categoryFolder.id]=h.contents.map(F=>F.id)});const O={};return(Q=m.value)==null||Q.forEach(h=>{O[h.embeddedFolder.id]=h.contents.map(F=>F.id)}),{id:Ne("copy")?void 0:o.id,folderId:o.folderId,typeId:o.contentType,values:l,categories:v,embedded:O}})}function V(){return L(this,null,function*(){const l={},f=yield i(l),v=yield me(f);return y.init([d.value,s.value,m.value]),{id:v,values:l}})}function g(l){return L(this,null,function*(){var f;if(e.value)for(const v in p.cultures)p.selected.includes(v)||p.selectedChanged(v);if(l&&typeof l=="object"){const v=Object.keys(l)[0];yield ne(),(f=c.value)==null||f.scrollToField(v)}})}function $(l){if(!(o.associated&&l.name=="Online"))return p.selected.includes(l.lang)}return C({save:V,getSaveData:i}),G(()=>[d.value,s.value,m.value],()=>{y.changed([d.value,s.value,m.value])},{deep:!0}),(l,f)=>{const v=Fe;return S(),J("div",tt,[M("div",ot,[A(Ce)]),r.value.length?(S(),B(v,{key:0,ref_key:"form",ref:c,"label-position":"top",model:d.value,rules:w.value,onSubmit:f[2]||(f[2]=ce(()=>{},["prevent"]))},{default:j(()=>{var O;return[(S(!0),J(D,null,R(r.value,(T,_)=>Te((S(),B(he,{key:_,field:T,model:d.value},null,8,["field","model"])),[[re,$(T)]])),128)),A(He,{modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=T=>s.value=T)},null,8,["modelValue"]),A(et,{id:u.id,modelValue:m.value,"onUpdate:modelValue":f[1]||(f[1]=T=>m.value=T),paths:[...(O=u.paths)!=null?O:[]]},null,8,["id","modelValue","paths"])]}),_:1},8,["model","rules"])):k.value?se("",!0):(S(),B(xe,{key:1},{default:j(()=>[M("p",null,H(N(E)("common.noFieldYet")),1)]),_:1}))])}}});var nt=Ae(lt,[["__scopeId","data-v-5a941b71"]]);export{nt as E};
