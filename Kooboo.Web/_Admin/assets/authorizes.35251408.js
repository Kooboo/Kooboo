var z=(A,w,h)=>new Promise((b,V)=>{var n=e=>{try{d(h.next(e))}catch(g){V(g)}},x=e=>{try{d(h.throw(e))}catch(g){V(g)}},d=e=>e.done?b(e.value):Promise.resolve(e.value).then(n,x);d((h=h.apply(A,w)).next())});import{d as q,g as k,c as R,o as v,j as C,w as r,b as o,u as l,f as _,t as N,a as U,b6 as P,F as T,k as $,x as K,b7 as J,e as H,aH as j}from"./url.2e6a77c4.js";import{_ as Q}from"./k-table.d4486972.js";import{a as G,p as W,b as X,c as Y,e as Z}from"./index.aba77680.js";import{u as I}from"./use-date.01b82ce0.js";import{_ as L}from"./icon-button.3313e42d.js";import{B as ee}from"./breadcrumb.80c136b8.js";import{g as M,w as oe,o as ae}from"./i18n.48bd28ac.js";import{u as le}from"./use-operation-dialog.f0f37a10.js";import{a as te,l as ne,r as ie,t as re}from"./validate.efc4a5c0.js";import{_ as se}from"./index.a731e53b.js";import{E as me}from"./index.fc90f5ad.js";import{E as ue,a as de}from"./index.6855d037.js";import{E as ce}from"./index.a439b087.js";import{E as pe}from"./index.c4e9b529.js";import{b as fe}from"./confirm.e2c924ff.js";import{E as ve}from"./windi.a5b0b048.js";import{E as _e}from"./index.2bc50276.js";import{E as he}from"./index.b494e80e.js";import"./sortable.esm.a99254e8.js";import"./main.ea42d807.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./replace-all.7cf5f327.js";import"./index.7034978e.js";import"./index.0d2684bf.js";import"./index.379e80ad.js";import"./focus-trap.23f44899.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.ff0264f3.js";import"./index.fcc3ea42.js";import"./error.7e8331f1.js";import"./event.776e7e11.js";import"./scroll.f51de5d8.js";import"./isEqual.f1ae9fb3.js";import"./_baseIsEqual.c0d7e77a.js";import"./debounce.61c67278.js";import"./toNumber.574be4f1.js";import"./index.064c7de9.js";import"./validator.e2869aba.js";import"./index.77edae39.js";import"./index.695d0284.js";import"./dayjs.min.0a66969b.js";import"./index.8262f5ef.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./index.d75a71d9.js";import"./index.6d45a031.js";import"./index.31f26a0f.js";import"./index.60af85f4.js";import"./style.19d0c187.js";import"./_baseClone.adbc92f5.js";import"./index.603c1365.js";import"./refs.4001ce17.js";import"./logo-transparent.1566007e.js";import"./index.99c4f65d.js";import"./aria.75ec5909.js";const be={class:"h-320px overflow-hidden"},Ve={class:"text-2l bold text-444 dark:text-fff/86"},ye={class:"p-12"},ke=_("div",{class:"text-2l bold text-444"},"jwt ( http, bearer )",-1),we={class:"p-12"},ge=_("div",{class:"text-2l bold text-444"},"api Key",-1),xe={class:"p-12"},Ue={class:"text-2l bold text-444 dark:text-fff/86"},$e={class:"p-24"},Ce={key:0,class:"text-center"},Se=q({props:{modelValue:{type:Boolean},id:null,openApi:null},emits:["update:modelValue","confirm"],setup(A,{emit:w}){const h=A,{visible:b,handleClose:V}=le(h,w),{t:n}=M(),x=k(),d=k({}),e=k({}),g=R(()=>({authorizeName:[te(n("common.nameRequiredTips")),ne(),ie(1,50),y.value?"":re(d.value.openApiName+d.value.authorizeName)]})),S=k([]),y=k(!0),D=k(!1),E=()=>z(this,null,function*(){var p;const t=JSON.parse(h.openApi.jsonData);if((p=t==null?void 0:t.components)!=null&&p.securitySchemes)for(const i in t.components.securitySchemes){const c=s(i);S.value.push({name:s(i),type:t.components.securitySchemes[i].type,value:t.components.securitySchemes[i]}),e.value[c]={}}h.id?(y.value=!0,g.value.name=[],d.value=yield G(h.id),e.value=d.value.securities):(y.value=!1,d.value.openApiName=h.openApi.name,d.value.authorizeName="")}),B=()=>z(this,null,function*(){yield x.value.validate(),d.value.securities=e.value,yield W(d.value),V(),w("confirm")});function s(t){return t.replace(/[^\w]/g,"_").toLowerCase()}function u(t){return t.scheme?t.scheme.toLowerCase():null}return E(),(t,p)=>{const i=me,c=ue,f=de,F=ce,O=pe;return v(),C(O,{"model-value":l(b),width:"600px","close-on-click-modal":!1,title:l(n)("common.authorize"),onClosed:l(V)},{footer:r(()=>[o(se,{"hidden-confirm":!S.value.length,permission:{feature:"openApi",action:"edit"},onConfirm:B,onCancel:l(V)},null,8,["hidden-confirm","onCancel"])]),default:r(()=>[_("div",be,[o(F,null,{default:r(()=>[o(f,{ref_key:"form",ref:x,model:d.value,rules:l(g),"label-width":"130px",onSubmit:p[2]||(p[2]=oe(()=>{},["prevent"])),onKeydown:ae(B,["enter"])},{default:r(()=>[_("div",Ve,N(l(n)("common.basicInformation")),1),_("div",ye,[o(c,{label:l(n)("common.authorizeName"),prop:"authorizeName"},{default:r(()=>[o(i,{modelValue:d.value.authorizeName,"onUpdate:modelValue":p[0]||(p[0]=a=>d.value.authorizeName=a),disabled:y.value},null,8,["modelValue","disabled"])]),_:1},8,["label"])]),(v(!0),U(T,null,P(S.value,a=>(v(),U(T,{key:a.type},[a.type==="http"?(v(),C(f,{key:0,"label-width":"130px"},{default:r(()=>[ke,_("div",we,[u(a.value)==="basic"?(v(),U(T,{key:0},[o(c,{label:l(n)("common.username")},{default:r(()=>[o(i,{modelValue:e.value[a.name].username,"onUpdate:modelValue":m=>e.value[a.name].username=m,placeholder:l(n)("common.username")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),o(c,{label:l(n)("common.password")},{default:r(()=>[o(i,{modelValue:e.value[a.name].password,"onUpdate:modelValue":m=>e.value[a.name].password=m,placeholder:l(n)("common.password")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])],64)):$("",!0),u(a.value)==="bearer"?(v(),U(T,{key:1},[o(c,{label:l(n)("common.name")},{default:r(()=>[o(i,{modelValue:e.value[a.name].name,"onUpdate:modelValue":m=>e.value[a.name].name=m,placeholder:l(n)("common.optionalDefaultBearer")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),o(c,{label:"Bearer"},{default:r(()=>[o(i,{modelValue:e.value[a.name].accessToken,"onUpdate:modelValue":m=>e.value[a.name].accessToken=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64)):$("",!0)])]),_:2},1024)):$("",!0),a.type==="apiKey"?(v(),C(f,{key:1,"label-width":"130px"},{default:r(()=>[ge,_("div",xe,[o(c,{label:"accessToken"},{default:r(()=>[o(i,{modelValue:e.value[a.name].accessToken,"onUpdate:modelValue":m=>e.value[a.name].accessToken=m,placeholder:"accessToken"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])]),_:2},1024)):$("",!0),a.type==="oauth2"?(v(),C(f,{key:2,"label-width":"130px"},{default:r(()=>[_("div",Ue,N(l(n)("oauth2 ( oauth2, clientCredentials )")),1),_("div",$e,[o(c,{label:l(n)("common.clientId")},{default:r(()=>[o(i,{modelValue:e.value[a.name].clientId,"onUpdate:modelValue":m=>e.value[a.name].clientId=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(c,{label:l(n)("common.clientSecret")},{default:r(()=>[o(i,{modelValue:e.value[a.name].clientSecret,"onUpdate:modelValue":m=>e.value[a.name].clientSecret=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),D.value?(v(),U(T,{key:1},[o(c,{label:l(n)("common.name")},{default:r(()=>[o(i,{modelValue:e.value[a.name].name,"onUpdate:modelValue":m=>e.value[a.name].name=m,placeholder:l(n)("common.optionalDefaultBearer")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),o(c,{label:l(n)("common.accessToken")},{default:r(()=>[o(i,{modelValue:e.value[a.name].accessToken,"onUpdate:modelValue":m=>e.value[a.name].accessToken=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(c,{label:l(n)("common.refreshToken")},{default:r(()=>[o(i,{modelValue:e.value[a.name].refreshToken,"onUpdate:modelValue":m=>e.value[a.name].refreshToken=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(c,{label:l(n)("common.expiresIn")},{default:r(()=>[o(i,{modelValue:e.value[a.name].expiresIn,"onUpdate:modelValue":m=>e.value[a.name].expiresIn=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])],64)):(v(),U("div",Ce,[_("span",{class:"text-blue cursor-pointer",onClick:p[1]||(p[1]=m=>D.value=!0)},N(l(n)("common.manuallyFillOut")),1)]))])]),_:2},1024)):$("",!0)],64))),128))]),_:1},8,["model","rules","onKeydown"])]),_:1})])]),_:1},8,["model-value","title","onClosed"])}}}),ze={class:"p-24"},Ne={class:"flex items-center"},Te={class:"flex items-center py-24 space-x-16"},Ae={class:"flex items-center"},De={class:"ellipsis"},jo=q({setup(A){const{t:w}=M(),h=k([]),b=k(),V=k(!1),n=k(""),x=k(K("SiteId")),d=()=>z(this,null,function*(){const s=K("id");h.value=yield X(s),b.value=yield Y(s)}),e=()=>z(this,null,function*(){d()}),g=s=>z(this,null,function*(){yield fe(s.length),yield Z(s.map(u=>u.id)),d()}),S=(s="")=>{n.value=s,V.value=!0},y=R(()=>{if(!b.value)return null;const s=JSON.parse(b.value.jsonData);if(!s.components||!s.components.securitySchemes)return null;for(const u in s.components.securitySchemes){const t=s.components.securitySchemes[u];if(!(t.type!=="oauth2"||!t.flows)){for(const p in t.flows)if(p==="authorizationCode")return{key:u,value:t.flows[p]}}}return null}),D=R(()=>`${location.origin}/_api/openapioauth2callback/${x.value}`),E=s=>{var u;if(!!((u=y.value)!=null&&u.key)){for(const t in s.securities)if(t===y.value.key)return s.securities[t]}},B=s=>{let u="";if(!!b.value){if(y.value){const t=y.value,p=E(s);if(!(t&&p))return;if(u=`${t.authorizationUrl}?response_type=code&state=${new Date().getTime()}&client_id=${p.clientId}&redirect_uri=${D.value}/${s.id}/${y.value.key}`,t.scopes){const i=[];for(const c in t.scopes)i.push(c);u+=`&scope=${encodeURI(i.join(" "))}`}}else{const t=`${location.origin}/_api/OpenApi/SaveToken?SiteId=${x.value}&id=${s.id}`;u=`${b.value.authUrl}?redirect=${encodeURIComponent(t)}`}window.open(u,new Date().getTime().toString())}};return d(),(s,u)=>{const t=ve,p=_e,i=he,c=J("hasPermission");return v(),U("div",ze,[_("div",Ne,[o(ee,{"crumb-path":[{name:"OpenApis",route:{name:"openapis"}},{name:"Authorizes"}]})]),_("div",Te,[H((v(),C(p,{round:"",onClick:u[0]||(u[0]=f=>S())},{default:r(()=>[_("div",Ae,[o(t,{class:"iconfont icon-a-addto"}),j(" "+N(l(w)("common.create")),1)])]),_:1})),[[c,{feature:"openApi",action:"edit"}]])]),o(l(Q),{data:h.value,"show-check":"",permission:{feature:"openApi",action:"edit"},onDelete:g},{default:r(()=>[o(i,{label:l(w)("common.name"),prop:"authorizeName"},{default:r(({row:f})=>[_("span",De,N(f.authorizeName),1)]),_:1},8,["label"]),o(i,{label:l(w)("common.lastModified")},{default:r(({row:f})=>[j(N(l(I)(f.lastModified)),1)]),_:1},8,["label"]),o(i,{width:"90",align:"right"},{default:r(({row:f})=>{var F;return[((F=b.value)==null?void 0:F.authUrl)||l(y)&&E(f)?(v(),C(L,{key:0,tip:l(w)("common.challenge"),icon:"icon-debugging",onClick:O=>B(f)},null,8,["tip","onClick"])):$("",!0),o(L,{icon:"icon-a-writein",tip:l(w)("common.edit"),onClick:O=>S(f.id)},null,8,["tip","onClick"])]}),_:1})]),_:1},8,["data"]),V.value?(v(),C(Se,{key:0,id:n.value,modelValue:V.value,"onUpdate:modelValue":u[1]||(u[1]=f=>V.value=f),"open-api":b.value,onConfirm:e},null,8,["id","modelValue","open-api"])):$("",!0)])}}});export{jo as default};
