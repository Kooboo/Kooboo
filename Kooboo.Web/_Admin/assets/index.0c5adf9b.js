var ye=Object.defineProperty,he=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var ee=(c,o,s)=>o in c?ye(c,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[o]=s,G=(c,o)=>{for(var s in o||(o={}))xe.call(o,s)&&ee(c,s,o[s]);if(Z)for(var s of Z(o))be.call(o,s)&&ee(c,s,o[s]);return c},te=(c,o)=>he(c,Ce(o));var F=(c,o,s)=>new Promise((E,w)=>{var r=i=>{try{y(s.next(i))}catch(g){w(g)}},C=i=>{try{y(s.throw(i))}catch(g){w(g)}},y=i=>i.done?E(i.value):Promise.resolve(i.value).then(r,C);y((s=s.apply(c,o)).next())});import{_ as ke}from"./k-table.e9121736.js";import{_ as we}from"./icon-button.e1f3bfd2.js";import{d as Q,g as I,c as N,h as ae,o as f,j as B,w as e,b as t,u as l,a as $,f as V,aH as z,t as b,k as A,b7 as le,e as se,F as O,M as Se,cd as Ve,N as Ee,b6 as oe}from"./url.2e6a77c4.js";import{B as $e}from"./breadcrumb.0ef7e7c4.js";import{g as W,o as Ie,w as Pe}from"./i18n.97105311.js";import{u as ne}from"./replace-all.8fa5a83d.js";import{a as Be,b as De,u as Te,f as Fe,m as Ne}from"./commerce.c633c6e0.js";import{b as ze}from"./confirm.46f27373.js";import{_ as re}from"./index.9ffc2c80.js";import{S as Ae}from"./search-input.1597a477.js";import{f as Me}from"./product.b50cc736.js";import{u as ie}from"./useFields.b5861b0a.js";import{_ as X}from"./index.aea1b33f.js";import{_ as me}from"./truncate-content.b4da0a61.js";import{E as Re}from"./index.c1764395.js";import{E as Y,a as ce}from"./index.f3d28a97.js";import{E as ue}from"./index.f997a738.js";import{E as Ue}from"./index.7a88a6b5.js";import{E as de}from"./index.4b289bae.js";import{E as pe}from"./windi.539ebeab.js";import{E as _e}from"./index.b09a9f00.js";import{E as fe}from"./index.9589f7cf.js";import{b as Le}from"./useLabels.14342caf.js";import{g as qe}from"./main.52487121.js";import{c as Ke,g as j}from"./string.955a924b.js";import{c as je}from"./index.afee24fe.js";import"./sortable.esm.a99254e8.js";import"./index.6302b2c1.js";import"./event.776e7e11.js";import"./index.9e96921b.js";import"./error.7e8331f1.js";import"./index.975a8825.js";import"./index.bc93d068.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.d267cbe6.js";import"./index.4587e608.js";import"./isNil.98bb3b88.js";import"./index.07e210fb.js";import"./scroll.8babc10c.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.de18cf8f.js";import"./validator.1d438d08.js";/* empty css                                                                 */import"./isEmpty.fff03236.js";import"./_baseIsEqual.abb55a3a.js";import"./search-provider.675d8cd3.js";import"./toNumber.574be4f1.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./style.f835519e.js";import"./_baseUniq.c477b8f6.js";import"./use-operation-dialog.6127483f.js";import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.3ed42952.js";import"./file.c7952a49.js";import"./validate.98ddbafd.js";import"./index.99641a60.js";import"./index.77759eed.js";import"./index.b1fe55d8.js";import"./index.51a59403.js";import"./index.29d7c76d.js";import"./index.317a7f30.js";import"./_baseClone.f10ff33c.js";import"./isEqual.3700b7f1.js";import"./folder.8308bb9d.js";import"./use-date.88693eba.js";import"./dayjs.min.378b3d72.js";import"./relations-tag.64683fac.js";import"./page.d86e40bb.js";import"./guid.c1a40312.js";import"./use-copy-text.81d01785.js";import"./index.0f4f13de.js";import"./browser.dd2c8c17.js";import"./throttle.041b2553.js";import"./debounce.61c67278.js";import"./_createCompounder.591d8488.js";import"./color-picker.f11d48f2.js";import"./index.a34c327d.js";import"./position.b1ced824.js";import"./index.a46fa52c.js";import"./image-cover.dadeb856.js";import"./media-dialog.fc4bbfea.js";import"./media.a886aaea.js";import"./index.f1409b26.js";/* empty css                                                          *//* empty css                                                          */import"./layout.89b59bcc.js";import"./index.6137c0c9.js";import"./utils.fb6ded14.js";import"./index.069e95d0.js";import"./use-file-upload.f6d4a33c.js";import"./index.57372297.js";import"./index.fbe2a003.js";import"./index.0187f789.js";import"./index.13bfae9f.js";import"./file.5d2fc29a.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.4f5fb1ef.js";import"./index.795c7a65.js";import"./dropdown.87a7678e.js";import"./refs.4001ce17.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";const He={key:0},Ge={class:"flex items-center pb-12 space-x-16"},Je=V("div",{class:"flex-1"},null,-1),Oe={class:"text-center"},Qe=Q({props:{excludes:null,modelValue:{type:Boolean}},emits:["update:modelValue","selected"],setup(c,{emit:o}){const s=c,{getColumns:E}=ie(),w=E([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]),{t:r}=W(),C=I(!0),y=I({pageIndex:1,pageSize:30,keyword:"",excludes:s.excludes}),i=I(),g=N(()=>i.value?i.value.list:[]);function D(p){return F(this,null,function*(){y.value.pageIndex=p,i.value=yield Me(y.value),i.value.list=i.value.list.map(_=>te(G({},_),{selected:!1}))})}const S=N(()=>g.value.some(p=>p.selected)&&g.value.some(p=>!p.selected)),h=N(()=>g.value.length&&g.value.every(p=>p.selected));function T(p){g.value.forEach(_=>_.selected=p)}ae(()=>{D(1)});function L(){o("selected",g.value.filter(p=>p.selected)),C.value=!1}return(p,_)=>{const M=Ae,R=Re,q=Y,K=ce,m=ue,a=Ue,n=re,u=de;return f(),B(u,{"model-value":C.value,width:"800px",title:l(r)("common.selectProduct"),"close-on-click-modal":!1,onClosed:_[3]||(_[3]=d=>o("update:modelValue",!1))},{footer:e(()=>[t(n,{disabled:!l(g).some(d=>d.selected),onConfirm:L,onCancel:_[2]||(_[2]=d=>C.value=!1)},null,8,["disabled"])]),default:e(()=>{var d,k,P;return[i.value?(f(),$("div",He,[V("div",Ge,[Je,t(M,{modelValue:y.value.keyword,"onUpdate:modelValue":_[0]||(_[0]=x=>y.value.keyword=x),class:"w-248px",onKeydown:_[1]||(_[1]=Ie(Pe(x=>D(1),["prevent"]),["enter"]))},null,8,["modelValue"])]),t(m,{"max-height":"400px"},{default:e(()=>[t(K,{data:l(g),class:"el-table--gray"},{default:e(()=>[t(q,{width:"60",align:"center"},{header:e(()=>[t(R,{size:"large",class:"!block !h-20px",indeterminate:l(S),"model-value":l(h),onChange:T},null,8,["indeterminate","model-value"])]),default:e(({row:x})=>[t(R,{modelValue:x.selected,"onUpdate:modelValue":J=>x.selected=J,size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(X,{columns:l(w)},{title:e(({row:x})=>[t(me,{tip:x.title},{default:e(()=>[z(b(x.title),1)]),_:2},1032,["tip"])]),_:1},8,["columns"])]),_:1},8,["data"])]),_:1}),V("div",Oe,[t(a,{class:"py-8",layout:"prev, pager, next","hide-on-single-page":"","page-size":(d=i.value)==null?void 0:d.pageSize,"current-page":(k=i.value)==null?void 0:k.pageIndex,total:(P=i.value)==null?void 0:P.count,onCurrentChange:D},null,8,["page-size","current-page","total"])])])):A("",!0)]}),_:1},8,["model-value","title"])}}}),We={class:"space-y-12"},Xe={class:"flex items-center"},Ye=Q({props:{editable:{type:Boolean},categoryId:null,modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(c,{emit:o}){const s=c,{t:E}=W(),w=I(!0),r=I(),C=I(!1),{getColumns:y}=ie(),i=y([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]);Be(s.categoryId).then(S=>{r.value=S});function g(S){var h;(h=r.value)==null||h.push(...S)}function D(){return F(this,null,function*(){yield De(s.categoryId,r.value.map(S=>S.id)),w.value=!1,o("reload")})}return(S,h)=>{var a;const T=pe,L=_e,p=fe,_=Y,M=ce,R=ue,q=re,K=de,m=le("hasPermission");return f(),$(O,null,[t(K,{"model-value":w.value,width:"850px",title:l(E)("common.products"),"close-on-click-modal":!1,onClosed:h[2]||(h[2]=n=>o("update:modelValue",!1))},{footer:e(()=>[t(q,{onConfirm:D,onCancel:h[1]||(h[1]=n=>w.value=!1)})]),default:e(()=>[V("div",We,[c.editable?se((f(),B(L,{key:0,round:"",onClick:h[0]||(h[0]=n=>C.value=!0)},{default:e(()=>[V("div",Xe,[t(T,{class:"mr-16 iconfont icon-a-addto"}),z(" "+b(l(E)("common.addProduct")),1)])]),_:1})),[[m,{feature:"productCategories",action:"edit"}]]):A("",!0),t(R,{"max-height":"400px"},{default:e(()=>[t(M,{data:r.value,class:"el-table--gray"},{default:e(()=>[t(X,{columns:l(i)},{title:e(({row:n})=>[t(me,{tip:n.title},{default:e(()=>[z(b(n.title),1)]),_:2},1032,["tip"])]),_:1},8,["columns"]),c.editable?(f(),B(_,{key:0,align:"right",width:"60"},{default:e(({row:n})=>[t(p,{placement:"top",content:l(E)("common.delete")},{default:e(()=>[t(T,{class:"iconfont icon-delete hover:text-blue text-l",onClick:u=>r.value=r.value.filter(d=>d.id!=n.id)},null,8,["onClick"])]),_:2},1032,["content"])]),_:1})):A("",!0)]),_:1},8,["data"])]),_:1})])]),_:1},8,["model-value","title"]),C.value?(f(),B(Qe,{key:0,modelValue:C.value,"onUpdate:modelValue":h[3]||(h[3]=n=>C.value=n),excludes:(a=r.value)==null?void 0:a.map(n=>n.id),onSelected:g},null,8,["modelValue","excludes"])):A("",!0)],64)}}}),Ze={class:"p-24"},et={class:"flex items-center py-24 space-x-16"},tt={class:"flex items-center"},ot={class:"flex items-center"},nt={class:"text-black dark:text-[#cfd3dc]"},at={class:"inline-flex flex-wrap gap-4"},lt={key:0,class:"text-s"},st={key:0},rt={key:1,class:"text-s"},mn=Q({setup(c){const{t:o}=W(),s=Se(),E=Ve(),w=s.meta.title,r=Te(),C=I(),y=I(!1),i=I(r.settings);r.loadSettings().then(()=>{i.value=r.settings});const{getFieldDisplayName:g}=Le(),D=qe(),S={image:{width:80}},h={"min-width":180},T=N(()=>{var m;return((m=M.value)==null?void 0:m.length)>1}),L=N(()=>T.value);function p(m){return F(this,null,function*(){yield ze(m.length),yield Fe(m.map(a=>a.id)),r.loadCategories()})}const _=N(()=>{var n;const m=(n=i.value.categoryCustomFields)!=null?n:[];let a=m.filter(u=>u.isSummaryField);return a.length||(a=m.slice(0,2)),a.map(u=>({name:Ke(u.name),displayName:g(u),controlType:u.type,multipleValue:u.multiple,attrs:G(G({},h),j(S,u.name))}))}),M=N(()=>{var m;return((m=r.categories)!=null?m:[]).map(a=>{var u;const n=(u=j(a,"customData"))!=null?u:{};for(const d of _.value)if(!j(a,d.name)){const k=j(n,d.name);if(!k)continue;a[d.name]=j(k,D.default)}return a})});function R(m){C.value=m,y.value=!0}function q(m,a){return F(this,null,function*(){const{newIndex:n,oldIndex:u}=a;if(n===void 0||u===void 0||u===n)return;const d=m[n],k=m[n+1],P=m[n-1],x={source:d.id,prevId:k==null?void 0:k.id,nextId:P==null?void 0:P.id};yield Ne(x),r.loadCategories()})}function K(){return F(this,null,function*(){r.loadCategories()})}return ae(()=>F(this,null,function*(){r.loadCategories()})),(m,a)=>{const n=pe,u=_e,d=je,k=fe,P=Ee("router-link"),x=we,J=Y,ge=ke,ve=le("hasPermission");return f(),$("div",Ze,[t($e,{name:l(w)},null,8,["name"]),V("div",et,[se((f(),B(u,{round:"",onClick:a[0]||(a[0]=v=>l(E).push(l(ne)({name:"product category create"})))},{default:e(()=>[V("div",tt,[t(n,{class:"mr-16 iconfont icon-a-addto"}),z(" "+b(l(o)("common.create")),1)])]),_:1})),[[ve,{feature:"productCategories",action:"edit"}]])]),t(ge,{data:l(M),"show-check":"",draggable:l(T),"row-key":"id",onDelete:p,onSorted:q,onSortChange:K,onChange:a[1]||(a[1]=()=>l(r).loadCategories())},{default:e(()=>[t(X,{columns:l(_)},{title:e(({row:v})=>[V("div",ot,[V("span",nt,b(v.title),1)])]),tags:e(({row:v})=>[V("div",at,[(f(!0),$(O,null,oe(v.tags,(U,H)=>(f(),B(d,{key:H,round:"",size:"small",type:"warning"},{default:e(()=>[z(b(U),1)]),_:2},1024))),128))])]),productCount:e(({row:v})=>[t(d,{round:"",class:"cursor-pointer",type:"success",onClick:U=>R(v)},{default:e(()=>[z(b(v.productCount),1)]),_:2},1032,["onClick"])]),condition:e(({row:v})=>[v.type=="Automated"?(f(),$("div",lt,[(f(!0),$(O,null,oe(v.condition.items,(U,H)=>(f(),$("div",{key:H},[H>0?(f(),$("span",st,b(v.condition.isAny?l(o)("common.or"):l(o)("common.and")),1)):A("",!0),z(" "+b(U.option)+" "+b(U.method)+" "+b(U.value),1)]))),128))])):(f(),$("span",rt,b(l(o)("common.manual")),1))]),_:1},8,["columns"]),t(J,{align:"right",width:"100",fixed:"right"},{default:e(({row:v})=>[t(P,{to:l(ne)({name:"product category edit",query:{id:v.id}}),class:"mx-8"},{default:e(()=>[t(k,{placement:"top",content:l(o)("common.edit")},{default:e(()=>[t(n,{class:"iconfont icon-a-writein hover:text-blue text-l"})]),_:1},8,["content"])]),_:2},1032,["to"]),l(L)?(f(),B(x,{key:0,icon:"icon-move js-sortable cursor-move",tip:l(o)("common.move"),"data-cy":"move"},null,8,["tip"])):A("",!0)]),_:1})]),_:1},8,["data","draggable"]),y.value?(f(),B(Ye,{key:0,modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=v=>y.value=v),"category-id":C.value.id,editable:C.value.type=="Manual",onReload:a[3]||(a[3]=v=>l(r).loadCategories())},null,8,["modelValue","category-id","editable"])):A("",!0)])}}});export{mn as default};
