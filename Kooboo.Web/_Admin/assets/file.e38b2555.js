var be=Object.defineProperty,ke=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var le=(r,o,l)=>o in r?be(r,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[o]=l,oe=(r,o)=>{for(var l in o||(o={}))Ce.call(o,l)&&le(r,l,o[l]);if(te)for(var l of te(o))xe.call(o,l)&&le(r,l,o[l]);return r},se=(r,o)=>ke(r,we(o));var V=(r,o,l)=>new Promise((w,n)=>{var c=i=>{try{_(l.next(i))}catch(C){n(C)}},N=i=>{try{_(l.throw(i))}catch(C){n(C)}},_=i=>i.done?w(i.value):Promise.resolve(i.value).then(c,N);_((l=l.apply(r,o)).next())});import{_ as Fe}from"./index.0e262df3.js";import{g as Pe,a as Ue,b as Le,e as Se,d as Ee,i as ze}from"./file.b0d4cc6e.js";import{B as Be}from"./breadcrumb.80c136b8.js";import{_ as Ie,M as Ve,a as Me,b as Ne,c as ne,t as ie}from"./search-provider.68dc3c2c.js";import{d as De,B as $e,cd as Re,M as Ae,g as m,E as Ke,c as z,h as Te,i as O,b7 as je,o as F,a as W,u as t,b as k,k as P,f as U,j as M,w as $,aH as B,t as L,e as Y,cg as qe,c0 as He}from"./url.2e6a77c4.js";import{b as Oe,d as We}from"./confirm.e2c924ff.js";import{i as re,l as Ye}from"./main.ea42d807.js";import{g as Ge}from"./i18n.48bd28ac.js";import{u as Je,a as Qe}from"./replace-all.7cf5f327.js";/* empty css                                                         */import{_ as Xe}from"./plugin-vue_export-helper.21dcd24c.js";import{l as Ze}from"./last.e7aa49db.js";import{E as ea}from"./index.77edae39.js";import{E as aa,j as ta}from"./windi.a5b0b048.js";import{E as la}from"./index.2bc50276.js";const oa={class:"media"},sa={key:0,class:"flex items-center px-24 relative"},na={class:"p-24 media__body"},ia={class:"flex items-center justify-between mb-16 media__head"},ra={class:"flex items-center space-x-24"},ua={key:0,class:"text-s mb-12 text-666 flex items-center space-x-4"},da={class:"rounded-normal overflow-hidden shadow-s-10"},ca=De({emits:["loaded"],setup(r,{expose:o,emit:l}){let w;const{t:n}=Ge(),c=$e("dialogInfo"),N=Re(),_=Ae(),i=m(!1),C=m(!1),f=m([]),v=m([]),S=m(!1),y=m("/"),u=Ke({currentPage:1,pageSize:50,totalCount:0}),R=m(!1),p=m(""),d=m(_.query.provider||"default"),A=m([]),ue=z(()=>Pe(d.value)),E=z(()=>v.value.filter(e=>e.selected)),I=z(()=>f.value.filter(e=>e.selected)),K=z(()=>E.value.length+I.value.length),G=z(()=>v.value.length+f.value.length),J=m([]),Q=z(()=>J.value.map(e=>(e.name==="searchResult"?e.name=n("common.searchResult"):e.name==="root"&&!c&&(e.name=n("common.files")),e)));function de(){w||(w=ta.service({background:"rgba(0, 0, 0, 0.5)"}))}function ce(){w==null||w.close(),w=void 0}Te(()=>{c?D():O(()=>_.query,e=>{_.name==="files"&&(y.value=e.folder||"/",p.value=e.keyword||"",d.value=e.provider||"default",D())},{immediate:!0,deep:!0})}),O(()=>i.value,e=>{f.value.forEach(a=>{a.selected=e}),v.value.forEach(a=>{a.selected=e})}),O(()=>K.value,e=>{e===0?(i.value=!1,C.value=!1):e<G.value?C.value=!0:e===G.value&&(C.value=!1,i.value=!0)});function T(e){return V(this,null,function*(){var h,g;const a=yield Ue({pageNr:e,pageSize:u.pageSize,path:y.value,keyword:(h=p.value)==null?void 0:h.trim(),provider:d.value,startAfter:e>1?(g=Ze(v.value))==null?void 0:g.key:""});fe(a,e)})}function fe(e,a){var b;if(A.value=(b=e.providers)!=null?b:[],J.value=e.crumbPath,e.errorMessage){f.value=[],v.value=[],u.totalCount=0,u.currentPage=1,console.warn(e.errorMessage),re(n("common.configError",{message:e.errorMessage.replace("{troubleshoot}",n("common.troubleshoot"))}),!0,{dangerouslyUseHTMLString:!0});return}S.value=e.files.infinite,S.value&&(a=e.files.pageNr);const h=(e.folders||[]).map(s=>(s.selected=!1,s));!S.value||a<=1?f.value=ne(h,"id"):f.value=ne([...f.value,...h],"id");const g=e.files.list.map(s=>(s.selected=!1,s.references=s.references||s.relations||{},s));v.value=!S.value||a<=1?g:[...v.value,...g],u.totalCount=e.files.totalCount,u.currentPage=a,u.pageSize=e.files.pageSize,l("loaded",{keyword:p.value,data:e,providers:A.value,infinite:S.value})}function me(e){u.currentPage=e,T(e)}function X(e){y.value=e.fullPath,u.currentPage=1,p.value="",v.value=[],f.value=[],j()}function ve(){Ye(),Z(),ce()}function j(){c?T(u.currentPage):N.push({name:_.name,query:se(oe({},_.query),{folder:y.value,keyword:p.value,provider:d.value})})}function D(){j(),T(u.currentPage)}function pe(){R.value=!0}function Z(){u.currentPage=1,D()}function he(){return V(this,null,function*(){try{yield Oe(E.value.length+I.value.length),I.value.length>0&&(yield Le(I.value.map(e=>e.fullPath),d.value)),E.value.length>0&&(yield Se(E.value.map(e=>e.key),d.value)),Z()}catch(e){}})}function ge(){return V(this,null,function*(){const e=I.value.map(s=>s.fullPath),a=E.value.map(s=>s.key),h={folder:y.value,folders:e,files:a},g=yield Ee(h,d.value);if(!g)return;const b=Qe(`Download/Package?file=${g}&type=file`);qe(`/_api/v2/${b}`)})}function ee(e){ie(e.fullPath,"/")!==ie(y.value,"/")&&q(e)}function q(e){X(e)}const ae=150;function _e(e){return V(this,null,function*(){if(e.size>1024*1024*ae)return re(n("common.maxUploadFileSizeOutOfLimit",{file:e.name,size:ae}),!0),!1;const a=He(y.value,e.name);(yield ze(d.value,a).then(()=>!0).catch(()=>!1))||(yield We()),de()})}function ye(){q({name:"root",fullPath:"/"})}return o({selectedFiles:E,getCrumbPath:Q,handleClickPath:q,handleClickBreadcrumb:ee}),(e,a)=>{const h=ea,g=Fe,b=aa,s=la,H=je("hasPermission");return F(),W("div",oa,[t(c)?P("",!0):(F(),W("div",sa,[k(Be,{"crumb-path":t(Q),onHandleClickPath:ee},null,8,["crumb-path"])])),U("div",na,[U("div",ia,[U("div",ra,[t(c)?P("",!0):(F(),M(h,{key:0,modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=x=>i.value=x),indeterminate:C.value,size:"large","data-cy":"check-all"},{default:$(()=>[B(L(t(n)("common.selectAllFiles")),1)]),_:1},8,["modelValue","indeterminate"])),k(g,{permission:{feature:"file",action:"edit"},disabled:!!p.value,multiple:!0,action:t(ue),"before-upload":_e,"on-success":ve,data:{folder:y.value}},null,8,["disabled","action","data"]),t(c)?P("",!0):Y((F(),M(s,{key:1,disabled:!!p.value,round:"","data-cy":"new-folder",onClick:pe},{default:$(()=>[k(b,{class:"iconfont icon-a-addfile"}),B(" "+L(t(n)("common.newFolder")),1)]),_:1},8,["disabled"])),[[H,{feature:"file",action:"edit"}]]),t(K)>0&&!t(c)?Y((F(),M(s,{key:2,round:"","data-cy":"download",onClick:ge},{default:$(()=>[k(b,{class:"iconfont icon-xiazai-wenjianxiazai-05"}),B(" "+L(t(n)("common.download")),1)]),_:1})),[[H,{feature:"file",action:"view"}]]):P("",!0),t(K)>0&&!t(c)?Y((F(),M(s,{key:3,round:"",class:"text-orange","data-cy":"delete",onClick:he},{default:$(()=>[k(b,{class:"iconfont icon-delete"}),B(L(t(n)("common.delete")),1)]),_:1})),[[H,{feature:"file",action:"delete"}]]):P("",!0)]),U("div",null,[k(Ie,{provider:d.value,"onUpdate:provider":[a[1]||(a[1]=x=>d.value=x),ye],searchKey:p.value,"onUpdate:searchKey":[a[2]||(a[2]=x=>p.value=x),j],providers:A.value},null,8,["provider","searchKey","providers"])])]),t(c)?P("",!0):(F(),W("div",ua,[k(b,{class:"iconfont icon-Tips"}),U("div",null,[B(L(t(n)("common.thePicturesAndIconsDisplayedOnYourWebsiteAreSuggestedToBePutInThe"))+" ",1),U("span",{class:"text-blue cursor-pointer",onClick:a[3]||(a[3]=x=>t(N).push(t(Je)({name:"media"})))},L(t(n)("common.mediaLibrary")),1),B(" "+L(t(n)("common.forManagement")),1)])])),U("div",da,[k(Ve,{folders:f.value,files:v.value,"has-checkbox":!0,"hide-open-folder":!p.value,"folder-type":"File",provider:d.value,onClickFolder:X},null,8,["folders","files","hide-open-folder","provider"]),v.value.length||f.value.length?(F(),M(Me,{key:0,class:"dark:bg-[#1e1e1e] py-24",pagination:t(u),infinite:S.value,onCurrentChange:me},null,8,["pagination","infinite"])):P("",!0)])]),k(Ne,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=x=>R.value=x),path:y.value,folders:f.value,provider:d.value,"folder-type":"File",onCreateSuccess:D},null,8,["modelValue","path","folders","provider"])])}}});var La=Xe(ca,[["__scopeId","data-v-6a265bf6"]]);export{La as F};
