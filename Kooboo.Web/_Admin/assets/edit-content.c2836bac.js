var N=(n,f,l)=>new Promise((x,u)=>{var s=r=>{try{c(l.next(r))}catch(_){u(_)}},a=r=>{try{c(l.throw(r))}catch(_){u(_)}},c=r=>r.done?x(r.value):Promise.resolve(r.value).then(s,a);c((l=l.apply(n,f)).next())});import{g as z,v as re,w as ie}from"./i18n.25caaace.js";import{g as ce,d as de,a as pe,l as me}from"./textContent.f45c90f4.js";import{g as fe,u as ve}from"./main.1c3b59e3.js";import{u as _e,g as ge,_ as ye}from"./index.50211567.js";import{G as he}from"./index.3be79fd5.js";import{_ as be}from"./index.5d366322.js";import{u as W}from"./index.b9334ca3.js";import{u as X}from"./use-operation-dialog.450d2247.js";import{_ as xe}from"./k-table.c13bd7f5.js";import{_ as Z}from"./index.50326354.js";import{E as Ce}from"./index.2e51d36e.js";import{E as Ve}from"./index.5388dbc8.js";import{E as ee}from"./index.a5d96e5a.js";import{bq as we,cr as Ee,d as U,g as E,i as R,o as b,j,w as T,b as F,u as I,f as M,a as D,b6 as P,F as B,G as te,aH as le,t as G,az as oe,c as K,K as ae,k as ne,h as Se,J as ke,cj as Ie,e as Oe,x as Te}from"./url.8f5ec20c.js";import{_ as se}from"./index.20e420e8.js";import{E as ue,a as Fe}from"./index.94998415.js";import{u as Ae}from"./use-save-tip.63213ba1.js";import{_ as $e}from"./plugin-vue_export-helper.21dcd24c.js";import{v as Ne,b as je}from"./style.1b77b3a2.js";import{s as De}from"./confirm.629bcef4.js";import{E as Le}from"./windi.a815125a.js";function Be(n,f,l,x){for(var u=-1,s=n==null?0:n.length;++u<s;){var a=n[u];f(x,a,l(a),n)}return x}function Me(n,f,l,x){return Ne(n,function(u,s,a){f(x,u,l(u),a)}),x}function Je(n,f){return function(l,x){var u=we(l)?Be:Me,s=f?f():{};return u(l,n,je(x),s)}}var Ue=Object.prototype,Pe=Ue.hasOwnProperty,Ke=Je(function(n,f,l){Pe.call(n,l)?n[l].push(f):Ee(n,l,[f])}),Re=Ke;const ze={class:"flex items-center"},Ge=U({props:{modelValue:{type:Boolean},current:null},setup(n,{emit:f}){const l=n,{t:x}=z(),{visible:u,handleClose:s}=X(l,f),a=E([]),c=E({}),r=E([]),_=E([]);R(()=>l.current,t=>{t.categoryFolder&&i()}),R(()=>l.modelValue,t=>{t&&(_.value=l.current.contents.map(o=>o.id))});function i(){return N(this,null,function*(){const t=yield ce({folderId:l.current.categoryFolder.id,pageNr:1,pageSize:99999});g(t.list)})}function g(t){var S,k;const o={};t.forEach(V=>{o[V.id]=V}),c.value=o;const v=Object.keys((k=(S=t[0])==null?void 0:S.textValues)!=null?k:{})[0];v&&(r.value=[v],a.value=t.map(V=>({id:V.id,[v]:V.textValues[v]})))}function y(){l.current.contents=_.value.map(t=>{const o=c.value[t];return o||null}).filter(t=>t).map((t,o)=>(t.order=o,t)),s()}function e(t){const o=_.value.indexOf(t);o>-1?_.value.splice(o,1):l.current.multipleChoice?_.value.push(t):_.value=[t]}return(t,o)=>{const v=Ce,S=Ve,k=ee;return b(),j(k,{modelValue:I(u),"onUpdate:modelValue":o[0]||(o[0]=V=>te(u)?u.value=V:null),width:"600px","close-on-click-modal":!1,title:I(x)("common.categories"),"custom-class":"el-dialog--fixed-footer",onClose:I(s)},{footer:T(()=>[F(Z,{onConfirm:y,onCancel:I(s)},null,8,["onCancel"])]),default:T(()=>[F(I(xe),{data:a.value},{default:T(()=>[F(S,{width:"50"},{default:T(V=>[M("div",ze,[F(v,{size:"large",class:"pl-14px","model-value":_.value.includes(V.row.id),onChange:L=>e(V.row.id)},null,8,["model-value","onChange"])])]),_:1}),(b(!0),D(B,null,P(r.value,V=>(b(),j(S,{key:V,prop:V,label:V},null,8,["prop","label"]))),128))]),_:1},8,["data"])]),_:1},8,["modelValue","title","onClose"])}}}),qe=U({props:{modelValue:null},emits:["update:modelValue"],setup(n,{emit:f}){const x=W(n,"modelValue",f),u=E(!1),s=E({});function a(i){var y,e;let g=(y=i.summaryField)!=null?y:Object.keys(i.textValues)[0];return g=(e=Object.keys(i.textValues).find(t=>t.toLowerCase()==g.toLowerCase()))!=null?e:"",i.textValues[g]}function c(i,g,y){y.list.splice(y.index,1)}function r(i){s.value=i,u.value=!0}function _(i,g){const y=i.splice(g.oldIndex,1)[0];i.splice(g.newIndex,0,y),i.forEach((e,t)=>{e.order=t})}return(i,g)=>{const y=ue;return b(),D(B,null,[(b(!0),D(B,null,P(I(x),(e,t)=>(b(),j(y,{key:t,label:e.display||e.alias},{default:T(()=>[F(se,{class:"!p-0 min-w-600px",list:e.contents,"id-prop":"id",onSort:o=>_(e.contents,o),onDelete:c,onAdd:o=>r(e)},{default:T(({item:o})=>[le(G(a(o)),1)]),_:2},1032,["list","onSort","onAdd"])]),_:2},1032,["label"]))),128)),(b(),j(oe,{to:"body"},[F(Ge,{modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=e=>u.value=e),current:s.value},null,8,["modelValue","current"])]))],64)}}});const He={class:"flex items-center gap-8 max-w-700px truncate"},Qe=["title"],Ye={key:0,class:"el-dialog__title"},We=U({props:{modelValue:{type:Boolean},current:null,currentContent:null,paths:null},emits:["save-success"],setup(n,{emit:f}){const l=n,x=ot,{t:u}=z(),{visible:s,handleClose:a}=X(l,f),c=K(()=>l.current.embeddedFolder.id),r=K(()=>{var e;return(e=l.currentContent)==null?void 0:e.id}),_=E();function i(){return N(this,null,function*(){var t;const e=yield(t=_.value)==null?void 0:t.save();e&&(f("save-success",{id:e.id,textValues:e.values[Object.keys(e.values)[0]]}),a())})}const g=K(()=>{let e=l.paths;return e||(e=[]),e.length&&!e[e.length-1]&&(e.pop(),e.push(u("common.createEmbedded"))),e.length||e.push(u("common.createEmbedded")),e}),y=E();return R(()=>s.value,()=>{ae(()=>{var e;s.value?(y.value=(e=Array.from(document.querySelectorAll(".el-overlay")).at(-1))==null?void 0:e.style.zIndex,document.body.style.setProperty("--tox-tinymce-aux-index",y.value),document.body.classList.add("editEmbeddedDialog")):document.body.classList.remove("editEmbeddedDialog")})}),(e,t)=>{const o=ee;return b(),j(o,{modelValue:I(s),"onUpdate:modelValue":t[0]||(t[0]=v=>te(s)?s.value=v:null),width:"800px","close-on-click-modal":!1,"custom-class":"el-dialog--fixed-footer editEmbeddedDialog","destroy-on-close":"",onClose:I(a)},{header:T(()=>[M("div",He,[(b(!0),D(B,null,P(I(g),(v,S)=>(b(),D(B,{key:S},[M("div",{class:"el-dialog__title truncate",title:v},G(v),9,Qe),S<I(g).length-1?(b(),D("div",Ye,">")):ne("",!0)],64))),128))])]),footer:T(()=>[F(Z,{onConfirm:i,onCancel:I(a)},null,8,["onCancel"])]),default:T(()=>[F(I(x),{id:I(r),ref_key:"editContent",ref:_,"folder-id":I(c),paths:n.paths},null,8,["id","folder-id","paths"])]),_:1},8,["modelValue","onClose"])}}}),Xe=["onClick"],Ze=U({props:{modelValue:null,id:null,paths:null},emits:["update:modelValue"],setup(n,{emit:f}){const l=n,{t:x}=z(),u=W(l,"modelValue",f),s=E(!1),a=E({}),c=E();function r(e){if(!e)return"";var t=Object.keys(e.textValues).find(o=>{var v;return(o==null?void 0:o.toLocaleLowerCase())==((v=e.summaryField)==null?void 0:v.toLocaleLowerCase())});return e.textValues[t!=null?t:Object.keys(e.textValues)[0]]}function _(e,t,o){return N(this,null,function*(){yield De(x("common.deleteEmbeddedFolderTips"));const v=o.list.splice(o.index,1);de({ids:v.map(S=>S.id),parentId:l.id})})}function i(e,t){a.value=e,c.value=t,s.value=!0}function g(e){c.value?c.value.textValues=e.textValues:a.value.contents.push(e)}function y(e,t){const o=e.splice(t.oldIndex,1)[0];e.splice(t.newIndex,0,o),e.forEach((v,S)=>{v.order=S})}return(e,t)=>{var S;const o=Le,v=ue;return b(),D(B,null,[(b(!0),D(B,null,P(I(u),(k,V)=>(b(),j(v,{key:V,label:k.display||k.alias},{default:T(()=>[F(se,{class:"!p-0 min-w-600px",list:k.contents,"id-prop":"id",onSort:L=>y(k.contents,L),onDelete:_,onAdd:L=>i(k)},{default:T(({item:L})=>[le(G(r(L)),1)]),right:T(({item:L})=>[M("a",{class:"cursor-pointer px-4 hover:text-blue","data-cy":"edit",onClick:Q=>i(k,L)},[F(o,{class:"iconfont icon-a-writein"})],8,Xe)]),_:2},1032,["list","onSort","onAdd"])]),_:2},1032,["label"]))),128)),(b(),j(oe,{to:"body"},[F(We,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=k=>s.value=k),current:a.value,"current-content":c.value,paths:[...(S=n.paths)!=null?S:[],r(c.value)],onSaveSuccess:g},null,8,["modelValue","current","current-content","paths"])]))],64)}}});const et={class:"edit-data"},tt={class:"flex justify-end mb-8"},lt=U({props:{folderId:null,contentType:null,id:null,paths:null,associated:{type:Boolean}},setup(n,{expose:f}){const l=n,{t:x}=z(),u=E(),s=E([]),a=E([]),c=E([]),r=E({}),_=E({}),i=fe(),g=E(!1),y=Ae(),e=ve();Se(()=>N(this,null,function*(){yield o(),l.associated||y.init([r.value,a.value,c.value])}));const t=K(()=>i.visible&&Object.keys(i.cultures).length>1);ke(()=>{e.firstActiveMenu=""});function o(){return N(this,null,function*(){g.value=!0;const d=yield pe({id:l.id,folderId:l.folderId,typeId:l.contentType});g.value=!1,S(d.properties),a.value=d.categories||[],c.value=d.embedded||[]})}Ie((d,w,C)=>N(this,null,function*(){var A;if(l.associated)return C();d.name==="login"?C():(e.firstActiveMenu=(A=d.meta.activeMenu)!=null?A:d.name,yield y.check([r.value,a.value,c.value]).then(()=>{C()}).catch(()=>{e.firstActiveMenu="contents",C(!1)}))}));const{getControlType:v}=_e();function S(d){if(!d||d.length===0)return;const w=i.default,C=[],A={},$={};d.forEach(h=>{Object.keys(h.values).sort((p,O)=>p===w?-1:O===w?1:0).map(p=>({lang:p,value:h.values[p]})).forEach(p=>{var Y;const O={lang:p.lang,name:h.name,displayName:h.isMultilingual&&t.value?h.displayName+" ("+p.lang+")":h.displayName,prop:h.name+"_"+p.lang,toolTip:h.toolTip,selectionOptions:JSON.parse(h.selectionOptions||"[]")||[],validations:JSON.parse((Y=h.validations)!=null?Y:"[]")||[],multipleValue:h.multipleValue,isMultilingual:h.isMultilingual,controlType:h.controlType,settings:JSON.parse(h.settings||"{}")||{}};C.push(O);let m=p.value;if(O.multipleValue)m=JSON.parse(m||"[]");else{let J=v(h.controlType);J&&(J.value==="Switch"?m&&typeof m=="string"?m=JSON.parse(m.toLowerCase()):m=!!m:J.value==="CheckBox"?m=m?JSON.parse(m):[]:J.value==="KeyValues"?m=m?JSON.parse(m):[]:J.value==="Number"&&(m=m===null?void 0:m))}A[O.prop]=m,$[O.prop]=ge(O)})}),s.value=C,r.value=A,_.value=$}function k(){return N(this,arguments,function*(d={}){var h,q,H;try{yield(h=u.value)==null?void 0:h.validate()}catch(p){throw yield L(p),p}const w=Re(s.value,p=>p.lang);for(const p in w)d[p]={},w[p].forEach(O=>{let m=r.value[O.prop];(O.multipleValue||Array.isArray(m))&&(m=JSON.stringify(m)),d[p][O.name]=m===void 0?null:m});const C={};(q=a.value)==null||q.forEach(p=>{C[p.categoryFolder.id]=p.contents.map(O=>O.id)});const A={};return(H=c.value)==null||H.forEach(p=>{A[p.embeddedFolder.id]=p.contents.map(O=>O.id)}),{id:Te("copy")?void 0:l.id,folderId:l.folderId,typeId:l.contentType,values:d,categories:C,embedded:A}})}function V(){return N(this,null,function*(){const d={},w=yield k(d),C=yield me(w);return y.init([r.value,a.value,c.value]),{id:C,values:d}})}function L(d){return N(this,null,function*(){var w;if(t.value)for(const C in i.cultures)i.selected.includes(C)||i.selectedChanged(C);if(d&&typeof d=="object"){const C=Object.keys(d)[0];yield ae(),(w=u.value)==null||w.scrollToField(C)}})}function Q(d){if(!(l.associated&&d.name=="Online"))return i.selected.includes(d.lang)}return f({save:V,getSaveData:k}),R(()=>[r.value,a.value,c.value],()=>{y.changed([r.value,a.value,c.value])},{deep:!0}),(d,w)=>{const C=Fe;return b(),D("div",et,[M("div",tt,[F(be)]),s.value.length?(b(),j(C,{key:0,ref_key:"form",ref:u,"label-position":"top",model:r.value,rules:_.value,onSubmit:w[2]||(w[2]=ie(()=>{},["prevent"]))},{default:T(()=>{var A;return[(b(!0),D(B,null,P(s.value,($,h)=>Oe((b(),j(ye,{key:h,field:$,model:r.value},null,8,["field","model"])),[[re,Q($)]])),128)),F(qe,{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=$=>a.value=$)},null,8,["modelValue"]),F(Ze,{id:n.id,modelValue:c.value,"onUpdate:modelValue":w[1]||(w[1]=$=>c.value=$),paths:[...(A=n.paths)!=null?A:[]]},null,8,["id","modelValue","paths"])]}),_:1},8,["model","rules"])):g.value?ne("",!0):(b(),j(he,{key:1},{default:T(()=>[M("p",null,G(I(x)("common.noFieldYet")),1)]),_:1}))])}}});var ot=$e(lt,[["__scopeId","data-v-5a941b71"]]);export{ot as E};
