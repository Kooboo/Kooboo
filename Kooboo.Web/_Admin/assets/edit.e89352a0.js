var l=(D,i,a)=>new Promise((u,n)=>{var m=e=>{try{p(a.next(e))}catch(c){n(c)}},f=e=>{try{p(a.throw(e))}catch(c){n(c)}},p=e=>e.done?u(e.value):Promise.resolve(e.value).then(m,f);p((a=a.apply(D,i)).next())});import{a3 as P,H as A,aa as L,_ as O}from"./dev-mode.acf56c3e.js";import{e as E}from"./guid.c1a40312.js";import{d as q,cd as G,g as w,x as y,c as R,cj as H,K as J,i as K,b8 as Q,o as d,a as M,f as b,b as _,u as r,w as k,j as C,k as S,aI as B,t as V,e as z}from"./url.4cb47a7a.js";import{u as N}from"./replace-all.56d2c1f7.js";import{u as F}from"./use-shortcuts.ff4b1f52.js";import{_ as W}from"./index.9250b320.js";import{u as X}from"./use-save-tip.e3dc783a.js";import{g as Y}from"./i18n.a87944a4.js";import{U as Z}from"./editor.main.d2800f63.js";import{m as T}from"./userWorker.b3a6730b.js";import{E as ee}from"./index.361e2245.js";import{E as te}from"./index.24947ed8.js";import{E as oe}from"./main.9fdfea92.js";import"./windi.6360286d.js";import"./index.fd96ea36.js";import"./error.7e8331f1.js";import"./config.1e73f9c3.js";import"./dark.9459c47b.js";import"./page.881ec888.js";import"./validate.bb56f9e3.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./style.c350d462.js";import"./toNumber.47eea968.js";import"./_baseIsEqual.dc9e64c4.js";import"./index.9fd79879.js";import"./index.7b8c5aef.js";import"./_baseClone.b8903935.js";import"./isEqual.4cab74e3.js";import"./index.f2c1b903.js";import"./index.178b9e08.js";import"./event.776e7e11.js";import"./isNil.98bb3b88.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.50a00b7f.js";import"./validator.b5df2420.js";import"./index.4d568055.js";import"./index.c86a187b.js";import"./index.d96452a6.js";import"./dropdown.86d3a7fb.js";import"./refs.3132cbdb.js";import"./use-copy-text.ec245a13.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./confirm.b60b5d2f.js";import"./logo-transparent.1566007e.js";import"./index.f0d5f031.js";import"./index.6918f0a5.js";import"./index.f15f695e.js";import"./index.7c862087.js";import"./debounce.4e0c106e.js";import"./index.66319a92.js";import"./index.c003dfa1.js";import"./icon-button.74ccc970.js";import"./index.4f90a917.js";import"./vuedraggable.umd.af323a53.js";import"./index.f154d010.js";import"./index.42922617.js";import"./index.b9a74c44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./alert.d2815716.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./index.0e5d639d.js";import"./cloneDeep.c5011aa2.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";import"./preload-helper.13a99eb0.js";import"./index.50c16ae5.js";const re={key:0,class:"h-full w-full flex flex-col overflow-hidden relative"},ie={class:"pt-16 px-32 bg-fff dark:bg-[#222] dark:border-transparent border-b border-solid border-line flex items-start"},ae=b("div",{class:"flex-1"},null,-1),me={class:"flex items-center space-x-12"},se={class:"flex-1"},pe={key:0,class:"absolute inset-0 flex items-center justify-center"},Kt=q({setup(D){const{t:i}=Y(),a=G(),u=w(),n=w(),m=X(),f=P(),p=A(y("id")||""),e=w(),c=R(()=>{var o;return((o=e.value)==null?void 0:o.id)!==E}),U=()=>l(this,null,function*(){e.value=yield f.getCode(y("id"),y("type"),y("eventType")),m.init(e.value)}),g=()=>{a.goBackOrTo(N({name:"code"}))},h=()=>l(this,null,function*(){var t;if(!e.value||e.value.isDecrypted)return;yield(t=u.value)==null?void 0:t.validate();const o=e.value.id===E;yield f.updateCode(e.value,p.save()),oe.success(i("common.saveSuccess")),m.init(e.value),o&&a.replace(N({name:"code-edit",query:{id:e.value.id}}))}),$=()=>l(this,null,function*(){yield h(),g()});H((o,t,s)=>l(this,null,function*(){o.name==="login"?s():yield m.check(e.value).then(()=>{s()}).catch(()=>{s(!1)})})),F("save",h),U();const x=R(()=>{if(!!e.value)return`${e.value.name||e.value.id}.ts`});return J(()=>{if(!x.value)return;const o=T.editor.getModel(T.Uri.file(x.value)),t=m.getValue();o&&t&&o.setValue(JSON.parse(t).body)}),K(()=>e.value,()=>{m.changed(e.value)},{deep:!0}),(o,t)=>{const s=ee,j=te,I=Q("hasPermission");return e.value?(d(),M("div",re,[b("div",ie,[_(L,{ref_key:"form",ref:u,model:e.value,"edit-mode":r(c),inline:""},null,8,["model","edit-mode"]),ae,b("div",me,[_(s,{round:"",class:"lineButton","data-cy":"format",onClick:t[0]||(t[0]=v=>n.value.format())},{default:k(()=>[B(V(r(i)("common.format")),1)]),_:1})])]),b("div",se,[e.value?(d(),C(O,{key:0,ref_key:"editor",ref:n,modelValue:e.value.body,"onUpdate:modelValue":t[1]||(t[1]=v=>e.value.body=v),language:"typescript",uri:r(Z).file(r(x)),"k-script":"",onMonacoLoadComplete:t[2]||(t[2]=v=>r(p).bindMonaco(v,"typescript"))},null,8,["modelValue","uri"])):S("",!0)]),e.value.isDecrypted?(d(),M("div",pe,[_(j,{icon:"error",title:r(i)("common.codeEncryptedTip")},null,8,["title"])])):S("",!0),_(W,{back:"",permission:{feature:"code",action:"edit"},"hidden-confirm":e.value.isDecrypted,"hidden-cancel":e.value.isDecrypted,onCancel:g,onSave:h},{"extra-buttons":k(()=>[e.value.isDecrypted?(d(),C(s,{key:0,round:"",type:"primary",onClick:g},{default:k(()=>[B(V(r(i)("common.back")),1)]),_:1})):z((d(),C(s,{key:1,round:"",type:"primary","data-cy":"save-and-return",onClick:$},{default:k(()=>[B(V(r(i)("common.saveAndReturn")),1)]),_:1})),[[I,{feature:"code",action:"edit"}]])]),_:1},8,["hidden-confirm","hidden-cancel"])])):S("",!0)}}});export{Kt as default};
