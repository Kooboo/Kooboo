var ye=Object.defineProperty,he=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var ee=(c,o,s)=>o in c?ye(c,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[o]=s,G=(c,o)=>{for(var s in o||(o={}))xe.call(o,s)&&ee(c,s,o[s]);if(Z)for(var s of Z(o))be.call(o,s)&&ee(c,s,o[s]);return c},te=(c,o)=>he(c,Ce(o));var F=(c,o,s)=>new Promise((E,w)=>{var r=i=>{try{y(s.next(i))}catch(g){w(g)}},C=i=>{try{y(s.throw(i))}catch(g){w(g)}},y=i=>i.done?E(i.value):Promise.resolve(i.value).then(r,C);y((s=s.apply(c,o)).next())});import{_ as ke}from"./k-table.b1a54b80.js";import{_ as we}from"./icon-button.74ccc970.js";import{d as Q,g as I,c as N,h as ae,o as f,j as B,w as e,b as t,u as l,a as $,f as V,aI as z,t as b,k as A,b8 as le,e as se,F as J,N as Se,cd as Ve,O as Ee,b7 as oe}from"./url.4cb47a7a.js";import{B as $e}from"./breadcrumb.f4d80c95.js";import{g as W,o as Ie,w as Pe}from"./i18n.a87944a4.js";import{u as ne}from"./replace-all.56d2c1f7.js";import{a as Be,b as De,u as Te,f as Fe,m as Ne}from"./commerce.ded2851e.js";import{b as ze}from"./confirm.b60b5d2f.js";import{_ as re}from"./index.f0d5f031.js";import{S as Ae}from"./search-input.2a27ef56.js";import{f as Re}from"./product.9d71c7fc.js";import{u as ie}from"./useFields.23cc2d07.js";import{_ as X}from"./index.85105f22.js";import{_ as me}from"./truncate-content.85e3d7e3.js";import{E as Ue}from"./index.42922617.js";import{E as Y,a as ce}from"./index.b38edc72.js";import{E as ue}from"./index.fd96ea36.js";import{E as Le}from"./index.c6da2706.js";import{E as de}from"./index.c003dfa1.js";import{E as pe}from"./windi.6360286d.js";import{E as _e}from"./index.361e2245.js";import{E as fe}from"./index.d96452a6.js";import{b as Me}from"./useLabels.aeaf94fa.js";import{g as qe}from"./main.9fdfea92.js";import{c as Ke,g as j}from"./string.955a924b.js";import{c as je}from"./index.7c862087.js";import"./sortable.esm.a99254e8.js";import"./index.f15f695e.js";import"./event.776e7e11.js";import"./index.7b8c5aef.js";import"./error.7e8331f1.js";import"./index.4f90a917.js";import"./index.4d568055.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";import"./index.f2c1b903.js";import"./index.178b9e08.js";import"./isNil.98bb3b88.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.50a00b7f.js";import"./validator.b5df2420.js";/* empty css                                                                 */import"./isEmpty.8a500dd9.js";import"./_baseIsEqual.dc9e64c4.js";import"./search-provider.ad425b7b.js";import"./toNumber.47eea968.js";import"./last.e7aa49db.js";import"./_baseIndexOf.4d7985be.js";import"./style.c350d462.js";import"./_baseUniq.d719bd5f.js";import"./use-operation-dialog.4f6d7533.js";import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";import"./file.a821eac5.js";import"./validate.bb56f9e3.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./index.9fd79879.js";import"./_baseClone.b8903935.js";import"./isEqual.4cab74e3.js";import"./folder.8308bb9d.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";import"./relations-tag.b9cbe606.js";import"./page.881ec888.js";import"./guid.c1a40312.js";import"./use-copy-text.ec245a13.js";import"./caret-bottom.ddd8dd91.js";import"./index.c33743a1.js";import"./browser.aedb6977.js";import"./throttle.1f6a079c.js";import"./debounce.4e0c106e.js";import"./_createCompounder.89b53ff3.js";import"./color-picker.2ebabb03.js";import"./index.f43a3c1f.js";import"./position.7590de53.js";import"./index.66319a92.js";import"./image-cover.b0b3d25c.js";import"./media-dialog.69c737ad.js";import"./media.e27599b4.js";import"./index.5ed58b47.js";/* empty css                                                          *//* empty css                                                          */import"./layout.b686c380.js";import"./index.765084fe.js";import"./utils.aa7941f8.js";import"./index.9fc39dc8.js";import"./use-file-upload.78bd75f1.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./index.1b4db5fb.js";import"./index.4d2ce883.js";import"./file.7f0748f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./index.bec063d7.js";import"./dropdown.86d3a7fb.js";import"./refs.3132cbdb.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";const Oe={key:0},Ge={class:"flex items-center pb-12 space-x-16"},He=V("div",{class:"flex-1"},null,-1),Je={class:"text-center"},Qe=Q({props:{excludes:null,modelValue:{type:Boolean}},emits:["update:modelValue","selected"],setup(c,{emit:o}){const s=c,{getColumns:E}=ie(),w=E([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]),{t:r}=W(),C=I(!0),y=I({pageIndex:1,pageSize:30,keyword:"",excludes:s.excludes}),i=I(),g=N(()=>i.value?i.value.list:[]);function D(p){return F(this,null,function*(){y.value.pageIndex=p,i.value=yield Re(y.value),i.value.list=i.value.list.map(_=>te(G({},_),{selected:!1}))})}const S=N(()=>g.value.some(p=>p.selected)&&g.value.some(p=>!p.selected)),h=N(()=>g.value.length&&g.value.every(p=>p.selected));function T(p){g.value.forEach(_=>_.selected=p)}ae(()=>{D(1)});function M(){o("selected",g.value.filter(p=>p.selected)),C.value=!1}return(p,_)=>{const R=Ae,U=Ue,q=Y,K=ce,m=ue,a=Le,n=re,u=de;return f(),B(u,{"model-value":C.value,width:"800px",title:l(r)("common.selectProduct"),"close-on-click-modal":!1,onClosed:_[3]||(_[3]=d=>o("update:modelValue",!1))},{footer:e(()=>[t(n,{disabled:!l(g).some(d=>d.selected),onConfirm:M,onCancel:_[2]||(_[2]=d=>C.value=!1)},null,8,["disabled"])]),default:e(()=>{var d,k,P;return[i.value?(f(),$("div",Oe,[V("div",Ge,[He,t(R,{modelValue:y.value.keyword,"onUpdate:modelValue":_[0]||(_[0]=x=>y.value.keyword=x),class:"w-248px",onKeydown:_[1]||(_[1]=Ie(Pe(x=>D(1),["prevent"]),["enter"]))},null,8,["modelValue"])]),t(m,{"max-height":"400px"},{default:e(()=>[t(K,{data:l(g),class:"el-table--gray"},{default:e(()=>[t(q,{width:"60",align:"center"},{header:e(()=>[t(U,{size:"large",class:"!block !h-20px",indeterminate:l(S),"model-value":l(h),onChange:T},null,8,["indeterminate","model-value"])]),default:e(({row:x})=>[t(U,{modelValue:x.selected,"onUpdate:modelValue":H=>x.selected=H,size:"large"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(X,{columns:l(w)},{title:e(({row:x})=>[t(me,{tip:x.title},{default:e(()=>[z(b(x.title),1)]),_:2},1032,["tip"])]),_:1},8,["columns"])]),_:1},8,["data"])]),_:1}),V("div",Je,[t(a,{class:"py-8",layout:"prev, pager, next","hide-on-single-page":"","page-size":(d=i.value)==null?void 0:d.pageSize,"current-page":(k=i.value)==null?void 0:k.pageIndex,total:(P=i.value)==null?void 0:P.count,onCurrentChange:D},null,8,["page-size","current-page","total"])])])):A("",!0)]}),_:1},8,["model-value","title"])}}}),We={class:"space-y-12"},Xe={class:"flex items-center"},Ye=Q({props:{editable:{type:Boolean},categoryId:null,modelValue:{type:Boolean}},emits:["update:modelValue","reload"],setup(c,{emit:o}){const s=c,{t:E}=W(),w=I(!0),r=I(),C=I(!1),{getColumns:y}=ie(),i=y([{name:"featuredImage",attrs:{width:80,align:"center"}},{name:"title"},{name:"variantsCount",attrs:{align:"center"}},{name:"inventory",attrs:{align:"center"}},{name:"active",attrs:{width:100,align:"center"}}]);Be(s.categoryId).then(S=>{r.value=S});function g(S){var h;(h=r.value)==null||h.push(...S)}function D(){return F(this,null,function*(){yield De(s.categoryId,r.value.map(S=>S.id)),w.value=!1,o("reload")})}return(S,h)=>{var a;const T=pe,M=_e,p=fe,_=Y,R=ce,U=ue,q=re,K=de,m=le("hasPermission");return f(),$(J,null,[t(K,{"model-value":w.value,width:"850px",title:l(E)("common.products"),"close-on-click-modal":!1,onClosed:h[2]||(h[2]=n=>o("update:modelValue",!1))},{footer:e(()=>[t(q,{onConfirm:D,onCancel:h[1]||(h[1]=n=>w.value=!1)})]),default:e(()=>[V("div",We,[c.editable?se((f(),B(M,{key:0,round:"",onClick:h[0]||(h[0]=n=>C.value=!0)},{default:e(()=>[V("div",Xe,[t(T,{class:"mr-16 iconfont icon-a-addto"}),z(" "+b(l(E)("common.addProduct")),1)])]),_:1})),[[m,{feature:"productCategories",action:"edit"}]]):A("",!0),t(U,{"max-height":"400px"},{default:e(()=>[t(R,{data:r.value,class:"el-table--gray"},{default:e(()=>[t(X,{columns:l(i)},{title:e(({row:n})=>[t(me,{tip:n.title},{default:e(()=>[z(b(n.title),1)]),_:2},1032,["tip"])]),_:1},8,["columns"]),c.editable?(f(),B(_,{key:0,align:"right",width:"60"},{default:e(({row:n})=>[t(p,{placement:"top",content:l(E)("common.delete")},{default:e(()=>[t(T,{class:"iconfont icon-delete hover:text-blue text-l",onClick:u=>r.value=r.value.filter(d=>d.id!=n.id)},null,8,["onClick"])]),_:2},1032,["content"])]),_:1})):A("",!0)]),_:1},8,["data"])]),_:1})])]),_:1},8,["model-value","title"]),C.value?(f(),B(Qe,{key:0,modelValue:C.value,"onUpdate:modelValue":h[3]||(h[3]=n=>C.value=n),excludes:(a=r.value)==null?void 0:a.map(n=>n.id),onSelected:g},null,8,["modelValue","excludes"])):A("",!0)],64)}}}),Ze={class:"p-24"},et={class:"flex items-center py-24 space-x-16"},tt={class:"flex items-center"},ot={class:"flex items-center"},nt={class:"text-black dark:text-[#cfd3dc]"},at={class:"inline-flex flex-wrap gap-4"},lt={key:0,class:"text-s"},st={key:0},rt={key:1,class:"text-s"},cn=Q({setup(c){const{t:o}=W(),s=Se(),E=Ve(),w=s.meta.title,r=Te(),C=I(),y=I(!1),i=I(r.settings);r.loadSettings().then(()=>{i.value=r.settings});const{getFieldDisplayName:g}=Me(),D=qe(),S={image:{width:80}},h={"min-width":180},T=N(()=>{var m;return((m=R.value)==null?void 0:m.length)>1}),M=N(()=>T.value);function p(m){return F(this,null,function*(){yield ze(m.length),yield Fe(m.map(a=>a.id)),r.loadCategories()})}const _=N(()=>{var n;const m=(n=i.value.categoryCustomFields)!=null?n:[];let a=m.filter(u=>u.isSummaryField);return a.length||(a=m.slice(0,2)),a.map(u=>({name:Ke(u.name),displayName:g(u),controlType:u.type,multipleValue:u.multiple,attrs:G(G({},h),j(S,u.name))}))}),R=N(()=>{var m;return((m=r.categories)!=null?m:[]).map(a=>{var u;const n=(u=j(a,"customData"))!=null?u:{};for(const d of _.value)if(!j(a,d.name)){const k=j(n,d.name);if(!k)continue;a[d.name]=j(k,D.default)}return a})});function U(m){C.value=m,y.value=!0}function q(m,a){return F(this,null,function*(){const{newIndex:n,oldIndex:u}=a;if(n===void 0||u===void 0||u===n)return;const d=m[n],k=m[n+1],P=m[n-1],x={source:d.id,prevId:k==null?void 0:k.id,nextId:P==null?void 0:P.id};yield Ne(x),r.loadCategories()})}function K(){return F(this,null,function*(){r.loadCategories()})}return ae(()=>F(this,null,function*(){r.loadCategories()})),(m,a)=>{const n=pe,u=_e,d=je,k=fe,P=Ee("router-link"),x=we,H=Y,ge=ke,ve=le("hasPermission");return f(),$("div",Ze,[t($e,{name:l(w)},null,8,["name"]),V("div",et,[se((f(),B(u,{round:"",onClick:a[0]||(a[0]=v=>l(E).push(l(ne)({name:"product category create"})))},{default:e(()=>[V("div",tt,[t(n,{class:"mr-16 iconfont icon-a-addto"}),z(" "+b(l(o)("common.create")),1)])]),_:1})),[[ve,{feature:"productCategories",action:"edit"}]])]),t(ge,{data:l(R),"show-check":"",draggable:l(T),"row-key":"id",onDelete:p,onSorted:q,onSortChange:K,onChange:a[1]||(a[1]=()=>l(r).loadCategories())},{default:e(()=>[t(X,{columns:l(_)},{title:e(({row:v})=>[V("div",ot,[V("span",nt,b(v.title),1)])]),tags:e(({row:v})=>[V("div",at,[(f(!0),$(J,null,oe(v.tags,(L,O)=>(f(),B(d,{key:O,round:"",size:"small",type:"warning"},{default:e(()=>[z(b(L),1)]),_:2},1024))),128))])]),productCount:e(({row:v})=>[t(d,{round:"",class:"cursor-pointer",type:"success",onClick:L=>U(v)},{default:e(()=>[z(b(v.productCount),1)]),_:2},1032,["onClick"])]),condition:e(({row:v})=>[v.type=="Automated"?(f(),$("div",lt,[(f(!0),$(J,null,oe(v.condition.items,(L,O)=>(f(),$("div",{key:O},[O>0?(f(),$("span",st,b(v.condition.isAny?l(o)("common.or"):l(o)("common.and")),1)):A("",!0),z(" "+b(L.option)+" "+b(L.method)+" "+b(L.value),1)]))),128))])):(f(),$("span",rt,b(l(o)("common.manual")),1))]),_:1},8,["columns"]),t(H,{align:"right",width:"100",fixed:"right"},{default:e(({row:v})=>[t(P,{to:l(ne)({name:"product category edit",query:{id:v.id}}),class:"mx-8"},{default:e(()=>[t(k,{placement:"top",content:l(o)("common.edit")},{default:e(()=>[t(n,{class:"iconfont icon-a-writein hover:text-blue text-l"})]),_:1},8,["content"])]),_:2},1032,["to"]),l(M)?(f(),B(x,{key:0,icon:"icon-move js-sortable cursor-move",tip:l(o)("common.move"),"data-cy":"move"},null,8,["tip"])):A("",!0)]),_:1})]),_:1},8,["data","draggable"]),y.value?(f(),B(Ye,{key:0,modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=v=>y.value=v),"category-id":C.value.id,editable:C.value.type=="Manual",onReload:a[3]||(a[3]=v=>l(r).loadCategories())},null,8,["modelValue","category-id","editable"])):A("",!0)])}}});export{cn as default};
