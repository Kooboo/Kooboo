var I=(f,a,n)=>new Promise((r,e)=>{var m=i=>{try{c(n.next(i))}catch(w){e(w)}},_=i=>{try{c(n.throw(i))}catch(w){e(w)}},c=i=>i.done?r(i.value):Promise.resolve(i.value).then(m,_);c((n=n.apply(f,a)).next())});import{d as q,o as d,a as A,b,w as p,F as P,b7 as U,aI as G,t as F,f as $,g as h,ce as J,j as C,u as S,k as B,i as O,cd as Z,c as ee,x as z,cj as te,b8 as oe,e as ae}from"./url.4cb47a7a.js";import{u as Q}from"./replace-all.56d2c1f7.js";import{_ as le}from"./index.9250b320.js";import{u as se}from"./use-shortcuts.ff4b1f52.js";import{_ as ne}from"./index.f154d010.js";import{g as j}from"./i18n.a87944a4.js";import{E as re,a as ie}from"./index.f15f695e.js";import{P as ue}from"./settings.d959e292.js";import{a as me,g as ce}from"./index.298baba8.js";import{_ as de}from"./index.0e5d639d.js";import{_ as pe}from"./index.f0d5f031.js";import{E as fe}from"./index.42922617.js";import{E as ve}from"./index.c003dfa1.js";import{l as W,p as _e,a as X}from"./page.881ec888.js";import{t as ge,m as ye}from"./layout-model.8c827919.js";import{c as he}from"./index.7c862087.js";import{E as be}from"./windi.6360286d.js";import{E as Y}from"./index.361e2245.js";import{E as xe,a as we,b as Ee}from"./index.c86a187b.js";import{E as ke,a as Ce}from"./index.ac10ee42.js";import{_ as Se}from"./index.ba677b9f.js";import{u as Ve,E as $e}from"./main.9fdfea92.js";import{c as Ne,e as Ae,n as Ie}from"./style.c350d462.js";import{e as H}from"./guid.c1a40312.js";import{u as Pe}from"./use-save-tip.e3dc783a.js";import{r as Te,a as De,i as Re}from"./validate.bb56f9e3.js";import{a as Be,s as Le,N as Ue,K as Fe,L as qe}from"./dev-mode.acf56c3e.js";import{E as je}from"./index.178b9e08.js";import{E as Me,a as ze}from"./index.9fd79879.js";import{E as He}from"./index.fd96ea36.js";import"./event.776e7e11.js";import"./index.7b8c5aef.js";import"./error.7e8331f1.js";import"./basic.f0527be6.js";import"./tooltip.66155ff7.js";import"./index.d96452a6.js";import"./focus-trap.50a00b7f.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.6918f0a5.js";import"./validator.b5df2420.js";import"./index.6f16842c.js";import"./index.4d568055.js";import"./index.e3f90979.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./vuedraggable.umd.af323a53.js";import"./cloneDeep.c5011aa2.js";import"./_baseClone.b8903935.js";import"./_baseIsEqual.dc9e64c4.js";import"./index.c10802d9.js";import"./scroll.16983984.js";import"./refs.3132cbdb.js";import"./index.f2c1b903.js";import"./aria.75ec5909.js";import"./isEqual.4cab74e3.js";import"./debounce.4e0c106e.js";import"./toNumber.47eea968.js";import"./index.66319a92.js";import"./dropdown.86d3a7fb.js";import"./index.77bc9666.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./confirm.b60b5d2f.js";import"./logo-transparent.1566007e.js";import"./index.d24a40b9.js";import"./index.f23f1e38.js";import"./index.a24f458a.js";import"./index.1fd72ea8.js";import"./index.abe211fa.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./config.1e73f9c3.js";import"./dark.9459c47b.js";import"./use-copy-text.ec245a13.js";import"./index.269bf65e.js";import"./monaco.c080bc0a.js";import"./classCompletion.a22e38a6.js";import"./extraLib.d94bb2b4.js";import"./icon-button.74ccc970.js";import"./index.4f90a917.js";import"./index.b9a74c44.js";import"./index.79632b7d.js";import"./index.99e769ef.js";import"./index.d878e15f.js";import"./alert.d2815716.js";import"./index.24947ed8.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.d235f69b.js";/* empty css                                                          */import"./file.a821eac5.js";import"./use-date.f1258183.js";import"./dayjs.min.ccc40d4f.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.78bd75f1.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.ec5f0705.js";import"./image-editor.a4ae94b1.js";import"./main.esm.e26794cb.js";import"./index.16f227d6.js";var L=(f=>(f[f.design=0]="design",f[f.settings=1]="settings",f))(L||{});const Oe={class:"flex items-center px-24 py-12 leading-none"},Ge=$("p",{class:"flex-1 text-m"},null,-1),Ke=q({props:{modelValue:null},emits:["update:modelValue"],setup(f){const{t:a}=j(),n=[{key:L.design,value:a("common.design")},{key:L.settings,value:a("common.setting")}];return(r,e)=>{const m=re,_=ie;return d(),A("div",Oe,[b(_,{class:"el-radio-group--rounded","model-value":f.modelValue,"onUpdate:modelValue":e[0]||(e[0]=c=>r.$emit("update:modelValue",c))},{default:p(()=>[(d(),A(P,null,U(n,c=>b(m,{key:c.key,label:c.key,"data-cy":c.key===0?"design":"setting"},{default:p(()=>[G(F(c.value),1)]),_:2},1032,["label","data-cy"])),64))]),_:1},8,["model-value"]),Ge,b(ne)])}}}),Qe={class:"p-32 grid grid-cols-3"},Xe=["title"],Je=q({props:{modelValue:{type:Boolean},model:null,sources:null},emits:["update:modelValue","selected"],setup(f,{emit:a}){const n=f;j();const r=h(!0),e=h([]),m=h([]),_=()=>I(this,null,function*(){e.value=yield me(n.model.tagName)}),c=J(()=>{const s=[];for(const l of e.value){const g=n.sources.find(t=>t.id===l.name);(g==null?void 0:g.tag)!=="layout"&&s.push(l)}return s}),i=(s,l)=>{l?m.value.push(s):m.value=m.value.filter(g=>g!==s)},w=()=>I(this,null,function*(){r.value=!1,a("selected",m.value)});return _(),(s,l)=>{const g=fe,t=ve;return d(),C(t,{"model-value":r.value,"custom-class":"el-dialog--zero-padding",width:"600px","close-on-click-modal":!1,title:f.model.displayName,onClosed:l[1]||(l[1]=o=>a("update:modelValue",!1))},{footer:p(()=>[b(pe,{disabled:!m.value.length,onConfirm:w,onCancel:l[0]||(l[0]=o=>r.value=!1)},null,8,["disabled"])]),default:p(()=>[$("div",null,[$("div",Qe,[(d(!0),A(P,null,U(S(c),o=>(d(),C(g,{key:o.id,size:"large",onChange:v=>i(o,v)},{default:p(()=>[$("p",{class:"hover:text-blue w-140px ellipsis text-16px h-17px",title:o.name,"data-cy":"name"},F(o.name),9,Xe)]),_:2},1032,["onChange"]))),128))])])]),_:1},8,["model-value","title"])}}}),We=q({props:{model:null,sources:null},setup(f){const a=f,{t:n}=j(),r=h([]),e=h(),m=h();ce().then(t=>r.value=t);function _(t,o){if(o.type==="layout"){t.push(o);for(const v of o.content)for(const V of v.addons)_(t,V);return t}}const c=J(()=>{const t=[];return _(t,a.model),t}),i=t=>I(this,null,function*(){var v,V,T;for(const y of t){const u={id:y.name,type:e.value.tagName.toLowerCase(),attributes:{id:y.name}},E=yield ge(a.sources,u);if((v=e.value)!=null&&v.requireEngine&&(u.attributes.engine=e.value.engineName),(V=e.value)!=null&&V.attribute){var o=document.createElement("div");o.innerHTML=`<div ${(T=e.value)==null?void 0:T.attribute} />`,o=o.children.item(0);for(const D of o.getAttributeNames())u.attributes[D]=o.getAttribute(D)}u.type==="layout"&&(u.content=W(u.id,E.source.body).content),m.value.addons.push(u)}}),w=(t,o)=>{o.addons=o.addons.filter(v=>v!==t),a.sources.splice(a.sources.findIndex(v=>v.id===t.id&&v.tag===t.type),1)},s=(t,o)=>{const v=o.addons.splice(t.oldIndex,1)[0];o.addons.splice(t.newIndex,0,v)},l=h(!1),g=(t,o)=>{e.value=t,m.value=o,l.value=!0};return(t,o)=>{const v=he,V=be,T=Y,y=xe,u=we,E=Ee,D=ke,M=Ce;return d(),A(P,null,[(d(!0),A(P,null,U(S(c),N=>(d(),C(M,{key:N.id,"model-value":N.content.map(k=>k.name)},{default:p(()=>[(d(!0),A(P,null,U(N.content,k=>(d(),C(D,{key:k.name,name:k.name,title:N==f.model?S(n)("common.positionName",{name:k.name}):S(n)("common.positionNameAndFrom",{name:k.name,from:N.id})},{default:p(()=>[b(de,{list:k.addons,"id-prop":"id","display-prop":"id",onDelete:(x,R)=>w(R,k),onSort:x=>s(x,k)},{right:p(({item:x})=>[b(v,{size:"small",class:"rounded-full mr-8","data-cy":"content-tag"},{default:p(()=>[G(F(x.type),1)]),_:2},1024)]),bottom:p(()=>[b(E,{trigger:"click",onCommand:x=>g(x,k)},{dropdown:p(()=>[b(u,null,{default:p(()=>[(d(!0),A(P,null,U(r.value,x=>(d(),C(y,{key:x.tagName,command:x,"data-cy":x.tagName},{default:p(()=>[$("span",null,F(x.displayName),1)]),_:2},1032,["command","data-cy"]))),128))]),_:1})]),default:p(()=>[b(T,{circle:""},{default:p(()=>[b(V,{class:"text-blue iconfont icon-a-addto","data-cy":"add"})]),_:1})]),_:2},1032,["onCommand"])]),_:2},1032,["list","onDelete","onSort"])]),_:2},1032,["name","title"]))),128))]),_:2},1032,["model-value"]))),128)),l.value?(d(),C(Je,{key:0,modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=N=>l.value=N),model:e.value,sources:f.sources,onSelected:i},null,8,["modelValue","model","sources"])):B("",!0)],64)}}}),Ye=q({props:{page:null,design:null,sources:null},setup(f){const a=f,n=Ve(),r=h(""),e=(m,_)=>{const c=a.sources.find(s=>s.tag===m.type&&s.id===m.id);if(!c)return"";if(m.type!=="layout")return c.source.body;let i=Ne(c.source.body);if(_){if(a.page.styles)for(const s of a.page.styles){const l=i.createElement("link");l.rel="stylesheet",l.href=s,i.head.appendChild(l)}if(a.page.scripts)for(const s of a.page.scripts){const l=i.createElement("script");l.src=s,i.head.appendChild(l)}}const w=m.content;for(const s of Ae(i)){const l=s.getAttribute("k-placeholder"),g=w.find(t=>t.name===l);g&&g.addons&&(s.innerHTML=g.addons.map(t=>e(t,!1)).join(""))}return Ie(i)};return O([()=>a.sources,()=>a.design,()=>a.page],()=>{r.value=e(a.design,!0)},{deep:!0,immediate:!0}),(m,_)=>(d(),C(Se,{content:r.value,"base-url":S(n).site.prUrl},null,8,["content","base-url"]))}}),Ze={key:0,class:"flex w-full h-full"},et={class:"flex-1 pr-32 pl-80px flex flex-col min-h-400px min-w-600px"},tt={class:"pt-16 flex items-center"},ot={class:"flex-1 rounded-normal overflow-hidden shadow-s-10 mb-100px bg-fff min-h-400px"},at={class:"bg-card dark:bg-[#333] shadow-s-10 w-400px h-full"},lt={class:"pb-150px"},Zo=q({setup(f){const{t:a}=j(),n=h(),r=h(),e=h(),m=Be(),_=h([]),c=Z(),i=h(L.design),w=h(),s=Pe(),l=h(),g=h(),t=ee(()=>{var y;return{name:((y=e.value)==null?void 0:y.id)&&e.value.id!==H?[]:[Te(1,50),De(a("common.nameRequiredTips")),Re(Le,a("common.thePageNameAlreadyExists"))]}});I(this,null,function*(){n.value=yield Ue(z("layoutId")),e.value=yield m.getPage(z("id"));const y=W(n.value.name,n.value.body),u=_e(e.value.body);g.value=e.value.urlPath,_.value.push({id:n.value.name,tag:"layout",source:{body:n.value.body}}),yield ye(y,u,_.value),r.value=y,s.init(e.value)});const o=y=>{!e.value||e.value.urlPath||(e.value.urlPath=`/${y}`)},v=()=>{e.value&&(e.value.body=X(r.value)),c.goBackOrTo(Q({name:"pages"}))};te((y,u,E)=>I(this,null,function*(){y.name==="login"?E():yield s.check(e.value).then(()=>{E()}).catch(()=>{E(!1)})}));const V=()=>I(this,null,function*(){var u,E;if(!e.value)return;yield w.value.validate(),yield(u=l.value)==null?void 0:u.validate();const y=e.value.id===H;yield m.updatePage(e.value),$e.success(a("common.saveSuccess")),g.value=(E=e.value.urlPath)!=null?E:"",s.init(e.value),y&&c.replace(Q({name:"layout-page-setting",query:{id:e.value.id,layoutId:z("layoutId")}}))}),T=()=>I(this,null,function*(){yield V(),v()});return Fe().loadAll(),qe().loadAll(),se("save",V),O(()=>e.value,()=>{s.changed(e.value)},{deep:!0}),O(()=>r.value,()=>{r.value&&(e.value.body=X(r.value)),s.changed(e.value)},{deep:!0}),(y,u)=>{const E=je,D=Me,M=ze,N=He,k=Y,x=oe("hasPermission");return d(),A(P,null,[r.value?(d(),A("div",Ze,[$("div",et,[$("div",tt,[e.value?(d(),C(M,{key:0,ref_key:"form",ref:w,model:e.value,rules:S(t)},{default:p(()=>[b(D,{label:S(a)("common.pageName"),prop:"name"},{default:p(()=>[b(E,{modelValue:e.value.name,"onUpdate:modelValue":u[0]||(u[0]=R=>e.value.name=R),class:"w-300px",title:e.value.name,disabled:e.value.id!==S(H),"data-cy":"page-name",onChange:o,onInput:u[1]||(u[1]=R=>{var K;return e.value.name=(K=e.value)==null?void 0:K.name.replace(/\s+/g,"")})},null,8,["modelValue","title","disabled"])]),_:1},8,["label"])]),_:1},8,["model","rules"])):B("",!0)]),$("div",ot,[e.value&&n.value?(d(),C(Ye,{key:0,design:r.value,page:e.value,sources:_.value},null,8,["design","page","sources"])):B("",!0)])]),$("div",at,[b(N,null,{default:p(()=>[$("div",lt,[b(Ke,{modelValue:i.value,"onUpdate:modelValue":u[2]||(u[2]=R=>i.value=R)},null,8,["modelValue"]),i.value===S(L).design&&r.value?(d(),C(We,{key:0,model:r.value,sources:_.value},null,8,["model","sources"])):B("",!0),i.value===S(L).settings&&e.value&&n.value?(d(),C(ue,{key:1,ref_key:"settingsForm",ref:l,model:e.value,"old-url-path":g.value,layout:n.value.body,sources:_.value},null,8,["model","old-url-path","layout","sources"])):B("",!0)])]),_:1})])])):B("",!0),b(le,{back:"",permission:{feature:"pages",action:"edit"},onCancel:v,onSave:V},{"extra-buttons":p(()=>[ae((d(),C(k,{round:"",type:"primary","data-cy":"save-and-return",onClick:T},{default:p(()=>[G(F(S(a)("common.saveAndReturn")),1)]),_:1})),[[x,{feature:"pages",action:"edit"}]])]),_:1})],64)}}});export{Zo as default};
