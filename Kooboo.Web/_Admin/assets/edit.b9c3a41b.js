var Q=Object.defineProperty,W=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var R=(l,i,r)=>i in l?Q(l,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[i]=r,U=(l,i)=>{for(var r in i||(i={}))X.call(i,r)&&R(l,r,i[r]);if(I)for(var r of I(i))Y.call(i,r)&&R(l,r,i[r]);return l},M=(l,i)=>W(l,K(i));var F=(l,i,r)=>new Promise((c,u)=>{var E=f=>{try{e(r.next(f))}catch(w){u(w)}},d=f=>{try{e(r.throw(f))}catch(w){u(w)}},e=f=>f.done?c(f.value):Promise.resolve(f.value).then(E,d);e((r=r.apply(l,i)).next())});import{T as Z,H as ee,a5 as oe,_ as te}from"./dev-mode.7f653a4a.js";import{e as ie}from"./guid.c1a40312.js";import{d as A,g as h,h as ae,aW as re,i as L,o as x,a as H,f as k,b as m,w as v,aH as O,t as C,u as p,n as ne,j as T,k as N,F as q,cd as le,x as J,cj as se,b7 as me,e as pe}from"./url.8f5ec20c.js";import{u as j}from"./replace-all.e310d26c.js";import{c as ue}from"./index.8cff0d70.js";import{_ as de}from"./index.e6a73380.js";import{u as ce}from"./use-save-tip.a46b00fb.js";import{U as fe}from"./editor.main.d2800f63.js";import{g as z}from"./i18n.0d8cb6d1.js";import{_ as ve}from"./icon-button.a2edb33f.js";import{E as _e}from"./edit-field-dialog.7b3176f5.js";import{_ as ye}from"./k-table.c1a07faa.js";import{u as ge}from"./index.b2877d7d.js";import{_ as be}from"./plugin-vue_export-helper.21dcd24c.js";import{c as P}from"./cloneDeep.007117a9.js";import{E as we}from"./windi.dcba9a95.js";import{E as G}from"./index.c7806af3.js";import{E as he}from"./index.8e0d96d6.js";import{_ as ke}from"./index.d1d474c4.js";import{E as Se}from"./index.6ac167de.js";import{E as Ve}from"./main.d919dab0.js";import"./index.3d638063.js";import"./error.7e8331f1.js";import"./userWorker.b3a6730b.js";import"./config.69138790.js";import"./dark.4719ae81.js";import"./page.be880a87.js";import"./validate.b9ea657d.js";import"./index.3e5d2d38.js";import"./index.f2618a8f.js";import"./index.ddf78e53.js";import"./index.6943850d.js";import"./index.4ccd5d27.js";import"./style.67f0cdc4.js";import"./toNumber.6efebd6a.js";import"./_baseIsEqual.f1f57955.js";import"./index.6756a6f3.js";import"./index.6e9a6658.js";import"./_baseClone.24478792.js";import"./isEqual.8058d1d5.js";import"./index.ab7ae43a.js";import"./index.97ced36a.js";import"./event.776e7e11.js";import"./isNil.98bb3b88.js";import"./index.1e651ffe.js";import"./scroll.9a94de30.js";import"./aria.75ec5909.js";import"./event.53b2ad83.js";import"./focus-trap.0c15535f.js";import"./validator.11bc55c7.js";import"./index.1d64e54f.js";import"./index.bc6ab153.js";import"./index.38840738.js";import"./dropdown.61c74520.js";import"./refs.d2253dd4.js";import"./use-copy-text.7801df9a.js";import"./index.66bd0e61.js";import"./toggleComment.5b29ca87.js";import"./confirm.f89fa710.js";import"./logo-transparent.1566007e.js";import"./index.d29acda2.js";import"./index.230671a2.js";import"./index.9a7a049b.js";import"./debounce.730e1961.js";import"./index.6d134d76.js";import"./vuedraggable.umd.e0421fdf.js";import"./index.bdc63b78.js";import"./index.ec3d8ab1.js";import"./index.3be79fd5.js";import"./index.f7975397.js";import"./index.337c36f2.js";import"./index.e68a3b8d.js";import"./alert.8fe5500a.js";import"./index.3b3f2bf9.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.92552fc5.js";/* empty css                                                          */import"./file.f8555a01.js";import"./use-date.3be35318.js";import"./dayjs.min.8b8ca7e9.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.e88ed30a.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.8fc1c564.js";import"./image-editor.37a79505.js";import"./main.esm.ae650d02.js";import"./index.8d99b8f6.js";import"./classCompletion.a22e38a6.js";import"./preload-helper.13a99eb0.js";import"./index.36905e5d.js";import"./tooltip.9f258018.js";import"./key-value-editor.37da5d91.js";import"./selection-editor.549e3f2f.js";import"./index.66c73cbe.js";import"./index.e3f90979.js";import"./index.86140375.js";import"./index.fdd01aa2.js";import"./editable-tags.efc8f93a.js";import"./index.9b4bce31.js";import"./_baseIndexOf.4d7985be.js";import"./index.77fd2161.js";import"./index.a2cc40a6.js";import"./string.75b81683.js";import"./isEmpty.d2ee0b7e.js";import"./index.b7efef2a.js";import"./sortable.esm.a99254e8.js";import"./index.17321c3b.js";import"./index.1dea228d.js";import"./media-dialog.6d9d43ca.js";import"./breadcrumb.3432b615.js";import"./plugin-vue_export-helper.41ffa612.js";import"./media.3136d42d.js";import"./index.ff2ed7f6.js";import"./search-provider.8815ed27.js";import"./last.e7aa49db.js";import"./use-operation-dialog.1c7cf152.js";import"./folder.8308bb9d.js";import"./relations-tag.c8ada5d9.js";import"./index.43142d25.js";import"./browser.3a7f9e8c.js";import"./throttle.3f3ee457.js";import"./search-input.fe88eea7.js";import"./layout.4c508974.js";import"./index.7d901c84.js";import"./position.a71853ef.js";import"./utils.6f25662a.js";import"./index.66e12c37.js";import"./index.fae306fc.js";import"./file.8c428cda.js";import"./pick.c2f0c4ca.js";import"./_basePickBy.a9f0143d.js";import"./index.b10628bd.js";import"./index.04b796f6.js";import"./index.4ecd1779.js";import"./index.50c16ae5.js";const xe={class:"flex items-center pb-24"},Ce={"data-cy":"display-name"},Ee={"data-cy":"control-type"},Fe=A({props:{modelValue:null,permission:null,propertyOptions:null,showDefaultValue:{type:Boolean},hidePreviewField:{type:Boolean},enableDynamicOptions:{type:Boolean}},emits:["update:model-value"],setup(l,{emit:i}){const r=l,c=h(),{t:u}=z(),{getControlType:E}=ge(),d=h(!1),e=h([]);ae(()=>{e.value=w(r.modelValue.map(t=>{const o=P(t);return _(o,"selectionOptions"),_(o,"validations"),_(o,"settings"),o}))}),re(()=>{e.value=[],c.value=void 0,d.value=!1});const f=t=>{const o={};t.forEach((n,y)=>{n.order=y,o[n.name]=n}),e.value=w(e.value).map(n=>o[n.name]||n)};function w(t){return t.sort((o,n)=>{if(o.isSystemField!==n.isSystemField){if(o.isSystemField)return 1;if(n.isSystemField)return-1}return o.order>n.order?1:-1})}function S(t){return F(this,null,function*(){e.value.splice(t,1)})}function _(t,o){t[o]?t[o]=typeof t[o]=="string"?JSON.parse(t[o]):t[o]:t[o]=[]}function D(t,o){return typeof t[o]=="string"?t[o]:JSON.stringify(t[o])}function $(){c.value=void 0,d.value=!0}function B(t){c.value=P(t),_(c.value,"selectionOptions"),_(c.value,"validations"),_(c.value,"settings"),d.value=!0}return L(()=>e.value,t=>{const o=t.map(n=>M(U({},n),{selectionOptions:D(n,"selectionOptions"),validations:D(n,"validations"),settings:D(n,"settings")}));i("update:model-value",o)},{deep:!0}),(t,o)=>{const n=we,y=G,a=he,g=ve;return x(),H(q,null,[k("div",xe,[m(y,{round:"","data-cy":"new-field",onClick:$},{default:v(()=>[m(n,{class:"iconfont icon-a-addto"}),O(" "+C(p(u)("common.newField")),1)]),_:1})]),m(p(ye),{ref:"table",data:e.value,"row-class-name":({row:s,rowIndex:V})=>s.isSystemField?"":"draggable",draggable:".draggable","row-key":"name",onSorted:o[0]||(o[0]=s=>f(s))},{default:v(()=>[m(a,{label:p(u)("common.name")},{default:v(({row:s})=>[k("span",{class:ne({"text-999":s.isSystemField}),"data-cy":"field-name"},C(s.name),3)]),_:1},8,["label"]),m(a,{label:p(u)("common.displayName")},{default:v(({row:s})=>[k("span",Ce,C(s.displayName),1)]),_:1},8,["label"]),m(a,{label:p(u)("common.controlType"),width:"200"},{default:v(({row:s})=>{var V;return[k("span",Ee,C((V=p(E)(s.controlType))==null?void 0:V.displayName),1)]}),_:1},8,["label"]),m(a,{width:"120",align:"right"},{default:v(({row:s,$index:V})=>[m(g,{icon:"icon-a-writein",tip:p(u)("common.edit"),"data-cy":"edit",onClick:b=>B(s)},null,8,["tip","onClick"]),s.isSystemField?N("",!0):(x(),T(g,{key:0,permission:{feature:"contentType",action:"edit"},icon:"icon-delete text-orange hover:text-orange",tip:p(u)("common.delete"),"data-cy":"delete",onClick:b=>S(V)},null,8,["tip","onClick"])),m(g,{icon:"icon-move js-sortable cursor-move",tip:p(u)("common.move"),"data-cy":"move"},null,8,["tip"])]),_:1})]),_:1},8,["data","row-class-name"]),d.value?(x(),T(_e,{key:0,modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=s=>d.value=s),fields:e.value,field:c.value,options:l.propertyOptions,"show-default-value":l.showDefaultValue,"hide-preview-field":l.hidePreviewField,"enable-dynamic-options":l.enableDynamicOptions},null,8,["modelValue","fields","field","options","show-default-value","hide-preview-field","enable-dynamic-options"])):N("",!0)],64)}}});var De=be(Fe,[["__scopeId","data-v-d1faafb8"]]);const Be={class:"h-full w-full flex flex-col overflow-hidden"},Te={class:"pt-16 px-32 bg-fff dark:bg-[#222] dark:border-transparent border-b border-solid border-line flex items-start"},$e=k("div",{class:"flex-1"},null,-1),Oe={class:"flex-1"},pi=A({setup(l){const{t:i}=z(),r=Z(),c=le(),u=h(),E=h(),d=ce(),e=h(),f=ee(J("id")||""),w={hideDisplayInSearchResult:!0,hideMultipleLanguage:!0,hideSummaryField:!0},S=h(!1),_=h([]),D=()=>F(this,null,function*(){e.value=yield r.getView(J("id")),d.init(e.value)}),$=()=>{c.goBackOrTo(j({name:"views"}))},B=()=>F(this,null,function*(){if(!e.value)return;yield u.value.validate();const y=e.value.id===ie;yield r.updateView(e.value,f.save()),Ve.success(i("common.saveSuccess")),d.init(e.value),y&&c.replace(j({name:"view-edit",query:{id:e.value.id}}))}),t=()=>{var y,a;S.value=!0,_.value=P((a=(y=e.value)==null?void 0:y.propDefines)!=null?a:[])},o=()=>{!e.value||(e.value.propDefines=P(_.value),S.value=!1)},n=()=>F(this,null,function*(){yield B(),$()});return se((y,a,g)=>F(this,null,function*(){y.name==="login"?g():yield d.check(e.value).then(()=>{g()}).catch(()=>{g(!1)})})),ue("save",B),L(()=>e.value,()=>{d.changed(e.value)},{deep:!0}),D(),(y,a)=>{const g=G,s=Se,V=me("hasPermission");return x(),H(q,null,[k("div",Be,[k("div",Te,[e.value?(x(),T(oe,{key:0,ref_key:"form",ref:u,model:e.value,inline:""},null,8,["model"])):N("",!0),$e,m(g,{round:"",class:"lineButton",onClick:t},{default:v(()=>[O(C(p(i)("common.parameters")),1)]),_:1}),m(g,{round:"",class:"lineButton",onClick:a[0]||(a[0]=b=>E.value.format())},{default:v(()=>[O(C(p(i)("common.format")),1)]),_:1})]),k("div",Oe,[e.value?(x(),T(te,{key:0,ref_key:"editor",ref:E,modelValue:e.value.body,"onUpdate:modelValue":a[1]||(a[1]=b=>e.value.body=b),language:"html","k-script":"",uri:p(fe).file(e.value.id),onMonacoLoadComplete:a[2]||(a[2]=b=>p(f).bindMonaco(b,"html"))},null,8,["modelValue","uri"])):N("",!0)]),m(de,{back:"",permission:{feature:"view",action:"edit"},onCancel:$,onSave:B},{"extra-buttons":v(()=>[pe((x(),T(g,{round:"",type:"primary","data-cy":"save-and-return",onClick:n},{default:v(()=>[O(C(p(i)("common.saveAndReturn")),1)]),_:1})),[[V,{feature:"view",action:"edit"}]])]),_:1})]),m(s,{modelValue:S.value,"onUpdate:modelValue":a[5]||(a[5]=b=>S.value=b),"close-on-click-modal":!1,title:p(i)("common.parameters")},{footer:v(()=>[m(ke,{onConfirm:o,onCancel:a[4]||(a[4]=b=>S.value=!1)})]),default:v(()=>[m(De,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=b=>_.value=b),"property-options":w,"show-default-value":!0,"hide-preview-field":!0},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}});export{pi as default};
