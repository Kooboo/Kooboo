var C=(m,w,s)=>new Promise((t,n)=>{var c=l=>{try{e(s.next(l))}catch(i){n(i)}},d=l=>{try{e(s.throw(l))}catch(i){n(i)}},e=l=>l.done?t(l.value):Promise.resolve(l.value).then(c,d);e((s=s.apply(m,w)).next())});import{S as O}from"./search-input.fe88eea7.js";import{g as q,w as z}from"./i18n.0d8cb6d1.js";import{d as A,g as p,i as k,o as u,j as y,w as f,f as h,u as v,b as g,a as E,b6 as G,t as J,cg as P,k as _,F as Q,e as W,r as X,ch as Y}from"./url.8f5ec20c.js";/* empty css                                                          */import{E as Z}from"./index.7d901c84.js";import{E as ee}from"./windi.dcba9a95.js";import{E as oe,a as le}from"./index.9a7a049b.js";import{E as te}from"./index.38840738.js";import{E as ae}from"./index.3d638063.js";import{E as re}from"./index.6ac167de.js";const se={class:"mx-32 flex justify-between space-x-16"},ne={class:"flex justify-between"},ie={style:{flex:"3"}},ue=["infinite-scroll-disabled"],ce=["innerHTML"],Ve=A({props:{modelValue:{type:Boolean},providers:null,fetchData:null},emits:["update:modelValue","list-changed"],setup(m,{expose:w,emit:s}){const t=m,n=p(!1),c=p(!1),{t:d}=q(),e=p({provider:"",keyword:"",pageNr:1}),l=p([]),i=p();k(()=>t.providers,()=>{var o;e.value.provider=(o=t.providers[0])==null?void 0:o.value}),k(()=>l.value,o=>s("list-changed",o));const V=()=>C(this,null,function*(){var a;if(e.value.keyword.trim()=="")return;n.value=!0;const o=yield t.fetchData(e.value);n.value=!1,c.value=o.hasMore,e.value.pageNr<=1?(l.value=o.list,(a=i==null?void 0:i.value)==null||a.scrollTo(0,0)):l.value=[...l.value,...o.list]}),x=Y(V,1e3);function S(){!e.value.keyword||n.value||(e.value.pageNr++,V())}function b(){e.value.pageNr=1,c.value=!0,n.value=!0,e.value.keyword&&x()}function D(){var o;e.value.pageNr=1,e.value.provider=(o=t.providers[0])==null?void 0:o.value,c.value=!0}function M(){var o;e.value.keyword="",e.value.provider=(o=t.providers[0])==null?void 0:o.value,e.value.pageNr=1,l.value=[],s("update:modelValue",!1)}const B=o=>"<span style='color:rgba(34, 150, 243, 1)'>"+o+"</span>";w({loadMore:S,reset:D});const N=p();return k(()=>t.modelValue,o=>{o&&setTimeout(()=>{N.value.focus()},0)}),(o,a)=>{const R=ee,L=oe,j=le,F=te,H=O,U=ae,$=re,K=Z;return u(),y($,{"model-value":m.modelValue,width:t.providers.length>1?"800px":"600px","close-on-click-modal":!1,title:v(d)("common.search"),"custom-class":"search_dialog",onClosed:M,"onUpdate:modelValue":a[2]||(a[2]=r=>s("update:modelValue",r))},{default:f(()=>[h("div",se,[t.providers.length>1?(u(),y(F,{key:0,style:{flex:"1"},placement:"top","show-after":300,content:v(d)("common.selectSourceTips")},{default:f(()=>[g(j,{modelValue:e.value.provider,"onUpdate:modelValue":a[0]||(a[0]=r=>e.value.provider=r),onChange:b},{default:f(()=>[(u(!0),E(Q,null,G(m.providers,({value:r,label:I,url:T})=>(u(),y(L,{key:r,value:r,label:I,"data-cy":r},{default:f(()=>[h("div",ne,[h("div",null,J(I),1),h("div",null,[T?(u(),y(R,{key:0,class:"text-blue iconfont icon-link1",onClick:z(de=>v(P)(T),["stop"])},null,8,["onClick"])):_("",!0)])])]),_:2},1032,["value","label","data-cy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["content"])):_("",!0),h("div",ie,[g(H,{ref_key:"searchInputRef",ref:N,modelValue:e.value.keyword,"onUpdate:modelValue":a[1]||(a[1]=r=>e.value.keyword=r),class:"w-full",placeholder:v(d)("common.searchKeywordTip"),"data-cy":"search",onInput:b,onSearch:v(x)},null,8,["modelValue","placeholder","onSearch"])])]),g(U,{ref_key:"scrollbarRef",ref:i,class:"mt-8","max-height":"45vh",style:{height:"100%"}},{default:f(()=>[W((u(),E("div",{"infinite-scroll-disabled":!c.value,"infinite-scroll-distance":50},[l.value&&l.value.length>0?X(o.$slots,"default",{key:0,list:l.value,keyword:e.value.keyword}):_("",!0),!n.value&&l.value&&e.value.keyword&&l.value.length==0?(u(),E("div",{key:1,class:"px-32 leading-4 text-center mt-8 whitespace-normal","data-cy":"no-search-result",innerHTML:v(d)("common.searchResultEmpty",{keyword:B(e.value.keyword)})},null,8,ce)):_("",!0)],8,ue)),[[K,S]])]),_:3},512)]),_:3},8,["model-value","width","title"])}}});export{Ve as _};
