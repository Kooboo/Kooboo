var N=(b,r,a)=>new Promise((e,n)=>{var f=d=>{try{u(a.next(d))}catch(L){n(L)}},p=d=>{try{u(a.throw(d))}catch(L){n(L)}},u=d=>d.done?e(d.value):Promise.resolve(d.value).then(f,p);u((a=a.apply(b,r)).next())});import{g as W,w as j,v as fe}from"./i18n.97105311.js";import{a as D}from"./replace-all.8fa5a83d.js";import{d as K,u as X,h as ve,b as le,k as G}from"./main.52487121.js";import{_ as H}from"./k-table.e9121736.js";import{d as R,g as S,o as i,a as w,b as l,w as s,u as t,f as m,k as V,j as h,i as F,t as v,F as M,aH as P,cn as oe,c0 as ee,b6 as J,az as se,e as _e,l as ge}from"./url.2e6a77c4.js";import{u as te}from"./use-date.88693eba.js";import{_ as ae}from"./index.9ffc2c80.js";import{E as be}from"./index.c1764395.js";import{E as ye}from"./index.1d8a0bb0.js";import{E as ke,a as ne}from"./index.317a7f30.js";import{E as Le}from"./index.4587e608.js";import{E as he}from"./index.a163a028.js";import{E as ie}from"./index.4b289bae.js";import{l as Se,b as $e,s as we}from"./request-access-limit.2c6b8e59.js";import{E as Z}from"./index.f3d28a97.js";import{c as Q,E as xe,a as Ve}from"./index.afee24fe.js";import{E as re}from"./index.f997a738.js";import{E as ue}from"./index.795c7a65.js";import{E as ce}from"./windi.539ebeab.js";import{E as me}from"./index.9589f7cf.js";import{_ as Ie}from"./chart-js.2bfafa9f.js";import{B as Ae}from"./breadcrumb.0ef7e7c4.js";import{w as Ce}from"./date.48fcf038.js";import{E as Ee,a as Te}from"./index.13bfae9f.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./sortable.esm.a99254e8.js";import"./icon-button.e1f3bfd2.js";import"./index.b09a9f00.js";import"./index.9e96921b.js";import"./index.975a8825.js";import"./index.bc93d068.js";import"./index.7a88a6b5.js";import"./isEqual.3700b7f1.js";import"./_baseIsEqual.abb55a3a.js";import"./error.7e8331f1.js";import"./index.6302b2c1.js";import"./event.776e7e11.js";import"./dayjs.min.378b3d72.js";import"./isNil.98bb3b88.js";import"./index.e3f90979.js";import"./event.53b2ad83.js";import"./_baseClone.f10ff33c.js";import"./index.07e210fb.js";import"./scroll.8babc10c.js";import"./focus-trap.de18cf8f.js";import"./refs.4001ce17.js";import"./tooltip.7fc982a4.js";import"./monaco.6a3362ef.js";import"./classCompletion.a22e38a6.js";import"./userWorker.b3a6730b.js";import"./editor.main.d2800f63.js";import"./index.00cc1b15.js";import"./validator.1d438d08.js";import"./list-editor.6914f1ec.js";import"./index.d7cf0025.js";import"./debounce.61c67278.js";import"./toNumber.574be4f1.js";import"./index.a46fa52c.js";import"./dropdown.87a7678e.js";import"./dark.ea14b486.js";import"./cloneDeep.5cd857a3.js";/* empty css                                                               */import"./plugin-vue_export-helper.21dcd24c.js";import"./plugin-vue_export-helper.41ffa612.js";const Ue=()=>K.get(D("VisitorLog/WeekNames")),Pe=b=>K.get(D("VisitorLog/TopPages"),{weekname:b}),ze=b=>K.get(D("VisitorLog/TopBots"),{weekname:b}),Be=b=>K.get(D("VisitorLog/TopReferer"),{weekname:b}),Ne=b=>K.get(D("VisitorLog/TopImages"),{weekname:b}),Re=()=>K.get(D("VisitorLog/Monthly")),We=(b,r)=>K.get(D("VisitorLog/errors"),{weekname:b,pageNr:r}),De=(b,r)=>K.get(D("VisitorLog/list"),{weekname:b,pageNr:r}),Ke=(b,r)=>K.get(D("VisitorLog/BotList"),{weekname:b,pageNr:r}),Oe={key:0,class:"pl-12 w-full"},qe={key:0,class:"grid grid-cols-2"},je={class:"space-y-4"},Fe={key:1,class:"grid grid-cols-2"},Me={key:1,class:"pl-12 w-full"},He={class:"pl-12 w-full"},Ze={class:"space-y-4"},de=R({props:{visitorLog:null},emits:["reload","update:modelValue"],setup(b,{emit:r}){const a=b,e=X(),{t:n}=W(),f=S(!0),p=S({permitLimit:10,withinSeconds:3}),u=S({permitLimit:10,withinSeconds:3}),d=S(e.site.accessLimitSettings.ipBlacklist.some($=>$==a.visitorLog.clientIP)),L=e.site.rateLimitSettings.ipLimits[a.visitorLog.clientIP],E=S(!!L);L&&(p.value.permitLimit=L.permitLimit,p.value.withinSeconds=L.withinSeconds);const I=S(a.visitorLog.userAgent),x=S(a.visitorLog.userAgent),A=e.site.accessLimitSettings.blockUserAgentKeywords.find($=>a.visitorLog.userAgent.indexOf($)>-1),c=Object.keys(e.site.rateLimitSettings.userAgentLimits).find($=>a.visitorLog.userAgent.indexOf($)>-1);A&&(I.value=A),c&&(x.value=c,u.value.permitLimit=e.site.rateLimitSettings.userAgentLimits[c].permitLimit,u.value.withinSeconds=e.site.rateLimitSettings.userAgentLimits[c].withinSeconds);const _=S(!!A),k=S(!!c),T=()=>N(this,null,function*(){d.value&&!e.site.accessLimitSettings.ipBlacklist.find($=>$==a.visitorLog.clientIP)?(e.site.accessLimitSettings.ipBlacklist.push(a.visitorLog.clientIP),e.site.accessLimitSettings.enable=!0):d.value||(e.site.accessLimitSettings.ipBlacklist=e.site.accessLimitSettings.ipBlacklist.filter($=>$!=a.visitorLog.clientIP)),E.value?(e.site.rateLimitSettings.ipLimits[a.visitorLog.clientIP]=p.value,e.site.rateLimitSettings.enable=!0):delete e.site.rateLimitSettings.ipLimits[a.visitorLog.clientIP],_.value&&I.value&&!e.site.accessLimitSettings.blockUserAgentKeywords.find($=>$==I.value)?(e.site.accessLimitSettings.blockUserAgentKeywords.push(I.value),e.site.accessLimitSettings.enable=!0):_.value||(e.site.accessLimitSettings.blockUserAgentKeywords=e.site.accessLimitSettings.blockUserAgentKeywords.filter($=>$!=I.value)),k.value&&x.value?(e.site.rateLimitSettings.userAgentLimits[x.value]=u.value,e.site.rateLimitSettings.enable=!0):delete e.site.rateLimitSettings.userAgentLimits[x.value],f.value=!1,r("reload"),yield ve(e.site),e.loadSite()});return($,y)=>{const O=be,z=ye,B=ke,q=Le,U=he,o=ne,C=ie;return i(),w("div",null,[l(C,{"model-value":f.value,width:"600px","close-on-click-modal":!1,title:t(n)("common.accessLimitSettings"),onClosed:y[11]||(y[11]=g=>r("update:modelValue",!1))},{footer:s(()=>[l(ae,{"confirm-label":t(n)("common.save"),onConfirm:T,onCancel:y[10]||(y[10]=g=>f.value=!1)},null,8,["confirm-label"])]),default:s(()=>[l(o,{"label-position":"top"},{default:s(()=>[l(B,{label:t(n)("common.rateLimit")},{default:s(()=>[t(e).site.rateLimitSettings.limitAllRequest?(i(),w("div",Me,[l(U,{title:t(n)("commmon.limitAllRequestTip"),type:"warning",closable:!1},null,8,["title"])])):(i(),w("div",Oe,[m("div",null,[l(O,{modelValue:E.value,"onUpdate:modelValue":y[0]||(y[0]=g=>E.value=g),label:`${t(n)("common.limit")} ${b.visitorLog.clientIP} ${t(n)("common.request")}`},null,8,["modelValue","label"]),E.value?(i(),w("div",qe,[l(B,{label:t(n)("common.withinSeconds")},{default:s(()=>[l(z,{modelValue:p.value.withinSeconds,"onUpdate:modelValue":y[1]||(y[1]=g=>p.value.withinSeconds=g),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(B,{label:t(n)("common.permitLimit")},{default:s(()=>[l(z,{modelValue:p.value.permitLimit,"onUpdate:modelValue":y[2]||(y[2]=g=>p.value.permitLimit=g),min:1},null,8,["modelValue"])]),_:1},8,["label"])])):V("",!0)]),m("div",je,[l(O,{modelValue:k.value,"onUpdate:modelValue":y[3]||(y[3]=g=>k.value=g),label:`${t(n)("common.limit")} ${t(n)("common.userAgent")}`},null,8,["modelValue","label"]),k.value?(i(),h(q,{key:0,modelValue:x.value,"onUpdate:modelValue":y[4]||(y[4]=g=>x.value=g),modelModifiers:{trim:!0},type:"textarea",rows:3},null,8,["modelValue"])):V("",!0),k.value?(i(),w("div",Fe,[l(B,{label:t(n)("common.withinSeconds")},{default:s(()=>[l(z,{modelValue:u.value.withinSeconds,"onUpdate:modelValue":y[5]||(y[5]=g=>u.value.withinSeconds=g),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(B,{label:t(n)("common.permitLimit")},{default:s(()=>[l(z,{modelValue:u.value.permitLimit,"onUpdate:modelValue":y[6]||(y[6]=g=>u.value.permitLimit=g),min:1},null,8,["modelValue"])]),_:1},8,["label"])])):V("",!0)])]))]),_:1},8,["label"]),l(B,{label:t(n)("common.forbidden")},{default:s(()=>[m("div",He,[m("div",null,[l(O,{modelValue:d.value,"onUpdate:modelValue":y[7]||(y[7]=g=>d.value=g),label:`${t(n)("common.forbidden")} ${b.visitorLog.clientIP} ${t(n)("common.request")}`},null,8,["modelValue","label"])]),m("div",Ze,[l(O,{modelValue:_.value,"onUpdate:modelValue":y[8]||(y[8]=g=>_.value=g),label:`${t(n)("common.forbidden")} ${t(n)("common.userAgent")}`},null,8,["modelValue","label"]),_.value?(i(),h(q,{key:0,modelValue:I.value,"onUpdate:modelValue":y[9]||(y[9]=g=>I.value=g),modelModifiers:{trim:!0},type:"textarea",rows:3},null,8,["modelValue"])):V("",!0)])])]),_:1},8,["label"])]),_:1})]),_:1},8,["model-value","title"])])}}}),pe=R({emits:["update:modelValue"],setup(b,{emit:r}){Se();const{t:a}=W(),e=S(!0),n=()=>N(this,null,function*(){e.value=!1,we()});return(f,p)=>{const u=ne,d=ie;return i(),w("div",null,[l(d,{"model-value":e.value,width:"600px","close-on-click-modal":!1,title:t(a)("common.requestAccessLimit"),onClosed:p[1]||(p[1]=L=>r("update:modelValue",!1))},{footer:s(()=>[l(ae,{"confirm-label":t(a)("common.save"),onConfirm:n,onCancel:p[0]||(p[0]=L=>e.value=!1)},null,8,["confirm-label"])]),default:s(()=>[l(u,{"label-position":"top"},{default:s(()=>[l($e)]),_:1})]),_:1},8,["model-value","title"])])}}}),Ge={"data-cy":"ip"},Je=["title","href"],Qe={"data-cy":"start-time"},Xe={class:"space-y-4"},Ye={key:0},et={class:"mr-4"},tt={class:"mr-4"},lt={key:1},ot=["title"],st={key:0,class:"text-s flex space-x-4 items-center"},at=["title"],nt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S(),n=X(),f=le(),p=S(!1),u=S(!1),d=S(),L=c=>N(this,null,function*(){e.value=yield De(r.week,c)}),E=c=>oe(ee(n.site.baseUrl,c));function I(c){var _,k,T,$,y;return`${c.clientInfo.os||""} ${((_=c.clientInfo)==null?void 0:_.platform)||""} ${((T=(k=c.clientInfo)==null?void 0:k.application)==null?void 0:T.name)||""} ${((y=($=c.clientInfo)==null?void 0:$.application)==null?void 0:y.version)||""} ${(c==null?void 0:c.userAgent)||""}`}function x(c){if(!n.site.accessLimitSettings.enable)return!1;if(n.site.accessLimitSettings.ipBlacklist.includes(c.clientIP))return!0;for(const _ of n.site.accessLimitSettings.blockUserAgentKeywords)if(c.userAgent.indexOf(_)>-1)return!0;return!1}function A(c){if(!n.site.rateLimitSettings.enable)return!1;if(n.site.rateLimitSettings.limitAllRequest||n.site.rateLimitSettings.ipLimits[c.clientIP])return!0;for(const _ of Object.keys(n.site.rateLimitSettings.userAgentLimits))if(c.userAgent.indexOf(_)>-1)return!0;return!1}return F(()=>r.week,c=>{c&&L(1)},{immediate:!0}),(c,_)=>{var q;const k=Z,T=Q,$=re,y=ue,O=Q,z=ce,B=me;return i(),w("div",null,[e.value?(i(),h(t(H),{key:0,data:(q=e.value)==null?void 0:q.list,pagination:{currentPage:e.value.pageNr,pageCount:e.value.totalPages,pageSize:e.value.pageSize},onChange:L},{default:s(()=>{var U;return[l(k,{label:"IP",width:"140"},{default:s(({row:o})=>[m("span",Ge,v(o.clientIP),1)]),_:1}),(U=t(f).header)!=null&&U.isOnlineServer?(i(),w(M,{key:0},[l(k,{label:t(a)("common.state")},{default:s(({row:o})=>[o.state?(i(),h(T,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"state"},{default:s(()=>[P(v(o.state),1)]),_:2},1024)):V("",!0)]),_:1},8,["label"]),l(k,{label:t(a)("common.country")},{default:s(({row:o})=>[o.country?(i(),h(T,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"country"},{default:s(()=>[P(v(o.country),1)]),_:2},1024)):V("",!0)]),_:1},8,["label"])],64)):V("",!0),l(k,{label:t(a)("common.page")},{default:s(({row:o})=>[m("a",{title:o.url,class:"text-blue ellipsis",href:E(o.url),target:"_blank","data-cy":"page-url"},v(o.url),9,Je)]),_:1},8,["label"]),l(k,{label:t(a)("common.startTime"),width:"180"},{default:s(({row:o})=>[m("span",Qe,v(t(te)(o.begin)),1)]),_:1},8,["label"]),l(k,{label:t(a)("common.timeElapsed")},{default:s(({row:o})=>[l(y,{width:"auto",trigger:"hover",placement:"right","popper-style":"padding: 0;"},{reference:s(()=>[o.timeSpan?(i(),h(T,{key:0,type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(o.timeSpan)+" ms ",1)]),_:2},1024)):V("",!0)]),default:s(()=>[l($,{"max-height":"98vh","view-style":"padding: 12px;"},{default:s(()=>{var C;return[m("div",Xe,[(C=o.entries)!=null&&C.length?(i(),w("table",Ye,[m("tbody",null,[(i(!0),w(M,null,J(o.entries,(g,Y)=>(i(),w("tr",{key:Y},[m("td",null,[m("span",et,v(g.name),1)]),m("td",null,[m("span",tt,v(g.value),1)]),m("td",null,[l(T,{type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(new Date(g.endTime).getTime()-new Date(g.startTime).getTime())+" ms ",1)]),_:2},1024)])]))),128))])])):(i(),w("div",lt,v(t(a)("common.empty")),1))])]}),_:2},1024)]),_:2},1024)]),_:1},8,["label"]),l(k,{label:t(a)("common.referer")},{default:s(({row:o})=>[m("div",{class:"ellipsis",title:o.referer},v(o.refererHost),9,ot)]),_:1},8,["label"]),l(k,{label:t(a)("common.clientInfo")},{default:s(({row:o})=>{var C,g;return[o.clientInfo?(i(),w("div",st,[(g=(C=o.clientInfo)==null?void 0:C.application)!=null&&g.isWebBrowser?(i(),h(O,{key:0,round:"",size:"small"},{default:s(()=>[P(v(t(a)("common.webBrowser")),1)]),_:1})):V("",!0),m("div",{class:"ellipsis",title:I(o)},v(I(o)),9,at)])):V("",!0)]}),_:1},8,["label"]),l(k,{label:t(a)("common.size"),width:"120"},{default:s(({row:o})=>[m("span",null,v(t(G)(o.size)),1)]),_:1},8,["label"]),l(k,{width:"48"},{header:s(()=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[l(z,{class:"iconfont icon-a-setup hover:text-blue text-l","data-cy":"inline-editor",onClick:_[0]||(_[0]=j(o=>u.value=!0,["prevent"]))})]),_:1},8,["content"])]),default:s(({row:o})=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[x(o)?(i(),h(z,{key:0,class:"iconfont icon-delete4 text-orange text-l",onClick:j(C=>{d.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):A(o)?(i(),h(z,{key:1,class:"iconfont icon-Tips text-[#e6a23c] text-l",onClick:j(C=>{d.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):(i(),h(z,{key:2,class:"iconfont icon-a-setup hover:text-blue text-l",onClick:j(C=>{d.value=o,p.value=!0},["prevent"])},null,8,["onClick"]))]),_:2},1032,["content"])]),_:1})]}),_:1},8,["data","pagination"])):V("",!0),(i(),h(se,{to:"body"},[m("div",null,[p.value&&e.value?(i(),h(de,{key:0,modelValue:p.value,"onUpdate:modelValue":_[1]||(_[1]=U=>p.value=U),"visitor-log":d.value,onReload:_[2]||(_[2]=U=>L(e.value.pageNr))},null,8,["modelValue","visitor-log"])):V("",!0)]),m("div",null,[u.value?(i(),h(pe,{key:0,modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=U=>u.value=U)},null,8,["modelValue"])):V("",!0)])]))])}}}),it=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=()=>N(this,null,function*(){e.value=yield Pe(r.week)});return F(()=>r.week,f=>{f&&n()},{immediate:!0}),(f,p)=>{const u=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(u,{label:t(a)("common.name")},{default:s(({row:d})=>[P(v(d.name),1)]),_:1},8,["label"]),l(u,{label:t(a)("common.size")},{default:s(({row:d})=>[P(v(t(G)(d.size)),1)]),_:1},8,["label"]),l(u,{label:t(a)("visitorLog.views"),prop:"count"},null,8,["label"])]),_:1},8,["data"])}}}),rt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=()=>N(this,null,function*(){e.value=yield Be(r.week)});return F(()=>r.week,f=>{f&&n()},{immediate:!0}),(f,p)=>{const u=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(u,{label:"URL",prop:"name"}),l(u,{label:t(a)("visitorLog.views"),prop:"count"},null,8,["label"])]),_:1},8,["data"])}}}),ut={class:"flex items-center"},ct={class:"w-80px h-44px mr-24 flex items-center justify-center"},mt=["src"],dt=["title"],pt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=X(),f=()=>N(this,null,function*(){e.value=yield Ne(r.week)});return F(()=>r.week,p=>{p&&f()},{immediate:!0}),(p,u)=>{const d=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(d,{label:"URL"},{default:s(({row:L})=>[m("div",ut,[m("div",ct,[m("img",{src:t(ee)(t(n).site.baseUrl,L.thumbNail)},null,8,mt)]),m("span",{class:"text-l font-bold flex-1 ellipsis",title:L.name},v(L.name),9,dt)])]),_:1}),l(d,{label:t(a)("common.size")},{default:s(({row:L})=>[P(v(t(G)(L.size)),1)]),_:1},8,["label"]),l(d,{label:t(a)("visitorLog.views"),prop:"count",width:"100px",align:"center"},null,8,["label"])]),_:1},8,["data"])}}}),ft={class:"p-16 rounded-normal bg-fff dark:bg-444"},vt=R({setup(b){const r=S([]),a=S(!1),e=S({type:"bar",data:{labels:[],datasets:[{label:"PV",data:[],backgroundColor:["rgb(54, 162, 235,0.6)"]}]},options:{scales:{y:{beginAtZero:!0}}}});return(()=>N(this,null,function*(){if(r.value=yield Re(),r.value.length<16)for(let f=0;f<16-r.value.length;f++)e.value.data.labels.push(""),e.value.data.datasets[0].data.push(0);e.value.data.labels.push(...r.value.map(f=>f.name)),e.value.data.datasets[0].data.push(...r.value.map(f=>f.count)),a.value=!0}))(),(f,p)=>(i(),w("div",ft,[m("div",null,[l(Ie,{height:"180",options:e.value},null,8,["options"])])]))}}),_t={"data-cy":"ip"},gt=["href"],bt={"data-cy":"start-time"},yt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S(),n=f=>N(this,null,function*(){e.value=yield We(r.week,f)});return F(()=>r.week,f=>{f&&n(1)},{immediate:!0}),(f,p)=>{var d,L,E,I;const u=Z;return i(),h(t(H),{data:(d=e.value)==null?void 0:d.dataList,pagination:{currentPage:(L=e.value)==null?void 0:L.pageNr,pageCount:(E=e.value)==null?void 0:E.totalPages,pageSize:(I=e.value)==null?void 0:I.pageSize},onChange:n},{default:s(()=>[l(u,{label:"IP",width:"140"},{default:s(({row:x})=>[m("span",_t,v(x.clientIP),1)]),_:1}),l(u,{label:"URL"},{default:s(({row:x})=>[m("a",{class:"text-blue ellipsis",href:x.previewUrl,target:"_blank"},v(x.url),9,gt)]),_:1}),l(u,{label:t(a)("common.startTime"),width:"180"},{default:s(({row:x})=>[m("span",bt,v(t(te)(x.startTime)),1)]),_:1},8,["label"]),l(u,{label:t(a)("common.message"),prop:"message"},null,8,["label"]),l(u,{label:t(a)("common.status"),prop:"statusCode"},null,8,["label"])]),_:1},8,["data","pagination"])}}}),kt={"data-cy":"ip"},Lt=["title","href"],ht={"data-cy":"start-time"},St={class:"space-y-4"},$t={key:0},wt={class:"mr-4"},xt={class:"mr-4"},Vt={key:1},It=["title"],At={key:0,class:"text-s flex space-x-4 items-center"},Ct=["title"],Et=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S(),n=X(),f=le(),p=S(!1),u=S(!1),d=S(),L=c=>N(this,null,function*(){e.value=yield Ke(r.week,c)}),E=c=>oe(ee(n.site.baseUrl,c));function I(c){var _,k,T,$,y;return`${c.clientInfo.os||""} ${((_=c.clientInfo)==null?void 0:_.platform)||""} ${((T=(k=c.clientInfo)==null?void 0:k.application)==null?void 0:T.name)||""} ${((y=($=c.clientInfo)==null?void 0:$.application)==null?void 0:y.version)||""} ${(c==null?void 0:c.userAgent)||""}`}function x(c){if(!n.site.accessLimitSettings.enable)return!1;if(n.site.accessLimitSettings.ipBlacklist.includes(c.clientIP))return!0;for(const _ of n.site.accessLimitSettings.blockUserAgentKeywords)if(c.userAgent.indexOf(_)>-1)return!0;return!1}function A(c){if(!n.site.rateLimitSettings.enable)return!1;if(n.site.rateLimitSettings.limitAllRequest||n.site.rateLimitSettings.ipLimits[c.clientIP])return!0;for(const _ of Object.keys(n.site.rateLimitSettings.userAgentLimits))if(c.userAgent.indexOf(_)>-1)return!0;return!1}return F(()=>r.week,c=>{c&&L(1)},{immediate:!0}),(c,_)=>{var q;const k=Z,T=Q,$=re,y=ue,O=Q,z=ce,B=me;return i(),w(M,null,[e.value?(i(),h(t(H),{key:0,data:(q=e.value)==null?void 0:q.list,pagination:{currentPage:e.value.pageNr,pageCount:e.value.totalPages,pageSize:e.value.pageSize},onChange:L},{default:s(()=>{var U;return[l(k,{label:"IP",width:"140"},{default:s(({row:o})=>[m("span",kt,v(o.clientIP),1)]),_:1}),(U=t(f).header)!=null&&U.isOnlineServer?(i(),w(M,{key:0},[l(k,{label:t(a)("common.state")},{default:s(({row:o})=>[o.state?(i(),h(T,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"state"},{default:s(()=>[P(v(o.state),1)]),_:2},1024)):V("",!0)]),_:1},8,["label"]),l(k,{label:t(a)("common.country")},{default:s(({row:o})=>[o.country?(i(),h(T,{key:0,type:"success",size:"small",class:"rounded-full","data-cy":"country"},{default:s(()=>[P(v(o.country),1)]),_:2},1024)):V("",!0)]),_:1},8,["label"])],64)):V("",!0),l(k,{label:t(a)("common.page")},{default:s(({row:o})=>[m("a",{title:o.url,class:"text-blue ellipsis",href:E(o.url),target:"_blank","data-cy":"page-url"},v(o.url),9,Lt)]),_:1},8,["label"]),l(k,{label:t(a)("common.startTime"),width:"180"},{default:s(({row:o})=>[m("span",ht,v(t(te)(o.begin)),1)]),_:1},8,["label"]),l(k,{label:t(a)("common.timeElapsed")},{default:s(({row:o})=>[l(y,{width:"auto",trigger:"hover",placement:"right","popper-style":"padding: 0;"},{reference:s(()=>[o.timeSpan?(i(),h(T,{key:0,type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(o.timeSpan)+" ms ",1)]),_:2},1024)):V("",!0)]),default:s(()=>[l($,{"max-height":"98vh","view-style":"padding: 12px;"},{default:s(()=>{var C;return[m("div",St,[(C=o.entries)!=null&&C.length?(i(),w("table",$t,[m("tbody",null,[(i(!0),w(M,null,J(o.entries,(g,Y)=>(i(),w("tr",{key:Y},[m("td",null,[m("span",wt,v(g.name),1)]),m("td",null,[m("span",xt,v(g.value),1)]),m("td",null,[l(T,{type:"success",size:"small",class:"rounded-full cursor-pointer","data-cy":"time-elapsed"},{default:s(()=>[P(v(new Date(g.endTime).getTime()-new Date(g.startTime).getTime())+" ms ",1)]),_:2},1024)])]))),128))])])):(i(),w("div",Vt,v(t(a)("common.empty")),1))])]}),_:2},1024)]),_:2},1024)]),_:1},8,["label"]),l(k,{label:t(a)("common.referer")},{default:s(({row:o})=>[m("div",{class:"ellipsis",title:o.referer},v(o.refererHost),9,It)]),_:1},8,["label"]),l(k,{label:t(a)("common.clientInfo")},{default:s(({row:o})=>{var C,g;return[o.clientInfo?(i(),w("div",At,[(g=(C=o.clientInfo)==null?void 0:C.application)!=null&&g.isWebBrowser?(i(),h(O,{key:0,round:"",size:"small"},{default:s(()=>[P(v(t(a)("common.webBrowser")),1)]),_:1})):V("",!0),m("div",{class:"ellipsis",title:I(o)},v(I(o)),9,Ct)])):V("",!0)]}),_:1},8,["label"]),l(k,{label:t(a)("common.size"),width:"120"},{default:s(({row:o})=>[m("span",null,v(t(G)(o.size)),1)]),_:1},8,["label"]),l(k,{width:"48"},{header:s(()=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[l(z,{class:"iconfont icon-a-setup hover:text-blue text-l","data-cy":"inline-editor",onClick:_[0]||(_[0]=j(o=>u.value=!0,["prevent"]))})]),_:1},8,["content"])]),default:s(({row:o})=>[l(B,{placement:"top",content:t(a)("common.accessLimitSettings")},{default:s(()=>[x(o)?(i(),h(z,{key:0,class:"iconfont icon-delete4 text-orange text-l",onClick:j(C=>{d.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):A(o)?(i(),h(z,{key:1,class:"iconfont icon-Tips text-[#e6a23c] text-l",onClick:j(C=>{d.value=o,p.value=!0},["prevent"])},null,8,["onClick"])):(i(),h(z,{key:2,class:"iconfont icon-a-setup hover:text-blue text-l",onClick:j(C=>{d.value=o,p.value=!0},["prevent"])},null,8,["onClick"]))]),_:2},1032,["content"])]),_:1})]}),_:1},8,["data","pagination"])):V("",!0),m("div",null,[(i(),h(se,{to:"body"},[m("div",null,[p.value&&e.value?(i(),h(de,{key:0,modelValue:p.value,"onUpdate:modelValue":_[1]||(_[1]=U=>p.value=U),"visitor-log":d.value,onReload:_[2]||(_[2]=U=>L(e.value.pageNr))},null,8,["modelValue","visitor-log"])):V("",!0)]),m("div",null,[u.value?(i(),h(pe,{key:0,modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=U=>u.value=U)},null,8,["modelValue"])):V("",!0)])]))])],64)}}}),Tt=R({props:{week:null},setup(b){const r=b,{t:a}=W(),e=S([]),n=()=>N(this,null,function*(){e.value=yield ze(r.week)});return F(()=>r.week,f=>{f&&n()},{immediate:!0}),(f,p)=>{const u=Z;return i(),h(t(H),{data:e.value},{default:s(()=>[l(u,{label:t(a)("common.name")},{default:s(({row:d})=>[P(v(d.name),1)]),_:1},8,["label"]),l(u,{label:t(a)("common.size")},{default:s(({row:d})=>[P(v(t(G)(d.size)),1)]),_:1},8,["label"]),l(u,{label:t(a)("visitorLog.views"),prop:"count"},null,8,["label"])]),_:1},8,["data"])}}}),Ut={class:"p-24"},Pt={class:"absolute top-16 right-24"},zt={class:"text-black dark:text-fff/86 mr-12"},Zl=R({setup(b){const{t:r}=W(),a=S([]),e=S(),n=S(!0);Ue().then(u=>{a.value=u.sort((d,L)=>{const E=d.split("-").map(x=>parseInt(x)),I=L.split("-").map(x=>parseInt(x));return E[0]===I[0]?I[1]-E[1]:I[0]-E[0]}),e.value=u[0]});const f=[{displayName:r("common.visitors"),value:"All",component:nt,showWeek:!0},{displayName:r("common.topPages"),value:"topPages",component:it,showWeek:!0},{displayName:r("common.topReferer"),value:"topReferer",component:rt,showWeek:!0},{displayName:r("common.topImages"),value:"topImages",component:pt,showWeek:!0},{displayName:r("common.chart"),value:"chart",component:vt,showWeek:!1},{displayName:r("common.errorList"),value:"errorList",component:yt,showWeek:!0},{displayName:r("common.bots"),value:"botList",component:Et,showWeek:!0},{displayName:r("common.topBots"),value:"topBots",component:Tt,showWeek:!0}],p=S(f[0].value);return F(()=>p.value,()=>{n.value=f.find(u=>u.value===p.value).showWeek}),(u,d)=>{const L=xe,E=Ve,I=Ee,x=Te;return i(),w("div",null,[m("div",Ut,[l(Ae,{name:t(r)("common.visitorLogs")},null,8,["name"]),_e(m("div",Pt,[m("span",zt,v(t(r)("common.week")),1),l(E,{modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=A=>e.value=A),class:"w-240px"},{default:s(()=>[(i(!0),w(M,null,J(a.value,A=>(i(),h(L,{key:A,value:A,label:t(Ce)(A),"data-cy":"week-opt"},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])],512),[[fe,n.value]])]),l(x,{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=A=>p.value=A)},{default:s(()=>[(i(),w(M,null,J(f,A=>l(I,{key:A.value,label:A.displayName,name:A.value},{default:s(()=>[p.value===A.value&&e.value?(i(),h(ge(A.component),{key:0,week:e.value},null,8,["week"])):V("",!0)]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}});export{Zl as default};
