var de=Object.defineProperty,ce=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var R=(o,e,a)=>e in o?de(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a,Q=(o,e)=>{for(var a in e||(e={}))pe.call(e,a)&&R(o,a,e[a]);if(N)for(var a of N(e))fe.call(e,a)&&R(o,a,e[a]);return o},G=(o,e)=>ce(o,me(e));var A=(o,e,a)=>new Promise((n,l)=>{var v=y=>{try{m(a.next(y))}catch(b){l(b)}},f=y=>{try{m(a.throw(y))}catch(b){l(b)}},m=y=>y.done?n(y.value):Promise.resolve(y.value).then(v,f);m((a=a.apply(o,e)).next())});import{b as ye,_ as ve,a as be,c as he,d as ge,e as Se}from"./basic.f0527be6.js";import{t as Ee,b as Ve}from"./replace-all.56d2c1f7.js";import{g as Y}from"./i18n.a87944a4.js";import{E as ke}from"./index.178b9e08.js";import{E as Ue}from"./windi.6360286d.js";import{E as _e}from"./index.361e2245.js";import{g as x,c as L,cd as Te,N as Ce,au as M,d as Z,i as Me,o as E,a as I,F as $,b7 as ee,b as S,u as t,f as Be,w as V,j as C,k as z,r as Ie}from"./url.4cb47a7a.js";import{j as K,k as F,m as xe,n as te,c as we}from"./style.c350d462.js";import{K as ne,L as le,a as Pe}from"./dev-mode.acf56c3e.js";import{g as oe,u as Ae}from"./main.9fdfea92.js";import{n as ae}from"./guid.c1a40312.js";import{r as Le}from"./index.30c55a10.js";import{E as qe,a as De}from"./index.ac10ee42.js";import{E as He}from"./index.6918f0a5.js";import{E as $e,a as Fe}from"./index.9fd79879.js";function Ke(o){const e=[];if(!o)return e;const a=ne(),n=K(o,["link","style"]);for(const l of n){if(F(l,"link")){const v=l.getAttribute("rel"),f=l.getAttribute("href");if(v==="stylesheet"&&f){const m=a.all.find(y=>y.href===f);m&&e.push({el:l,content:m.name,id:m.id})}}F(l,"style")&&e.push({el:l,content:l.innerHTML,id:ae()})}return e}function Oe(o){const e=[];if(!o)return e;const a=le(),n=K(o,["script"]);for(const l of n){const v=l.getAttribute("src");if(v){const f=a.all.find(m=>m.href===v);f&&e.push({el:l,content:f.name,id:f.id,position:J(l)})}else e.push({el:l,content:l.innerHTML,id:ae(),position:J(l)})}return e}function je(o,e){const a=[];if(!o||!e)return a;const n=oe();for(const l of K(o,["meta"])){const v=l.getAttribute("charset"),f=l.getAttribute("property"),m=l.getAttribute("http-equiv"),y=l.getAttribute("name"),b=l.getAttribute("content");if(v){let i=e.find(h=>!!h.charset);i?(i.charset=v,i.el=l):i={charset:v,el:l},a.push(i)}if(m&&b){let i=e.find(h=>h.httpequiv===m);i?(i.content||(i.content={}),i.el=l):(i={httpequiv:m,content:{},el:l},i.content[n.default]=b),a.push(i)}if(y&&b){let i=e.find(h=>h.name===y);i?(i.content||(i.content={}),i.el=l):(i={name:y,content:{},el:l},i.content[n.default]=b),a.push(i)}if(f&&b){let i=e.find(h=>h.property===f);i?(i.content||(i.content={}),i.el=l):(i={property:f,content:{},el:l},i.content[n.default]=b),a.push(i)}}return a}function J(o){return xe(o).some(e=>F(e,"head"))?"head":"body"}const Ne=ne(),Re=le(),se=Pe(),U=x(),u=x(),Qe=L(()=>u.value?te(u.value):""),H=L(()=>Ke(u.value)),W=L(()=>Oe(u.value)),X=L(()=>{var o;return je(u.value,(o=U.value)==null?void 0:o.metas)});function Ge(o,e,a){u.value.body.innerHTML=Le(o,e!=null?e:!1,a)}function ze(o){let e=u.value.head.querySelector("#designer-page-style");if(o){if(!e){e=document.createElement("style"),e.setAttribute("id","designer-page-style"),e.innerHTML=o,u.value.head.appendChild(e);return}e.innerHTML=o;return}e&&u.value.head.removeChild(e)}function Je(o,e){return A(this,null,function*(){var n,l;const a=yield se.getPage(o,e);a.urlPath=(n=a.urlPath)!=null?n:"",a.name=(l=a.name)!=null?l:"",U.value=a,u.value=we(U.value.body)})}function We(){const o=Te(),e=Ce(),a=s=>{const p=H.value[s.oldIndex],c=H.value[s.newIndex].el;c!=null&&c.parentElement&&c.parentElement.insertBefore(p.el,s.oldIndex>s.newIndex?c:c.nextElementSibling),M(u)},n=s=>{if(!u.value)return;const p=Ne.all.find(c=>c.id===s);if(p){const c=u.value.createElement("link");c.rel="stylesheet",c.href=p.href,u.value.head.appendChild(c),M(u)}},l=(s,p)=>{const c=W.value.filter(q=>q.position===p),g=c[s.oldIndex],T=c[s.newIndex].el;T.parentElement&&T.parentElement.insertBefore(g.el,s.oldIndex>s.newIndex?T:T.nextElementSibling),M(u)},v=(s,p)=>{if(!u.value)return;const c=Re.all.find(g=>g.id===s);if(c){const g=u.value.createElement("script");g.src=c.href,p==="head"?u.value.head.appendChild(g):u.value.body.appendChild(g),M(u)}},f=s=>{!u.value||(s.remove(),M(u))},m=(s,p)=>{!u.value||(p&&p.parentElement?p.parentElement.insertBefore(s,p):u.value.head.appendChild(s),M(u))};return{init:Je,setBody:Ge,setPageStyle:ze,model:U,styles:H,scripts:W,metas:X,preview:Qe,sortStyle:a,insertStyle:n,sortScript:l,insertScript:v,deleteElement:f,insertElement:m,save:()=>A(this,null,function*(){if(!U.value||!u.value)return;U.value.body=te(u.value),U.value.metas=X.value;const s=yield se.updatePage(U.value);return o.replace({query:G(Q({},e.query),{id:s.id})}),s}),updateTitle:s=>{!u.value||(u.value.title=s)},addOrUpdateMeta:s=>{const p=oe(),c=ye(s,p.default);s.el&&c?(m(c,s.el),f(s.el)):c&&U.value&&(U.value.metas.push(s),m(c))},deleteMeta:s=>{s.el&&f(s.el)}}}const Xe={class:"px-24 py-16 space-y-4"},Ye=Z({props:{modelValue:null},emits:["update:modelValue"],setup(o,{emit:e}){const a=o,{t:n}=Y(),l=x(Ee(a.modelValue)),v=f=>{l.value.splice(f,1)};return Me(()=>l.value,()=>{e("update:modelValue",Ve(l.value))},{deep:!0}),(f,m)=>{const y=ke,b=Ue,i=_e;return E(),I("div",Xe,[(E(!0),I($,null,ee(l.value,(h,s)=>(E(),I("div",{key:s,class:"flex items-center space-x-4"},[S(y,{modelValue:h.key,"onUpdate:modelValue":p=>h.key=p,placeholder:t(n)("common.key"),"data-cy":"key"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),S(y,{modelValue:h.value,"onUpdate:modelValue":p=>h.value=p,placeholder:t(n)("common.value"),"data-cy":"value"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),Be("div",null,[S(i,{circle:"","data-cy":"remove",onClick:p=>v(s)},{default:V(()=>[S(b,{class:"text-orange iconfont icon-delete"})]),_:2},1032,["onClick"])])]))),128)),S(i,{circle:"","data-cy":"add",onClick:m[0]||(m[0]=h=>l.value.push({key:"",value:""}))},{default:V(()=>[S(b,{class:"text-blue iconfont icon-a-addto"})]),_:1})])}}}),yt=Z({props:{items:{default(){return["basic","HTMLMeta","parameters","style","scripts","cache"]}}},setup(o,{expose:e}){const a=o,{model:n,updateTitle:l,deleteElement:v,styles:f,sortStyle:m,insertStyle:y,scripts:b,sortScript:i,insertScript:h,metas:s,addOrUpdateMeta:p,deleteMeta:c}=We(),{t:g}=Y(),T=x("basic"),q=Ae(),w=x();return function(){var _,P;const r=(_=a.items)!=null?_:[];T.value=(P=r[0])!=null?P:"basic"}(),e({validate:()=>A(this,null,function*(){var B;if(Array.isArray(w.value))for(const r of w.value)yield r.validate();else yield(B=w.value)==null?void 0:B.validate()})}),(B,r)=>{const _=qe,P=He,re=$e,ie=Fe,ue=De;return t(n)?(E(),C(ue,{key:0,modelValue:T.value,"onUpdate:modelValue":r[15]||(r[15]=k=>T.value=k)},{default:V(()=>[(E(!0),I($,null,ee(o.items,k=>(E(),I($,{key:k},[k==="basic"?(E(),C(_,{key:0,name:"basic",title:t(g)("common.basic")},{default:V(()=>[S(ve,{ref_for:!0,ref_key:"basicForm",ref:w,url:t(n).urlPath,"onUpdate:url":r[0]||(r[0]=d=>t(n).urlPath=d),urls:t(n).urlPaths,"onUpdate:urls":r[1]||(r[1]=d=>t(n).urlPaths=d),titles:t(n).contentTitle,"onUpdate:titles":r[2]||(r[2]=d=>t(n).contentTitle=d),published:t(n).published,"onUpdate:published":r[3]||(r[3]=d=>t(n).published=d),"url-params-bindings":t(n).urlParamsBindings,"obj-id":t(n).id,"onUpdate:defaultTitle":t(l)},null,8,["url","urls","titles","published","url-params-bindings","obj-id","onUpdate:defaultTitle"])]),_:1},8,["title"])):k==="HTMLMeta"?(E(),C(_,{key:1,name:"HTMLMeta",title:t(g)("common.HTMLMeta")},{default:V(()=>[S(be,{list:t(s),onDelete:t(c),onAddOrUpdate:t(p)},null,8,["list","onDelete","onAddOrUpdate"])]),_:1},8,["title"])):k==="parameters"?(E(),C(_,{key:2,name:"parameters",title:t(g)("common.parameters")},{default:V(()=>[S(Ye,{modelValue:t(n).parameters,"onUpdate:modelValue":r[4]||(r[4]=d=>t(n).parameters=d)},null,8,["modelValue"])]),_:1},8,["title"])):k==="style"?(E(),C(_,{key:3,name:"style",title:t(g)("common.style")},{default:V(()=>{var d,O,j;return[S(he,{list:t(f),onSort:t(m),onInsert:t(y),onDelete:r[5]||(r[5]=D=>t(v)(D.el))},null,8,["list","onSort","onInsert"]),(j=(O=(d=t(q))==null?void 0:d.site)==null?void 0:O.unocssSettings)!=null&&j.enable?(E(),C(ie,{key:0,"label-position":"top",class:"px-24"},{default:V(()=>[S(re,{label:t(g)("common.disableUnocss")},{default:V(()=>[S(P,{modelValue:t(n).disableUnocss,"onUpdate:modelValue":r[6]||(r[6]=D=>t(n).disableUnocss=D)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})):z("",!0)]}),_:1},8,["title"])):k==="scripts"?(E(),C(_,{key:4,name:"scripts",title:t(g)("common.scripts")},{default:V(()=>[S(ge,{list:t(b),onSort:t(i),onDelete:r[7]||(r[7]=d=>t(v)(d.el)),onInsert:t(h)},null,8,["list","onSort","onInsert"])]),_:1},8,["title"])):k==="cache"?(E(),C(_,{key:5,name:"cache",title:t(g)("common.cache")},{default:V(()=>[S(Se,{enable:t(n).enableCache,"onUpdate:enable":r[8]||(r[8]=d=>t(n).enableCache=d),enableVersion:t(n).cacheByVersion,"onUpdate:enableVersion":r[9]||(r[9]=d=>t(n).cacheByVersion=d),enableCulture:t(n).cacheByCulture,"onUpdate:enableCulture":r[10]||(r[10]=d=>t(n).cacheByCulture=d),versionType:t(n).cacheVersionType,"onUpdate:versionType":r[11]||(r[11]=d=>t(n).cacheVersionType=d),enableDevice:t(n).cacheByDevice,"onUpdate:enableDevice":r[12]||(r[12]=d=>t(n).cacheByDevice=d),minutes:t(n).cacheMinutes,"onUpdate:minutes":r[13]||(r[13]=d=>t(n).cacheMinutes=d),queryKeys:t(n).cacheQueryKeys,"onUpdate:queryKeys":r[14]||(r[14]=d=>t(n).cacheQueryKeys=d)},null,8,["enable","enableVersion","enableCulture","versionType","enableDevice","minutes","queryKeys"])]),_:1},8,["title"])):Ie(B.$slots,k,{key:6})],64))),128))]),_:3},8,["modelValue"])):z("",!0)}}});export{yt as _,We as u};
