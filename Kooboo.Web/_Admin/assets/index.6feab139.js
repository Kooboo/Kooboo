var A=(_,d,s)=>new Promise((r,C)=>{var V=e=>{try{y(s.next(e))}catch(E){C(E)}},S=e=>{try{y(s.throw(e))}catch(E){C(E)}},y=e=>e.done?r(e.value):Promise.resolve(e.value).then(V,S);y((s=s.apply(_,d)).next())});import{_ as oe}from"./icon-button.e30c79ea.js";import{_ as ae}from"./k-table.f75c31cc.js";import{a as B}from"./replace-all.dd6016f2.js";import{d as M}from"./main.d8c6ef59.js";import{d as le,g as z,w as O,o as P}from"./i18n.2d8b30eb.js";import{u as ne}from"./use-date.28e9a8a3.js";import{u as ie}from"./use-operation-dialog.fbfa9343.js";import{e as re}from"./guid.c1a40312.js";import{a as F,r as ue,l as me,H as se}from"./validate.348f94d6.js";import{_ as de}from"./dev-mode.e5eea554.js";import{_ as ce}from"./index.ed88cf90.js";import{U as pe}from"./editor.main.d2800f63.js";import{E as fe}from"./index.21d7e739.js";import{E as ve}from"./index.bb5499e2.js";import{E as _e,a as ye}from"./index.a141884f.js";import{E as he,a as be}from"./index.ab4ed870.js";import{E as J}from"./windi.bf752d69.js";import{E as Q}from"./index.96970839.js";import{E as Ce}from"./index.a4ff385c.js";import{d as W,g as R,c as j,i as Ve,o as m,j as f,w as n,b as l,u as i,k as D,a as w,b6 as $,aH as x,t as v,F as N,f as U,G as ge,h as ke,b7 as we,e as Ee}from"./url.8f5ec20c.js";import{B as Ue}from"./breadcrumb.79da4f07.js";import{b as Ae}from"./confirm.617d359f.js";import{E as Ne}from"./index.bc06171b.js";import{c as $e}from"./cloneDeep.b77ba92c.js";import"./index.ec785feb.js";import"./focus-trap.3f074800.js";import"./isNil.98bb3b88.js";import"./event.53b2ad83.js";import"./index.a595fe6d.js";import"./index.e87fdc52.js";import"./index.0535d5fe.js";import"./sortable.esm.a99254e8.js";import"./index.14993118.js";import"./isEqual.c3e9e9f4.js";import"./_baseIsEqual.2f38f7c3.js";import"./error.7e8331f1.js";import"./index.4c9af567.js";import"./event.776e7e11.js";import"./index.0a83bb10.js";import"./index.50c16ae5.js";import"./preload-helper.13a99eb0.js";import"./dayjs.min.35b12e7a.js";import"./index.37979027.js";import"./index.3dc39d21.js";import"./index.832f2769.js";import"./index.b3e4ff8e.js";import"./index.5af167df.js";import"./style.ad574a57.js";import"./toNumber.6efebd6a.js";import"./index.8143a7f0.js";import"./classCompletion.a22e38a6.js";import"./userWorker.b3a6730b.js";import"./vuedraggable.umd.8a5464a3.js";import"./index.593106e3.js";import"./config.589cc0cd.js";import"./dark.7c26a0d3.js";import"./page.c26fc024.js";import"./index.80a4dc1a.js";import"./index.bf8ed8c6.js";import"./scroll.54c27fbd.js";import"./aria.75ec5909.js";import"./validator.1bcd6e6a.js";import"./index.35ae15db.js";import"./dropdown.d7a15792.js";import"./refs.d2253dd4.js";import"./use-copy-text.67d6617b.js";import"./index.68d24a68.js";import"./toggleComment.5b29ca87.js";import"./use-save-tip.ee41ca28.js";import"./index.745dc8e0.js";import"./index.b3d1cf25.js";import"./index.3be79fd5.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.5f2a659f.js";import"./index.06224119.js";import"./index.14aabd47.js";import"./alert.8fe5500a.js";import"./index.b4ac73b5.js";/* empty css                                                               */import"./media-list.vue_vue_type_style_index_0_scoped_true_lang.a31db113.js";/* empty css                                                          */import"./file.52d8e05a.js";/* empty css                                                          *//* empty css                                                                 */import"./use-file-upload.1cd07d1f.js";/* empty css                                                         */import"./image-editor.vue_vue_type_style_index_0_scoped_true_lang.7c6ede25.js";import"./image-editor.404a4df5.js";import"./main.esm.f3ac04a5.js";import"./index.a330b59f.js";import"./index.e3f90979.js";import"./_baseClone.29a8cd97.js";import"./debounce.730e1961.js";import"./index.b68af8a1.js";import"./plugin-vue_export-helper.41ffa612.js";import"./logo-transparent.1566007e.js";const X=le.global.t,xe=()=>M.get(B("Authentication/list")),Re=_=>M.post(B("Authentication/Deletes"),_,void 0,{successMessage:X("common.deleteSuccess")}),Se=_=>M.post(B("Authentication/post"),_,void 0,{successMessage:X("common.saveSuccess")}),Te=()=>M.get(B("Authentication/GetTypes")),qe=_=>M.get(B("Authentication/isUniqueName"),{name:_},{hiddenLoading:!0,hiddenError:!0}),De={class:"w-full space-y-4"},Be=W({props:{modelValue:{type:Boolean},current:null},emits:["save-success"],setup(_,{emit:d}){const s=_,{t:r}=z(),{visible:C,handleClose:V}=ie(s,d),S=()=>({id:re,name:"",matcher:"None",action:"None",failedAction:"None",customCodeName:"",customCode:`// sample code.. 
// if (k.request.url.indexOf('/api') == 0) {
//     var token = k.request.headers.get('Authorization');
//     if (token != 'abc123') k.response.unauthorized()
// }`,httpCode:401,url:"/",conditions:[]}),y=R(),e=R({}),E={name:[F(r("common.nameRequiredTips")),ue(1,50),me(),{asyncValidator(o,a,k){return A(this,null,function*(){try{yield qe(a),k()}catch(b){k(Error(r("common.valueHasBeenTakenTips")))}})},trigger:"blur"}],httpCode:[F(r("common.httpCodeRequiredTips")),se],url:[F(r("common.urlRequiredTips"))],options:[{validator(o,a,k){e.value.conditions.length===0?k(new Error(r("common.fieldRequiredTips"))):k()},trigger:"blur"}]},u=j(()=>!s.current),c=j(()=>{var o,a;return(u.value?r("common.create"):r("common.edit"))+((o=s.current)!=null&&o.name?": "+((a=s.current)==null?void 0:a.name):"")}),h=R();Ve(()=>s.modelValue,o=>A(this,null,function*(){var a;o&&(h.value||(h.value=yield Te()),(a=y.value)==null||a.resetFields(),s.current?e.value=s.current:e.value=S())}));function H(o){e.value.conditions.splice(o,1)}function g(){var o;e.value.conditions.push({left:"url",operator:"=",right:""}),(o=y.value)==null||o.clearValidate("options")}function I(){return A(this,null,function*(){var o;yield(o=y.value)==null?void 0:o.validate(),yield Se(e.value),V(),d("save-success")})}return(o,a)=>{const k=ve,b=_e,T=he,q=be,G=J,L=Q,Z=fe,ee=ye,te=Ce;return m(),f(te,{modelValue:i(C),"onUpdate:modelValue":a[11]||(a[11]=t=>ge(C)?C.value=t:null),width:"650px","close-on-click-modal":!1,title:i(c),onClose:i(V)},{footer:n(()=>[l(ce,{permission:{feature:"authentication",action:"edit"},onConfirm:I,onCancel:i(V)},null,8,["onCancel"])]),default:n(()=>[h.value?(m(),f(ee,{key:0,ref_key:"form",ref:y,rules:E,model:e.value,"label-position":"top",onSubmit:a[10]||(a[10]=O(()=>{},["prevent"])),onKeydown:P(I,["enter"])},{default:n(()=>[i(u)?(m(),f(b,{key:0,prop:"name",label:i(r)("common.name")},{default:n(()=>[l(k,{modelValue:e.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.name=t),"data-cy":"name"},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0),l(b,{prop:"matcher",label:i(r)("common.matcher")},{default:n(()=>[l(q,{modelValue:e.value.matcher,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.matcher=t),class:"w-full","data-cy":"matcher"},{default:n(()=>[(m(!0),w(N,null,$(h.value.matcher,t=>(m(),f(T,{key:t.name,value:t.name,"data-cy":"matcher-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.matcher==="Condition"?(m(),f(b,{key:1,prop:"options"},{default:n(()=>[U("div",De,[(m(!0),w(N,null,$(e.value.conditions,(t,K)=>(m(),w("div",{key:K,class:"flex items-center space-x-4"},[l(q,{modelValue:t.left,"onUpdate:modelValue":p=>t.left=p,class:"w-120px","data-cy":"condition-left"},{default:n(()=>[(m(),w(N,null,$(["url","method"],p=>l(T,{key:p,value:p,"data-cy":"condition-left-opt"},{default:n(()=>[x(v(p),1)]),_:2},1032,["value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(q,{modelValue:t.operator,"onUpdate:modelValue":p=>t.operator=p,class:"w-150px","data-cy":"condition-operater"},{default:n(()=>[(m(),w(N,null,$([{label:"=",value:"="},{label:"!=",value:"!="},{label:"Contains",value:"contains"},{label:"Not contains",value:"notcontains"},{label:"Starts with",value:"startwith"},{label:"Not starts with",value:"notstartwith"}],p=>l(T,{key:p.value,value:p.value,label:p.label,"data-cy":"condition-operater-opt"},null,8,["value","label"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(b,{prop:"conditions."+K+".right",rules:i(F)(i(r)("common.valueRequiredTips"))},{default:n(()=>[l(k,{modelValue:t.right,"onUpdate:modelValue":p=>t.right=p,"data-cy":"condition-right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),U("div",null,[l(L,{circle:"","data-cy":"remove-condition",onClick:p=>H(K)},{default:n(()=>[l(G,{class:"iconfont icon-delete text-orange"})]),_:2},1032,["onClick"])])]))),128)),l(L,{circle:"",onClick:a[2]||(a[2]=t=>g())},{default:n(()=>[l(G,{class:"iconfont icon-a-addto text-blue","data-cy":"add-condition"})]),_:1})])]),_:1})):D("",!0),l(b,{prop:"action",label:i(r)("common.action")},{default:n(()=>[l(q,{modelValue:e.value.action,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.action=t),class:"w-full","data-cy":"action"},{default:n(()=>[(m(!0),w(N,null,$(h.value.action,t=>(m(),f(T,{key:t.name,value:t.name,"data-cy":"action-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.action==="CustomCode"?(m(),f(b,{key:2,prop:"customCodeName",label:i(r)("common.code")},{default:n(()=>[l(de,{modelValue:e.value.customCode,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.customCode=t),class:"h-200px",language:"typescript","k-script":"",uri:i(pe).file(e.value.id),onKeydown:a[5]||(a[5]=P(O(()=>{},["stop"]),["enter"]))},null,8,["modelValue","uri"])]),_:1},8,["label"])):(m(),w(N,{key:3},[l(b,{prop:"failedAction",label:i(r)("common.failedAction")},{default:n(()=>[l(q,{modelValue:e.value.failedAction,"onUpdate:modelValue":a[6]||(a[6]=t=>e.value.failedAction=t),class:"w-full","data-cy":"failed-action"},{default:n(()=>[(m(!0),w(N,null,$(h.value.failedAction,t=>(m(),f(T,{key:t.name,value:t.name,"data-cy":"failed-action-opt"},{default:n(()=>[x(v(t.display),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e.value.failedAction==="ResultCode"?(m(),f(b,{key:0,prop:"httpCode",label:i(r)("common.httpCode")},{default:n(()=>[l(Z,{modelValue:e.value.httpCode,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value.httpCode=t),placeholder:i(r)("common.httpCode"),"data-cy":"http-code"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):D("",!0),e.value.failedAction==="Redirect"?(m(),f(b,{key:1,prop:"url",label:i(r)("common.url")},{default:n(()=>[l(k,{modelValue:e.value.url,"onUpdate:modelValue":a[8]||(a[8]=t=>e.value.url=t),"data-cy":"redirect-url",onInput:a[9]||(a[9]=t=>e.value.url=e.value.url.replace(/\s+/g,""))},null,8,["modelValue"])]),_:1},8,["label"])):D("",!0)],64))]),_:1},8,["model","onKeydown"])):D("",!0)]),_:1},8,["modelValue","title","onClose"])}}}),Me={class:"p-24"},Ie={class:"flex items-center py-24 space-x-16"},Fe=["title"],He={"data-cy":"matcher"},Ke={"data-cy":"action"},Ge={"data-cy":"failed-action"},Le={class:"ellipsis","data-cy":"parameters"},qo=W({setup(_){const{t:d}=z(),s=R([]),r=R(!1),C=R();ke(()=>{V()});function V(){return A(this,null,function*(){s.value=(yield xe()).sort((u,c)=>u.lastModified>c.lastModified?-1:1)})}function S(u){return u.action==="CustomCode"?u.customCode+"":u.failedAction==="ResultCode"?u.httpCode+"":u.failedAction==="Redirect"?u.url:""}function y(u){return u.matcher!=="Condition"?u.matcher:u.conditions.map(c=>`${c.left} ${c.operator} '${c.right}'`).join(" && ")}function e(u){return A(this,null,function*(){yield Ae(u.length);const c=u.map(h=>h.id);yield Re({ids:c}),V()})}function E(u){return A(this,null,function*(){C.value=u?$e(u):void 0,r.value=!0})}return(u,c)=>{const h=J,H=Q,g=Ne,I=oe,Y=we("hasPermission");return m(),w("div",Me,[l(Ue,{name:i(d)("common.authentication")},null,8,["name"]),U("div",Ie,[Ee((m(),f(H,{round:"","data-cy":"create",onClick:c[0]||(c[0]=o=>E())},{default:n(()=>[l(h,{class:"iconfont icon-a-addto"}),x(" "+v(i(d)("common.create")),1)]),_:1})),[[Y,{feature:"authentication",action:"edit"}]])]),l(i(ae),{data:s.value,"show-check":"",permission:{feature:"authentication",action:"delete"},onDelete:e},{default:n(()=>[l(g,{label:i(d)("common.name"),width:"150"},{default:n(({row:o})=>[U("span",{class:"ellipsis",title:o.name,"data-cy":"name"},v(o.name),9,Fe)]),_:1},8,["label"]),l(g,{label:i(d)("common.matcher")},{default:n(({row:o})=>[U("span",He,v(y(o)),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.action"),width:"150"},{default:n(({row:o})=>[U("span",Ke,v(o.action),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.failedAction"),width:"150"},{default:n(({row:o})=>[U("span",Ge,v(o.action==="CustomCode"?"CustomCode":o.failedAction),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.parameters"),width:"180"},{default:n(({row:o})=>[U("div",Le,v(S(o)),1)]),_:1},8,["label"]),l(g,{label:i(d)("common.lastModified"),width:"180"},{default:n(({row:o})=>[x(v(i(ne)(o.lastModified)),1)]),_:1},8,["label"]),l(g,{width:"70",align:"right"},{default:n(({row:o})=>[l(I,{icon:"icon-a-setup",tip:i(d)("common.setting"),"data-cy":"setting",onClick:a=>E(o)},null,8,["tip","onClick"])]),_:1})]),_:1},8,["data"]),l(Be,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=o=>r.value=o),current:C.value,onSaveSuccess:V},null,8,["modelValue","current"])])}}});export{qo as default};
